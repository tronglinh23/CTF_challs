var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},WSB;(function(n){var t="pp_",i=100,r=200,u=function(){function u(t,i){var r=this;this._page=t;this._sections=[];this._selectedItemIndex=-1;this._itemClickEventHandler=function(t,i){var r=document.getSelection();r.toString()&&r.focusNode==i.target||t.click(n.getCurrentTime(),n.getInputType(i))};this._contextMenuHandler=function(t,u,f){u&&(u.pageX||u.pageY)?n.safeExecute(function(){return i.showContextMenuOnXY(t,u.pageX,u.pageY,function(){return r.focus(!1)},n.getInputType(u),f)},"contextMenuHandler"):n.safeExecute(function(){return i.showContextMenuOnElement(t,f?_ge(f.id):_ge(t.id),function(){return r.focus(!1)},u?n.getInputType(u):0,f)},"contextMenuHandler")};n.Host.bindSearchBoxGotFocus(function(){r.blur()});n.Host.bindKeyDown(function(n){r.hasFocus()&&(n==36||n==35)&&r.selectFirstOrLastItem(n==36)})}return u.prototype.init=function(t){var i=this;this._previewPaneViewModelParent=t;this._suggestionClickEventHandler=function(t,r){var u=n.getCurrentTime(),f=n.getInputType(r);i._previewPaneViewModelParent.onBeforeItemLaunch(u,f,4,null);t.click(u,f);i._previewPaneViewModelParent.onAfterItemLaunch(4)}},u.prototype.finalizeKeystroke=function(){this.instrumentOnPreviewPaneRendered(!1,!0)},u.prototype.instrumentOnPreviewPaneRendered=function(n,t){if(this._timestampFirstRender&&this._onPreviewPaneRendered){var i={firstRenderTS:this._timestampFirstRender,layout:this.getLayoutDataForPPRenderedInstrumentation()};this._onPreviewPaneRendered(t,!n,i)}},u.prototype.update=function(t,i,r,u,f,e,o){var s=this;this._currentCallValid&&(this._currentCallValid.valid=!1);f&&(o||(this.instrumentOnPreviewPaneRendered(!1,!0),this._timestampFirstRender=null,this._settingsOnlineModules=[],this._settingsOnlineModulesRetrieved=!1),this._onPreviewPaneRendered=f);this._previewPaneId=u;this._previewedSuggestion=t;this._sections=[];this._hasPreviewIconBeenSet=!1;this._haveActionsBeenFetched=!1;this._sectionRetrieved_jumplist=!1;this._sectionRetrieved_settingsFaq=!1;this._sectionRetrieved_settingsRelatedSettings=!1;this._allSectionsRetrieved=function(){return s._sectionRetrieved_jumplist&&s._sectionRetrieved_settingsFaq&&s._sectionRetrieved_settingsRelatedSettings};var l=o&&this.hasFocus(),h=function(t){s._previewPaneViewModelParent.onResponseReceived(n.getCurrentTime());t?s.delayedRender():s.render();(s._previewPaneViewModelParent.focusPending||l)&&(s._previewPaneViewModelParent.focusPending=!1,s.focus(!1))},c={valid:!0};this._currentCallValid=c;t&&this.updateSelection(t,i,function(){return c.valid},function(){return h(!1)},function(){return h(!0)})},u.prototype.setPreviewIcon=function(t,i,u,f,e){var o=this,s=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isTest)&&(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.DisablePreviewGetIcon),h;s||(h=4,t.getIcon(h,function(r){o._hasPreviewIconBeenSet=!0;t.previewIcon=r;n.populateImageRatio(t.previewIcon,t.type,function(){return o.getActions(i,f,e,u)})}));!s&&(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)||n.safeSetTimeout(function(){o._hasPreviewIconBeenSet||(o._hasPreviewIconBeenSet=!0,t.previewIcon=n.ScopeConfig[n.getScope(n.getGroupType(t))].icon,n.populateImageRatio(t.previewIcon,t.type,function(){return o.getActions(i,f,e,u)}))},r,"setPreviewIcon")},u.prototype.updateSelection=function(n,t,i,r,u){n.getIcon?this.setPreviewIcon(n,t,i,r,u):(n.icon&&(n.previewIcon={content:n.icon.content,type:n.icon.type,bgColor:n.icon.bgColor,needsAccentColor:!0,ratio:n.icon.ratio,className:n.icon.className}),this.getActions(t,r,u,i))},u.prototype.hasFocus=function(){return!!this._selectedItem},u.prototype.focus=function(t){var i=this.getSelectableItems(),r,u;i.length>0?(r=t?0:this._selectedItemIndex!=-1?this._selectedItemIndex:0,u=i[r],this.select(u,!1),n.Host.searchBoxHasFocus()&&n.Host.setFocusInWebView("localPP focus")):this._previewPaneViewModelParent.focusPending=!0},u.prototype.readyToBlur=function(){return!0},u.prototype.blur=function(){this._selectedItem&&(this._selectedItem.selected=!1,this._selectedItem=null,this.render())},u.prototype.clear=function(){this._selectedItem=null;this._selectedItemIndex=-1;this._previewedSuggestion=null;this._onPreviewPaneRendered=null;this._sections=[];this._settingsOnlineModules=[];this._settingsOnlineModulesRetrieved=!1;sb_ct(this._renderTimer);this._hasPreviewIconBeenSet=!1;this._renderTimer=null;this.render()},u.prototype.getSelectableItems=function(){return[].concat.apply([],this.getSelectableItemsByGroup())},u.prototype.getSelectableItemsByGroup=function(){for(var n,t,f,s,r,e,h,i=[],u=0,o=this._sections;u<o.length;u++)n=o[u],t=[],t=t.concat(n.items),f=n.collapsedItems.length>0,f&&(s=_ge(n.collapsedItems[0].id).classList,s.contains("collapsedItem")||(t=t.concat(n.collapsedItems))),i.push(t),f&&i.push([n.expander]);for(r=0,e=this._settingsOnlineModules;r<e.length;r++)h=e[r],i.push(h.settingLinks);return i},u.prototype.getSelectedItem=function(){return this._selectedItem},u.prototype.select=function(t,i){var u,r;if(i){SharedLogHelper.LogError("selectPreviewPaneItem",null,new Error("Can't update search box value when selecting preview pane item"));return}this._selectedItem==t&&this._selectedItem.selected||(this._selectedItem&&(this._selectedItem.selected=!1),t&&(u=this.getSelectableItems().findIndex(function(n){return n==t}),u<0?SharedLogHelper.LogError("LocalPreviewPane.Select",null,new Error("select called on unknown item")):(t.selected=!0,this._selectedItem=t,this._selectedItemIndex=u,this.render(),r=_ge(t.id),r&&(r.focus(),this._page.scrollToElement(r,n.StaticHtmlElements.qfPreviewScrollArea,n.StaticHtmlElements.qfPreviewScrollArea.offsetHeight)))))},u.prototype.onAfterKeyDown=function(t,i){return n.isContextMenuKey(t,i.shiftKey)?(this._contextMenuHandler(this._previewedSuggestion,null,this._selectedItem),!0):!1},u.prototype.selectFirstOrLastItem=function(n){var t=this.getSelectableItems(),i;t.length!=0&&(i=n?0:t.length-1,this.select(t[i],!1))},u.prototype.isAnaheimDataSuggestionType=function(t){return t.type=="ANAH"||t.type=="ANAR"||t.type=="ANAT"||t.type=="ANAF"||t.type=="ANATH"&&n.config.topHitMuse},u.prototype.isAnaheimDataSuggestion=function(t){var i=n.getGroupType(t);return this.isAnaheimDataSuggestionType(t)&&(i==n.GroupType.SearchSuggestions||i==n.GroupType.AnaheimDataTopHit&&n.config.topHitMuse)},u.prototype.getAnaheimDataPreviewedSuggestion=function(n){var t,i,r;return this.isAnaheimDataSuggestion(n)&&(t=__assign({},n),i="https://"+HitHighlightingParser.removeMarkers(t.primaryMetadata),r=new URL(i),t.primaryMetadata=r.hostname),t},u.prototype.getDataModel=function(){if(this._previewedSuggestion){var t=this.getAnaheimDataPreviewedSuggestion(this._previewedSuggestion),i=this._previewedSuggestion.uninstallationInProgress?{messageText:n.Host.getLocString("UninstallationInProgress",HitHighlightingParser.removeMarkers(this._previewedSuggestion.text)),icon:{content:"&#xE946",type:2},messageClassName:"uninstallMessage"}:null;return{suggestion:t?t:this._previewedSuggestion,sections:n.deepCopy(this._sections),suggestionClickHandler:this._suggestionClickEventHandler,itemClickHandler:this._itemClickEventHandler,contextMenuClickHandler:this._contextMenuHandler,settingsOnlineModules:n.deepCopy(this._settingsOnlineModules),messageDataModel:i}}return null},u.prototype.render=function(){this._page.updatePreviewContainerView(this.getDataModel());this._previewedSuggestion&&(this._timestampFirstRender||(this._timestampFirstRender=n.getCurrentTime()),this.instrumentIfAllSectionsRetrieved())},u.prototype.instrumentIfAllSectionsRetrieved=function(){this._previewedSuggestion&&this._allSectionsRetrieved()&&this.instrumentOnPreviewPaneRendered(!0,!1)},u.prototype.delayedRender=function(){var t=this;this._renderTimer||(this._renderTimer=n.safeSetTimeout(function(){t.render();t._renderTimer=null},i,"delayedRender"))},u.prototype.getActions=function(t,i,r,u){var e=this,f;if(u()){if(f=this._previewedSuggestion,!f||this._haveActionsBeenFetched){i();return}this._haveActionsBeenFetched=!0;this.addToSection(this.createSyntheticAction(f),null,n.Host.getLocString("ActionsSection"));n.config.settingsOnlineModuleEnabled&&n.isSetting(f.type)&&f.deviceItem&&!this._settingsOnlineModulesRetrieved?n.fetchUrlJson(this.getRelatedSearchUrl(f.deviceItem.id,n.uiLanguageCache),null,null,function(n){return e.createSettingOnlineModules(n,u)}):(this._sectionRetrieved_settingsFaq=!0,this._sectionRetrieved_settingsRelatedSettings=!0);n.getVerbsAsync("PreviewPaneExtraActions",f,n.config.rawVerbs,!0,function(n){return e.processVerbs(n,t,i,r,u)},u)}},u.prototype.processVerbs=function(t,i,r,u,f){var k=this,w,l,h,v,b,y,c,p,e;if(f()){w=n.Host.getLocString("ActionsSection");l=this._previewedSuggestion;t=n.extendVerbs(t,l,this._page,function(){return k.render()});var s=-1,o=-1,a=0;for(h=0,v=t;h<v.length;h++)e=v[h],e.verb==="copy"&&(s=a),e.verb==="S_CopyFullPath"&&(o=a),a++;for(s!=-1&&o!=-1&&(e=t[o],s<o?(t.splice(o,1),t.splice(s+1,0,e)):(t.splice(s+1,0,e),t.splice(o,1))),b=function(n){if(n.verb){var t=y.createAction(n);n.getIcon&&n.getIcon(1,function(n){t.icon=n;u()});y.addToSection(t,null,w)}},y=this,c=0,p=t;c<p.length;c++)e=p[c],b(e);this.processChildSuggestions(l,i,function(){f()&&u()});this._sectionRetrieved_jumplist=!0;r()}},u.prototype.createSyntheticAction=function(t){var i="",u=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType(),r;return i=t.type=="PPL"&&u!=2?n.Host.getLocString("OpenContact"):t.previewPaneType==1||this.isAnaheimDataSuggestion(t)?n.Host.getLocString("OpenInBrowser"):n.Host.getLocString("Open"),r={verb:n.JumplistActionItemType[n.JumplistActionItemType.S_Open],displayName:i,icon:{type:2,content:"&#xE8A7"},executeSync:function(){return t.click(n.getCurrentTime(),0)}},this.createAction(r,n.GroupType.JumpListSynthetic)},u.prototype.createAction=function(i,r){var u=this,f=n.JumplistActionItemType[i.verb],e={ppId:this._previewPaneId,st:r||n.GroupType.JumpListActions,vbt:f||undefined,vbr:f?undefined:i.verb};return{id:t+i.verb,text:i.displayName,click:function(t,r){var f=5;u._previewPaneViewModelParent.onBeforeItemLaunch(t,r,f,e);if(i.executeSync){n.safeExecute(function(){return i.executeSync()},"verb.executeSync",null,i.verb);u._previewPaneViewModelParent.onAfterItemLaunch(f)}else n.Async.safeChain("verb.executeAsync",function(){return i.executeAsync()},function(){return u._previewPaneViewModelParent.onAfterItemLaunch(f)},null,null,i.verb)},icon:i.icon,selected:!1,narratorText:i.displayName,instData:e}},u.prototype.processChildSuggestions=function(i,r,u){var e=this,f;if(i&&(i.previewPaneType!=1||n.RuntimeConfig.MiniSERPMode!=0)){if(i.calculateChildSuggestions&&i.calculateChildSuggestions(),i.childSuggestions){var s=1,h=function(f){var h=i.childSuggestions[f],l=h.groupType==n.GroupType.JumpListTasks,v={ppId:o._previewPaneId,st:h.groupType},c={id:t+i.id+"_"+f,text:HitHighlightingParser.removeMarkers(h.text),click:function(n,t){var i=l?5:6;e._previewPaneViewModelParent.onBeforeItemLaunch(n,t,i,v);h.click(n,t);e._previewPaneViewModelParent.onAfterItemLaunch(i)},icon:h.icon,selected:!1,narratorText:h.narratorText,annotationClass:"annotation",isJumpListTaskItem:!!l,instData:v},y=void 0,p=void 0,a;l||(a=n.getGroupTitleAndNarratorText(r,h.groupType,h,null),c.tooltip=h.tooltip,y=a.title,p=a.narratorText,c.annotation=h.additionalInfoText);h.getIcon&&h.getIcon(1,function(t){c.icon=t;n.populateImageRatio(c.icon,h.type,function(){return u()})});o.addToSection(c,y,p,l?s++:null)},o=this;for(f=0;f<i.childSuggestions.length;f++)h(f)}n.config.itemsBeforeExpander&&this.processItemsForExpander()}},u.prototype.addToSection=function(n,t,i,r){var u=this._sections.find(function(n){return(n.title||"")==(t||"")});u?typeof r=="number"?u.items.splice(r,0,n):u.items.push(n):(u={title:t,narratorText:i,items:[n],collapsedItems:[],expander:null},this._sections.push(u))},u.prototype.processItemsForExpander=function(){var t;if(this._sections.length!=0){var r=function(n,t,i){n.pi=t;i&&(n.c=1)},i=this._sections.length,u=1,f=function(t){var f=e._sections[t],o=f.items,c,l,h,a,s,v;if(t==0){for(c=!1,l=!1,h=0;h<o.length;++h)if(a=o[h],a.instData.st==n.GroupType.JumpListTasks){l=!0;break}else a.instData.st==n.GroupType.JumpListActions&&(c=!0);f.sectionType=l?n.GroupType.JumpListTasks:c?n.GroupType.JumpListActions:n.GroupType.JumpListSynthetic}else f.sectionType=f.items[0].instData.st;if(t==0)for(s=0;s<o.length;s++)s!=0&&!o[s].isJumpListTaskItem&&(i!=1||o[1].isJumpListTaskItem)&&(f.collapsedItems=o.splice(s),f.expander={id:"expander"+u++,selected:!1,text:null});else i!==t+1&&o.length>n.config.itemsBeforeExpander+1&&(f.collapsedItems=o.splice(n.config.itemsBeforeExpander),f.expander={id:"expander"+u++,selected:!1,text:null});v=0;f.items.forEach(function(n){return r(n.instData,v++,!1)});f.collapsedItems.forEach(function(n){return r(n.instData,v++,!0)})},e=this;for(t=0;t<i;t++)f(t)}},u.prototype.getLayoutDataForPPRenderedInstrumentation=function(){var t={sectionTypes:[],sectionLengths:[]},i,u,r,f,n;if(this._sections)for(i=0,u=this._sections;i<u.length;i++)n=u[i],t.sectionTypes.push(n.sectionType),t.sectionLengths.push(n.items.length+n.collapsedItems.length);if(this._settingsOnlineModules)for(r=0,f=this._settingsOnlineModules;r<f.length;r++)n=f[r],t.sectionTypes.push(n.sectionType),t.sectionLengths.push(n.settingLinks.length);return t.sectionTypes.length>0?t:undefined},u.prototype.onAnyOptionClick=function(n){this.select(n,!1);this.hasFocus||this.focus(!1)},u.prototype.getRelatedSearchUrl=function(t,i){return"/PPRelatedSearch?query="+n.encodeQueryParameter(t)+"&lang="+n.encodeQueryParameter(i)},u.prototype.createSettingOnlineModules=function(n,t){t()&&(this._settingsOnlineModulesRetrieved=!0,this.createSettingFaqModule(n),this.createSettingRelatedSettingsModuleAsync(n,t))},u.prototype.createSettingFaqModule=function(t){var f=this,o=n.Host.getLocString("SettingsFAQModuleHeader"),i=t&&t.SettingPageQnAs,r,e;if(i&&i.length>0){var u=[],s=function(t){var r=i[t],e,o;r.Query&&r.BingIALink&&(e={ppId:h._previewPaneId,st:n.GroupType.JumpListSettingsFaq,pi:t},o={id:"faq"+t,narratorText:r.Query,selected:!1,text:r.Query,click:function(t,i){var u=9;f._previewPaneViewModelParent.onBeforeItemLaunch(t,i,u,e,0);n.Host.launchUri(r.BingIALink);f._previewPaneViewModelParent.onAfterItemLaunch(u)},instData:e},u.push(o))},h=this;for(r=0;r<i.length;++r)s(r);u.length>0&&(e={header:o,settingLinks:u,sectionType:n.GroupType.JumpListSettingsFaq},this._settingsOnlineModules.push(e),this.render())}this._sectionRetrieved_settingsFaq=!0;this.instrumentIfAllSectionsRetrieved()},u.prototype.createSettingRelatedSettingsModuleAsync=function(t,i){var r=this,f=n.Host.getLocString("RelatedSettingsModuleHeader"),u=t&&t.SettingPageRelatedSettingsIds;u&&u.length>0?n.LocalDataProvider.getSettings(u,function(t){var e,s,o,h;if(i()){for(e=[],s=function(i){var s=u[i],f=t[s],o,h;f&&(o={ppId:r._previewPaneId,st:n.GroupType.JumpListSettingsRelatedSettings,pi:i},h={id:s,narratorText:f.deviceItem.displayName,selected:!1,text:f.deviceItem.displayName,click:function(t,i){var u=9;r._previewPaneViewModelParent.onBeforeItemLaunch(t,i,u,o);n.Host.launchDeviceItem(f.deviceItem,"THST");r._previewPaneViewModelParent.onAfterItemLaunch(u)},instData:o},e.push(h))},o=0;o<u.length;++o)s(o);e.length>0&&(h={header:f,settingLinks:e,sectionType:n.GroupType.JumpListSettingsRelatedSettings},r._settingsOnlineModules.push(h),r.render());r._sectionRetrieved_settingsRelatedSettings=!0;r.instrumentIfAllSectionsRetrieved()}}):(this._sectionRetrieved_settingsRelatedSettings=!0,this.instrumentIfAllSectionsRetrieved())},u}();n.WSBLocalPreviewPaneViewModel=u})(WSB||(WSB={}))