var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArray,__assign,WSB;(function(n){function f(t,r,u,f,e,o,s,h){i(t,r,u,function(t){var i=null;t.status==200&&(i=t.responseText?n.safeExecute(function(){return JSON.parse(t.responseText)},"JSON.parse"):{success:!0});f(i)},e,o,s,h)}function i(i,r,u,f,e,o,s,h,c,l,a){var v=c&&_w.XMLHttpRequest?new XMLHttpRequest:sj_gx(),w=l!==null&&l!==void 0?l:u?"POST":"GET",p,y;try{v.open(w,i,!0)}catch(b){SharedLogHelper.LogError("fetchUrl",i,b);f&&f({responseText:"",contentType:"",status:-1,result:3});return}if(r)for(p in r)v.setRequestHeader(p,r[p]);e&&(y=e.register(function(){return v.abort()},!1,"xhr abort"));n.config.useEventListeners?(v.addEventListener("load",function(){t(v,0,f,y,e,o,a)}),v.addEventListener("timeout",function(){t(v,1,f,y,e,o,a)}),v.addEventListener("abort",function(){t(v,2,f,y,e,o,a)}),v.addEventListener("error",function(){t(v,3,f,y,e,o,a)})):(v.onreadystatechange=function(){v.readyState==4&&v.status>0&&t(v,0,f,y,e,o,a)},v.ontimeout=function(){return t(v,1,f,y,e,o,a)},v.onabort=function(){return t(v,2,f,y,e,o,a)},v.onerror=function(){return t(v,3,f,y,e,o,a)});typeof s!="undefined"?v.withCredentials=s:v.withCredentials!==undefined&&(v.withCredentials=!0);h&&h>0&&(v.timeout=h);v.send(u)}function t(n,t,i,r,u,f,e){if(!f||f()){n.readyState==4&&(n.onreadystatechange=function(){});r&&u.unregister(r);var o={};e&&e.map(function(t){return o[t]=n.getResponseHeader(t)});i&&i({responseText:n.responseText,contentType:n.getResponseHeader("content-type")||"",status:n.status,result:t,responseURL:n.responseURL,responseHeaders:o})}}function e(n){var t=n.IconContent;return t?t[0]=="S"?{content:t.slice(1),type:1}:{content:t,type:2}:n.Icon?{content:n.Icon,type:0}:null}var r,u;n.fetchUrlJson=f;n.fetchUrl=i;r=function(){function t(t){this._dataSource=t;this._delay=n.config.webDataSourcesWithThrottling[t]||0;this._timers=[]}return t.prototype.getBaseUrl=function(){throw new Error("Not Implemented");},t.prototype.getPostBody=function(){return undefined},t.prototype.onBeforeFetchUrl=function(){},t.prototype.createUrl=function(t){return decodeURIComponent(this.getBaseUrl())+(t?n.encodeQueryParameter(t.queryToFetch.toLowerCase()):"")},t.prototype.addParamsToUrl=function(n,t){var i=t?Object.keys(t):[];return i.length>0&&(n+=n.includes("?")?"&":"?",n+=i.map(function(n){return n+"="+t[n]}).join("&")),n},t.prototype.fetch=function(t,i,r,u,f,e,o,s,h,c){var p=this,l,v,a,y,w;if(n.isDataSourceEnabled(this._dataSource,t)){if(l=this.addParamsToUrl(this.createUrl(t),e),n.config.shGAWDx&&(t===null||t===void 0?void 0:t.fromSearchHome)&&(t===null||t===void 0?void 0:t.queryToFetch)==="Good news - MSN"&&(l="https://api.msn.com/news/feed?ocid=winsearch&market=en-us&query=good%20news&apikey=uvobH5fEn1uz1xwZ5yuwtWzu2y32WpRZ6EMpZx7o09"),v=this.getPostBody(t)||"",this._lastSequenceNumber!=r){for(a=0,y=this._timers;a<y.length;a++)w=y[a],sb_ct(w);this._timers=[];this._lastSequenceNumber=r}if(this._delay>0&&!t.isFormulatedQuery)this._timers.push(n.safeSetTimeout(function(){p.onBeforeFetchUrl(r,l);p.fetchUrl(l,o,v,i,u,f,s,h,c)},this._delay,"fetchDelay"));else{this.onBeforeFetchUrl(r,l);this.fetchUrl(l,o,v,i,u,f,s,h,c)}}},t.prototype.fetchUrl=function(t,r,u,f,e,o,s,h,c){var l=this;i(t,r,u,function(i){var r=i.responseText,o=i.contentType,u=i.status,e;u==200&&(n.TestHookUrlParameters&&r&&(r=r.replace(new RegExp("<!--[^]*?-->","gm"),"")),r&&o.includes("json")&&(e=n.safeExecute(function(){return JSON.parse(r)},"parseWebProviderResponse",null,t)));f(l._dataSource,e,u==200?null:u.toString())},this._delay>0?e:null,o,h,s,c)},t}();n.JsonDataProvider=r;u=function(t){function i(n){var i=t.call(this,"Web")||this;return i._responseCacheManager=n,i}return __extends(i,t),i.prototype.getName=function(){return"AsSuggestionsDataProvider"},i.prototype.getBaseUrl=function(){return n.config.u},i.prototype.onBeforeFetchUrl=function(t,i){n.InstrumentationHelper.instrumentSnRProviderFetchUrl(t,i)},i.prototype.fetch=function(i,r,u,f,e,o,s){var c=this,h;n.isDataSourceEnabled(this._dataSource,i)&&(n.config.enableFetchStartLogging&&n.InstrumentationHelper.instrumentFetchProviderBegin(u,"ASDP:"+this._dataSource),h=r,h=function(t,u,f,e){u&&n.isEmptyUrlPrefix(i)&&(u.Suggestions=[]);c.processResourceResponse(u);r(t,u,f,e)},this._responseCacheManager?this.fetchWithCache(i,h,u,f,e,o,s):t.prototype.fetch.call(this,i,h,u,f,e,o,s))},i.prototype.fetchWithCache=function(i,r,u,f,e,o,s){var l=this,a=this._responseCacheManager.get(i),v,h,y,c;if(a){v=this.addParamsToUrl(this.createUrl(i),o);this.onBeforeFetchUrl(u,v);r(this._dataSource,a,null,1);n.config.forceUseNifQF&&this._dataSource=="Web"&&(h=n.deepCopy(o),h.wsbnoas="1",this.fetchWithoutCache(i,r,u,f,e,h,s))}else y=function(){return!0},c=r,c=function(n,t,u){e()&&r(n,t,u,0);i.queryToFetch&&l.responseIsValidForCaching(u,t)&&(t.ELToken&&(t=Object.assign({},t),delete t.ELToken),l._responseCacheManager.put(i,t))},t.prototype.fetch.call(this,i,c,u,f,y,o,s)},i.prototype.fetchWithoutCache=function(n,i,r,u,f,e,o){var h=function(){return!0},s=i;s=function(n,t,r){f()&&i(n,t,r,0)};t.prototype.fetch.call(this,n,s,r,u,h,e,o)},i.prototype.responseIsValidForCaching=function(n,t){var i="HS";return!n&&t&&t.Suggestions.every(function(n){return!n.InstantAnswer&&n.Attributes.stype!=i})},i.prototype.processResourceResponse=function(n){var t,i;n&&(t=n.Resources,t)&&(this._downloadedStylesResources?this.updateWithDownloadedResources(t):this._downloadedStylesResources=t.Styles,i={Styles:t.Styles,Scripts:null},JsonInject.WriteHeadAndBeforeContentResources(i))},i.prototype.updateWithDownloadedResources=function(n){var t,i;for(t in n.Styles)for(i in n.Styles[t])this._downloadedStylesResources[t][i]?delete n.Styles[t][i]:this._downloadedStylesResources[t][i]=n.Styles[t][i]},i}(r);n.AsSuggestionsDataProvider=u;n.getIconFromOnlineResponse=e})(WSB||(WSB={})),function(n){var t;(function(t){function f(n,t,i,r,f){typeof indexedDB!="undefined"&&new u(n,f,t,i,r)}function e(n,t,i,r,f){typeof indexedDB!="undefined"&&new u(n,f,t,i,r)}function o(n,t,i,r,f,e){typeof indexedDB!="undefined"&&new u(n,e,t,i,r,f)}function s(n,t,i,r,f,e){typeof indexedDB!="undefined"&&new u(n,e,t,i,r,f)}function h(n,t,u){i(n,"deleteDatabase requested");try{var f=indexedDB.deleteDatabase(n);f.onsuccess=function(){i(n,"deleteDatabase completed");t&&t()};f.onerror=r("deleteDatabase.onError",function(t){SharedLogHelper.LogError("deleteDB",n,t);u&&u(t)})}catch(e){u&&u(e)}}function r(n,t){return function(i){var r=n;try{r+=" "+i.target.error.name}catch(u){}t(new Error(r))}}var i,u;t.instanceWithNumberKeys=f;t.instanceWithStringKeys=e;t.instanceWithNumberKeysAndSecondaryKey=o;t.instanceWithStringKeysAndSecondaryKey=s;i=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.dbTrace)?function(t,i){return n.log("["+t+"] "+i)}:function(){};t.deleteDatabase=h;t.handleErrorEvent=r;u=function(){function t(n,u,f,e,o,s){var h=this,c;this._databaseName=n;this.onClosed=o;this._secondaryIndex=s;this._closePending=!1;this._storeName=n+"Store";i(this._databaseName,"open requested");try{c=indexedDB.open(n,u||1)}catch(l){e(new Error("IndexedDbClientSideStorage.const: Could not open database"));return}c.onsuccess=function(n){h._database=n.target.result;t._allInstances.push(h);i(h._databaseName,"open completed");f(h)};c.onupgradeneeded=function(n){var t,r;i(h._databaseName,"upgrading");t=n.target.result;t.objectStoreNames.contains(h._storeName)&&t.deleteObjectStore(h._storeName);r=t.createObjectStore(h._storeName);h._secondaryIndex&&r.createIndex(h._secondaryIndex,h._secondaryIndex,{unique:!1})};c.onerror=r("open.onError",e);c.onblocked=r("open.onBlocked",e)}return t.prototype.put=function(n,t,i,r){this.safeDbOperation("put",n.toString(),"readwrite",i,function(i,r,u){var f=i.put(t,n);f.onsuccess=r;f.onerror=u},r)},t.prototype.putMultiple=function(n,t,i){this.safeDbOperation("putMultiple",n.length.toString(),"readwrite",t,function(t,i,r){var u=0,f=function(){if(u<n.length){var e=t.put(n[u].value,n[u].key);u+=1;e.onsuccess=u==n.length?i:f;e.onerror=r}};f()},i)},t.prototype.getValue=function(n,t,i){this.safeDbOperation("getValue",n.toString(),"readonly",function(n){return t(n.target.result)},function(t,i,r){var u=t.get(n);u.onsuccess=i;u.onerror=r},i)},t.prototype.getRange=function(n,t,i,r){var u=this;this.safeDbOperation("getRange","["+n+", "+t+")","readonly",i,function(i,r,f){var e=IDBKeyRange.bound(n,t,!1,!0);u.queryFromCursor(i.openCursor(e),r,f)},r)},t.prototype.getRangeOnSecondaryKey=function(n,t,i,r){var u=this;this._secondaryIndex?this.safeDbOperation("getRangeOnSecondaryKey","["+n+", "+t+")","readonly",i,function(i,r,f){var e=i.index(u._secondaryIndex),o=IDBKeyRange.bound(n,t,!1,!0);u.queryFromCursor(e.openCursor(o),r,f)},r):r(new Error("getRangeOnSecondaryKey: Index name is missing"))},t.prototype.removeRange=function(n,t,i,r){var u=this;this.safeDbOperation("removeRange","["+n+","+t+"]","readwrite",i,function(i,r,f){var e=IDBKeyRange.bound(n,t,!1,!0);u.removeFromCursor(i.openCursor(e),r,f)},r)},t.prototype.removeRangeOnSecondaryKey=function(n,t,i,r){var u=this;this._secondaryIndex?this.safeDbOperation("removeRangeOnSecondaryKey","["+n+","+t+"]","readwrite",i,function(i,r,f){var e=i.index(u._secondaryIndex),o=IDBKeyRange.bound(n,t,!1,!0);u.removeFromCursor(e.openCursor(o),r,f)},r):r(new Error("removeRangeOnSecondaryKey: Index name is missing"))},t.prototype.getAll=function(n,t){var i=this;this.safeDbOperation("getAll",null,"readonly",n,function(n,t,r){return i.queryFromCursor(n.openCursor(),t,r)},t)},t.prototype.close=function(){i(this._databaseName,"close requested");this.innerClose()},t.prototype.innerClose=function(){var f,e,r,u,o;if(t._requestsInProgress>0)i(this._databaseName,"delaying close because of "+t._requestsInProgress+" requests in progress"),this._closePending=!0;else for(f=function(t){t._database&&(n.safeExecute(function(){return t._database.close()},e._databaseName+".close"),i(t._databaseName,"close completed"),t._database=null,t.onClosed())},e=this,r=0,u=t._allInstances;r<u.length;r++)o=u[r],f(o)},t.prototype.queryFromCursor=function(t,i,r){var u=[];t.onsuccess=function(t){var r=t.target.result;r&&u.push({key:r.primaryKey,value:r.value});r&&u.length!=n.config.maxIndexedDBCursorIterations?r["continue"]():i(u)};t.onerror=r},t.prototype.removeFromCursor=function(t,i,r){var u=0;t.onsuccess=function(t){var r=t.target.result;r&&(r["delete"](),u+=1);r&&u!=n.config.maxIndexedDBCursorIterations?r["continue"]():i(null)};t.onerror=r},t.prototype.safeDbOperation=function(n,u,f,e,o,s){var h=this,l,c,a;i(this._databaseName,n+" requested"+(u?" "+u:""));t._requestsInProgress+=1;l=function(r){i(h._databaseName,n+" completed "+(u?u+" ":""));t._requestsInProgress-=1;e(r);h._closePending&&t._requestsInProgress==0&&h.innerClose()};c=function(n){t._requestsInProgress-=1;s(n);h._closePending&&t._requestsInProgress==0&&h.innerClose()};try{this._database?(a=this._database.transaction(this._storeName,f).objectStore(this._storeName),o(a,l,r(n+".onError",c))):c(new Error(n+" Database not initialized"))}catch(v){c(v)}},t._requestsInProgress=0,t._allInstances=[],t}()})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(WSB||(WSB={})),function(n){var t;(function(t){var i=3,r=function(){function r(t,i,r,u,f){var e=this;this._storageFactory=t;this.createResponse=i;this.dataPopulated=r;this.getDataSourceState=u;this._dataSource=f;this._pendingQueries=[];this._storageOpenInProgress=!1;this._retryCount=0;n.Host&&(n.Host.bindAppVisible(function(){return e.initStorage()}),n.Host.bindDismissed(function(){return e._pendingQueries=[]}),n.Host.bindAppHidden(function(){return e.teardownStorage()}))}return r.prototype.onAfterWrite=function(){if(this._writing=!1,this._pendingWrites.length>0){var n=this._pendingWrites.shift();n()}else this._tearDownPending&&this.teardownStorage()},r.prototype.teardownStorage=function(){this._writing?this._tearDownPending=!0:(this._tearDownPending=!1,this._storage&&this._storage.close())},r.prototype.initStorage=function(){var n=this;!this._storageOpenInProgress&&this.dataPopulated()&&(this._storageOpenInProgress=!0,this._storageFactory(function(t){n._storage=t;n._storageOpenInProgress=!1;n._pendingQueries.forEach(function(n){return n()});n._pendingQueries=[]},function(t){n.onError(t,"open storage");n._storageOpenInProgress=!1;n._pendingQueries.forEach(function(n){return n()});n._pendingQueries=[]},function(){return n._storage=null}))},r.getUnixTime=function(t){return t||(t=n.getCurrentDate()),Math.round(t.getTime()/1e3)},r.prototype.onError=function(n,t){t!="open storage"&&SharedLogHelper.LogError(t,this._dataSource,n);this.teardownStorage()},r.prototype.reloadStorage=function(){this.teardownStorage();this.initStorage()},r.prototype.isReady=function(){return!!this._storage},r.prototype.getTimeout=function(t,i){return!t||(i===null||i===void 0?void 0:i.isSearchHomeZI)?n.config.latencyTimeoutForZeroInput:n.config.indexedDBTimeout},r.prototype.getKey=function(n){return this._dataSource=="ANA"?"anaheimData":n.queryToFetch?n.queryToFetch.toLocaleLowerCase():""},r.prototype.fetch=function(t,i,r,u,f){var o=this,s=n.getCurrentTime(),e;(n.config.enableFetchStartLogging&&n.InstrumentationHelper.instrumentFetchProviderBegin(r,"SBDP:"+this._dataSource),n.isDataSourceEnabled(this._dataSource,t))&&(e=function(r,u){var h=n.getCurrentTime()-s,e;n.InstrumentationHelper.instrumentPerfEvent(n.SequenceNumberManager.getSequenceNumber(),"Fetch"+o._dataSource,h);e=u=="R";f()&&i(o._dataSource,o.createResponse(t,r,e),o.getDataSourceState(u))},this.innerQueryStorage(1,this.getKey(t),function(n){return e(n,"R")},function(){return e(null,"E")},function(){return e(null,"X")},function(){return e(null,"T")},t))},r.prototype.withStorage=function(n){return this._storage?(n(this._storage),!0):!1},r.prototype.getMaxKey=function(n){return n.slice(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)},r.prototype.getStorage=function(n,t,i,r){this.innerQueryStorage(null,null,function(t){return n(t)},t,i,r)},r.prototype.queryStorage=function(n,t,i,r,u){this.innerQueryStorage(0,n,t,i,r,u)},r.prototype.innerQueryStorage=function(r,u,f,e,o,s,h){var a=this,c=null,l=!1,v=!0,w=function(){if(v)if(v=!1,a._storage){var n=function(n){(n===null||n===void 0?void 0:n.message)==="NotFoundError"&&(a._retryCount+=1);c&&sb_ct(c);a.onError(n,"query");l||(l=!0,e())};r==0?a._storage.getValue(u,function(n){c&&sb_ct(c);l||(l=!0,f(n))},n):u?a._storage.getRange(u,a.getMaxKey(u),function(n){c&&sb_ct(c);l||(l=!0,f(n))},n):a._storage.getAll(function(n){c&&sb_ct(c);l||(l=!0,f(n))},n)}else c&&sb_ct(c),l||(l=!0,e())},y,p;if(this._storage)w();else if(this._retryCount<i)if(this.initStorage(),this._storageOpenInProgress)this._pendingQueries.push(w);else{o();return}else{this._retryCount=0;y=n.DataProviderDBName[this.getName()];this.onError(new Error("Corrupted "+y+". Will delete and reloading."),"IndexDBCorruption");t.deleteDatabase(y);return}p=this.getTimeout(u,h);p&&(c=n.safeSetTimeout(function(){c=null;v=!1;l||(l=!0,s())},p,"innerQueryStorage"))},r}();t.StorageBasedDataProvider=r})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(WSB||(WSB={})),function(n){var t=function(){function t(n,t){this._navigationHelper=n;this._temporaryMessageHandler=t}return t.prototype.parse=function(t,i,r,u,f,e,o){var c=this,l=[],a=[],v=[],y=[],p=[],w=[],b=[],k=[],d,s,h,g;if(u&&u.Suggestions)for(d=function(r){var u=r.suggestionData,f,e;u.handoffType==2?n.isApp(u.type)?(f=u,a.push(f.id),p.push(r)):n.isSetting(u.type)?(f=u,v.push(f.id),w.push(r)):n.isFileOrFolder(u.type)&&(f=u,y.push(f.id),b.push(r)):n.isBingEnabled()&&(e=n.safeExecute(function(){return c.parseMRUWebSuggestion(t,r,i)},"parseMRUWebSuggestion"),e&&(u.handoffType==0?k.push(e):l.push(e)))},s=0,h=u.Suggestions;s<h.length;s++)g=h[s],d(g);n.lookupById(t,"MPP",a,p,function(n){return[n.suggestionData.id]},"MST",v,w,function(n){return n.suggestionData.id},f,i,e,o,function(n,r,u,f){return c.parseIdLookupResponse(t,i,n,r,u,f)},"MFF",y,b,function(n){return n.suggestionData.id});n.isDataSourceEnabled("MRS",t)&&e("MRS",k,u);e("MRU",l,u)},t.prototype.parseIdLookupResponse=function(t,i,r,u,f,e){var s=this,o=r.suggestionData,h,c;((n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.mockMRUDataFile)&&f.length==0&&(h={displayName:o.id,id:o.id,kind:"document",getProperty:null,propertyHits:[],rankScore:1e3},f.push(n.createLocalResponseSuggestionWithDeviceItemImage(h,o.type,u))),f.length==1)&&(c=function(n){return s.setupRemoveFromHistoryContextMenu(n,r,t),n.lastLaunchTime=r.rankingData.lastLaunchTime,o.appContextData&&(n.appContext=o.appContextData.appContext,n.query=o.appContextData.query,n.text=t.queryToFetch?HitHighlightingParser.addMarkers(o.appContextData.textWithoutHH,t.queryToFetch):o.appContextData.textWithoutHH),s.setRankingSignals(n,o),!0},n.safeExecute(function(){return n.parseLocalSuggestion(t,f[0],u,i,s._temporaryMessageHandler,o.type,e,c)},"parseLocalSuggestion "+u))},t.prototype.setRankingSignals=function(n,t){n.hc=t.hc;n.highConfidenceMetaSuggestionScore=t.highConfidenceMetaSuggestionScore;n.prefetchConfidenceScore=t.prefetchConfidenceScore;n.fromHistory=!0;n.hasMruData=!0},t.prototype.parseMRUWebSuggestion=function(t,i,r){var f=i.suggestionData,u=n.createSuggestion(t,t.queryToFetch?HitHighlightingParser.addMarkers(f.textWithoutHH,t.queryToFetch):f.textWithoutHH,null,f.icon,f.type,f.query,n.InstrumentedItem.createInstrumentedItem(r,f.type),f.handoffType,r,!1),e,h,o,c,s;u.lastLaunchTime=i.rankingData.lastLaunchTime;this.setRankingSignals(u,f);switch(u.handoffType){case 5:case 4:if(!n.isCortanaEnabledCache||u.type=="CSK"||(e=f,u.primaryMetadata=e.annotation||e.secondaryText,u.reactKey=u.type+u.primaryMetadata,!n.setCat1SuggestionProperties(u,t,r,e.actionUri,e.taskFrame,e.confidence,e.source)))return null;break;case 10:return null;case 0:case 13:case 14:if(!n.isDataSourceEnabled("MRS",t))return null;h=f;!t.isSearchHomeZI||t.scope==n.Scope.Web&&n.config.enableZeroInputSearchHomeWeb||(u=this.setTextAndIconForLBSHSuggestion(u,h));n.setWebSearchSuggestionProperties(u,t,r,h.url,this._navigationHelper);u.reactKey=this.generateReactKey(t,u);break;case 1:o=f;c=i.rankingData;t.queryToFetch.length>3&&(u.autoOpenPreviewPaneWhenOnTopHit=!!c.previewPaneLaunchCount);s=o.title||o.secondaryText;t.isSearchHomeZI&&s?(u.additionalInfoText=o.url,u.text=HitHighlightingParser.removeMarkers(s)):u.primaryMetadata=s;u.reactKey=o.type+o.url;n.setUrlSuggestionProperties(u,t,r,o.url);n.config.directNavPreviewPane&&u.type=="MD"&&u.url&&(u.getIcon=n.getFaviconUrlForRawUrl(u.url,64,64,1.5),t.isSearchHomeZI||(u.previewPaneType=2));break;default:return SharedLogHelper.LogError("parseMruWebSuggestion",null,new Error("Unexpected handoff type: "+f.handoffType)),null}return n.isValidSuggestion(u,"parseMruWebSuggestion")?(this.setupRemoveFromHistoryContextMenu(u,i,t),u):null},t.prototype.setTextAndIconForLBSHSuggestion=function(t,i){return t.text=i.query,t.icon=n.config.disableMruLBSHColorfulIcon?{type:2,content:"&#xE721"}:{type:0,className:n.config.mirrorMruLBSHItemIcon?"LBSHSpyglassSV2":"LBSHSpyglass"},t},t.prototype.setupRemoveFromHistoryContextMenu=function(t,i,r){var u=this;n.RuntimeConfig.QfMode!=5&&n.RuntimeConfig.QfMode!=9&&i.remove&&n.setExtraVerbs(t,function(f){if(f||!i.remove)return[];if(!t.removeIcon&&t.duplicates&&t.duplicates.some(function(n){return!n.fromHistory}))return[];var e=n.config.mruSearchHome&&r.scope==n.Scope.All,o={verb:e?"RemoveFromDeviceHistoryAll":"RemoveFromDeviceHistory",displayName:n.Host.getLocString("RemoveFromDeviceHistory"),executeSync:function(){i.remove(function(){n.Host.refreshCurrentPane();e||u._temporaryMessageHandler.showTemporaryMessage(n.Host.getLocString("RemovedFromDeviceHistory",HitHighlightingParser.removeMarkers(t.text)))});delete i.remove},icon:{content:"&#xE711",type:2}};return[o]},!0)},t.prototype.generateReactKey=function(n,t){return(n===null||n===void 0?void 0:n.isSearchHomeZI)?t.type+t.text:t.type+n.fullPartialQuery},t}();n.MRUParser=t}(WSB||(WSB={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var r="LastUpdated",i="MRUNoItemsAvailable",u=function(t){function u(i,u,f,e,o,s,h,c){var l=this;i&&(i.bindItemLaunch(function(n,t,i){return l.storeSuggestionToMRU(n,t,i)}),i.bindConversationEnds(function(n,t,i){return l.storeSuggestionToMRU(n,t,i)}));var a,v=function(t,i,f){return u(s,function(i){t(i);var r=n.getTimeDiffInDays(a);(r===null||r>=1)&&(a=n.getCurrentDate(),l.prune());l.getStorage(function(n){return l.instrumentMRUSize(n)},function(){return l.onAfterWrite()},function(){return l.onAfterWrite()},function(){return l.onAfterWrite()})},i,f,r)},y=function(t,i,r){return n.MockUrlParameters&&typeof n.MockedMRUData=="object"&&(i=n.MockedMRUData),n.safeExecute(function(){return l.createMruResponse(t,i,r)},"createMruResponse")},p=function(){return!0},w=function(n){return n=="R"?undefined:n};return n.Host.bindClearMRURequested(function(t){l.teardownStorage();n.ClientSideStorage.deleteDatabase(s,function(){return t(!0)},function(){return t(!1)})}),l=t.call(this,v,y,p,w,"MRU")||this,l.candidatesEnabled=h,l.loggingEnabled=c,l.getSuggestionKey=f,l.getGroupType=e,l.isMRUHistoryGroupType=o,l._pendingWrites=[],sj_evt.bind("clearMRUButtonClicked",function(){n.ClientSideStorage.deleteDatabase(n.MRUDatabaseName);l.reloadStorage()}),l}return __extends(u,t),u.prototype.getName=function(){return"MRUDataProvider"},u.prototype.createMruResponse=function(t,i,r){var c=this,f,s,u,o,h;if(i=i||[],f=this.getKey(t),this._lastKey=r?f:null,s=r?i.find(function(n){return n.key==f}):null,this._valueForLastKey=s?s.value:null,u={},n.config.mruSignalsEnabled&&this._valueForLastKey&&(u.SuggestionEngagementData=this._valueForLastKey.SuggestionEngagementData),u.LookupCompletions=i.map(function(n){return{key:n.key,value:n.value.SuggestionEngagementData}}),this.candidatesEnabled()){var e=[],v=this.getOldestDateToKeep(),y=function(n,t){var u,i,r,f;if(t.Suggestions)for(u=function(i){var r=l.getRankingData(t,i);r&&r.lastLaunchTime&&r.lastLaunchTime>=v&&e.push({rankingData:n==l._lastKey?{prefixLaunchCount:r.prefixLaunchCount,lastLaunchTime:r.lastLaunchTime,previewPaneLaunchCount:r.previewPaneLaunchCount,lastPreviewPaneLaunchTime:r.lastPreviewPaneLaunchTime}:r,suggestionData:i,remove:function(t){return c.remove(n,i,t)}})},i=0,r=t.Suggestions;i<r.length;i++)f=r[i],u(f)},l=this;for(o=0,h=i;o<h.length;o++){var a=h[o],p=a.key,w=a.value;y(p,w)}e.length>0&&(u.Suggestions=[],e.sort(function(n,t){return t.rankingData.lastLaunchTime-n.rankingData.lastLaunchTime}),e.forEach(function(n){return c.addToResponseIfNotPresent(u.Suggestions,n)}),f?f.length<=n.config.mruLengthA?u.Suggestions.splice(n.config.maxMruA):f.length<=n.config.mruLengthB&&u.Suggestions.splice(n.config.maxMruB):u.Suggestions.splice(n.config.maxMruZeroInput))}return u},u.removeRankerSignals=function(n,t){return n=="highConfidenceMetaSuggestionScore"||n=="prefetchConfidenceScore"?undefined:t},u.prototype.addToResponseIfNotPresent=function(n,t){var i=n.find(function(n){return n.suggestionData.suggestionKey==t.suggestionData.suggestionKey}),r;i?(r=i.remove,i.remove=function(n){return r(function(){return t.remove(n)})},i.rankingData.lastLaunchTime=Math.max(i.rankingData.lastLaunchTime,t.rankingData.lastLaunchTime),i.rankingData.prefixLaunchCount+=t.rankingData.prefixLaunchCount,t.rankingData.previewPaneLaunchCount&&(i.rankingData.previewPaneLaunchCount=(i.rankingData.previewPaneLaunchCount||0)+t.rankingData.previewPaneLaunchCount),t.rankingData.lastPreviewPaneLaunchTime&&(i.rankingData.lastPreviewPaneLaunchTime=i.rankingData.lastPreviewPaneLaunchTime?Math.max(i.rankingData.lastPreviewPaneLaunchTime,t.rankingData.lastPreviewPaneLaunchTime):t.rankingData.lastPreviewPaneLaunchTime)):n.push(t)},u.prototype.addToDataIfNotPresent=function(n,t){var i=JSON.stringify(t,u.removeRankerSignals),r=n.find(function(n){return JSON.stringify(n,u.removeRankerSignals)==i});r||n.push(t)},u.prototype.storeSuggestionToMRU=function(n,t,i){var r=this,u;if(this.loggingEnabled()){if(this._writing){this._pendingWrites.push(function(){return r.storeSuggestionToMRU(n,t,i)});return}this._writing=!0;u=this.getKey(t);this._lastKey==u?this.updateAndSaveLaunchData(u,this._valueForLastKey,n,i):this.queryStorage(u,function(t){return r.updateAndSaveLaunchData(u,t,n,i)},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()})}},u.prototype.remove=function(n,t,i){var r=this;if(this._writing){this._pendingWrites.push(function(){return r.remove(n,t,i)});return}this._writing=!0;this._lastKey==n?this.removeAndSaveLaunchData(n,this._valueForLastKey,t,i):this.queryStorage(n,function(u){return r.removeAndSaveLaunchData(n,u,t,i)},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()})},u.prototype.createOrUpdateDbEntry=function(t,r,u,f){var e,o;return r?(r.LastUpdated=n.ClientSideStorage.StorageBasedDataProvider.getUnixTime(),r.SuggestionEngagementData=r.SuggestionEngagementData||{}):r={LastUpdated:n.ClientSideStorage.StorageBasedDataProvider.getUnixTime(),SuggestionEngagementData:{}},e=this.getSuggestionKey(u),r.SuggestionEngagementData[e]=this.updateMRUEntryClicksAndTime(r.SuggestionEngagementData[e],r.LastUpdated,f),this.getGroupType&&(r.SuggestionEngagementData[e].groupType=this.getGroupType(u)),n.LightweightStorage.getItem(i)=="1"&&this.isMRUHistoryGroupType&&this.isMRUHistoryGroupType(u)&&n.LightweightStorage.removeItem(i),this.candidatesEnabled()&&(o=u.getMruData(),o&&t&&(r.Suggestions||(r.Suggestions=[]),this.addToDataIfNotPresent(r.Suggestions,o))),r},u.prototype.updateMRUEntryClicksAndTime=function(n,t,i){return n?(n.prefixLaunchCount+=1,n.lastLaunchTime=t):n={prefixLaunchCount:1,lastLaunchTime:t},i&&(n.previewPaneLaunchCount=(n.previewPaneLaunchCount||0)+1,n.lastPreviewPaneLaunchTime=t),n},u.prototype.getOldestDateToKeep=function(){var t=n.getCurrentDate();return t.setDate(t.getDate()-n.config.mruMaxAgeInDays),n.ClientSideStorage.StorageBasedDataProvider.getUnixTime(t)},u.prototype.updateAndSaveLaunchData=function(t,i,r,u){var f=this;if(i=n.safeExecute(function(){return f.createOrUpdateDbEntry(t,i,r,u)},"createOrUpdateDbEntry"),!i){this.onAfterWrite();return}n.safeExecute(function(){return f.removeOldLaunches(i,f.getOldestDateToKeep())},"removeOldLaunches");this._lastKey=t;this._valueForLastKey=i;this.withStorage(function(n){return n.put(t,i,function(){return f.onAfterWrite()},function(n){f.onError(n,"updateAndSaveLaunchData");f.onAfterWrite()})})||this.onAfterWrite()},u.prototype.removeAndSaveLaunchData=function(n,t,i,r){var u=this,e,f;if(!t){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("MRU entry not present"));this.onAfterWrite();return}if(e=JSON.stringify(i),f=(t.Suggestions||[]).findIndex(function(n){return JSON.stringify(n)==e}),f==-1){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("Suggestion not present in MRU"));this.onAfterWrite();return}t.Suggestions.splice(f,1);this._lastKey=n;this._valueForLastKey=t;this.withStorage(function(i){return i.put(n,t,function(){r&&r();u.onAfterWrite()},function(n){u.onError(n,"removeAndSaveLaunchData");u.onAfterWrite()})})||this.onAfterWrite()},u.prototype.getRankingData=function(n,t){return n.SuggestionEngagementData?n.SuggestionEngagementData[t.suggestionKey]:undefined},u.prototype.removeOldLaunches=function(n,t){var i,r,u;if(n.Suggestions)for(i=n.Suggestions.length-1;i>=0;--i)r=this.getRankingData(n,n.Suggestions[i]),u=r?r.lastLaunchTime:null,(!u||u<t)&&n.Suggestions.splice(i,1);this.removeOldEngagementData(n.SuggestionEngagementData,t)},u.prototype.removeOldEngagementData=function(n,t){var i,r,u;if(n)for(i in n)r=n[i],r&&(u=r.lastLaunchTime,(!u||u<t)&&delete n[i])},u.prototype.prune=function(n){var t=this;if(this._writing){this._pendingWrites.push(function(){return t.prune(n)});return}this._writing=!0;this.withStorage(function(i){return i.removeRangeOnSecondaryKey(0,t.getOldestDateToKeep(),function(){n&&n();t.onAfterWrite()},function(n){t.onError(n,"MRUDataProvider prune");t.onAfterWrite()})})||this.onAfterWrite()},u.prototype.instrumentMRUSize=function(t){for(var r,e,u=0,i=0,f=t;i<f.length;i++)r=f[i].value,r.Suggestions&&(u+=r.Suggestions.length);e={totalnumberOfEntries:t.length.toString(),totalNumberOfSuggestions:u.toString()};n.InstrumentationHelper.logClientInstEvent("ClientInst","MRUSize",null,e)},u}(n.ClientSideStorage.StorageBasedDataProvider);t.MRUDataProvider=u})(t=n.MRU||(n.MRU={}))}(WSB||(WSB={}));__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},function(n){var t;(function(t){function o(t,i){var u,f;if(!i)throw new Error("Undefined query IQuery for data source: "+t);if(r||ft(),u=r[t],!u)throw new Error("Unsupported data source: "+t);if(n.config.indexerQuerySimplified&&t=="IFF"&&(i===null||i===void 0?void 0:i.queryToFetch.length)<=8)return u[4];if(f=u.filter(function(n){return!n.enabled||n.enabled(i)}),f.length==0)throw new Error("No enabled strategies for data source: "+t);else if(f.length>1)throw new Error("Multiple strategies for data source: "+t);else return f[0]}function yr(n){return r||ft(),!!r[n]}function pr(n,t,i){if(!r||!r[i]||t.taskFrame)return!1;var u=o(i,t);return u.sfgaoFilter?!u.sfgaoFilter(n.getProperty("System.SFGAOFlags")):!1}function i(n,t){return n=gi.concat(n),t&&(n=n.concat(nr)),n}function ft(){p=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getUserSID();var ut=0,ii=f(n.getKnownFolderPathLC(n.FOLDERID_Profile)),ft=si(ut,p,!1),et=ft[0],w=ft[1],ot=si(ut,p,!0),o=ot[0],t=ot[1];tt=et;gt=w;var st='"System.Kind" != ANY ARRAY['+rt.concat("link").map(function(n){return"'"+n+"'"}).join(", ")+"] AND "+et,ri="\"System.Kind\" = SOME ARRAY['program'] AND "+o,s='"System.Kind" != ANY ARRAY['+ti.map(function(n){return"'"+n+"'"}).join(", ")+"] AND "+o,d='"System.Kind" != ANY ARRAY['+ni.concat(rt).concat("folder").map(function(n){return"'"+n+"'"}).join(", ")+"] AND "+o,ui="\"System.Kind\" = SOME ARRAY['folder'] AND "+o,ht="\"System.Kind\" = SOME ARRAY['Music'] AND "+o,lt="\"System.Kind\" = SOME ARRAY['Picture'] AND "+o,at='"System.Kind" = SOME ARRAY['+it.map(function(n){return"'"+n+"'"}).join(", ")+"] AND "+o,fi="\"System.Kind\" != ANY ARRAY['game', 'calendar', 'web history', 'feed', 'contact', 'task', 'journal', 'note', 'instantmessage'] AND "+o,ei="SCOPE = 'file:"+ii+"' AND \"System.Kind\" = SOME ARRAY['folder'] AND "+o,oi=nu(p);r={};r.IFF=[{selectFields:i(e,!1),filterFieldsSets:[vt],mostRelevantProps:a,kindAndScopeClauses:st,sortClause:n.config.enableIndexerQueryExtensionSort?b(h):u,searchOptions:3,sfgaoFilter:w,enabled:function(t){return!!(t===null||t===void 0?void 0:t.queryToFetch)&&!n.supportsShortcuts("IFF",t)}},{selectFields:i(e,!1),filterFieldsSets:[],mostRelevantProps:a,kindAndScopeClauses:st,sortClause:n.config.enableIndexerQueryExtensionSort?b(h):u,searchOptions:0,sfgaoFilter:w,enabled:function(t){return!(t===null||t===void 0?void 0:t.queryToFetch)&&!n.supportsShortcuts("IFF",t)}},{selectFields:i(yt,!0),filterFieldsSets:[tr],mostRelevantProps:a,kindAndScopeClauses:s,sortClause:n.config.enableIndexerQueryExtensionSort?b(h):u,searchOptions:3,sfgaoFilter:t,enabled:function(t){return!!(t===null||t===void 0?void 0:t.queryToFetch)&&n.supportsShortcuts("IFF",t)}},{selectFields:i(yt,!0),filterFieldsSets:[],mostRelevantProps:a,kindAndScopeClauses:s,sortClause:n.config.enableIndexerQueryExtensionSort?b(h):u,searchOptions:0,sfgaoFilter:t,enabled:function(t){return t&&!t.queryToFetch&&n.supportsShortcuts("IFF",t)}},{selectFields:i(e,!0),filterFieldsSets:[ir],mostRelevantProps:a.concat(["System.Title"]),kindAndScopeClauses:s,sortClause:n.config.enableIndexerQueryExtensionSort?b(h):u,searchOptions:0,sfgaoFilter:t,enabled:function(t){return n.config.indexerQuerySimplified&&(t===null||t===void 0?void 0:t.queryToFetch.length)<=8&&!!(t===null||t===void 0?void 0:t.queryToFetch)}}];r.MDOC=[{selectFields:i(v,!0),filterFieldsSets:[pt.concat(er)],mostRelevantProps:k,kindAndScopeClauses:d,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:function(t){return(t===null||t===void 0?void 0:t.queryToFetch)&&n.config.minLengthForContentMatch&&(t===null||t===void 0?void 0:t.queryToFetch.length)>=n.config.minLengthForContentMatch}},{selectFields:i(v,!0),filterFieldsSets:[pt],mostRelevantProps:k,kindAndScopeClauses:d,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:function(t){return(t===null||t===void 0?void 0:t.queryToFetch)&&(!n.config.minLengthForContentMatch||(t===null||t===void 0?void 0:t.queryToFetch.length)<n.config.minLengthForContentMatch)}},{selectFields:i(v,!0),filterFieldsSets:[],mostRelevantProps:k,kindAndScopeClauses:d,sortClause:u,searchOptions:0,sfgaoFilter:t,enabled:function(n){return n&&!n.queryToFetch}},];r.MPVD=[{selectFields:i(v.concat(y).concat(y),!0),filterFieldsSets:[g],mostRelevantProps:k,kindAndScopeClauses:fi,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:function(n){return!!(n===null||n===void 0?void 0:n.queryToFetch)}}];r.MFOL=[{selectFields:i(or,!0),filterFieldsSets:[hr],mostRelevantProps:sr,kindAndScopeClauses:ui,sortClause:u,searchOptions:3,sfgaoFilter:t}];r.MPHO=[{selectFields:i(nt,!0),filterFieldsSets:[cr],mostRelevantProps:wt,kindAndScopeClauses:lt,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:function(n){return!!(n===null||n===void 0?void 0:n.queryToFetch)}},{selectFields:i(nt,!0),filterFieldsSets:[],mostRelevantProps:wt,kindAndScopeClauses:lt,sortClause:u,searchOptions:0,sfgaoFilter:t,enabled:function(n){return n&&!n.queryToFetch}},];r.MVID=[{selectFields:i(y,!0),filterFieldsSets:[lr],mostRelevantProps:bt,kindAndScopeClauses:at,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:function(n){return!!(n===null||n===void 0?void 0:n.queryToFetch)}},{selectFields:i(y,!0),filterFieldsSets:[],mostRelevantProps:bt,kindAndScopeClauses:at,sortClause:u,searchOptions:0,sfgaoFilter:t,enabled:function(n){return n&&!n.queryToFetch}},];r.MMUS=[{selectFields:i(kt,!0),filterFieldsSets:[ar],mostRelevantProps:dt,kindAndScopeClauses:ht,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:function(n){return!!(n===null||n===void 0?void 0:n.queryToFetch)}},{selectFields:i(kt,!0),filterFieldsSets:[],mostRelevantProps:dt,kindAndScopeClauses:ht,sortClause:u,searchOptions:0,sfgaoFilter:t,enabled:function(n){return n&&!n.queryToFetch}},];r.IBA=[{selectFields:i(rr,!0),filterFieldsSets:[fr],mostRelevantProps:ur,kindAndScopeClauses:ri,sortClause:u,searchOptions:3,sfgaoFilter:t}];r.MFF=[{selectFields:i(e,!1),filterFieldsSets:[vr],mostRelevantProps:null,kindAndScopeClauses:null,sortClause:null,searchOptions:0,sfgaoFilter:null}];r.LDIC=[{selectFields:i(e,!0),filterFieldsSets:[],mostRelevantProps:null,kindAndScopeClauses:ei,sortClause:u,searchOptions:0,sfgaoFilter:t}];r[ct]=[{selectFields:i(e,!0),filterFieldsSets:[],mostRelevantProps:null,kindAndScopeClauses:s,sortClause:u,searchOptions:0,sfgaoFilter:t}];r.ANA=[{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:oi,sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:function(t){return n.isDataSourceEnabled("ANA",null)&&!n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==0}},{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:function(t){return n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==1}},{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:function(t){return n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==2}},{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:function(t){return n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==3}},{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:function(t){return n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==4}},]}function wr(t,i,r,u,f){var e;return n.config.enableNaturalLanguageIndexerQuery?SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSqlFromNQSInput(t.queryToFetch).then(function(e){var o;return e&&e.length>0&&!n.config.enableNaturalLanguageIndexQueryCounterFactual?(n.InstrumentationHelper.notifyNaturalQuerySyntaxFetched(n.SequenceNumberManager.getSequenceNumber(),!0),Promise.resolve(e)):(n.InstrumentationHelper.notifyNaturalQuerySyntaxFetched(n.SequenceNumberManager.getSequenceNumber(),!1),ri((o=t===null||t===void 0?void 0:t.queryToFetch)!==null&&o!==void 0?o:"").then(function(n){return ot(t,n,i,r,u,f)}))}):ri((e=t===null||t===void 0?void 0:t.queryToFetch)!==null&&e!==void 0?e:"").then(function(n){return ot(t,n,i,r,u,f)})}function br(n,t,i,r){var u=o(t,n),f="SELECT TOP "+i.length+" "+d(u.selectFields)+" FROM SystemIndex WHERE "+uu(u,i,r),e=st(r);return e!=""&&(f+=" AND "+e),f}function kr(t,i){var r=o(t,null),e=n.config.maxDeviceItemCacheSize,u="SELECT TOP "+e+" "+d(r.selectFields)+" FROM SystemIndex WHERE ",f=st(i);return f!=""&&(u+=f+" AND "),u+r.kindAndScopeClauses}function dr(){var n=o(ct,null),t="WorkId, "+d(n.selectFields),i=n.kindAndScopeClauses;return"SELECT "+t+" FROM SystemIndex WHERE "+i+" ORDER BY "+n.sortClause}function gr(n,t){r&&r[n]&&r[n][t]&&(r[n][t].kindAndScopeClauses=tu(p,t))}function nu(t){var i=(n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getExpirationThreshold())?n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getExpirationThreshold():14,r='"System.DateCreated" > DATEADD(day, -'+i+", GETGMTDATE())",u="(SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Canary/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Dev/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Beta/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Stable/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/undefined/Profiles/')";return r+" AND "+u}function ii(t,i,r,u){var f="";return f+='"System.DateCreated" > DATEADD(day, -'+(n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getExpirationThreshold())+", GETGMTDATE()) AND (",f+=et(t,i,r,u),f+")"}function et(n,t,i,r){for(var f="",u=0;u<i.length;u++){if(f+="SCOPE = 'winrt://{"+n+"}/LS/Desktop/Microsoft Edge/"+i[u].displayName+"/"+r.displayName+"/"+t+"/'",u==i.length-1)break;f+=" OR "}return f}function tu(t,i){var r=n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getAvailableChannels(),u=n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getSelectedProfile();if(r&&u)switch(i){case 1:return ii(t,"History",r,u);case 2:return et(t,"QuickLinks",r,u);case 3:return ii(t,"RecentlyClosed",r,u);case 4:return et(t,"Favorites",r,u)}return""}function ot(n,t,i,r,u,f){var h,c,a=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getLCIDStringForText((h=n===null||n===void 0?void 0:n.queryToFetch)!==null&&h!==void 0?h:""),e=n.taskFrame?au(u,n.taskFrame.parsed,a):o(u,n),s="SELECT TOP "+r+" "+d(e.selectFields)+" FROM SystemIndex",v=fu(e,(c=n===null||n===void 0?void 0:n.queryToFetch)!==null&&c!==void 0?c:"",t,i,e.searchOptions,a,f),l;return v!=""&&(s=s+" WHERE "+v,l=st(f),l!=""&&(s+=" AND "+l)),s+(" ORDER BY "+e.sortClause)}function iu(n){var f,i,r,t,u;if(n.kind=="link"||n.kind=="program")for(f=n.getProperty("System.Kind"),i=0,r=f;i<r.length;i++){if(t=r[i],t=="program")return ru(n,t);if(t!="link")return u={displayName:n.displayName,id:n.id,kind:t,getProperty:function(t){return n.getProperty(t)},propertyHits:n.propertyHits,rankScore:n.rankScore,getImageAsync:function(t){return n.getImageAsync(t)},imageType:n.imageType,canHaveContextMenu:n.canHaveContextMenu,getVerbsAsync:function(){return n.getVerbsAsync()},extension:n.extension,itemTypeDisplayName:n.itemTypeDisplayName,createdDate:n.createdDate,lastModifiedDate:n.lastModifiedDate},u.originalDeviceItem=n,u}return n}function ru(t,i){var r=t.displayName,u,f;return r.toLocaleLowerCase().endsWith(".lnk")&&(r=r.substr(0,r.length-4)),u=n.indexerFilePathToRegularPath(t.id),f={displayName:r,id:u,kind:i,getProperty:function(n){return t.getProperty(n)},propertyHits:t.propertyHits,rankScore:t.rankScore,getImageAsync:function(n){return t.getImageAsync(n)},imageType:t.imageType,canHaveContextMenu:t.canHaveContextMenu,getVerbsAsync:function(){return t.getVerbsAsync()},extension:t.extension,itemTypeDisplayName:t.itemTypeDisplayName,createdDate:t.createdDate,lastModifiedDate:t.lastModifiedDate,filePath:u,lastAccessed:t.getProperty("System.DateAccessed"),version:null,isImmersive:!1,logoBackgroundColor:null,launchArguments:null,totalLaunches:null,isTrustedApp:!1,packageFamilyName:null,jumpList:null,getJumpListAsync:null,voiceCommandExamples:null,rawIndexResponse:null},f.originalDeviceItem=t,f}function d(n){return n.map(function(n){return n=="System.ParsingPath"?"path":'"'.concat(n,'"')}).join(",")}function st(t){return n.config.useWhereId&&t?"ReuseWhere("+t+") ":""}function uu(n,t){return"("+ou(n,t)+")"}function fu(n,t,i,r,u,e){var o="",s,h;return n.mostRelevantProps.length>0&&(o+="WITH ("+n.mostRelevantProps.join(", ")+") AS #MRProps "),s=su(n,t,i,u,e),s&&(o+="("+s+") AND "),h=r?f(r):r,h&&(o+="(Scope = '"+h+"') AND "),o+n.kindAndScopeClauses}function eu(n,t){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.tokenize(n,t)}function ri(n){return SearchAppWrapper.CortanaApp.queryFormulationView.getLinguisticDataAsync(n)}function ui(t,i){var r="",u=t.filterFieldsSets.length>1;return t.filterFieldsSets.forEach(function(t){var s,f,h,l,e,o,c,a;for(u&&(r?r+=") AND (":r="("),s=!0,f=0,h=t;f<h.length;f++){for(l=h[f],e=!1,o=0,c=i;o<c.length;o++)a=c[o],s?(r+="(",s=!1):r+=e?" OR ":" OR (",r+=n.formatString(l,[a]),e=!0;e&&(r+=")")}}),u&&(r+=")"),r}function ou(n,t){var i=t.map(function(n){return ht(n)});return ui(n,i)}function su(n,t,i,r,u){var o=[t],e,f;return(i===null||i===void 0?void 0:i.alternatives)&&i.alternatives.forEach(function(n){return o.push(n)}),e=o.map(function(n){return ht(n)}),f=ui(n,e),(r&2)==2&&(f=hu(r,i,e,f,u)),f}function hu(t,i,r,u,f){for(var k,c,l,p,e,s,v,w,d,g=cu(t),h=!1,y=0,b=g;y<b.length;y++){for(k=b[y],c=!1,l=0,p=r;l<p.length;l++){var nt=p[l],a=[],o=eu(nt,i.language);if(h&&n.config.indexerQueryMWLimit){if((t&4)==0||o.length<=n.config.indexerQueryMWLimit)for(e=0;e<Math.min(o.length,n.config.indexerQueryMWLimit);++e)a.push(o[e])}else if((t&4)==0||o.length<=at)for(e=0;e<Math.min(o.length,at);++e)a.push(o[e]);if(a.length>1){for(s="",v=0,w=a;v<w.length;v++)d=w[v],s&&(s+=" AND "),s+='"'+d+(h?'*"':'"');u?u+=c?" OR ":" OR (":u="(";u+=n.formatString(k,[s,f]);c=!0}}c&&(u+=")");h=!h}return u}function cu(n){var t=[];return t.push("CONTAINS(#MRProps, '{0}', {1}) RANK BY COERCION(ABSOLUTE, 600)"),(n&1)==1&&t.push("CONTAINS(#MRProps, '{0}', {1}) RANK BY COERCION(ABSOLUTE, 550)"),t}function fi(n,t){return n.length>0&&(n=n.replace(/'/g,"''"),n=n.replace(/"/g," "),t>=2&&(n=n.replace(/%/g,"[%]"),n=n.replace(/_/g,"[_]"),n=n.replace(/\[/g,"[[]"),t==3?(n=n.replace(/\*/g,"%"),n=n.replace(/\?/g,"_")):(n=n.replace(/\*/g," "),n=n.replace(/\?/g," ")))),n}function f(n){return fi(n,1)}function ht(n){return fi(n,2)}function lu(n){var t=w[n];if(t)return t;throw new Error("select fields for NL Data source was not found: "+n);}function s(n,t,i){for(var u=[],r=3;r<arguments.length;r++)u[r-3]=arguments[r];typeof i=="string"?(i=ht(i),t.push(u.map(function(t){return"CONTAINS(".concat(t,",'\"").concat(i,"*\"',").concat(n,") RANK BY COERCION(ABSOLUTE, 1000)")}))):i&&i.Value&&s.apply(void 0,__spreadArray([n,t,i.Value],u,!1))}function au(n,t,i){var f=[],e='"System.Kind" != ANY ARRAY['+ut+"]",o,r;if(t.FileType&&t.FileType.Value){o=t.FileType.Value;switch(o){case"Document":break;case"Picture":e="\"System.Kind\" = SOME ARRAY['Picture']";break;case"Video":e='"System.Kind" = SOME ARRAY['+it.map(function(n){return"'"+n+"'"}).join(", ")+"]";break;case"Powerpoint":case"Word":case"Excel":e="CONTAINS(System.ItemType,'\""+ei[o]+"*\"',"+i+') RANK BY COERCION(ABSOLUTE, 1000) AND "System.Kind" != ANY ARRAY['+ut+"]";break;default:e='"System.Kind" != ANY ARRAY['+ut+"]";s(i,f,o,"System.ItemType","System.ItemTypeText")}}return s(i,f,t.Title,"System.ItemNameDisplay","System.Title"),s(i,f,t.Body,"System.ItemNameDisplay","System.Title","System.FileDescription","System.Keywords","System.Search.Contents"),t.People&&t.People.forEach(function(n){var t=n.Value;t&&s(i,f,t=="me"?SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.userName:t,"System.Author","System.FileOwner","System.Document.LastAuthor","System.Photo.TagViewAggregate")}),s(i,f,t.Place,"System.Photo.TagViewAggregate"),r=vu(t.Time),r&&f.push(["System.DateCreated>='"+r[0]+"' AND System.DateCreated<'"+r[1]+"'","System.DateModified>='"+r[0]+"' AND System.DateModified<'"+r[1]+"'","System.DateAccessed>='"+r[0]+"' AND System.DateAccessed<'"+r[1]+"'","System.DateArchived>='"+r[0]+"' AND System.DateArchived<'"+r[1]+"'","System.DateAcquired>='"+r[0]+"' AND System.DateAcquired<'"+r[1]+"'",]),{selectFields:lu(n),filterFieldsSets:f,kindAndScopeClauses:e?e+" AND "+tt:tt,mostRelevantProps:[],searchOptions:0,sortClause:u,sfgaoFilter:gt}}function vu(t){var i,f,u,e,r;return t?(i=t.value,!i)?null:(f=i.indexOf("T"),f!=-1&&(i=i.substr(0,f)),u=i.split("-"),u.length<2||u.length>3)?null:(e=new Date(i),!n.isValidDate(e))?null:(r=new Date(i),u.length==3?r.setUTCDate(r.getUTCDate()+1):r.setUTCMonth(r.getUTCMonth()+1),[oi(e),oi(r)]):null}function oi(n){var t=n.toISOString();return t.substr(0,t.indexOf("T"))}function si(t,i,r){var u,h,c,e,o,s,l,a,v;r||(u="NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['hidden'] AND NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['system'] AND NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['link']");r?h=function(n){return!(n&wi)&&!(n&pi)&&(!!(n&&bi)||n&&di&&!!(n&&lt)||n&&ki&&!!(n&&lt))}:(u+=" AND (System.Shell.SFGAOFlagsStrings = SOME ARRAY['stream']",u+=" OR (System.Shell.SFGAOFlagsStrings = SOME ARRAY['fileanc'] AND System.Shell.SFGAOFlagsStrings = SOME ARRAY['folder'])",u+=" OR (System.Shell.SFGAOFlagsStrings = SOME ARRAY['storageanc'] AND System.Shell.SFGAOFlagsStrings = SOME ARRAY['folder'])",u+=")");r?u="System.Shell.OmitFromView != 'true'":u+=" AND System.Shell.OmitFromView != 'true'";c=f(n.getKnownFolderPathLC(n.FOLDERID_Profile));switch(t){case 0:e=f(n.getKnownFolderPathLC(li));u+=" AND (Scope = 'file://' OR Scope = 'csc://{"+i+"}') AND (Scope <> 'file:"+c+"\\AppData') AND (Scope <> 'file:"+e+"\\Default\\AppData') AND (Scope <> 'file:"+e+"\\Administrator\\AppData')";o=f(n.getKnownFolderPathLC(hi));s=f(n.getKnownFolderPathLC(ci));u+=" AND (Scope <> 'file:"+o+"')";s!=o&&(u+=" AND (Scope <> 'file:"+s+"')");l=f(n.getKnownFolderPathLC(ai));u+=" AND (Scope <> 'file:"+l+"')";a=f(n.getKnownFolderPathLC(vi));u+=" AND (Scope <> 'file:"+a+"')";r&&(v=f(n.getKnownFolderPathLC(yi)),u+=" AND (Scope <> 'file:"+v+"')");break;case 1:u+=" AND (Scope = 'file://' OR Scope = 'csc://{"+i+"}')";break;default:throw new Error("Unknown SearchScope: "+t);}return[u,h]}function b(n){for(var e,i="CASE ",r=1,t=0,f=n;t<f.length;t++)e=f[t],i+="WHEN 'System.FileExtension' = "+e+" THEN "+r.toString()+" ",r+=1;return i+("ELSE 999 END ASC, "+u)}var ct="PRIME",hi="{905e63b6-c1bf-494e-b29c-65b732d3d21a}",ci="{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}",li="{0762D272-C50A-4BB0-A382-697DCD729B80}",ai="{A4115719-D62E-491D-AA7C-E74B8BE3B067}",vi="{0482af6c-08f1-4c34-8c90-e17ec98b1e17}",yi="{bfb9d5e0-c6a9-404c-b2b2-ae6db6af4968}",pi=4096,wi=524288,bi=4194304,lt=536870912,ki=8388608,di=268435456,at=3,u='"System.Search.Rank" DESC, "System.DateModified" DESC, "System.ItemNameDisplay" ASC',h=['".exe"','".xlsx"','".lnk"','".docx"','".xls"','".doc"','".bat"','".pptx"','".pdf"','".txt"',],gi=["System.Kind","System.Search.Rank","System.ParsingPath","System.DateCreated","System.DateModified","System.Search.QueryPropertyHits","System.ItemNameDisplay","System.FileExtension","System.ItemType",],nr=["System.Link.TargetParsingPath","System.SFGAOFlags",],c='"System.DateCreated" DESC, "System.Link.DateVisited" DESC, "System.History.VisitCount" DESC, "System.History.SelectionCount" DESC',l=["System.ApplicationName","System.Document.Version","System.Identity","System.Status","System.ContentType","System.ProviderItemID","System.Link.TargetUrl","System.Title","System.Link.DateVisited","System.History.VisitCount","System.History.SelectionCount",],e=["System.Title","System.Music.AlbumTitle","System.Music.DisplayArtist"],a=["System.ItemNameDisplay","System.Music.DisplayArtist","System.Music.AlbumTitle",],vt=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 960)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 760)","CONTAINS(System.Music.AlbumTitle, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 660)",],yt=e.concat("System.DateAccessed"),tr=vt.concat(["CONTAINS(System.Link.TargetParsingPath, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 920)"]),ir=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 960)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Link.TargetParsingPath, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 920)",],rr=["System.DateAccessed",],ur=["System.ItemNameDisplay",],fr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Link.TargetParsingPath, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 795)",],v=["System.Search.AutoSummary","System.Keywords","System.Title","System.Author","System.Document.LastAuthor",],k=["System.ItemNameDisplay","System.Keywords","System.Title",],g=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Photo.TagViewAggregate, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)",],w,ei;n.config.onlyWhereContains||(g=g.concat(["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 999)","System.Title = '{0}' RANK BY COERCION(ABSOLUTE, 980)","System.Keywords = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Photo.TagViewAggregate = '{0}' RANK BY COERCION(ABSOLUTE, 940)","System.Music.DisplayArtist = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Music.Genre = '{0}' RANK BY COERCION(ABSOLUTE, 950)",]));var pt=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)",],er="CONTAINS(System.Search.Contents, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 545)",or=[],sr=["System.ItemNameDisplay",],hr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)",],nt=["System.Photo.TagViewAggregate","System.Title",],wt=["System.ItemNameDisplay","System.Photo.TagViewAggregate",],cr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Photo.TagViewAggregate, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)",],y=["System.Title","System.Keywords","System.Music.DisplayArtist","System.Music.Genre",],bt=["System.ItemNameDisplay","System.Title","System.Keywords",],lr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)",],kt=["System.Title","System.Music.DisplayArtist","System.Music.AlbumTitle","System.Music.Genre",],dt=["System.ItemNameDisplay","System.Title","System.Music.AlbumTitle",],ar=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Music.AlbumTitle, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 865)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)",],vr=["path = '{0}'"],r;t.getStrategy=o;t.dataSourceSupported=yr;t.suppress=pr;var p,tt,gt,it=["Movie","RecordedTV","Video"],ni=it.concat(["Picture","Music"]),ti=["calendar","game","web history","feed","contact","task","journal","note","instantmessage"],rt=ti.concat("program"),ut=ni.concat(rt).concat(["folder","link"]).map(function(n){return"'"+n+"'"}).join(",");t.initStrategies=ft;t.generateIndexerQueryAsync=wr;t.generateIndexerQueryForMRUFilesAndFolders=br;t.generateIndexerQueryForDeviceItemCache=kr;t.generateIndexerPrimerQuery=dr;t.updateAnaheimStrategy=gr;t.generateIndexerQuery=ot;t.fixKind=iu;w={};w.MPHO=i(nt,!1);w.MVID=i(y,!1);w.MDOC=i(v,!1);ei=function(){var n={};return n.Powerpoint="ppt",n.Word="doc",n.Excel="xls",n}()})(t=n.IndexerQueryGenerator||(n.IndexerQueryGenerator={}))}(WSB||(WSB={})),function(n){function c(t,i,r,u,f,e,o,s){var h=u?r+" "+i:r;return n.Async.safeChainWithGlobalCaching("getIcon",function(i){return t.getImageAsync(n.getImageSizeValue(i))},function(n){return n+"_"+i},function(t){return n.toIcon(t,"getIcon.toIcon",e,o,h)},e,f?function(){return(t===null||t===void 0?void 0:t.imageType)===0}:null,h,null,s)}function t(t,i,r,u,f,e){return{deviceItem:t,getIcon:c(t,t.id,r,r&&!n.localDataSourceMayContainPII(r),n.displayedInGridLayout(i),u,f,0),icon:e?u:null,suggestionType:i}}function l(n,t,i){return{deviceItem:n,icon:i,suggestionType:t}}function lt(n){return n.map(function(n){return{isSimulated:!0,displayName:n,id:null,kind:null,getProperty:null,propertyHits:null,rankScore:null}})}function a(){n.config.enableFetchStartLogging&&n.InstrumentationHelper.instrumentFetchProviderBegin(n.SequenceNumberManager.getSequenceNumber(),"TOPP");var t=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getAllAppsAsync();return t.then(function(t){var r=[],u,i;for(u in t)(i=t[u],i)&&(n.config.allowZeroLaunchTopApps||i.totalLaunches>0)&&!n.contains(ct,i.id)&&r.push(i);return n.config.minTopApps&&r.length<n.config.minTopApps?[]:r}).then(function(n){return n}).then(function(n){return n}).then(function(t){return t.sort(function(t,i){return t.totalLaunches!==0||i.totalLaunches!==0?i.totalLaunches-t.totalLaunches:n.contains(e,t.id)?n.contains(e,i.id)?e.indexOf(t.id)-e.indexOf(i.id):-1:n.contains(e,i.id)?1:0}),[].concat(t)})}function i(t,i,r){switch(t){case"program":return"IBA";case"picture":return i&&n.contains(v,i.toLowerCase())?"FL":"LI";case"video":return i&&n.contains(y,i.toLowerCase())?"FL":"LV";case"movie":case"recordedtv":return"LV";case"music":return"MU";case"folder":return"FD";default:return r}}function o(t,i,r,u,f,e,o,s,h){var l=o&&h?t.filter(function(t){return n.contains(Object.keys(tt),t)}):[],c;l.length>0&&(t=t.filter(function(t){return!n.contains(l,t)}));c=function(t){for(var u,e,r=0,f=l;r<f.length;r++)u=f[r],e=tt[u],t[u]={deviceItem:{id:u,displayName:n.Host.getLocString(e.locStringKey),kind:null,getProperty:function(){return null},propertyHits:[],rankScore:1e3},icon:e.icon};i(t)};n.safeExecute(function(){var h,i,l,a,v;if(t.length==0)c({});else{if(h={},i=t.slice(0),s)for(l=t.length-1;l>=0;--l)a=t[l],s.hasOwnProperty(a)&&(h[a]=s[a],i.splice(l,1));i.length==0?c(h):(v=!o||n.localDataSourceMayContainPII(o)?o:o+" "+i,n.Async.safeChain(r,function(){return u(i)},function(r){var e=n.Map.map(i,r,function(n){return f(n)}),u;if(s&&i.forEach(function(n){return s[n]=e[n]}),i.length!=t.length)for(u in h)h.hasOwnProperty(u)&&(e[u]=h[u]);c(e)},function(){return c({})},e,v))}},"resolveIdsWithCache",null,o,function(){return c({})})}function pt(n,t){if(!t.launchArguments||yt.test(n.query))return!0;var i=t.id.toLowerCase();return it.some(function(n){return i.includes(n)})?!0:!1}function rt(t,i,r,u,f){if(!f)return!1;var o=t.displayName.toLocaleLowerCase(),e=i.queryToFetch.toLocaleLowerCase(),s=null;if(f.Parses&&f.Parses.length>0&&f.Parses[0].SubParses&&f.Parses[0].SubParses.length>1&&f.Parses[0].SubParses[0].Interpretation&&f.Parses[0].SubParses[0].Interpretation==="regex"&&e.length>=f.Parses[0].SubParses[0].QueryEnd&&f.Query!=null){if(e.length===f.Parses[0].SubParses[0].QueryEnd)return!0;e=e.substr(f.Parses[0].SubParses[0].QueryEnd+1);f.Query=f.Query.substr(f.Parses[0].SubParses[0].QueryEnd+1)}return e.length<n.config.filterCICandidatesPrefixLength&&!ut(e,o)&&(s=n.matchesOnPropertyHH(o,e),!s)?!0:dt(o,e,t,r,u,f)?!0:!1}function dt(t,i,r,u,f,e){var o,s,h;return!i||!e||!e.MatchScore||!e.Parses||e.Parses.length==0||!e.Parses[0].Entities||e.Parses[0].Entities.length==0||!e.Query?!1:t.startsWith(i)&&i.length>=n.config.filterCICandidatesPrefixLength?!1:(o=e.Query,o.startsWith(i))?!1:n.config.bypassCIFilterOnSubstringMatch&&t.split(" ").some(function(n){return n.startsWith(i)})?!1:(s=t.startsWith(o),!s)?!0:(h=1,f.Counter>=h)?!0:(f.Counter++,!1)}function ut(n,t){var r,i;if(!!t&&t.length==0||(r=t.split(" "),n.length!=r.length))return!1;for(i=0;i<r.length;i++)if(r[i].length==0||r[i][0]!=n[i])return!1;return!0}function ft(n){var i=n.id.toLowerCase(),t;if(i.startsWith("http:")||i.startsWith("https:")||n.kind=="link"&&i.endsWith(".url"))return 1;if(i.startsWith("file:")||n.kind=="document")return 0;if(t=n.filePath,t&&(t=t.toLowerCase(),t!=i)){if(t.startsWith("http:")||t.startsWith("https:")||n.kind=="link"&&t.endsWith(".url"))return 1;if(t.startsWith("file:"))return 0}return 2}function et(n,t){if(t.dataSource=="PP"){var i=ft(n);if(i==1)return"LURL";if(i==0)return"LDOC"}return t.getSuggestionType(n)}function ot(t){return t&&t.rawIndexResponse?n.safeExecute(function(){return JSON.parse(t.rawIndexResponse)},"parseConstraintIndexMetaData"):undefined}function st(t,i,r,u,f,e){var w,a,s,p,c,o,v,l,h;if(n.IndexerQueryGenerator&&n.IndexerQueryGenerator.suppress(i,t,u))return!0;if(r=="PP")return(w=i.id,n.contains(wt,w))?!0:(a=i,rt(a,t,!0,f,e))?!0:(s=i.kind,s&&(s=s.toLocaleLowerCase(),s!="program"&&s!="unknown"))?!0:u=="LRA"&&ft(a)!=2?!0:(p=a.extension,p&&p.toLowerCase()==".chm")?!0:!1;if(r!="LURL"&&i.kind=="link"&&n.RuntimeConfig.QfMode!=5)return!0;if(n.isSetting(r))return rt(i,t,!1,f,e)?!0:!1;if((c=i,!n.IndexerQueryGenerator&&u=="MDOC"&&c.propertyHits.length==1&&c.propertyHits[0]=="System.Search.Contents"&&(!n.config.minLengthForContentMatch||t.queryToFetch.length<n.config.minLengthForContentMatch))||(o=c.id,o&&(n.RuntimeConfig.QfMode!=5&&(o.includes("\\.")||o.includes("/."))||(o=o.toLowerCase(),t.queryToFetch.toLocaleLowerCase()!=i.displayName.toLocaleLowerCase()&&kt.some(function(n){return o.includes("\\"+n+"\\")||o.includes("/"+n+"/")}))))||(v=c.extension,v&&n.RuntimeConfig.QfMode!=5&&!t.queryToFetch.toLowerCase().includes(v.toLowerCase())&&n.contains(bt,v.toLowerCase())))return!0;if(r=="CG"){if(l=i,h=l.displayName.split(" ")[0].toLowerCase(),h.includes("\\")||h.indexOf(":")==1)return!1;var y=l.id.toLowerCase(),b=y.lastIndexOf("."),k=y.lastIndexOf("\\"),d=l.kind=="folder"||b<0||b<k;if(d&&!h.includes("%")||![".exe",".com"].some(function(n){return h.includes(n)})&&(at.some(function(n){return y.includes(n)})||!l.launchArguments&&it.some(function(n){return y.includes(n)})||n.contains(vt,h)))return!0}return!1}var s=":wux:",h="Classic_{87d66a43-7b11-4a28-9811-c86ee395acf7}",ct=["Microsoft.XboxGamingOverlay_8wekyb3d8bbwe!App"],e=["Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge","windows.immersivecontrolpanel_cw5n1h2txyewy!microsoft.windows.immersivecontrolpanel","Microsoft.WindowsCalculator_8wekyb3d8bbwe!App","Microsoft.ScreenSketch_8wekyb3d8bbwe!App","{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}\\mspaint.exe","{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\mspaint.exe"],v,y,ht,f;n.getIcon=c;n.createLocalResponseSuggestionWithDeviceItemImage=t;n.fetchForTopLocalApps=a;v=[".dwg",".ai",".psd"];y=[".ts"];n.getSuggestionTypeFromKindAndExtension=i;var p={getResultsContainer:function(n){return n.apps},dataSource:"PP",getSuggestionType:function(){return"PP"},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Apps].icon,i.isImmersive?i.logoBackgroundColor:undefined)},supportsEmptyQuery:!0},w={getResultsContainer:function(n){return n.settings},dataSource:"ST",getSuggestionType:function(){return"ST"},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(i,r,u){if(n.isModernSetting(i)){var f=i.glyph,e=void 0;return e=n.config.useCobaltCSS&&i.glyphFontFamily==="Settings Fluent Icons"?{content:f,type:8}:f?{content:f,type:1}:n.ScopeConfig[n.Scope.Settings].icon,l(i,r,e)}return t(i,r,u,n.ScopeConfig[n.Scope.Settings].icon)},supportsEmptyQuery:!1},b=[p,w,{getResultsContainer:function(n){return n.media},dataSource:"LM",getSuggestionType:function(n){return i(n.kind,n.extension,"FL")},maxUpTo3chars:7,maxAfter3chars:10,maxAfter8charsOrInL2ZeroInput:20,supportsEmptyQuery:!0},{getResultsContainer:function(n){return n.files},dataSource:"FL",getSuggestionType:function(n){return i(n.kind,n.extension,"FL")},maxUpTo3chars:7,maxAfter3chars:10,maxAfter8charsOrInL2ZeroInput:20,supportsEmptyQuery:!0},{getResultsContainer:function(){throw Error("Only supported via IndexerQuery");},dataSource:"IBA",getSuggestionType:function(){return"IBA"},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Apps].icon)},supportsEmptyQuery:!1},{getResultsContainer:function(){throw Error("Only supported via IndexerQuery");},dataSource:"IFF",getSuggestionType:function(n){return i(n.kind,n.extension,"FL")},maxUpTo3chars:7,maxAfter3chars:15,maxAfter8charsOrInL2ZeroInput:25,supportsEmptyQuery:!0},],k=[{getResultsContainer:function(n){return n.files},dataSource:"MDOC",getSuggestionType:function(n){return i(n.kind,n.extension,"FL")},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Documents].icon,null,!0)},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.folders},dataSource:"MFOL",getSuggestionType:function(n){return i(n.kind,n.extension,"FD")},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Folders].icon,null,!0)},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.pictures},dataSource:"MPHO",getSuggestionType:function(n){return i(n.kind,n.extension,"LI")},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Photos].icon,null,!0)},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.video},dataSource:"MVID",getSuggestionType:function(n){return i(n.kind,n.extension,"LV")},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Videos].icon,null,!0)},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.music},dataSource:"MMUS",getSuggestionType:function(){return"MU"},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Music].icon,null,!0)},supportsEmptyQuery:!1},{getResultsContainer:function(n){return n.files},dataSource:"MPVD",getSuggestionType:function(n){return i(n.kind,n.extension,"FL")},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Documents].icon,null,!0)},supportsEmptyQuery:!1},],d=[{getResultsContainer:function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.startPathCompletionQuery(n.originalQuery,"")},dataSource:"PT",getSuggestionType:function(){return"PT"},maxUpTo3chars:15,maxAfter3chars:15,maxAfter8charsOrInL2ZeroInput:15,customCancellation:function(){return SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastPathCompletionQuery()},supportsEmptyQuery:!1},{getResultsContainer:function(){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getRecentAppsAsync()},getResults:function(n){return n},dataSource:"LRA",getSuggestionType:function(){return"PP"},customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Apps].icon,i.isImmersive?i.logoBackgroundColor:undefined)},supportsEmptyQuery:!0},{getResultsContainer:function(t){return ThresholdUtilities.createPromise(function(i){var r=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.recentSearches||[],u,f,e;r=r.filter(function(n){return!!n});r.length>0&&t.queryToFetch&&(u=n.escapeRegex(t.queryToFetch),f=u.split(/\s+/).filter(function(n){return!!n}).map(function(n){return new RegExp("^"+n+"| "+n,"i")}),r=r.filter(function(n){return f.every(function(t){return t.test(n)})}));e=lt(r);i(e)})},getResults:function(n){return n},dataSource:"FEH",getSuggestionType:function(){return"FEH"},customCreateLocalResponseSuggestion:function(n,t){return l(n,t,{type:2,content:"&#xE81C"})},supportsEmptyQuery:!0},{getResultsContainer:function(){return a()},getResults:function(n,t){return n.then(function(n){return t?n.slice(0,t):n})},dataSource:"TOPP",getSuggestionType:function(){return"TOPL"},customGetMax:function(t){return n.shouldShowStaticSearchHome(t)?6:5},customCreateLocalResponseSuggestion:function(i,r,u){return t(i,r,u,n.ScopeConfig[n.Scope.Apps].icon,i.isImmersive?i.logoBackgroundColor:undefined)},supportsEmptyQuery:!0},{getResultsContainer:function(n){return ThresholdUtilities.createPromise(function(t){var i=r?r.retrieveItemsFromCache(n.queryToFetch):[];t(i)})},getResults:function(n){return n},dataSource:"LDIC",getSuggestionType:function(n){return i(n.kind,n.extension,"FD")},maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,supportsEmptyQuery:!1},],g=[{getResultsContainer:function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.startCommandLineQuery(n.originalQuery,"")},dataSource:"CG",getSuggestionType:function(){return"CG"},customCancellation:function(){return SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastCommandLineQuery()},supportsEmptyQuery:!1},];n.LocalDataProviderDataSources=b.concat(k).concat(d).concat(g).map(function(n){return n.dataSource});var u={suggestions:[],maxedOut:!1},nt={},r,tt={"shell:RecycleBinFolder":{icon:{content:"&#xEF87",type:2},locStringKey:"RecycleBin"}};var at=["\\system32\\user.exe","\\system32\\sidebar.exe","\\system32\\at.exe","\\system32\\change.exe","\\system32\\control.exe","\\system32\\find.exe","\\system32\\net.exe","\\system32\\share.exe","\\system32\\rundll32.exe","\\system32\\append.exe","\\system32\\choice.exe","\\system32\\clip.exe","\\system32\\comp.exe","\\system32\\compact.exe","\\system32\\consent.exe","\\system32\\convert.exe","\\system32\\format.exe","\\system32\\graphics.com","\\system32\\label.exe","\\system32\\mem.exe","\\system32\\mode.com","\\system32\\more.com","\\system32\\recover.exe","\\system32\\replace.exe","\\system32\\reset.exe","\\system32\\shadow.exe","\\system32\\sort.exe","\\system32\\tree.com","\\system32\\webcam.exe","\\system32\\systemsettings.exe","\\system32\\command.com","\\system32\\tabtip.exe","\\system32\\services.exe","\\system32\\help.exe","\\system32\\where.exe","\\system32\\skydrive.exe","\\system32\\calc.exe","\\system32\\fc.exe","\\accessories\\wordpad.exe",n.config.blocklistNotepadCommand?"\\system32\\notepad.exe":null,].filter(function(n){return!!n}),it=["\\system32\\finger.exe","\\system32\\ping.exe","\\system32\\print.exe","\\system32\\shutdown.exe","\\system32\\expand.exe","\\system32\\tskill.exe","\\system32\\reg.exe","\\system32\\sc.exe",],vt=["uninstall","outlook","excel","skype","nero","onenote","lync","vmware","firefox","itunes","photoshop","print","opera","visio","thunderbird","smartscreen"],yt=/[\/\.\-\\]/;n.isRealCommand=pt;var wt=["Microsoft.Cortana_8wekyb3d8bbwe!CortanaUI","Microsoft.Windows.Cortana_cw5n1h2txyewy!CortanaUI",],bt=[".dll",".pdb",".obj",".bin",".etl",".bak",".config",".resx",".manifest",".ini",".searchconnector-ms",".settingcontent-ms",".vstx",".vssx",".ms-one-stub",],kt=["visio content","bin","debug","obj","objd","amd64","x86","microsoftedgebackups",];n.isInitials=ut;n.getSuggestionTypeOverride=et;n.parseConstraintIndexMetaData=ot;n.isSuppressed=st;ht=function(){function e(t,i){var u=this;this._previousKeystrokeCache=t;i&&(r=i,n.Host.bindShown(function(){r&&(r.clean(),u.cacheDeviceItems())}));n.Host.bindAppHidden(function(){nt={}})}return e.prototype.getName=function(){return"LocalDataProvider"},e.setWhereId=function(n){var i,t;if(!n||n.close){if(e.lastResultHandle&&!n){(t=(i=e.lastResultHandle).close)===null||t===void 0?void 0:t.call(i);e.lastResultHandle=null;return}e.lastResultHandle=n}},e.prototype.fetch=function(t,i,r,u,o){var it=this,rt,ut,ft,et,s,c,ot,a,st,h,v,at,y,ht,p,vt,yt,w,ct,nt,pt,wt,tt,lt,l;if(u&&u.register(function(){return n.Async.clearPendingItemsFromCache()},!1,"clearPendingItemsFromCache"),s=[],c=b.filter(function(i){return n.isDataSourceEnabled(i.dataSource,t)}),n.IndexerQueryGenerator&&(s=s.concat(c.filter(function(t){return n.IndexerQueryGenerator.dataSourceSupported(t.dataSource)})),c=c.filter(function(t){return!n.IndexerQueryGenerator.dataSourceSupported(t.dataSource)})),c.length>0){if(!t.queryToFetch&&!c.every(function(n){return n.supportsEmptyQuery}))throw new Error(f);if(u&&u.register(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastDeviceQuery()},!1,"cancelLastDeviceQuery"),ot=n.safeExecute(function(){var i=n.Host.getRawImpressionGuid();return n.config.logClientPerf&&n.InstrumentationHelper.instrumentDeviceQueryBegin(i),SearchAppWrapper.CortanaApp.queryFormulationView.startDeviceQuery(t.queryToFetch,i)},"startDeviceQuery",null,t.queryToFetch),ot)for(a=0,st=c;a<st.length;a++)l=st[a],this.searchFolderWithMultipleResults(t,l,ot,i,o,u,(rt=e.lastResultHandle)===null||rt===void 0?void 0:rt.whereId);else this.emptyFetch(c,i)}if(h=k.filter(function(i){return n.isDataSourceEnabled(i.dataSource,t)}),n.IndexerQueryGenerator&&(s=s.concat(h.filter(function(t){return n.IndexerQueryGenerator.dataSourceSupported(t.dataSource)})),h=h.filter(function(t){return!n.IndexerQueryGenerator.dataSourceSupported(t.dataSource)})),h.length>0){if(!t.queryToFetch&&!h.every(function(n){return n.supportsEmptyQuery}))throw new Error(f);v=t.taskFrame?t.taskFrame.raw:"";n.Async.safeChain("executeSearchAsync",function(){return SearchAppWrapper.CortanaApp.searchResultsView.executeSearchAsync(t.queryToFetch,v)},function(n){var f,r,s,c;if(o())if(n)for(r=0,s=h;r<s.length;r++)c=s[r],it.searchFolderWithMultipleResults(t,c,n,i,o,u,(f=e.lastResultHandle)===null||f===void 0?void 0:f.whereId);else it.emptyFetch(h,i)},function(){return it.emptyFetch(h,i)},null,v?t.queryToFetch+"\n"+v:t.queryToFetch)}if(s.length>0){if(e.lastQuery&&!t.fullPartialQuery.startsWith(e.lastQuery)&&e.setWhereId(null),e.lastQuery=t.fullPartialQuery,!t.queryToFetch&&!s.every(function(n){return n.supportsEmptyQuery}))throw new Error(f);if(s.some(function(n){return n.dataSource=="MPHO"})&&s.some(function(n){return n.dataSource=="MVID"})&&s.some(function(n){return n.dataSource=="MDOC"})&&s.some(function(n){return n.dataSource=="MPVD"}))at=s.find(function(n){return n.dataSource=="MPVD"}),this.searchFolderWithMultipleResults(t,at,null,i,o,u,(ut=e.lastResultHandle)===null||ut===void 0?void 0:ut.whereId);else for(y=0,ht=s;y<ht.length;y++)l=ht[y],this.searchFolderWithMultipleResults(t,l,null,i,o,u,(ft=e.lastResultHandle)===null||ft===void 0?void 0:ft.whereId)}if(p=d.filter(function(i){return n.isDataSourceEnabled(i.dataSource,t)}),p.length>0){if(!t.queryToFetch&&!p.every(function(n){return n.supportsEmptyQuery}))throw new Error(f);for(vt=function(n){u&&n.customCancellation&&u.register(function(){return n.customCancellation()},!0,n.dataSource+" cancellation");yt.searchFolderWithMultipleResults(t,n,t,i,o,u,(et=e.lastResultHandle)===null||et===void 0?void 0:et.whereId)},yt=this,w=0,ct=p;w<ct.length;w++)l=ct[w],vt(l)}if(nt=g.filter(function(i){return n.isDataSourceEnabled(i.dataSource,t)}),nt.length>0){if(!t.queryToFetch&&!nt.every(function(n){return n.supportsEmptyQuery}))throw new Error(f);for(pt=function(n){u&&n.customCancellation&&u.register(function(){return n.customCancellation()},!0,n.dataSource+" cancellation");wt.searchFolderWithSingleResult(t,n,t,i,o)},wt=this,tt=0,lt=nt;tt<lt.length;tt++)l=lt[tt],pt(l)}t.taskFrame&&n.safeExecute(function(){return SearchAppWrapper.CortanaApp.searchResultsView.setTaskFrame(t.originalQuery,"")},"reset task frame")},e.prototype.emptyFetch=function(n,t){for(var f,i=0,r=n;i<r.length;i++)f=r[i],this.logProviderFailure(f.dataSource),t(f.dataSource,u,e.getDataSourceState(0))},e.prototype.getMax=function(t,i){return i.customGetMax?i.customGetMax(t):n.RuntimeConfig.QfMode==5||t.scope!=n.Scope.All?t.queryToFetch?i.maxAfter8charsOrInL2ZeroInput*2:i.maxAfter8charsOrInL2ZeroInput:t.queryToFetch.length>8?i.maxAfter8charsOrInL2ZeroInput:t.queryToFetch.length>3?i.maxAfter3chars:i.maxUpTo3chars},e.prototype.toLocalResponse=function(i,r,u,f,e){var y,p,a,w,o,v;e&&(p=f,p.getGroupDisplayName&&(y=p.getGroupDisplayName(e)));var k={Counter:0},b=[],d=u.length<i;for(a=0,w=u;a<w.length;a++){var c=w[a],l=et(c,f),h=n.isApp(l)||n.isSetting(l)?ot(c):undefined;st(r,c,l,f.dataSource,k,h)||(o=void 0,o=f.customCreateLocalResponseSuggestion?f.customCreateLocalResponseSuggestion(c,l,f.dataSource):t(c,l,f.dataSource),y&&(o.groupDisplayName=y),h&&(o.ciMetaData=h,h.Query&&h.Query.includes(s)&&(v=h.Query.split(s),v.length==2&&(o.uxHint=v[1],o.ciMetaData.Query=v[0]))),b.push(o))}return{suggestions:b,maxedOut:d}},e.prototype.getResults=function(n,t,i,r){if(r.getResults)return r.getResults(i,t);var u=i,f=this.enableSpellCorrection(n);return u.getItemsAsyncWithSpeller?u.getItemsAsyncWithSpeller(0,t,f):i.getItemsAsync(0,t)},e.prototype.enableSpellCorrection=function(t){return t.queryToFetch.length>=n.config.enableCISpellerAtPrefixLength&&this._previousKeystrokeCache&&this._previousKeystrokeCache.enableCISpeller(t.queryToFetch)?!0:t.queryToFetch.length>=n.config.enableCISpellerAtPrefixLength&&n.config.enableCISpeller==1?!0:!1},e.prototype.searchFolderWithMultipleResults=function(t,i,r,f,o,s,h){var p=this,c=i.dataSource,a=this.getMax(t,i),v=!r,w,y,l;if(v){if(n.RuntimeConfig.QfMode==5&&(l=n.Host.getFileExplorerCurrentPath()),l&&!/^[a-zA-Z]\:\\/.test(l)){f(c,u,null,null,!0);return}w=(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.getFeatureEnabled(41150162))?function(){return n.IndexerQueryGenerator.generateIndexerQueryAsync(t,l,a,c,h).then(function(i){if(!o())return null;var r={rawSQL:i,queryText:t.originalQuery,impressionID:n.Host.getRawImpressionGuid()};return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.querySearchIndexerResultsAsync(r)})}:function(){return n.IndexerQueryGenerator.generateIndexerQueryAsync(t,l,a,c,h).then(function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.queryWindowsSearchIndexerAsync(n)})}}else{if(y=n.safeExecute(function(){return i.getResultsContainer(r)},"getResultsContainer "+c),!y){f(c,u,null);return}w=function(){return p.getResults(t,a,y,i)}}n.Async.safeChain(v?"queryWindowsSearchIndexerAsync":"getItemsAsync",w,function(r){var u,s,h;o()&&(u=r.resultSet,s=void 0,r.whereId&&e.setWhereId(r),u?s=r.state:u=typeof r.length=="undefined"?Object.keys(r).map(function(n){return r[n]}):r,v&&n.supportsShortcuts(c,t)&&(u=u.map(function(t){return n.IndexerQueryGenerator.fixKind(t)})),h=e.getDataSourceState(s),f(c,p.toLocalResponse(a,t,u,i,y),h))},function(t){n.isCancellation(t)||p.logProviderFailure(c);f(c,u,null)},v?s:null,c+" "+t.queryToFetch)},e.prototype.searchFolderWithSingleResult=function(t,i,r,f,e){var s=this,o=i.dataSource,h=n.safeExecute(function(){return i.getResultsContainer(r)},"getResultsContainer "+o);h?n.Async.safeChain("tryGetResultAsync "+o,function(){return h.tryGetResultAsync()},function(n){e()&&f(o,s.toLocalResponse(1,t,n?[n]:[],i,null),null)},function(t){n.isCancellation(t)||s.logProviderFailure(o);f(o,u,null)},null,t.queryToFetch):f(o,u,null)},e.prototype.logProviderFailure=function(t){var i=n.providerFailureLogName(t);i&&SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure&&n.safeExecute(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure(i,"ErrorForTopHit")},"logProviderFailure")},e.prototype.cacheDeviceItems=function(){var t="LDIC",i=function(){var i,r=n.IndexerQueryGenerator.generateIndexerQueryForDeviceItemCache(t,(i=e.lastResultHandle)===null||i===void 0?void 0:i.whereId);return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.queryWindowsSearchIndexerAsync(r)};r.setReady(!1);n.Async.safeChain("initializeDeviceItemCacheAsync",i,function(n){var t,i,u;for(n.whereId&&e.setWhereId(n),t=0,i=n.resultSet;t<i.length;t++)u=i[t],r.addItemToCache(u);r.setReady(!0)})},e.getDataSourceState=function(n){switch(n){case 0:return"UN";case 1:return"NI";case 2:return"PI"}return undefined},e.getApps=function(n,t,i,r){o(n,t,"findAppsAsync",function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findAppsAsync(n)},function(n){return p.customCreateLocalResponseSuggestion(n,null,r)},i,r,null,!0)},e.getSettings=function(n,t,i,r){o(n,t,"findSettingsAsync",function(n){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findSettingsAsync(n)},function(n){return w.customCreateLocalResponseSuggestion(n,null,r)},i,r,null)},e.getFiles=function(r,u,f,s,h){o(r,u,"findFilesAsync",function(t){var i,r;return n.IndexerQueryGenerator?(r=n.IndexerQueryGenerator.generateIndexerQueryForMRUFilesAndFolders(f,"MFF",t,(i=e.lastResultHandle)===null||i===void 0?void 0:i.whereId),SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.queryWindowsSearchIndexerAsync(r).then(function(n){var i,t,r,u;for(n.whereId&&e.setWhereId(n),i={},t=0,r=n.resultSet;t<r.length;t++)u=r[t],i[u.id]=u;return i})):SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findFilesAsync(t)},function(n){return t(n,i(n.kind,n.extension,"FL"),h)},s,h,nt)},e.launchIndexingOptions=function(t){var i=this;e.getSettings([h],function(r){var u=r[h];u?n.Host.launchDeviceItem(u.deviceItem,"ST"):t||i.launchIndexingOptions(!0)},null,null,!0)},e}();n.LocalDataProvider=ht;f="Local provider doesn't support empty query"}(WSB||(WSB={}));__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},function(n){var t,f="UpsellDismissed",e="moreButton",i="feedbackButton",o="optionsButton",s="rewardsBadgeButton",h="userProfileButton",c="closeButton",l="backButton",r=4.5,u=10,a=function(){function a(r,u,a,v,y,p){var w=this,b,k,d;if(this._page=r,this._accessTokenManager=u,this._msRewardsViewModel=a,this._menuFactory=v,this._substrateProfilePictureProvider=y,this._optionsWindow=p,this._moreButton={id:e,selected:!1,text:null},this._feedbackButton={id:i,selected:!1,text:null},this._optionsButton={id:o,selected:!1,text:null},this._rewardsBadgeButton={id:s,selected:!1,text:null},this._userProfileButton={id:h,selected:!1,text:null},this._closeButton={id:c,selected:!1,text:null},this._backButton={id:l,selected:!1,text:null},this._topHitPresent=!1,this._resultsPresent=!1,this._currentScopeTileIndex=-1,this._moreMenuOpened=!1,this._optionsMenuOpened=!1,this._userProfileMenuOpened=!1,this._shouldRenderScopes=!0,this._advancedOptionsIdCounter=0,this._advancedOptionsScope=[],this._shouldShowBuildNumber=!1,this._userProfilesCache={},this.menuDividerId=0,this._upsellGotDismissed=n.LightweightStorage.getItem(f)=="1",t=SearchAppWrapper.CortanaApp,n.isMsbInternalTenant()){if(n.config.scopesOrderBeginMS.length==0)return}else if(n.shouldUseMsbEnterpriseScopes()){if(n.config.scopesOrderBeginMsbEnterprise.length==0)return}else if(n.config.scopesOrderBegin.length==0)return;b=function(){w._currentQuery&&w.renderScopes()};n.Host.bindAppHidden(function(){w._scopeTiles=null;w._effectiveScopeOrder=null});n.Host.bindQueryChangedOrInitialized(function(n){w._currentQuery=n;w._currentScopeTileIndex=-1});n.Host.bindDismissed(function(){w._shouldRenderScopes=!0;w._currentScopeTileIndex=-1;w._verifyAccountForAADRequired=!1;w._verifyAccountForMSARequired=!1});n.Host.bindButtonRightOfSearchBoxClick(function(t){(t==""||t=="")&&(n.Host.reformulate(""),w.setFocusInSearchBox("clear search box"),n.InstrumentationHelper.logClientInstEvent("Select","ClearSearchBox",null))});n.Host.bindScopeListRequiresUpdate(function(){w.init();b()});n.Host.bindOnFeedbackClosing(function(t){var r;!t&&n.RuntimeConfig.AlwaysWide&&((r=_ge(i))===null||r===void 0?void 0:r.focus())});n.Host.bindKeyDown(function(n,t){t.ctrlKey&&n==13&&t.shiftKey&&(w._shouldShowBuildNumber=!0)});this._substrateUpsellDismiss={action:function(){w._upsellGotDismissed=!0;n.LightweightStorage.setItem(f,"1");n.Host.refreshCurrentPane()},icon:{content:"&#xE711",type:2}};a&&a.bindRewardsBadgeUpdated(function(){w._shouldRenderScopes=n.config.optScopesRender;b()});u&&(k=function(){if(w._currentQuery){var t=n.ScopeConfig[w._currentQuery.scope];w.refreshAdvancedOptionsScopeList(t);w.updateTopHitHeader()}},d=function(n,t,i){n==0?(t=="https://substrate.office.com/SubstrateSearch-Internal.ReadWrite"||t=="https://substrate.office.com/M365.Access"||t=="service::cortana.bing.com::mbi_ssl")&&(w._verifyAccountForMSARequired=i,k()):n==1&&(t=="https://substrate.office.com"&&(w._verifyAccountForAADRequired=i,k()),w._verifyAccountForAADRequired&&w.initializeAADVerification(n))},u.bindVerifyAccountRequired(function(n,t){d(n,t,!0)}),u.bindAccessTokenAvailable(function(n,t){d(n,t,!1)}))}return a.prototype.focusNextScopeTile=function(t,i){var u=[].slice.call(n.StaticHtmlElements.scopesHeader.getElementsByClassName("scope-tile")),r=n.shouldSkipSelectedScope()?u.filter(function(n){return!n.classList.contains("scope-tile--selected")}):u;this._currentScopeTileIndex=r.indexOf(t);n.config.scopeWithBackground?i?this._currentScopeTileIndex===r.length-1?this._currentScopeTileIndex=0:this._currentScopeTileIndex!=r.length-2&&++this._currentScopeTileIndex:this._currentScopeTileIndex>0&&this._currentScopeTileIndex!==r.length-1?--this._currentScopeTileIndex:this._currentScopeTileIndex===0&&(this._currentScopeTileIndex=r.length-1):i?this._currentScopeTileIndex!=r.length-1&&++this._currentScopeTileIndex:this._currentScopeTileIndex>0&&--this._currentScopeTileIndex;n.shouldSkipSelectedScope()&&(this._currentScopeTileIndex=u.indexOf(r[this._currentScopeTileIndex]));this._menuFactory.dismiss();u[this._currentScopeTileIndex].focus()},a.prototype.render=function(t,i,r,u,f,e){if(this._currentQuery=t,t){var o=n.getEffectiveScope(t);this.innerRender(t.scope,o,t,i,r,u,f,e)}else this.cleanUp()},a.prototype.getScopeToolTip=function(t,i){var u=n.ScopeConfig[t],f=n.getScopeDisplayName(u),r;return r=i&&!this._allScopeButtonPresent?"RemovingScopeNarratorText2":t==n.Scope.All?"AddingScopeNarratorTextAll2":"AddingScopeNarratorText",n.Host.getLocString(r,f)},a.prototype.selectScope=function(n){var i,r,t;for(this._selectedScope&&(this._selectedScope.tooltip=this.getScopeToolTip(this._selectedScope.type,!1),this._selectedScope.enabled=!1,this._selectedScope=null),i=0,r=this._scopeTiles;i<r.length;i++)if(t=r[i],t.enabled=t.type==n,t.enabled){t.tooltip=this.getScopeToolTip(n,!0);this._selectedScope=t;break}},a.prototype.innerRender=function(t,i,r,u,f,e,o,s){this._topHitPresent=u;this._resultsPresent=f;n.RuntimeConfig.ScopesAvailable&&(this._scopeTiles||this.init(),this._scopeTiles&&(!this._selectedScope||this._selectedScope.type!=t)&&this.selectScope(t));this.renderTopHitHeader(t,i,r,f,e,o,s);n.RuntimeConfig.ScopesAvailable&&(this.renderScopes(),this.renderBranding());var h=this._advancedOptionsScope.filter(function(n){return n.layout==1||n.layout==6});h&&this._page.renderAdvancedOptionsMessages(h)},a.prototype.refreshAdvancedOptionsScopeList=function(t){this._advancedOptionsScope=n.RuntimeConfig.ScopesAvailable&&t.showUpsellOnSuggestionsList&&t.showUpsellOnSuggestionsList()?this.getAdvancedOptions(n.SequenceNumberManager.getSequenceNumber(),0):[]},a.prototype.renderTopHitHeader=function(t,i,r,u,f,e,o){var s=n.ScopeConfig[i],a=r.showProgressBar?e:!f,v=!r||!r.queryToFetch,y=this.getEmptyResultsMessage(u,a,v,i,s,e,o),h=y[0],c=y[1],l=a||v||u||!this._lastRenderedTopHitHeader||n.uses3lineTemplate(i)?this.getHeaderText(i,s):this._lastRenderedTopHitHeader.headerText,p;(this.refreshAdvancedOptionsScopeList(s),n.RuntimeConfig.AlwaysWide&&(this._advancedOptionsScope=this._advancedOptionsScope.concat(this.getAdvancedOptions(n.SequenceNumberManager.getSequenceNumber(),1))),this._lastRenderedTopHitHeader&&this._lastRenderedTopHitHeader.scope==t&&this._lastRenderedTopHitHeader.message==h&&this._lastRenderedTopHitHeader.subMessage==c&&this._lastRenderedTopHitHeader.headerText==l&&this._lastRenderedTopHitHeader.advancedOptions==this._advancedOptionsScope)||(this._lastRenderedTopHitHeader={scope:t,headerText:l,message:h,subMessage:c,advancedOptions:this._advancedOptionsScope,scopeForDisplay:i},p={headerText:l,message:h,subMessage:c,messageIcon:h?s.icon:null},this._page.updateTopHitHeaderView(p))},a.prototype.updateTopHitHeader=function(){if(this._lastRenderedTopHitHeader){var t=n.ScopeConfig[this._lastRenderedTopHitHeader.scopeForDisplay],i={headerText:this._lastRenderedTopHitHeader.headerText,message:this._lastRenderedTopHitHeader.message,subMessage:this._lastRenderedTopHitHeader.subMessage,messageIcon:this._lastRenderedTopHitHeader.message?t.icon:null};this._page.updateTopHitHeaderView(i)}},a.prototype.shouldShowRewardsBadge=function(t){return n.RuntimeConfig.AlwaysWide||!!t&&t.scope==n.Scope.All},a.prototype.initializeAADVerification=function(){if(this._page!=null){var t=_ge("userProfileButton");if(t||(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)){if(!this._aadVerification){if(this._aadVerification=this._page.createAADVerification("AADVerification"),!this._aadVerification)return;this._aadVerification.addMessage(n.Host.getLocString("AADVerificationAttention")).icon("Rewards").setClass("miniflyout").target(t,"Left")}this._aadVerification.target(t,"Left").renderAADVerification(this._accessTokenManager)}}},a.prototype.getScopesHeaderDataModel=function(){var t=this;this._advancedOptionsIdCounter=0;var i=this.getScopeBarElements(),u=this.getHiddenScopeElements(i)||[],f=this._msRewardsViewModel&&this._msRewardsViewModel.getDataModel(),s=typeof n.enableCobaltBranding=="function"&&n.enableCobaltBranding()?this.getScopesBrandingDataModel():null,r=n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isTourVisible();r&&(i=i.map(function(n){return Object.assign({},n,{click:undefined,tooltip:undefined})}),f&&(f.click=function(){return null}));var e=n.config.userProfileButtonEnabled?this.getUserProfileButtonData():[null,null],o=e[0],h=e[1];return{isWin11DSB:n.isWin11DSB(this._currentQuery),scopes:n.config.pureRender?n.deepCopy(i):i,showFeedback:this.isFeedbackEnabled()?r?function(){return}:function(){return t.showFeedback()}:null,scopesBackBtnHandler:function(){return t.scopesBackBtnClicked()},scopesLeftCaretBtnHandler:function(){return t.scopesLeftCaretClicked()},scopesRightCaretBtnHandler:function(){return t.scopesRightCaretClicked()},scopesBackBtnEnterKeyPressedHandler:function(n){return t.scopesBackBtnEnterKeyPressed(n)},rewardsBadgeDataModel:this.shouldShowRewardsBadge(this._currentQuery)&&f,moreMenuDataModel:u.length>0?{opened:this._moreMenuOpened,menuItems:u,buttonClickHandler:function(n,i,f){return r?null:t._moreMenuOpened?t.closeMoreMenuDropDown():t.openMoreMenuDropDown(u,n,i,f)}}:null,optionsMenuDataModel:{opened:this._optionsMenuOpened,buttonClickHandler:function(n,i,u){return r?null:t._optionsMenuOpened?t.closeOptionsMenuDropDown():t.openOptionsMenuDropDown(n,i,u)}},userProfileButtonDataModel:n.config.userProfileButtonEnabled&&o?{opened:this._userProfileMenuOpened,buttonClickHandler:function(n,i,u){return r?null:t._userProfileMenuOpened?t.closeUserProfileDropDown():t.openUserProfileDropDown(n,i,u)},icon:o,userName:h}:null,brandBarDataModel:s,closeButtonClickHandler:function(n,i,r){return t.closeButtonClicked(n,i,r)}}},a.prototype.renderScopes=function(){var t;(!n.config.optScopesRender||this._currentQuery&&this._currentQuery.scopePrefix||(this._selectedScope?this._selectedScope.selected==!1:((t=this._currentQuery)===null||t===void 0?void 0:t.scope)==n.Scope.All)||this._moreMenuOpened||this._optionsMenuOpened)&&(this._shouldRenderScopes=!0);this._shouldRenderScopes&&(this._page.updateScopesHeaderView(this.getScopesHeaderDataModel()),this._shouldRenderScopes=!1)},a.prototype.getScopesBrandingDataModel=function(){if(typeof n.getMsbBranding=="function"){var t=n.getMsbBranding();if(!!t)return{msbBranding:t}}return null},a.prototype.renderBranding=function(){var i=_ge("msbBrandingBar"),t;if(i){if(typeof n.enableBrandingBar=="function"&&n.enableBrandingBar()&&(t=this.getScopesBrandingDataModel(),t===null||t===void 0?void 0:t.msbBranding)){this._page.updateBrandingBarView(t);return}this._page.updateBrandingBarView(null)}},a.prototype.createTourFlyout=function(){var t=this,e=Object.keys(n.Host.getQuery().enabledDataSources),o=e.indexOf("MRU")!=-1?n.LightweightStorage.getItem("MRUNoItemsAvailable")=="1":!0,u=[{id:"web_Tour",message:n.Host.getLocString("TourSearchText"),title:n.Host.getLocString("TourSearchTitle"),group:'document.createElement(\'search\').setAttribute("id", "search")',enabled:!0,icon:"WebSearch"},{id:o?"gr37_TourWide":"gr37_Tour",message:n.Host.getLocString("TourQuickSearchText"),title:n.Host.getLocString("TourQuickSearchTitle"),group:"gr37",enabled:n.shouldEnableQuickSearches(n.Host.getLanguage().toLowerCase()),icon:"QuickSearch"},{id:"SNSC_Tour",message:n.Host.getLocString("TourSnipSearchText"),title:n.Host.getLocString("TourSnipSearchTitle"),group:"SNSC",enabled:n.shouldEnableSnipSearch(),icon:"VisualSearch"},{id:"rewardsBadgeButton_Tour",message:n.Host.getLocString("TourRewardsText"),title:n.Host.getLocString("TourRewardsTitle"),group:"rewardsBadgeButton",enabled:this._msRewardsViewModel.isRewardsEnabled(),icon:"RewardsTrophy"}],i=this._page.createFlyout("WWETour"),r,f;if(i==null){n.LightweightStorage.removeItem("wweTourEnabled");n.setZeroInputDataSourcesForL1();n.Host.refreshCurrentPane();n.StaticHtmlElements.root.classList.remove("overlayEnabled");n.LightweightStorage.removeItem("wweTourRefreshed");return}n.Host.bindAppHidden(function(){t.removeTourFlyout();t._page.hideOverlayAreaView();t._page.hideFlyoutAreaView();t._page.updateScopesHeaderView(t.getScopesHeaderDataModel())});this._page.updateScopesHeaderView(this.getScopesHeaderDataModel());i.dismissible(Number.MIN_VALUE,null);i.repeat(Number.MAX_VALUE);i.icon("WebSearch").overlay(!0);u.forEach(function(n){n.enabled&&i.addMessage(n.message,n.title,_ge(n.group),n.id,n.icon)});r=u.filter(function(n){return n.enabled}).length;f=r==1;n.InstrumentationHelper.logClientInstEvent("Select","WWETour",null,{intendedFlyouts:r.toString()});i.target(n.StaticHtmlElements.groups).button(n.Host.getLocString("WelcomeExpTourFinish"),function(){t.removeTourFlyout();t._page.hideOverlayAreaView();t._page.updateScopesHeaderView(t.getScopesHeaderDataModel())},2).isLinkTextButton(!1).showButton(f).show()},a.prototype.removeTourFlyout=function(){n.LightweightStorage.removeItem("wweTourRefreshed");n.LightweightStorage.removeItem("wweTourEnabled");n.StaticHtmlElements.root.classList.remove("overlayEnabled")},a.prototype.getInstItem=function(t,i){var r=n.InstrumentedItem.getNonSuggestionInstrumentedItem(t,n.SyntheticQSCodesMaps.KValues,n.SyntheticQSCodesMaps.HandoffsForNonSuggestions[t]);return n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(i,t,r),r},a.prototype.closeButtonClicked=function(t,i,r){var u=n.SequenceNumberManager.getSequenceNumber(),f=this.getInstItem("CB",u);n.InstrumentationHelper.instrumentItemClick(t,f,u,null,i,r);SearchAppWrapper.CortanaApp.dismissApp()},a.prototype.openMoreMenuDropDown=function(t,i,r,u){var e=this,f=n.SequenceNumberManager.getSequenceNumber(),o=this.getInstItem("MMB",f);n.InstrumentationHelper.instrumentItemClick(i,o,f,null,r,u);this._msRewardsViewModel&&this._msRewardsViewModel.hide();this._menuFactory.showDropdownMenu(t,document.getElementById(this._moreButton.id),1,function(){n.safeSetTimeout(function(){return e.closeMoreMenuDropDown()},0,"closeMoreMenuDropDown")},r);this._moreMenuOpened=!0;this.renderScopes()},a.prototype.closeMoreMenuDropDown=function(){this._moreMenuOpened=!1;this.renderScopes()},a.prototype.openOptionsMenuDropDown=function(t,i,r){var f=this,e=n.RuntimeConfig.AlwaysWide?1:2,u=n.SequenceNumberManager.getSequenceNumber(),o=this.getAdvancedOptions(u,e),s=this.getInstItem("OMB",u);n.InstrumentationHelper.instrumentItemClick(t,s,u,null,i,r);this._msRewardsViewModel&&this._msRewardsViewModel.hide();this._menuFactory.showDropdownMenu(o,document.getElementById(this._optionsButton.id),2,function(){n.safeSetTimeout(function(){return f.closeOptionsMenuDropDown()},0,"closeOptionsMenuDropDown")},i);this._optionsMenuOpened=!0;this.renderScopes()},a.prototype.closeOptionsMenuDropDown=function(){this._optionsMenuOpened=!1;this._shouldShowBuildNumber=!1;this.renderScopes()},a.prototype.openUserProfileDropDown=function(t,i){var u=this,r=n.SequenceNumberManager.getSequenceNumber(),f=this.getAccountOptionsForUserProfileButton(r),e=this.getInstItem("APB",r);n.InstrumentationHelper.instrumentItemClick(t,e,r,null,i,null);this._msRewardsViewModel&&this._msRewardsViewModel.hide();this._menuFactory.showDropdownMenu(f,document.getElementById(this._userProfileButton.id),2,function(){n.safeSetTimeout(function(){return u.closeUserProfileDropDown()},0,"closeUserProfileDropDown")},i);this._userProfileMenuOpened=!0;this.renderScopes()},a.prototype.closeUserProfileDropDown=function(){this._userProfileMenuOpened=!1;this.renderScopes()},a.prototype.cleanUp=function(){_w.ReactDOM&&(ReactDOM.unmountComponentAtNode(n.StaticHtmlElements.topResults),ReactDOM.unmountComponentAtNode(n.StaticHtmlElements.groups),ReactDOM.unmountComponentAtNode(n.StaticHtmlElements.topHitHeader),ReactDOM.unmountComponentAtNode(n.StaticHtmlElements.scopesHeader));this._lastRenderedTopHitHeader=null;this._page.updateTopHitHeaderView(null);this._page.updateScopesHeaderView(null)},a.prototype.scopeNamesElements=function(t){var i=this;return t.map(function(t){return i._scopeTiles.find(function(i){return n.Scope[i.type]==t})}).filter(function(n){return!!n})},a.prototype.getEffectiveScopeOrder=function(){var t,i,u,r,f;return!this._scopeTiles||this._scopeTiles.length==0?[]:this._effectiveScopeOrder&&!n.config.pathCompletionReplacesAll?this._effectiveScopeOrder.slice(0):(n.isMsbInternalTenant()?n.RuntimeConfig.AlwaysWide?(t=n.config.scopesOrderBeginAlwaysWideMS,i=n.config.scopesOrderLastAlwaysWide,u=n.config.numberOfScopesToRenderAlwaysWideMS):(t=n.config.scopesOrderBeginMS,i=n.config.scopesOrderLast,u=n.config.numberOfScopesToRenderMS):n.shouldUseMsbEnterpriseScopes()?n.RuntimeConfig.AlwaysWide?(t=n.config.scopesOrderBeginAlwaysWideMsbEnterprise,i=n.config.scopesOrderLastAlwaysWide,u=n.config.numberOfScopesToRenderAlwaysWideMsbEnterprise):(t=n.config.scopesOrderBeginMsbEnterprise,i=n.config.scopesOrderLast,u=n.config.numberOfScopesToRenderMsbEnterprise):n.RuntimeConfig.AlwaysWide?(t=n.config.scopesOrderBeginAlwaysWide,i=n.config.scopesOrderLastAlwaysWide,u=n.config.numberOfScopesToRenderAlwaysWide):(t=n.config.scopesOrderBegin,i=n.config.scopesOrderLast,u=n.config.numberOfScopesToRender),r=[],t&&(n.config.pathCompletionReplacesAll&&(i=i.filter(function(n){return n!="PathCompletion"}),this._currentQuery&&this._currentQuery.canBePathCompletion&&(t=t.map(function(n){return n=="All"?"PathCompletion":n}))),f=i?this.scopeNamesElements(i):[],r=this.scopeNamesElements(t),r=r.slice(0,u-f.length),r.push.apply(r,f)),this._effectiveScopeOrder=r,r.slice(0))},a.prototype.getHiddenScopeElements=function(t){var i;if(!this._moreScopeTiles)return[];if(n.config.scopeWithBackground){var u=["scope2","scope11","scope7","scope3"],r=[],f=function(n){var t=e._moreScopeTiles.filter(function(t){var i=t.id;return i===u[n]});r.push.apply(r,t)},e=this;for(i=0;i<this._moreScopeTiles.length;i++)f(i);return r}return this._moreScopeTiles.filter(function(i){return t.find(function(n){return n.type==i.type})==undefined&&n.Scope[i.type]!="PathCompletion"&&n.Scope[i.type]!="All"})},a.prototype.getScopeBarElements=function(){var s=this,t,i,u,h,r,f,e,o,c;if(!this._scopeTiles||n.RuntimeConfig.QfMode==11)return[];if(t=this.getEffectiveScopeOrder(),n.config.scopeWithBackground&&n.RuntimeConfig.AlwaysWide){for(i=this.getHiddenScopeElements(t)||[],u=i.findIndex(function(n){var t;return(n===null||n===void 0?void 0:n.type)==((t=s._selectedScope)===null||t===void 0?void 0:t.type)}),u>=0&&(i[u].enabled=!0),h=t.map(function(n){return n.type}),r=0,f=i;r<f.length;r++)e=f[r],h.indexOf(e.type)===-1&&(t=t.concat(e));this._scopeTiles=t}else o=t.some(function(n){return n.enabled}),!o&&this._selectedScope&&(n.config.pathCompletionReplacesAll&&n.Scope[this._selectedScope.type]=="PathCompletion"||(c=this._scopeTiles.find(function(n){return n.type==s._selectedScope.type}),t.push(c),o=!0));return t},a.prototype.isFeedbackEnabled=function(){return n.isBingEnabled()},a.prototype.showFeedback=function(){n.Host.showFeedbackForm();this._msRewardsViewModel&&this._msRewardsViewModel.hide()},a.prototype.sliderDirection=function(n){var t=_qs(".scope-with-background__slider"),i=_qs(".scope-with-background__leftCaret"),r=_qs(".scope-with-background__rightCaret"),u=_qs("body[dir='rtl']");t&&i&&r&&(u?n==2||n==0?(t.classList.remove("scopes-list--right"),r.style.display="none",i.style.display="inline-block"):(t.classList.add("scopes-list--right"),i.style.display="none",r.style.display="inline-block"):n==1||n==0?(t.classList.remove("scopes-list--right"),i.style.display="none",r.style.display="inline-block"):(t.classList.add("scopes-list--right"),r.style.display="none",i.style.display="inline-block"),n==0&&(t.scrollLeft=0))},a.prototype.scopesSlider=function(n,t,i){var r=_qs(".scope-with-background__slider"),o=_qs("body[dir='rtl']"),f,u,e;r&&(f=r.scrollWidth,this.sliderDirection(n),u=0,e=setInterval(function(){o?n===2?r.scrollLeft-=i:n===1&&(r.scrollLeft+=i):n===1?r.scrollLeft-=i:n===2&&(r.scrollLeft+=i);u>=f&&window.clearInterval(e);u+=i},t))},a.prototype.scopesBackBtnClicked=function(){n.RuntimeConfig.AlwaysWide&&(this.scopesSliderReset(),n.Host.reformulate(""),n.InstrumentationHelper.logClientInstEvent("Select","ScopeBackBtnSelected",null,null))},a.prototype.scopesBackBtnEnterKeyPressed=function(n){n==="Enter"&&this.scopesBackBtnClicked()},a.prototype.scopesSliderReset=function(){this.scopesSlider(0,r,u)},a.prototype.scopesLeftCaretClicked=function(){this.scopesSlider(1,r,u);n.InstrumentationHelper.logClientInstEvent("Select","ScopesLeftCaretBtnSelected",null,null)},a.prototype.scopesRightCaretClicked=function(){this.scopesSlider(2,r,u);n.InstrumentationHelper.logClientInstEvent("Select","ScopesRightCaretBtnSelected",null,null)},a.prototype.getHeaderText=function(t,i){var r,u;if(n.RuntimeConfig.FlatListWithoutGroups)return null;if(r=n.getScopeDisplayName(i),r){if(this._topHitPresent)return t==n.Scope.All||t==n.Scope.PathCompletion?(u=n.config.quickMatchLabel?"QuickMatch":"BestMatch",n.Host.getLocString(u)):(u=this.getBestMatchScopeName(t),n.Host.getLocString(u,r));if(this._resultsPresent)return null;if(t!=n.Scope.All)return r}return n.Host.getLocString("BestMatch")},a.prototype.getBestMatchScopeName=function(t){return n.config.quickMatchLabel?"QuickMatchFor".concat(n.Scope[t]):"BestMatchFor".concat(n.Scope[t])},a.prototype.getEmptyResultsMessage=function(t,i,r,u,f,e,o){var s;return n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9||t||!i&&!r||u!=n.Scope.Documents&&f.showUpsellOnSuggestionsList&&f.showUpsellOnSuggestionsList()?["",""]:typeof n.isDocumentZeroQueryEnabled=="function"&&n.isDocumentZeroQueryEnabled()&&u==n.Scope.Documents?e&&o===!1?f.getEmptyZIMessages():["",""]:u==n.Scope.All&&n.config.enableDSBFullWidthIter2&&SearchAppWrapper.CortanaApp.entryPoint=="WNSDSB"?["",""]:r?f.getEmptyZIMessages():[n.Host.getLocString("NoResults",(s=this._currentQuery)===null||s===void 0?void 0:s.queryToFetch),""]},a.prototype.init=function(){var r,u,i,t;if(n.initScopePrefixes(),this._scopeTiles=[],this._moreScopeTiles=[],n.RuntimeConfig.ScopesAvailable){r=n.isMsbInternalTenant()?n.RuntimeConfig.AlwaysWide?n.config.scopesOrderBeginAlwaysWideMS:n.config.scopesOrderBeginMS:n.shouldUseMsbEnterpriseScopes()?n.RuntimeConfig.AlwaysWide?n.config.scopesOrderBeginAlwaysWideMsbEnterprise:n.config.scopesOrderBeginMsbEnterprise:n.RuntimeConfig.AlwaysWide?n.config.scopesOrderBeginAlwaysWide:n.config.scopesOrderBegin;this._allScopeButtonPresent=n.contains(r,"All");for(u in n.ScopeConfig)(i=parseInt(u),t=n.ScopeConfig[i],(t.prefixes||t.prefixesLocString||t.scopeNameLocString)&&n.isScopeEnabled(i,t))&&((i!=n.Scope.All||this._allScopeButtonPresent)&&this._scopeTiles.push(this.createScopeElement(i,t,!1)),this._moreScopeTiles.push(this.createScopeElement(i,t,!0)));this._moreScopeTiles.sort(function(t,i){return t.type==n.Scope.All?-1:i.type==n.Scope.All?1:t.text.localeCompare(i.text)});this._selectedScope&&this.selectScope(this._selectedScope.type);this._effectiveScopeOrder=null}},a.prototype.createScopeElement=function(t,i,r){var u=this;return{isScopeElement:!0,id:(r?"scope":"l1scope")+t,type:t,enabled:!1,text:n.getScopeDisplayName(i),title:null,icon:t==n.Scope.All?{content:"&#xE8A9",type:1}:i.icon,click:function(){return u.clickHandler(t,"scopeBar")},selected:!1,tooltip:this.getScopeToolTip(t,!1),isSelectable:!0}},a.prototype.clickHandler=function(t,i,r){var h=n.getScopeDisplayName(n.ScopeConfig[t]),e,u=this._currentQuery,f=u.scope,o,s,c;if(this._shouldRenderScopes=!0,this._scopeTiles.some(function(n){return n.type==f})||(f=n.Scope.All),h&&f!=t)e=(t==n.Scope.All||t==n.Scope.PathCompletion?"":h+": ")+u.queryToFetch,this.innerRender(t,t,u,this._topHitPresent,this._resultsPresent,!0,!1),o={query:this._currentQuery,topResults:[],groups:[]},this._page.updateTopResultsView(o,!1),this._page.updateGroupsView(o,!1);else{if(f==n.Scope.All||this._allScopeButtonPresent){this.setFocusInSearchBox("scope clickHandler noop");return}e=u.queryToFetch;t=n.Scope.All;this.innerRender(t,t,u,this._topHitPresent,this._resultsPresent,!0,!1)}s=n.Scope[t];c={Scope:s,Source:i,GroupSource:r&&r.source?r.source.toString():undefined};n.InstrumentationHelper.logClientInstEvent("Select","ScopeChanged",null,c);f!=t&&n.Host.reformulate(e,undefined,undefined,r);this.setFocusInSearchBox("scope clickHandler "+s)},a.prototype.setFocusInSearchBox=function(t){n.Host.setFocusInSearchBox(null,t);var i=n.getCurrentActiveElement();i&&i.blur()},a.prototype.isScopeElement=function(t){return t&&this._scopeTiles&&(this.isScopeButton(t.id)||n.contains(this._scopeTiles,t))},a.prototype.isMenuElement=function(n){return n&&this.isMenuButton(n.id)},a.prototype.isScopeButton=function(n){return n==this._feedbackButton.id||n==this._rewardsBadgeButton.id||n==this._userProfileButton.id||n==this._closeButton.id||n==this._backButton.id||this.isMenuButton(n)},a.prototype.isMenuButton=function(n){return n==this._moreButton.id||n==this._optionsButton.id},a.prototype.getSelectableItems=function(){var t=[],i;return n.RuntimeConfig.ScopesAvailable&&(t=t.concat(this.getScopeSelectableItems())),i=this._advancedOptionsScope.filter(function(n){return n.layout==0||n.layout==6}),i.length>0&&(t=t.concat(i)),t},a.prototype.getSelectableItemsByGroup=function(){var t=[],i=this.getScopeBarElements(),r,u,o,f,e;return n.shouldSkipSelectedScope()&&this._selectedScope==i[0]&&(i=i.slice(1)),n.isWin11DSB(this._currentQuery)||n.RuntimeConfig.QfMode==11||(t.push(i.slice(0,1)),r=i.findIndex(function(n){return n.selected}),r>0?t.push(i.slice(r,r+1)):n.shouldSkipSelectedScope()||(u=i.findIndex(function(n){return n.enabled}),u>0&&t.push(i.slice(u,u+1)))),n.config.scopeWithBackground?(f=[this._rewardsBadgeButton,this._optionsButton,this._userProfileButton],o=document.getElementById("backButton"),f.forEach(function(n){_ge(n.id)&&t.push([n])}),o&&(t=__spreadArray(__spreadArray([[this._backButton]],t.slice(0,1),!0),t.slice(1),!0))):(f=[this._moreButton,this._rewardsBadgeButton,this._userProfileButton,this._feedbackButton,this._optionsButton,this._closeButton],f.forEach(function(n){_ge(n.id)&&t.push([n])})),e=this._advancedOptionsScope.filter(function(n){return n.layout==0||n.layout==6}),e.length>0&&t.push.apply(t,e.map(function(n){return[n]})),t},a.prototype.getScopeSelectableItems=function(){var r=this.getScopeBarElements(),t=this._currentScopeTileIndex,f=r.length,u;if(n.isWin11DSB(this._currentQuery))return t<0&&(t=0),this.getSelectableItemsByGroup()[t];if(n.shouldSkipSelectedScope()&&this._selectedScope==r[0]&&(r=r.slice(1),--t,--f),t<0&&this._selectedScope&&!n.shouldSkipSelectedScope())return[this._selectedScope];if(u=n.getCurrentActiveElement(),u)switch(u.id){case e:return[this._moreButton];case i:return[this._feedbackButton];case o:return[this._optionsButton];case s:return[this._rewardsBadgeButton];case h:return[this._userProfileButton];case c:return[this._closeButton];case l:return[this._backButton]}return(t<0||t>=f)&&(t=0),r.slice(t,t+1)},a.prototype.getSelectedItem=function(){return null},a.prototype.select=function(t){var i=[].slice.call(n.StaticHtmlElements.scopesHeader.getElementsByClassName("scope-tile")),r=n.shouldSkipSelectedScope()?i.filter(function(n){return!n.classList.contains("scope-tile--selected")}):i;this._currentScopeTileIndex=r.indexOf(_ge(t.id));n.shouldSkipSelectedScope()&&(this._currentScopeTileIndex=i.indexOf(r[this._currentScopeTileIndex]))},a.prototype.onAfterKeyDown=function(){return!1},a.prototype.getSubstrateUpsellClickHandler=function(t,i){var u=this,r;return i=i&&__spreadArray(__spreadArray([],i,!0),["HeaderFooterViewModel::getSubstrateUpsellClickHandler(authType=".concat(t,")")],!1),r=function(){n.Host.refreshCurrentPane();n.Host.setFocusInSearchBox(null,"SubstrateUpsell")},function(){return u._accessTokenManager.promptAutheticateDialog(t,n.getSubstrateResourceOrScope(t),r,r,i)}},a.prototype.getSubstrateUpsell=function(t,i,r){var c=null,u="VerifyAccountToSearch",f=0,l="CloudSearch",a=["Verify"],e=null,o=[],v,s,h;return r==0?(v=n.getEffectiveScope(this._currentQuery),f=6,s=this._accessTokenManager?this._accessTokenManager.getCachedAccountInfo(t):null,s&&o.push(s.accountUserName),h=[n.Scope.People,n.Scope.Emails,n.Scope.Documents],n.config.accountVerificationInAllScope&&h.push(n.Scope.All),n.contains(h,v)&&(o.length>0&&(u="VerifyAccount"),e=this._substrateUpsellDismiss),l=""):r==2&&(u=null,f=2,c={content:"&#xE9BE",type:2,needsAccentColor:!0},e=this._substrateUpsellDismiss,a=["VerifyAccountToSearch"]),this.createAdvancedOption(t==1?"COFA":"COOA",i,l,u,a,this.getSubstrateUpsellClickHandler(t,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getSubstrateUpsell(authType=".concat(t,", position=").concat(r,")")]:undefined),f,e,c,null,o,"VerifyButton")},a.prototype.getOneDriveUpsell=function(t){return this.createAdvancedOption("SDSC",t,null,null,["SeeResultsFromOneDrive"],function(){n.Host.launchCortanaSignIn()},2,null,{content:"&#xE9BE",type:2,needsAccentColor:!1})},a.prototype.getIndexingOption=function(t){var i=n.config.controlPanelSearchSettings?function(){return n.Host.launchSearchSettings()}:function(){return n.LocalDataProvider.launchIndexingOptions(!1)};return this.createAdvancedOption("OMIO",t,"",null,["OptionsMenuIndexing"],i,2,null,{type:2,content:"&#xED52"})},a.prototype.getAdvancedOptionCssClass=function(n,t){return n==4?t?"menuInfo selectedAccount":"menuInfo":n==5?"menuLabel":null},a.prototype.createContextMenuGroup=function(n,t,i,r){var u=this.createAdvancedOption(n,t,null,i,null,null,5);return u.groupItems=r,u.narratorText=u.message,u},a.prototype.createBuildVersionOption=function(){var t=n.Host.getLocString("Build");return{id:"advancedOption"+this._advancedOptionsIdCounter++,selected:!1,title:t,message:undefined,text:t+": "+n.config.snrVersion,instItem:undefined,click:undefined,layout:4,cssClass:this.getAdvancedOptionCssClass(4),isSelectable:!1,subItems:undefined,isExpanded:!1}},a.prototype.createDebugFallbackOption=function(t){return this.createAdvancedOption(null,t,"FallbackBundleText",null,["FallbackBundleText"],function(){return n.fallbackToPrepopulatedBundle(new Error("Fallback button clicked"))},2,null,{type:2,content:"&#xE81F"})},a.prototype.createAdvancedOption=function(t,i,r,u,f,e,o,s,h,c,l,a){var y,p,v;return t&&(y=this.getInstItem(t,i)),p="advancedOption"+this._advancedOptionsIdCounter++,c&&c.length==0&&(c=null),v={id:p,selected:!1,title:n.Host.getLocString(r),message:u?n.Host.getLocString.apply(n.Host,__spreadArray([u],l?l:[],!1)):null,text:f?n.Host.getLocString(f[0]):null,instItem:y,click:undefined,layout:o,dismiss:s,icon:h,cssClass:this.getAdvancedOptionCssClass(o),isSelectable:!!e||!!c,subItems:c,buttonLabel:n.Host.getLocString(a),isExpanded:!c?undefined:!1},v.narratorText=v.text,v.click=e?function(t,i){y&&n.InstrumentationHelper.instrumentItemClick(t,y,n.SequenceNumberManager.getSequenceNumber(),null,i,null);e(v)}:undefined,v},a.prototype.getAccountOptions=function(t,i){var u=[];if(!this._accessTokenManager)return u;var f=this._accessTokenManager.getCachedAccountInfo(0),e=this._accessTokenManager.getCachedAccountInfo(1),c=this._accessTokenManager.isMsaAvailable(),l=this._accessTokenManager.isAadAvailable(),o="menuItemWithButton focusable",s="removeHover",h="highlight",r;return(f||e)&&!i&&(r=this.createAdvancedOption(null,t,null,"ConnectedAccounts",null,null,5),r.cssClass=this.getAdvancedOptionCssClass(5),u.push(r),f&&n.isCloudSearchEnabledMsaCache&&(r=this.createAdvancedOption(null,t,null,null,["MicrosoftAccount"],null,4),r.message=f.accountUserName,r.narratorText=r.message,r.cssClass=this.getAdvancedOptionCssClass(4),n.isSubstrateOutlookAccountConnected||(r.cssClass+=" "+h),u.push(r),this._verifyAccountForMSARequired&&(r=this.createAdvancedOption(null,t,null,"VerifyAccountAttention",null,this.getSubstrateUpsellClickHandler(0,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptions(VerifyAccountAttention|MSA)"]:undefined),4),r.cssClass=s,r.icon={type:2,content:"&#xE946"},u.push(r),r=this.createAdvancedOption("OMVA",t,null,"VerifyButton",null,this.getSubstrateUpsellClickHandler(0,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptions(VerifyButton|MSA)"]:undefined),2),r.cssClass=o,u.push(r))),e&&n.isCloudSearchEnabledAadCache&&(r=this.createAdvancedOption(null,t,null,null,["AadAccount"],null,4),r.message=e.accountUserName,r.narratorText=r.message,r.cssClass=this.getAdvancedOptionCssClass(4),u.push(r),n.isSubstrateO365AccountConnected||(r.cssClass+=" "+h),this._verifyAccountForAADRequired&&(r=this.createAdvancedOption(null,t,null,"VerifyAccountAttention",null,this.getSubstrateUpsellClickHandler(1,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptions(VerifyAccountAttention|AAD)"]:undefined),4),r.cssClass=s,r.icon={type:2,content:"&#xE946"},u.push(r),r=this.createAdvancedOption("OMVA",t,null,"VerifyButton",null,this.getSubstrateUpsellClickHandler(1,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptions(VerifyButton|AAD)"]:undefined),2),r.cssClass=o,u.push(r))),u.push(this.getMenuDividerOption()),r=this.createAdvancedOption("OMAC",t,null,null,["ManageAccounts"],function(){return n.Host.launchWindowsAccountSettings()},2,null,{type:2,content:"&#xE716"}),r.cssClass=this.getAdvancedOptionCssClass(2),u.push(r)),i&&this._accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptions"]:undefined)||(f&&(n.isCloudSearchEnabledMsaCache||!c)||(r=this.createAdvancedOption("OMAC",t,null,null,n.isCloudSearchEnabledMsaCache?["AddMicrosoftAccount"]:["EnableMsaSearch"],n.isCloudSearchEnabledMsaCache?function(){return n.Host.launchWindowsAccountSettings()}:function(){return n.Host.launchSearchPermissions()},2,null,{type:2,content:n.isCloudSearchEnabledMsaCache?"&#xE8FA":"&#xE9BE"}),r.cssClass=this.getAdvancedOptionCssClass(2),u.push(r)),e&&(n.isCloudSearchEnabledAadCache||!l)||(r=this.createAdvancedOption("OMAC",t,null,null,n.isCloudSearchEnabledAadCache?["AddAadAccount"]:["EnableAadSearch"],n.isCloudSearchEnabledAadCache?function(){return n.Host.launchWindowsAccountSettings()}:function(){return n.Host.launchSearchPermissions()},2,null,{type:2,content:n.isCloudSearchEnabledAadCache?"&#xE8FA":"&#xE9BE"}),r.cssClass=this.getAdvancedOptionCssClass(2),u.push(r))),u},a.prototype.getUserProfileButtonData=function(){var r=this,u,i,t=this._accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getUserProfileButtonData"]:undefined),f;return t?(i=t.accountProviderAuthority=="consumers"?0:1,u=this._userProfilesCache[t.accountUserName],!u)?(f=this._substrateProfilePictureProvider.getPersonDefaultIcon(t.accountUserName),this._userProfilesCache[t.accountUserName]=f,this._accessTokenManager.getAccount(i,i==1?"https://outlook.office.com/":n.config.useCobaltCSS?"https://outlook.office.com/M365.Access":"https://outlook.office.com/User.ReadWrite",!1,!0,function(u){if(u&&u.Token){var f=r._substrateProfilePictureProvider.getProfilePictureIconForToken(i,u.Token,t.accountUserName);f&&f(1,function(n){n&&(r._userProfilesCache[t.accountUserName]=n,r.renderScopes())})}else n.logAuthRelatedInfo("getAccountOnFailure::HeaderFooterViewModel::getUserProfileButtonData","authenticate failed for accType ".concat(i,"."))},undefined,n.Host.isAuthInvestigation()?["HeaderFooterViewModel::getUserProfileButtonData"]:undefined),[f,t.accountUserName]):[u,t.accountUserName]:[null,null]},a.prototype.getAccountOptionsForUserProfileButton=function(t){var l=this,r,i,u,y,h,e,c,p;if(!this._accessTokenManager)return[];var a="removeHover",v="menuItemWithButton focusable",o=this._accessTokenManager.getAllAvailableAccounts(0),s=this._accessTokenManager.getAllAvailableAccounts(1),w=this._accessTokenManager.getCachedAccountInfo(0),b=this._accessTokenManager.getCachedAccountInfo(1),f=o.concat(s);if(o.length+s.length==0)return[];if(r=[],u=this._accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptionsForUserProfileButton"]:undefined),u&&(f=f.filter(function(n){return n.accountUserName!=u.accountUserName}),n.config.useCobaltCSS||(i=this.createAdvancedOption(null,t,null,"Accounts",null,null,5),i.cssClass=this.getAdvancedOptionCssClass(5),r.push(i)),i=this.createAdvancedOption(null,t,null,null,u.accountProviderAuthority=="consumers"?["MicrosoftAccount"]:["AadAccount"],null,4,null,this._userProfilesCache[u.accountUserName]),i.message=u.accountUserName,i.narratorText=i.message,i.cssClass=this.getAdvancedOptionCssClass(4,u),i.isSelectedAccount=u&&n.config.useCobaltCSS,r.push(i),w&&n.isCloudSearchEnabledMsaCache&&this._verifyAccountForMSARequired&&(i=this.createAdvancedOption(null,t,null,"VerifyAccountAttention",null,this.getSubstrateUpsellClickHandler(0,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptionsForUserProfileButton(VerifyAccountAttention|MSA)"]:undefined),4),i.cssClass=a,i.icon={type:2,content:"&#xE946"},r.push(i),i=this.createAdvancedOption("OMVA",t,null,"VerifyButton",null,this.getSubstrateUpsellClickHandler(0,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptionsForUserProfileButton(VerifyButton|MSA)"]:undefined),2),i.cssClass=v,r.push(i)),b&&n.isCloudSearchEnabledAadCache&&this._verifyAccountForAADRequired&&(i=this.createAdvancedOption(null,t,null,"VerifyAccountAttention",null,this.getSubstrateUpsellClickHandler(1,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptionsForUserProfileButton(VerifyAccountAttention|AAD)"]:undefined),4),i.cssClass=a,i.icon={type:2,content:"&#xE946"},r.push(i),i=this.createAdvancedOption("OMVA",t,null,"VerifyButton",null,this.getSubstrateUpsellClickHandler(1,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptionsForUserProfileButton(VerifyButton|AAD)"]:undefined),2),i.cssClass=v,r.push(i))),f.length>0)for(r.push(this.getMenuDividerOption()),y=function(u){i=h.createAdvancedOption("APPA",t,null,null,u.accountProviderAuthority=="consumers"?["MicrosoftAccount"]:["AadAccount"],function(){l._accessTokenManager.setSelectedAccount(u,3,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptionsForUserProfileButton::<navigate callback>"]:undefined);n.Host.notifyAccountSelected(u);l._menuFactory.dismiss()},0,null,{type:2,content:"&#xE77B"});i.message=u.accountUserName;i.narratorText=i.message;i.cssClass=h.getAdvancedOptionCssClass(0);r.push(i)},h=this,e=0,c=f;e<c.length;e++)p=c[e],y(p);return r.push(this.getMenuDividerOption()),i=this.createAdvancedOption("OMAC",t,null,null,["ManageAccounts"],function(){return n.Host.launchWindowsAccountSettings()},2,null,{type:2,content:"&#xE716"}),i.cssClass=this.getAdvancedOptionCssClass(2),r.push(i),o&&(n.isCloudSearchEnabledMsaCache||!this._accessTokenManager.isMsaAvailable())||(i=this.createAdvancedOption("OMAC",t,null,null,n.isCloudSearchEnabledMsaCache?["AddMicrosoftAccount"]:["EnableMsaSearch"],n.isCloudSearchEnabledMsaCache?function(){return n.Host.launchWindowsAccountSettings()}:function(){return n.Host.launchSearchPermissions()},2,null,{type:2,content:n.isCloudSearchEnabledMsaCache?"&#xE8FA":"&#xE9BE"}),i.cssClass=this.getAdvancedOptionCssClass(2),r.push(i)),s&&(n.isCloudSearchEnabledAadCache||!this._accessTokenManager.isAadAvailable())||(i=this.createAdvancedOption("OMAC",t,null,null,n.isCloudSearchEnabledAadCache?["AddAadAccount"]:["EnableAadSearch"],n.isCloudSearchEnabledAadCache?function(){return n.Host.launchWindowsAccountSettings()}:function(){return n.Host.launchSearchPermissions()},2,null,{type:2,content:n.isCloudSearchEnabledAadCache?"&#xE8FA":"&#xE9BE"}),i.cssClass=this.getAdvancedOptionCssClass(2),r.push(i)),r},a.prototype.getMenuDividerOption=function(){return{id:"divider_".concat(this.menuDividerId++),selected:!1,title:"",message:null,isSeparator:!0,text:"",instItem:null,click:null,layout:3,isSelectable:!1}},a.prototype.addZiCustomization=function(t,i,r){var h=this,f,c,u,o,e,s,v,y;if(r===void 0&&(r=!0),n.config.enableSearchHomeCustomization&&this._currentQuery.isSearchHomeZI&&this._currentQuery.scope==n.Scope.All){f={};for(c in this._currentQuery.availableDataSources)if(u=this._currentQuery.availableDataSources[c],u&&u.suggestionGroupToggler){if(typeof u.groupType!="number")throw new Error("missing groupType declaration for suggestionGroupToggler");f[u.groupType]||(f[u.groupType]=u.suggestionGroupToggler)}if(o=this._currentQuery.staticGroupOrder?this._currentQuery.staticGroupOrder.filter(function(n){return!!f[n]}):Object.keys(f).map(function(n){return+n}),o.length!=0){var l=[],p=function(t){var r=f[t],u=r.isHidden(),e=a.createAdvancedOption("OMZI",i,null,null,[],function(){r.toggle(!u);h._menuFactory.dismiss();n.Host.refreshCurrentPane()},2,null,null,null),o=n.getGroupTitleAndNarratorText(a._currentQuery,t,null,!1).title;e.text=n.Host.getLocString(u?"ShowSomething":"HideSomething",o);l.push(e)},a=this;for(e=0,s=o;e<s.length;e++)v=s[e],p(v);y=this.createAdvancedOption(null,i,null,null,["CustomizeSearchHome"],function(n){return h._menuFactory.showSubMenu(n)},2,null,{type:2,content:"&#xE70F"},l);r&&t.push(this.getMenuDividerOption());t.push(y)}}},a.prototype.addSinglePaneOptions=function(i,r){var f=this,e,o,u,s;n.RuntimeConfig.QfMode!=11&&(e=this.getScopeBarElements(),o=this.getHiddenScopeElements(e).filter(function(t){return t.type!=n.Scope.All}).map(function(n){var t=n;return t.layout=0,t}),i.push(this.createContextMenuGroup(null,r,"MoreScopesListToolTip",o)));i.push(this.getMenuDividerOption());u=[];t.authenticationManager.getAllSearchWebAccountsAsync?(this._accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::addSinglePaneOptions"]:undefined)&&n.config.userProfileButtonEnabled||(s=this.getAccountOptions(r),u.push(this.createAdvancedOption(null,r,null,null,["ConnectedAccounts"],null,2,null,{type:2,content:"&#xE716"},s))),u.push(this.createAdvancedOption("OMSS",r,null,null,["SearchSettings"],function(){return n.config.controlPanelSearchSettings?n.Host.launchSearchPermissions():n.Host.launchSearchSettings()},2,null,{type:2,content:"&#xE713"}))):(n.isCloudSearchEnabledAadCache||n.isCloudSearchEnabledMsaCache)&&this.addCloudSearchUpsells(u,r,2);u.push(this.getIndexingOption(r,1));this.addZiCustomization(u,r,!1);i.push(this.createContextMenuGroup(null,r,"OptionsButtonToolTip",u));this.isFeedbackEnabled()&&(i.push(this.getMenuDividerOption()),i.push(this.createAdvancedOption("FB",r,null,null,["FeedbackButtonText"],function(){f.showFeedback();f._menuFactory.dismiss()},2,null,{type:2,content:"&#xED15"},null)))},a.prototype.getAdvancedOptions=function(i,r){var f=this,u=[],e;return r==1&&(t.authenticationManager.getAllSearchWebAccountsAsync&&(u.push.apply(u,this.getAccountOptions(i,n.config.userProfileButtonEnabled)),u.push(this.createAdvancedOption("OMSS",i,null,null,["SearchSettings"],function(){return n.config.controlPanelSearchSettings?n.Host.launchSearchPermissions():n.Host.launchSearchSettings()},2,null,{type:2,content:"&#xE713"}))),u.push(this.getIndexingOption(i,r)),this.isFeedbackEnabled()&&n.isTwoPanesZIEnabled()&&(u.push(this.getMenuDividerOption()),e=this.createAdvancedOption("FB",i,null,null,["FeedbackButtonText"],function(){f.showFeedback();f._menuFactory.dismiss()},2,null,{type:2,content:"&#xED15"},null),e.cssClass=this.getAdvancedOptionCssClass(2),u.push(e)),this.addZiCustomization(u,i)),r==2&&this.addSinglePaneOptions(u,i),r==0&&(n.isCloudSearchEnabledAadCache||n.isCloudSearchEnabledMsaCache)&&this.addCloudSearchUpsells(u,i,r),r!=2&&n.config.troubleshootButton&&u.push(this.getMenuDividerOption()),n.config.troubleshootButton&&(r==1||r==2)&&u.push(this.createAdvancedOption("OMTS",i,null,null,["Troubleshoot"],function(){return n.Host.launchUri("https://aka.ms/fixsearch")},2,null,{type:2,content:"&#xE90F"},null)),(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)||!this._optionsWindow||r!=1&&r!=2||u.push(this.createAdvancedOption(null,i,null,null,["OptionsWindowButton"],function(){f._optionsWindow.showOptionsWindow();f._menuFactory.dismiss()},2,null,{type:2,content:"&#xE90F"},null)),r!=0&&n.TestHookUrlParameters&&n.config.debugFallbackScenario&&u.push(this.createDebugFallbackOption(i)),n.config.snrVersion&&(r==1||r==2)&&(this._shouldShowBuildNumber||n.TestHookUrlParameters||n.isMsftAccountConnected)&&u.push(this.createBuildVersionOption()),u},a.prototype.addCloudSearchUpsells=function(t,i,r){var e,f,u;if((this.addMsbUpsell(t,i,r),e=n.substrateProvidersEnabled(),r==0||r==2)&&(f=[n.Scope.People,n.Scope.Emails,n.Scope.Documents],n.config.accountVerificationInAllScope&&f.push(n.Scope.All),r!=0||this._selectedScope!=null&&n.contains(f,this._selectedScope.type)))if(e){if(this._upsellGotDismissed&&this._selectedScope&&n.contains(f,this._selectedScope.type)&&r==0)return;u=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();(u==1||u==4)&&this._verifyAccountForAADRequired&&t.push(this.getSubstrateUpsell(1,i,r));(u==2||u==4)&&this._verifyAccountForMSARequired&&t.push(this.getSubstrateUpsell(0,i,r))}else n.isBingEnabled()&&n.isCortanaEnabledCache&&t.push(this.getOneDriveUpsell(i))},a.prototype.addMsbUpsell=function(t,i,r){var c=this;if(n.config.msbAccountVerificationInSearchHome&&n.msbEnabledForQuery(null)&&r==0&&this._selectedScope!=null&&this._selectedScope.type==n.Scope.All&&this._currentQuery!=null&&this._currentQuery.isSearchHomeZI){var f=!1,e="MsbVerifyAccount",o=[],s=n.getStoredMsbTenantName();s&&(f=!0,e="MsbReverifyAccount",o=[s]);var u={isReverify:f,WSB_SessinRandom:n.Host.createGuid(),WSB_Position:r,WSB_SequenceNumber:i,WSB_ScopeType:this._selectedScope.type},l=function(){var t=function(){_w.bfbWsbTel&&bfbWsbTel.logValue("VerifyAccountSuccess","",u);n.Host.refreshCurrentPane();n.Host.setFocusInSearchBox(null,"MsbAadUpsell")},i=function(){_w.bfbWsbTel&&bfbWsbTel.logValue("VerifyAccountFailed","",u);n.Host.refreshCurrentPane();n.Host.setFocusInSearchBox(null,"MsbAadUpsell")};_w.bfbWsbTel&&bfbWsbTel.logValue("VerifyAccountDialogShown","",u);c._accessTokenManager.promptAutheticateDialog(1,"9ea1ad79-fdb6-4f9a-8bc3-2b70f96e34c7",t,i,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::onNavigate(MsbAadUpsell)"]:undefined)},h=this.createAdvancedOption("MSBA",i,null,e,null,l,6,null,{type:2,content:"&#xE814"},null,o,"VerifyButton");h.cssClass="msb-aad-upsell";t.push(h);_w.bfbWsbTel&&bfbWsbTel.logValue("VerifyAccountUpsellAdded","",u)}},a}();n.HeaderFooterViewModel=a}(WSB||(WSB={}));__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},function(n){function t(n,t){var i=HitHighlightingParser.removeMarkers(n.text),r;!i.includes(t.queryToFetch)&&i.toLowerCase().startsWith(t.queryToFetch.toLowerCase())&&(r=t.queryToFetch+i.substr(t.queryToFetch.length),n.text=HitHighlightingParser.addMarkers(r,t.queryToFetch));!n.query.includes(t.queryToFetch)&&n.query.toLowerCase().startsWith(t.queryToFetch.toLowerCase())&&(n.query=t.queryToFetch+n.query.substr(t.queryToFetch.length))}function i(i,r,u,f,e,o,s){var c,h;if(i.actionUri=f,i.confidence=o,i.source=s,i.handoffType==4)if(c=i.query.toLowerCase()==r.queryToFetch.toLowerCase(),i.updateFromQuery=function(t){return c?(i.query=t.queryToFetch,i.text=HitHighlightingParser.addMarkers(i.query,t.queryToFetch),i.narratorText=n.getNarratorText(i),!0):!1},h=n.parseTaskFrame(e),h)i.isReformulation=!0,i.click=function(){return n.safeSetTimeout(function(){return n.Host.reformulate(i.query,h)},0,"Cat1Click-Reformulation")};else return!1;else i.classNames.push("action"),i.click=function(){return n.Host.launchCat1(i.query,f,e)};return i.icon={type:3},t(i,r),i.narratorText=n.getNarratorText(i),i.type!="CSK"&&(i.getMruData=function(){return __assign(__assign({},n.getMruWebSuggestionData(i)),{annotation:i.primaryMetadata,actionUri:f,taskFrame:e,confidence:o,source:s})}),!0}function o(i,r,u,e,o,s,h,c,l,a,v){if(i.isAnswer=!0,i.htmlContent=e&&e.Content?e.Content.HTML:null,i.segments=c,i.htmlContent){var y=JsonInject.GetResourceKeys([e]);y&&(i.executeScript=function(){return JsonInject.WriteAfterContentResources(JsonInject.FilterResources(a,y))})}s&&(i.secondaryIcon={content:s,type:0});i.text.includes(HitHighlightingParser.startMarker)||(i.text=HitHighlightingParser.addMarkers(i.text,r.queryToFetch));i.htmlContent||o&&(i.primaryMetadata=o,i.additionalInfoText=" - "+o);i.handoffType==10?(i.classNames.push("action"),t(i,r),i.icon={type:3},i.click=function(){return n.Host.launchCat2or3a(i.query,l)},i.allowedInGroups=!i.htmlContent):(f(i,r),i.click=function(){return n.Host.launchSearch(i.query,v.getSearchUrl(r.fullPartialQuery,i.query,i.type,h),!1)},i.allowedInGroups=i.secondaryIcon?!!i.additionalInfoText:!i.htmlContent,i.getMruData=function(){return n.getMruUrlSuggestionData(i,h)});i.narratorText=n.getNarratorText(i)}function r(t,i,r,u,e,o){f(t,i);i.queryToFetch||(t.text=HitHighlightingParser.addMarkers(t.text));t.click=n.config.enableMoreEdgeProtocol?function(){return n.Host.launchSearch(t.query,e.getSearchUrl(i.fullPartialQuery,t.query,t.type,u,t.handoffType,i.isSearchHomeZI&&n.mapOSFormCode("WSHBSH")),t.useRaf,i.isSearchHomeZI&&n.mapOSFormCode("WSHBSH"))}:function(){return n.Host.launchSearch(t.query,e.getSearchUrl(i.fullPartialQuery,t.query,t.type,u,t.handoffType,i.isSearchHomeZI&&n.mapOSFormCode("WSHBSH")),t.useRaf)};t.narratorText=n.getNarratorText(t);t.getMruData=function(){return n.getMruUrlSuggestionData(t,u)};t.type=="HS"&&n.setExtraVerbs(t,function(){var i=[{verb:"ManageSearchHistory",displayName:n.Host.getLocString("ManageSearchHistory"),executeSync:function(){return n.Host.launchPrivacyPortal()},icon:{content:"&#xE81C",type:2}}];return n.config.removeSuggUrl&&i.unshift({verb:"RemoveFromWebHistory",displayName:n.Host.getLocString("RemoveFromWebHistory"),executeSync:function(){return o(t.text)},icon:{content:"&#xE711",type:2}}),i},!0)}function u(t,i,r,u){t.tooltip=i.isSearchHomeZI?t.text+"\n\n"+u:u+"\n\n"+HitHighlightingParser.removeMarkers(t.primaryMetadata);n.isValidIcon(t.icon)||(t.getIcon=n.Host.getEdgeIcon);t.url=u;t.click=function(){return n.Host.launchUri(u)};t.narratorText=n.getNarratorText(t,n.Host.getLocString("DirectNavSuggestion"));t.getMruData=function(){return n.getMruUrlSuggestionData(t,u)}}function f(t,i){n.isValidIcon(t.icon)||(t.icon=t.type=="HS"?{content:"&#xE81C",type:2}:t.handoffType===13?{content:"&#xEB9F",type:2}:t.handoffType===14?{content:"&#xE714",type:1}:n.getSearchSuggestionIcon());t.primaryMetadata||t.secondaryIcon||t.htmlContent||t.additionalInfoText||(t.primaryMetadata=t.handoffType===13?n.Host.getLocString("SearchForWebImages"):t.handoffType===14?n.Host.getLocString("SearchForWebVideos"):n.getWebSuggestionAnnotation(n.msbEnabledForQuery(i)))}var e=function(){function t(t,i,r,u){var f=this;this._navigationHelper=t;this._temporaryMessageHandler=i;this._accessTokenManager=r;this._previousKeystrokeCache=u;this.removeBingHistorySuggestionCallBack=function(t){f._accessTokenManager?f._accessTokenManager.getAccount(0,n.getBingResourceOrScope(0),!1,!0,function(i){if(i&&i.Token){var r={};r["X-Search-RPSToken"]=i.Token;f.sendRemoveBingHistorySuggestionRequest(t,r)}else n.logAuthRelatedInfo("getAccountOnFailure::OnlineSuggParser::removeBingHistorySuggestionCallBack","authenticate failed for MSA account.")},undefined,n.Host.isAuthInvestigation()?["OnlineSuggestionParser::removeBingHistorySuggestionCallBack"]:undefined):f.sendRemoveBingHistorySuggestionRequest(t,null)}}return t.prototype.parse=function(n,t,i,r,u,f,e){this.parseOnlineSuggestions(n,t,r,u,f,e,i)},t.prototype.parseOnlineSuggestions=function(t,i,r,u,f,e,o){var l=this,s,c,b;if(!r){n.isDataSourceEnabled("Web",t)&&f("Web",[],null);n.isDataSourceEnabled("OSTMA",t)&&f("OSTMA",[],null);n.isDataSourceEnabled("QS",t)&&f("QS",[],null);return}r&&r.ELToken&&(n.Host.setElToken(r.ELToken),r.LC==1&&n.Host.sendElToken());var a=[],v=[],y=[],h=[],p=[],w=n.isDataSourceEnabled("Web",t);n.safeExecute(function(){for(var e,s=function(u){var s=u.Attributes,c=s.appId,f,e;if(c)return v.push(u),c.split(";").forEach(function(t){n.contains(h,t)||h.push(t)}),"continue";if(f=s.settingId,f)return y.push(u),p.push(f),"continue";w&&(e=n.safeExecute(function(){return l.parseOnlineSuggestion(t,u,i,r.Resources,o)},"parseOnlineSuggestion"),e&&a.push(e))},u=0,f=r.Suggestions;u<f.length;u++)e=f[u],s(e)},"parseOnlineSuggestions");w&&(s=null,c=null,r.RankingSignals&&(s=n.safeExecute(function(){return n.parseWebEngagementSignals(r.RankingSignals)},"parseWebEngagementSignals"),n.isL2(t)||(c=n.safeExecute(function(){return n.parseWebSuppressionSignals(r.RankingSignals,t)},"parseWebSuppressionSignals"))),this._previousKeystrokeCache&&this._previousKeystrokeCache.updateWebSignalsData(t.queryToFetch,s),b={rankingSignals:r.RankingSignals,engagementSignals:s,suppressedGroups:c,webTopResultRoutingType:r.PrefixRoutingType},f("Web",a,b));n.lookupById(t,"OSTMA",h,v,function(n){return n.Attributes.appId.split(";")},"QS",p,y,function(n){return n.Attributes.settingId},u,i,f,e,function(n,u,f,e){return l.parseIdLookupResponse(r,t,i,n,u,f,e)},null,null,null,null)},t.prototype.parseIdLookupResponse=function(t,r,u,f,e,o,s){var h=this,c,l;if(o.length!=1){c=n.safeExecute(function(){return h.parseOnlineSuggestion(r,f,u,t.Resources,e)},"parseOnlineSuggestion "+e);c&&s.push(c);return}l=function(t){var e=f.Attributes;return h.compliesWithMinVersion(e.appMinVersion,t.deviceItem.version)?(t.appContext=e.appContext,h.setRankingSignals(t,f),f.Text&&e.query&&(!n.isApp(t.type)||t.appContext)&&(t.text=f.Text,t.query=e.query),f.SecondaryText&&(t.primaryMetadata=f.SecondaryText),t.handoffType==5)?i(t,r,u,e.actionUri,e.taskFrame,parseFloat(e.confidence),parseInt(e.source)):!0:!1};n.safeExecute(function(){return n.parseLocalSuggestion(r,o[0],e,u,h._temporaryMessageHandler,f.Attributes.stype,s,l)},"parseLocalSuggestion "+e)},t.prototype.parseOnlineSuggestion=function(t,f,e,s,h){var d=this,l=f.Attributes,a=l.stype,y,c,v;if(a=="CS"||l.appId||l.settingId)return null;if(y=l.isAnswer==="1"?l.url||l.vertical?n.verticalToHandoffType(l.vertical):10:l.taskFrame?l.actionUri.startsWith("action://FindMyStuff/")?4:5:a=="MD"||a=="ML"?1:n.verticalToHandoffType(l.vertical),c=n.createSuggestion(t,f.Text,null,n.getIconFromOnlineResponse(f),a,l.query,n.InstrumentedItem.createInstrumentedItem(e,a),y,e,!1),c.primaryMetadata=f.SecondaryText,this.setRankingSignals(c,f),c.autoOpenPreviewPaneWhenOnTopHit=l.openPP==="1",l.isAnswer==="1"){if(!l.url&&!n.isCortanaEnabledCache)return null;c.signals=f.Signals;o(c,t,e,f.InstantAnswer,l.additionalInfoText,l.secondaryIconUrl,l.url,l.segments,l.taskFrame,s,this._navigationHelper);l.noHeightRestriction==="1"&&c.classNames.push("noHeightRestriction");c.reactKey=a+l.url}else if(l.taskFrame){if(!n.isCortanaEnabledCache||!i(c,t,e,l.actionUri,l.taskFrame,parseFloat(l.confidence),parseInt(l.source)))return null;c.reactKey=a+l.taskFrame}else{if(!l.url)return null;if(c.autoOpenPreviewPaneWhenOnTopHit=l.openPP==="1",c.reactKey=a+t.queryToFetch+l.url,c.type=="MD"||c.type=="ML")v=n.prettyPrintUrl(l.query,t.queryToFetch,!0),v!=c.query&&(c.query=v,c.text=t.queryToFetch?HitHighlightingParser.addMarkers(v,t.queryToFetch):v),c.primaryMetadata&&!c.primaryMetadata.includes(HitHighlightingParser.startMarker)&&(c.primaryMetadata=HitHighlightingParser.addMarkers(c.primaryMetadata,t.queryToFetch)),u(c,t,e,l.url);else{if(n.queryLooksLikeUrl(c.query))return null;r(c,t,e,l.url,this._navigationHelper,this.removeBingHistorySuggestionCallBack)}}if(!n.isValidSuggestion(c,"parseOnlineSuggestion"))return null;var g=["Actor","City","Place","Country","State","Animal","Attraction","Food","Artist","People"],nt=["Song","TvShow","Movie"],p=c.segments,w=p?p.split(","):[],b=w.some(function(t){return n.contains(g,t)}),k=w.some(function(t){return n.contains(nt,t)});return(f.ChildSuggestions||b||k)&&(c.calculateChildSuggestions=function(){return d.calculateRelatedSuggestions(c,t,f,h,b,k)}),n.config.directNavPreviewPane&&c.type=="MD"&&c.url&&(c.getIcon=n.getFaviconUrlForRawUrl(c.url,64,64,1.5),c.previewPaneType=2),c},t.prototype.setRankingSignals=function(n,t){var i=t.Attributes;n.hc=i.hc==="1";n.highConfidenceSuggestionScore=+i.hcs;n.highConfidenceMetaSuggestionScore=t.HighConfidenceMetaSuggestionScore;n.prefetchConfidenceScore=t.PrefetchConfidenceScore;n.suggestionLogMeta=i.lm},t.prototype.compliesWithMinVersion=function(n,t){var r,u,i,f,e;if(!n)return!0;if(!t)return!1;for(r=n.split("."),u=t.split(".");r.length>u.length;)u.push("0");for(i=0;i<r.length;++i){if(f=u[i],e=r[i],f<e)return!1;if(f>e)return!0}return!0},t.prototype.sendRemoveBingHistorySuggestionRequest=function(t,i){var u=this,r;t=HitHighlightingParser.removeMarkers(t);r=n.config.removeSuggUrl.replace("%7b0%7d",encodeURIComponent(t)).replace("%7bSID%7d",sj_cook.get("_SS","SID"));n.fetchUrlJson(r,i,null,function(i){i&&i.success&&(n.Host.refreshCurrentPane(),n.safeSetTimeout(function(){return u._temporaryMessageHandler.showTemporaryMessage(n.Host.getLocString("RemoveFromWebHistoryConfirmation",t))},250,"removeBingHistorySuggestion"))})},t.prototype.addRelatedSuggestion=function(t,i,u,f,e,o,s){var h=n.createSuggestion(i,f,null,e,o,t?t.Query:u.query,n.InstrumentedItem.createInstrumentedItem(u.sequenceNumber,o),s,u.sequenceNumber,!1,null,null,!0);h.groupType=n.GroupType.Related;h.parent=u;h.isChild=!0;h.tooltip=t?t.SecondaryText:null;h.rankingScore=t?t.RankingScore:0;h.category=t?t.Category:null;h.isAnswer=!0;r(h,i,u.sequenceNumber,t?t.Url:null,this._navigationHelper,this.removeBingHistorySuggestionCallBack);h.primaryMetadata=null;h.reactKey=o+f+(t?t.Category+t.SecondaryText:"");n.isValidSuggestion(h,"calculateRelatedSuggestions")&&u.childSuggestions.push(h)},t.prototype.calculateRelatedSuggestions=function(t,i,r,u,f,e){var s,h,o;if(t.childSuggestions=[],r.ChildSuggestions)for(s=0,h=r.ChildSuggestions;s<h.length;s++)o=h[s],this.addRelatedSuggestion(o,i,t,o.Text,n.getIconFromOnlineResponse(o),o.Type,0);f&&this.addRelatedSuggestion(null,i,t,n.Host.getLocString("Images"),null,"EIM",13);e&&this.addRelatedSuggestion(null,i,t,n.Host.getLocString("Videos"),null,"EVI",14);t.childSuggestions.length>0&&n.InstrumentationHelper.instrumentDataSource(t.sequenceNumber,u,t.childSuggestions,null)},t}();n.OnlineSuggestionsParser=e;n.adjustCasing=t;n.setCat1SuggestionProperties=i;n.setWebSearchSuggestionProperties=r;n.setUrlSuggestionProperties=u}(WSB||(WSB={}));__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},function(n){function p(n){return n?[n]:[]}function ut(n){if(n){var t=n.lastIndexOf(".");if(t>=0)return n.substring(t)}return""}function ft(t){var i=t?new Date(t):null;return n.isValidDate(i)?i:null}function et(t){if(t){var i=n.getCurrentDate();if(i.getDate()==t.getDate()&&i.getMonth()==t.getMonth()&&i.getFullYear()==t.getFullYear())return t.toLocaleTimeString(n.uiLanguageCache,{hour:"numeric",minute:"numeric"})}return null}function r(t,r,u,e,o){var nt,tt,p,it,a,w,v,h,c,s,rt,y,b;if(o===void 0&&(o=!1),!o&&e.extensionLC&&SearchAppWrapper.CortanaApp.hideFileExtensions){var d=e.extensionLC.length,l=e.query,g=l.toLocaleLowerCase();g.endsWith(e.extensionLC)&&(nt=r?HitHighlightingParser.addMarkers(l,r):l,tt=n.config.disableSyntaxHighlight?r===""||!e.extensionLC.toLocaleLowerCase().startsWith("."+r.toLocaleLowerCase()):nt.toLocaleLowerCase().endsWith(e.extensionLC),tt&&(e.query=l.substring(0,l.length-d),p=e.text.toLocaleLowerCase(),it=HitHighlightingParser.removeMarkers(p),g==it&&(a=p.lastIndexOf(e.extensionLC),a>0&&(e.text=e.text.substring(0,a)+e.text.substr(a+d)))))}for(e.lastModifiedDate&&(e.lastModifiedDateString=e.lastModifiedDate.toLocaleString(n.uiLanguageCache,{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric"})),e.lastAccessDate&&(e.lastAccessDateString=e.lastAccessDate.toLocaleString(n.uiLanguageCache,{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric"})),e.primaryMetadata=e.sourceForGroup&&e.sourceForGroup!=1?n.getGroupSourceDisplayName(e.sourceForGroup):e.itemTypeDisplayName,e.explanation?e.additionalInfoText=e.explanation:t.isSearchHomeZI&&n.config.msbQws3sSugHideTimestamp?e.additionalInfoText=null:t.isSearchHomeZI&&(e.additionalInfoText=e.prettyPrintedPath||e.path),e.classNames=e.classNames.indexOf("fbig")>=0?["fbig"]:[],e.match?(w=(vt(e.match.matchType)?n.Host.getLocString(n.MatchType[e.match.matchType])+": ":"")+HitHighlightingParser.addMarkers(e.match.matchedText,r),e.additionalInfoText=w,e.secondaryMetadata=w,e.classNames.push("withMatchAnnotation","forceNoWrapOutsideTopResult")):e.lastModifiedDateString&&n.RuntimeConfig.QfMode!=5&&(e.secondaryMetadata=n.Host.getLocString("LastModified")+": "+e.lastModifiedDateString),e.narratorText=n.getNarratorText(e),n.displayedInGridLayout(e.type)&&(u?e.classNames.push("bigIcon","biggerIcon"):e.classNames.push("bigIcon")),!o&&e.handoffType==2&&SearchAppWrapper.CortanaApp.copyToClipboard&&i(e,function(){return[{verb:n.JumplistActionItemType[n.JumplistActionItemType.S_CopyFullPath],displayName:n.Host.getLocString("CopyFullPath"),executeSync:function(){return SearchAppWrapper.CortanaApp.copyToClipboard(e.path,"")},icon:{type:1,content:"&#xE8C8"}}]},!1),v={},h=e.prettyPrintedPath||e.path,h&&(c=h.lastIndexOf("/"),c<0&&(c=h.lastIndexOf("\\")),c<0&&(c=h.lastIndexOf(" > ")),s=h.substring(0,c),s.endsWith(":")&&(s=s+"\\"),e.parentFolder=s,v[n.Host.getLocString("Location")]=[{text:s,click:function(){return n.isUncOrLocalPath(s)?SearchAppWrapper.CortanaApp.launcher.startLaunchFolder(s):e.locationUrl?SearchAppWrapper.CortanaApp.launcher.launchUriAsync(decodeURI(e.locationUrl)):SearchAppWrapper.CortanaApp.launcher.launchUriAsync(s)}}]),rt=n.nicerCloudFilesEnabled(t,e),e.tooltip=at(e,rt),y=0,b=f;y<b.length;y++){var k=b[y],ft=k[0],et=k[1],ot=k[2],ut=e[ot];ut&&!ft&&(v[n.Host.getLocString(et)]=[{text:ut}]);e.previewMetadata=v}}function ot(t,i,u){var e,o;for(i.match||!u.match||i.parentFolderDisambig||(i.match=u.match,i.needsRefreshAfterDeduping=!0,i.previewPaneNeedsRefreshAfterDeduping=!0),e=0,o=f;e<o.length;e++){var c=o[e],s=c[2],h=u[s];h&&!i[s]&&(i[s]=h,i.needsRefreshAfterDeduping=!0,i.previewPaneNeedsRefreshAfterDeduping=!0)}(n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9)&&(i.needsRefreshAfterDeduping=!1,i.previewPaneNeedsRefreshAfterDeduping=!1);i.needsRefreshAfterDeduping&&r(t,n.getEffectiveQuery(t),n.isL2(t),i,!0)}function st(t,i,r){return r===void 0&&(r=1),n.Async.safeChainWithGlobalCaching("getIconForTypeAsync",function(t){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getIconForTypeAsync(i,n.getImageSizeValue(t))},function(n){return n+"_"+i},function(i){return n.toIcon(i,"getIconForTypeAsync",t)},t,null,null,r)}function w(n){return n!=null&&(n.type==3||!!n.content||!!n.className)}function e(n,t,i){i===void 0&&(i=!0);var r=n.mayContainPII;return n.text?n.query?!n.handoffType&&n.handoffType!==0?(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing handoff type")),!1):n.type?i&&!n.getIcon&&!w(n.icon)?(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing icon")),!1):!0:(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing suggestion type")),!1):(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing query")),!1):(SharedLogHelper.LogError(t,r?"":n.deviceItem?n.deviceItem.id:"",new Error("Missing text")),!1)}function i(t,i,r){var u=t.getExtraVerbs;t.getExtraVerbs=function(t){var f=u?u(t):[],e=i(t);return n.joinVerbs(f,e,r)}}function ht(t,i,r){var u=t.getExtraVerbsAsync;t.getExtraVerbsAsync=u?function(t){return ThresholdUtilities.createPromise(function(f){return u(t).then(function(u){return i(t).then(function(t){return f(n.joinVerbs(u,t,r))})})})}:i}function u(n,t){var r=n.propertyHits||[],i=r.indexOf(t);return typeof i=="object"&&i.returnValue!==undefined?i.returnValue:i>=0}function ct(n){var i,t;if(n&&typeof n=="object"&&n.length){for(i="",t=0;t<n.length;t++)i+=n[t],t!=n.length-1&&(i+=", ");return i}return n}function t(t,i,r){return n.safeExecute(function(){return ct(t.getProperty(i))},"get"+i,undefined,r)}function lt(t){for(var r,f,o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];for(r=0,f=o;r<f.length;r++){var e=f[r],h=e[0],s=e[1],c=e[2];if(s&&u(t,c))return n.createMatch(h,s)}return null}function at(t,i){var r=i?t.query+"\n"+t.parentFolder:t.prettyPrintedPath||t.path||"",o,l,e,s,u;for(t.textContentIfMatched&&(r+=(r?"\n\n":"")+t.textContentIfMatched),o=!!r,l=function(){r&&(r+="\n");o&&(r+="\n",o=!1)},e=0,s=f;e<s.length;e++){var h=s[e],a=h[0],v=h[1],c=h[2];i&&c=="lastModifiedBy"&&t.lastModifiedDateString||(u=t[c],u&&(!a||i)&&(l(),i&&c=="lastModifiedDateString"&&t.lastModifiedBy&&(u=n.Host.getLocString("LastModifiedCombined",u,t.lastModifiedBy)),r+=n.Host.getLocString(v)+": "+u))}return t.explanation&&t.meeting&&(r=HitHighlightingParser.removeMarkers(t.explanation)+"\n\n"+r),r}function vt(t){switch(t){case n.MatchType.Author:case n.MatchType.LastModifiedBy:case n.MatchType.Tags:case n.MatchType.Genre:case n.MatchType.Album:case n.MatchType.Artist:return!0;case n.MatchType.Content:case n.MatchType.Location:return!1;default:throw new Error("Unknown match type: "+t);}}function yt(t,i,r,u,f,e,o,s,h,c,l,a,v,y,w,b,k,d){i&&n.isDataSourceEnabled(i,t)&&n.LocalDataProvider.getApps(r,function(t){var e,s,r,o,h;if(c()){for(n.InstrumentationHelper.instrumentResponseReceived(l,i,null,0,!1,!1),e=[],s=function(r){n.safeExecute(function(){return y(r,i,f(r).map(function(n){return t[n]}).filter(function(n){return!!n}),e)},"parseApp "+i)},r=0,o=u;r<o.length;r++)h=o[r],s(h);a(i,e,null)}},v,i);e&&n.isDataSourceEnabled(e,t)&&n.LocalDataProvider.getSettings(o,function(t){var u,o,r,f,v;if(c()){for(n.InstrumentationHelper.instrumentResponseReceived(l,e,null,0,!1,!1),u=[],o=function(r){n.safeExecute(function(){return y(r,e,p(t[h(r)]),u)},"parseSetting "+i)},r=0,f=s;r<f.length;r++)v=f[r],o(v);a(e,u,null)}},v,e);w&&n.isDataSourceEnabled(w,t)&&n.LocalDataProvider.getFiles(b,function(t){var r,f,i,u,e;if(c()){for(n.InstrumentationHelper.instrumentResponseReceived(l,w,null,0,!1,!1),r=[],f=function(i){n.safeExecute(function(){return y(i,w,p(t[d(i)]),r)},"parseFile "+w)},i=0,u=k;i<u.length;i++)e=u[i],f(e);a(w,r,null)}},t,v,w)}function pt(t){return n.EdgeAppIds.some(function(n){return t.id==n})?n.Host.getLocString("MicrosoftRecommendedBrowser"):n.Host.getLocString("App")}function wt(t){return n.isModernSetting(t)?n.Host.getLocString("SystemSettingsAnnotation"):n.Host.getLocString("ControlPanelAnnotation")}function bt(t){return n.isFileOrFolder(t.type)?t.deviceItem:null}function kt(t,u,f,e,o,s){var h=n.getAppItem(o),l,a,c,v,p,y,w;if(h){e&&k(o,h);o.primaryMetadata=pt(h);o.narratorText=n.getNarratorText(o);o.tooltip=t.isSearchHomeZI?o.text:"";o.type=="IBA"&&(o.tooltip=h.id,o.path=h.id);return}if(n.isSetting(o.type)){o.primaryMetadata=wt(o.deviceItem);o.narratorText=n.getNarratorText(o);o.tooltip=t.isSearchHomeZI?o.text:"";return}if(o.type=="LURL"&&(h=o.deviceItem,h)){l=h.id;o.narratorText=n.getNarratorText(o,n.Host.getLocString("DirectNavSuggestion"));o.tooltip=o.query+"\n\n"+l;o.url=l;return}if(a=bt(o),a){dt(t,u,f,e,s,o,a);return}if(o.type=="PT"||o.type=="CG"){if(c=o,o.type!="PT"&&o.deviceItem.launchArguments||(c.path=o.deviceItem.id),v=o.deviceItem,p=v.kind,p=="program"){d(o);return}if(y=gt(v),y){c.itemTypeDisplayName=y;r(t,u,f,c);return}o.type=="CG"&&d(o);return}if(o.type=="FEH"){o.narratorText=n.getNarratorText(o,n.Host.getLocString("SearchHistorySuggestion"));u&&(o.text=HitHighlightingParser.addMarkers(o.text,u));SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.onSearchHistoryRemoved&&(w={verb:"RemoveFromDeviceHistory",displayName:n.Host.getLocString("RemoveFromDeviceHistory"),executeSync:function(){SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.onSearchHistoryRemoved(o.query);n.Host.refreshCurrentPane()},icon:{content:"&#xE711",type:2}},i(o,function(){return[w]},!1));return}throw new Error("Unexpected type: "+o.type);}function dt(i,f,e,o,s,h,c){var y,p,d,w,b,v,a,g,l,nt,tt;if(d=h.type=="LDOC"?n.resolveKnownFolderGUIDsInPath(c.id):n.indexerFilePathToRegularPath(c.id),h.path=d,h.itemTypeDisplayName=c.itemTypeDisplayName,o&&k(h,c),w=c.lastModifiedDate,n.isValidDate(w)&&(h.lastModifiedDate=w),b=c.extension,b&&(h.extensionLC=b.toLocaleLowerCase()),s!="MFF"||n.IndexerQueryGenerator){h.type=="MU"&&(h.artist=n.IndexerQueryGenerator?t(c,"System.Music.DisplayArtist",s):t(c,"System.Music.Artist",s),h.album=t(c,"System.Music.AlbumTitle",s));v=void 0;switch(s){case"MPVD":h.author=t(c,"System.Author",s);h.lastModifiedBy=t(c,"System.Document.LastAuthor",s);h.tags=t(c,"System.Keywords",s);h.tags+=t(c,"System.Photo.TagViewAggregate",s);u(c,"System.Search.Contents")&&(a=t(c,"System.Search.AutoSummary",s),a&&(y=n.tryGetTextContentMatch(a,f),h.textContentIfMatched=y[0],v=y[1]),c.propertyHits.length==1&&(h.matchedOnlyOnContent=!0));n.IndexerQueryGenerator&&(h.artist=t(c,"System.Music.DisplayArtist",s),h.genre=t(c,"System.Music.Genre",s));break;case"MDOC":h.author=t(c,"System.Author",s);h.lastModifiedBy=t(c,"System.Document.LastAuthor",s);h.tags=t(c,"System.Keywords",s);u(c,"System.Search.Contents")&&(a=t(c,"System.Search.AutoSummary",s),a&&(p=n.tryGetTextContentMatch(a,f),h.textContentIfMatched=p[0],v=p[1]),c.propertyHits.length==1&&(h.matchedOnlyOnContent=!0));break;case"MPHO":h.tags=t(c,"System.Photo.TagViewAggregate",s);break;case"MVID":n.IndexerQueryGenerator&&(h.artist=t(c,"System.Music.DisplayArtist",s),h.genre=t(c,"System.Music.Genre",s));h.tags=t(c,"System.Keywords",s);break;case"MMUS":h.genre=t(c,"System.Music.Genre",s)}g=n.config.disableSyntaxHighlight?!h.text.startsWith(n.Host.getQuery().queryToFetch)&&f:!h.text.includes(HitHighlightingParser.startMarker)&&f;g&&(l=void 0,nt=s!="LM"&&s!="FL",nt&&(s=="MFF"?(l=t(c,"System.Title",s),l&&!n.matchesOnPropertyHH(l,f)&&(l=undefined)):u(c,"System.Title")&&(l=t(c,"System.Title",s))),l?h.text=HitHighlightingParser.addMarkers(l,f):v?h.match=v:(tt=n.IndexerQueryGenerator?"System.Music.DisplayArtist":"System.Music.Artist",h.match=lt(c,s,[n.MatchType.Album,h.album,"System.Music.AlbumTitle"],[n.MatchType.Artist,h.artist,tt],[n.MatchType.Genre,h.genre,"System.Music.Genre"],[n.MatchType.Tags,h.tags,"System.Keywords"],[n.MatchType.Tags,h.tags,"System.Photo.TagViewAggregate"],[n.MatchType.Author,h.author,"System.Author"],[n.MatchType.LastModifiedBy,h.lastModifiedBy,"System.Document.LastAuthor"])))}r(i,f,e,h);ni(h)}function k(t,i){var r=n.safeExecute(function(){return i.getProperty("System.Link.TargetParsingPath")},"getTargetPath"),u,f,e;r&&(r=r.toLocaleLowerCase(),u=n.getKnownFolderPathLC(n.FOLDERID_Profile),u&&(f=n.getKnownFolderPathLC(n.FOLDERID_SystemX86),f&&r.startsWith(f+"\\config\\systemprofile")?r=u+r.substr(f.length+21):(e=n.getKnownFolderPathLC(n.FOLDERID_System),e&&r.startsWith(e+"\\config\\systemprofile")&&(r=u+r.substr(e.length+21)))),t.targetPathLC=r)}function gt(n){if(n.launchArguments)return null;var t=n.itemTypeDisplayName;return t&&t[0]!="."?t:null}function o(t){for(var f,e,l,y,s,h,a,i,c,r,v,o=[],u=0;u<t.length-1;++u)if(f=t[u],!n.displayedInGridLayout(f.type)&&!f.explanation)for(e=u+1;e<t.length;++e)if(l=t[e],f.type==l.type&&f.text.toLocaleLowerCase()==l.text.toLocaleLowerCase()){o[u]=!0;o[e]=!0;break}if(o.length!=0)for(y=t.filter(function(n,t){return o[t]}),s=n.Host.getLocString("InfoTextWithSource"),h=0,a=y;h<a.length;h++)if(i=a[h],i.path){if(c=i.path.lastIndexOf("\\"),c==-1)continue;if(r=i.path.slice(i.path.lastIndexOf("\\",c-1)+1,c),v=i.handoffType==2?null:i.primaryMetadata,v&&r.endsWith(":"))continue;i.type=="IBA"?(i.secondaryMetadata=i.primaryMetadata,i.primaryMetadata=r):i.primaryMetadata=i.primaryMetadata?v?n.formatString(s,[r,i.primaryMetadata]):n.formatString(s,[i.primaryMetadata,r]):r;i.additionalInfoText=n.formatString(s,[" -",r]);i.match&&(i.classNames=i.classNames.filter(function(n){return n!="withMatchAnnotation"&&n!="forceNoWrapOutsideTopResult"}));i.narratorText=n.getNarratorText(i);i.parentFolderDisambig=r}}function d(t){t.primaryMetadata=n.Host.getLocString("RunCommandPrompt");t.classNames.push("action");t.narratorText=n.getNarratorText(t)}function g(t,i,r,u,f,o,s,h){var w=n.localDataSourceMayContainPII(r),b,y,l,p,k;if(!o){b=i.deviceItem.kind;SharedLogHelper.LogError("parseLocalSuggestion"+r,w?"":i.deviceItem.displayName||i.deviceItem.id,new Error("Unrecognized kind: "+b));return}if(y=o=="LURL"?1:2,n.isSuggestionTypeEnabled(r,o,y,t)){var a=n.getEffectiveQuery(t),v=i.deviceItem.displayName,d=v&&a?HitHighlightingParser.addMarkers(v,a):v,c=n.createSuggestion(t,d,i.getIcon,i.icon,o,v,n.InstrumentedItem.createInstrumentedItem(u,o),y,u,w);c.uxHint=ui(i,a);i.deviceItem.isSimulated||(c.deviceItem=i.deviceItem);c.ciMetaData=i.ciMetaData;n.isApp(o)&&(c.pinnedToTaskbar=n.Host.isPinnedToTaskbar(i.deviceItem.id));i.groupDisplayName&&(c.groupDisplayName=i.groupDisplayName);l=n.getAppItem(c);l?(c.click=function(){return n.Host.launchAppItem(l,r,c.appContext)},n.config.maxJLcm&&ti(t,c,l,f,u,r),c.reactKey=o+l.id):c.type=="FEH"?(c.click=function(){return n.Host.submitFileExplorerTextSuggestion(c.query)},c.reactKey=o+c.query):c.type=="FD"&&n.RuntimeConfig.QfMode==5?(c.click=function(){return n.Host.submitFileExplorerFolderSuggestion(c.path)},c.reactKey=o+c.deviceItem.id):(c.click=function(){return n.Host.launchDeviceItem(c.deviceItem,r)},c.reactKey=o+c.deviceItem.id);l&&c.type!="IBA"||n.isSetting(c.type)||n.isFileOrFolder(c.type)&&c.type!="LDOC"?c.getMruData=function(){return __assign(__assign({},n.getMruSuggestionData(c)),{id:i.deviceItem.id,appContextData:c.appContext?{appContext:c.appContext,query:c.query,textWithoutHH:HitHighlightingParser.removeMarkers(c.text)}:undefined})}:(p=n.getCommandLineItem(c),p&&(c.hc=n.isRealCommand(c,p)));k=n.getGroupType(c);n.shouldSetThisPcGroupSource(k,t)&&(c.sourceForGroup=1);kt(t,a,n.isL2(t),n.supportsShortcuts(r,t),c,r);(n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9)&&(c.additionalInfoText=undefined,c.primaryMetadata=undefined,c.secondaryMetadata=undefined);c.reactKey||(c.reactKey=o+t+i.deviceItem.id);e(c,"parseLocalSuggestion "+r)&&h(c)&&s.push(c)}}function ni(t){i(t,function(){var i,r;return t.duplicates&&(i=t.duplicates.find(function(n){return n.handoffType==7||n.handoffType==8}),i)?(r=[],r.push({verb:n.JumplistActionItemType[n.JumplistActionItemType.S_OpenInBrowser],displayName:n.Host.getLocString("OpenInBrowser"),executeSync:function(){return n.Host.launchUri(i.url+(i.handoffType==8?"?web=1":""))},icon:{type:1,content:"&#xE774"}}),i.locationUrl&&r.push({verb:n.JumplistActionItemType[n.JumplistActionItemType.S_OpenFileLocationInBrowser],displayName:n.Host.getLocString("OpenFileLocationIn",n.getGroupSourceDisplayName(i.sourceForGroup)),executeSync:function(){return n.Host.launchUri(i.locationUrl)},icon:{type:2,content:"&#xE838"}}),r):[]},!0)}function nt(t,i){return!n.config.enableFallbackIconsForJumpLists||!y[t]?!1:n.contains(y[t],i)}function ti(t,r,u,f,e,o){var l=u.id,p=u.filePath,h,w,y;if(!n.config.forceAllJumplists){if(h=n.config.enableJumplistRestrictions&&it[l],!h&&p){w=p.toLowerCase();for(y in v)if(w.includes(y)){h=v[y];break}if(!h&&n.config.enableJumplistRestrictions)for(y in a)if(w.includes(y)){h=a[y];break}}if(h&&h.length==0)return}(n.RuntimeConfig.AlwaysWide||!rt.find(function(n){return n==l}))&&(r.calculateChildSuggestions=function(){return ii(t,l,p,r,u,h,f,e,o)},n.config.maxJLcm&&i(r,function(t){var i=[],e,o;return t||(r.calculateChildSuggestions&&r.calculateChildSuggestions(),!r.childSuggestions||n.RuntimeConfig.AlwaysWide&&r.previewPaneType||(e=!1,r.childSuggestions.filter(function(t){return t.type=="JL"&&!t.displayed&&t.groupType==n.GroupType.JumpListTasks}).slice(0,n.config.maxJLcm).forEach(function(n){e=!0;var t=nt(r.deviceItem.id,n.groupType)?r.getIcon:s(n.jumpListItem,n.parent,!1,l),o={verb:"JumpListTask_"+l+"_"+n.text,displayName:n.text,executeSync:function(){return c(u,n,f)},getIcon:t};i.push(o)}),o=!1,r.childSuggestions.filter(function(t){return t.type=="JL"&&!t.displayed&&t.groupType!=n.GroupType.JumpListTasks}).slice(0,n.config.maxJLcm).forEach(function(n,t){var r,h;e&&!o&&(r={},i.push(r));o=!0;h={verb:"JumpList_"+l+"_"+t,displayName:n.text,executeSync:function(){return c(u,n,f)},getIcon:s(n.jumpListItem,n.parent,!0,l)};i.push(h)}))),i},!0))}function ii(t,i,r,u,f,l,a,v,y){var k,w,ut,p,d,it,b,g,rt,ot;if(u.calculateChildSuggestions=null,k=f.jumpList,k&&k.length!=0){for(w=r||"",ut=w.indexOf("}"),w=w.substr(ut+1),p=[],d=0,it=k;d<it.length;d++)if(b=it[d],!l||n.contains(l,b.type)){var ft=h(b.type),et=ft!=n.GroupType.JumpListTasks,st=function(r){var y;if(tt(r))return"continue";var k=nt(u.deviceItem.id,h(b.type))?u.getIcon:s(r,u,et,i),l="JL",o=n.createSuggestion(t,r.displayName,k,null,l,r.displayName,n.InstrumentedItem.createInstrumentedItem(v,l),2,u.sequenceNumber,et,null,null,!0);o.click=function(){return c(f,o,a)};o.jumpListItem=r;o.groupType=ft;o.groupDisplayName=b.name;o.parent=u;o.tooltip=r.description;y=w&&r.path.endsWith(w);y||(o.path=r.path);e(o,"calculateJumpListSuggestions")&&(p.push(o),ri(f,o,a))};for(g=0,rt=b.items;g<rt.length;g++)ot=rt[g],st(ot)}p.length>0&&(u.childSuggestions=u.childSuggestions?u.childSuggestions.concat(p):p,o(p),n.InstrumentationHelper.instrumentDataSource(v,y,p,null))}}function s(t,i,r,u){return function(f,e){return n.getIcon(t,u+"_"+t.path+"_"+t.displayName,"jumpList",!r,!1,null,null,0)(f,function(n){n?e(n):i.getIcon(f,e)})}}function tt(t){return t.displayName?!n.RuntimeConfig.AlwaysWide&&n.olderThan2Weeks(t.lastAccessed)?!0:!1:!0}function h(t){switch(t){case 0:return n.GroupType.JumpListTasks;case 1:return n.GroupType.JumpListPinned;case 2:return n.GroupType.JumpListRecent;case 3:return n.GroupType.JumpListFrequent;default:return n.GroupType.JumpListCustom}}function c(t,i,r){n.Async.safeChain("launchJumpList",function(){return i.jumpListItem.launchAsync()},function(){return n.Host.manuallyDismissApp()},function(){n.DialogBox?n.DialogBox.show(n.Host.getLocString("JumpListItemUnavailableDeleteConfirmation"),[{id:null,text:n.Host.getLocString("Cancel"),selected:!0,action:function(){return n.Host.setFocusInSearchBox(null,"jumpListItemDialogBoxCancel")}},{id:null,text:n.Host.getLocString("Remove"),selected:!1,action:function(){l(t,i,r);n.Host.setFocusInSearchBox(null,"jumpListItemUnavailable1")}}]):(r.showTemporaryMessage(n.Host.getLocString("JumpListItemUnavailable")),l(t,i,r),n.Host.setFocusInSearchBox(null,"jumpListItemUnavailable2"))})}function l(t,i,r){var u=function(){return r.showTemporaryMessage(n.Host.getLocString("RemoveFromListFailure",i.text))},f=i.parent.childSuggestions.length==1;n.Async.safeChain("deleteJumpList",function(){return i.jumpListItem.deleteAsync()},function(){n.Async.safeChain("getJumpListAsync",function(){return t.getJumpListAsync()},function(t){f&&t.some(function(n){return h(n.type)==i.groupType&&n.items.some(function(n){return!tt(n)})})?u():(n.Host.refreshCurrentPane(),r.showTemporaryMessage(n.Host.getLocString("RemovedFromList",i.text)))},u)},u)}function ri(t,r,u){r.jumpListItem.deleteAsync&&i(r,function(){var i={verb:"RemoveFromThisList",displayName:n.Host.getLocString("RemoveFromThisList"),executeSync:function(){return l(t,r,u)},icon:{type:2,content:"&#xE711"}};return[i]},!0)}function ui(t,i){if(t&&t.uxHint){var r=i?HitHighlightingParser.addMarkers(t.uxHint,i):t.uxHint;return n.Host.getLocString("RelatedSynonym",r)}return null}var it={"Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge":[0],"Microsoft.InternetExplorer.Default":[0],Chrome:[0],"360browser":[0]},a={skype:[],outlook:[0],"360browser":[0],chrome:[0],iexplore:[0],opera:[0],firefox:[0],safari:[0]},v={"\\msedge.exe":[0]},rt=["Microsoft.Windows.Explorer",],f=[[!0,"LastAccessed","lastAccessDateString"],[!1,"LastModified","lastModifiedDateString"],[!1,"LastModifiedBy","lastModifiedBy"],[!1,"Author","author"],[!1,"Artist","artist"],[!1,"Album","album"],[!1,"Genre","genre"],[!1,"Tags","tags"],],y={"Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge":[n.GroupType.JumpListTasks],"Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe!App":[n.GroupType.JumpListTasks],"Microsoft.XboxApp_8wekyb3d8bbwe!Microsoft.XboxApp":[n.GroupType.JumpListCustom],"com.squirrel.Teams.Teams":[n.GroupType.JumpListTasks],"Microsoft.ScreenSketch_8wekyb3d8bbwe!App":[n.GroupType.JumpListTasks]},b;n.getFileExtension=ut;n.toDate=ft;n.getTodayTimeString=et;n.setFileTemplate=r;n.enrichMetadataFromDuplicate=ot;n.getIconForTypeAsync=st;n.isValidIcon=w;n.isValidSuggestion=e;n.setExtraVerbs=i;n.setExtraVerbsAsync=ht;b=function(){function t(n){this._temporaryMessageHandler=n}return t.prototype.parse=function(t,i,r,u,f,e){for(var l,a,v=this,s=[],y=function(u){n.safeExecute(function(){return g(t,u,r,i,v._temporaryMessageHandler,u.suggestionType,s,function(){return!0})},"parseLocalSuggestion "+r)},h=0,c=u.suggestions;h<c.length;h++)l=c[h],y(l);(n.isFileOrFolderLocalDataSource(r)||r=="IBA")&&o(s);a={maxedOut:u.maxedOut};e(r,s,a)},t}();n.SuggestionsParser=b;n.lookupById=yt;n.decorateSuggestionsWithParentFolder=o;n.parseLocalSuggestion=g}(WSB||(WSB={})),function(n){var t;(function(t){t.currentCIVersion="-1";var i=function(){function i(r){var u=this;(n.Host.bindShown(function(){var n=u.getContstraintIndexInfo(r.lastUrl);t.currentCIVersion=n?String(n.version):"-1"}),n.Host.hasFallbackHappened())||n.Host.bindAppHidden(function(){var l,s,e,h;if(n.isBingEnabled()&&n.isBrowserOnline()){var c=u.safeGetLastUrl(r),w=u.safeGetUrlResult(r),b=n.getWindowHost().toLowerCase(),nt=b=="bing.com"||b.endsWith(".bing.com");if(!nt&&!(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest))return;if(l=n.LightweightStorage.getItem(i.LastCIDownloadAttemptKey),s=null,l&&(s=new Date(l)),s&&(u.getTimeDiffInMins(s)<n.config.waitBetweenCIDownloadCallsInMins?n.config.waitBetweenCIDownloadCallsInMins:0))return;e=u.getContstraintIndexInfo(c);t.currentCIVersion=String(e.version);var a=n.getCurrentLanguage(),f=n.config.ciVersion,o=u.parseUrlResult(w),v=u.getUrlForCiCab(f,a),k=n.contains(n.config.blocklistedCiVersions,e.version)&&f<e.version,tt=f==o.version&&o.errorCode!="00000000";if(f>0&&n.config.supportedCiMarkets[a]&&(a!=e.language||f>e.version||k||tt)&&(!o.url||k||c==o.url||o.errorCode!="00000000")){var y="cis_v"+f,p="ci_v"+f,d=n.LightweightStorage.getItem(y)?parseInt(n.LightweightStorage.getItem(y)):0,g=n.LightweightStorage.getItem(p)?parseInt(n.LightweightStorage.getItem(p)):0;n.LightweightStorage.setItem(i.LastCIDownloadAttemptKey,n.getCurrentDate().toString());h="constraintIndexDownloader.tryDownloadFromUrlAsync";n.Async.safeChain(h,function(){return r.tryDownloadFromUrlAsync(v)},function(i){if(i){var r=u.getContstraintIndexInfo(c);t.currentCIVersion=String(r.version);d++;n.LightweightStorage.setItem(y,d.toString())}else SharedLogHelper.LogError(h,"urlResult: "+w,"Download failed");g++;n.LightweightStorage.setItem(p,g.toString())},function(n){SharedLogHelper.LogError(h,"onError - url:  ".concat(v),n.message)},null,v,0)}}})}return i.prototype.parseUrlResult=function(n){var r=null,t=null,u=1,i,f;return n?(i=n.split(":0x"),i.length>1?(r=i[0],t=i[1],t!="00000000"&&SharedLogHelper.LogWarning("constraintIndexDownloader.urlResult",t,"Download encountered problems"),f=this.getContstraintIndexInfo(r),u=f.version):SharedLogHelper.LogError("constraintIndexDownloader.parseUrlResult","urlResult: "+n,"Invalid URL")):SharedLogHelper.LogError("constraintIndexDownloader.parseUrlResult","No urlResult"),{url:r,version:u,errorCode:t}},i.prototype.getContstraintIndexInfo=function(n){var r=-1,u="",t,i;return n?(t=n.split("/"),t.length>1?(i=t[t.length-1].split("."),u=i.length==2?i[0]:"",r=+t[t.length-2]):SharedLogHelper.LogError("constraintIndexDownloader.getContstraintIndexInfo","url: "+n,"Invalid URL")):SharedLogHelper.LogError("constraintIndexDownloader.getContstraintIndexInfo","No Url"),{version:r,language:u}},i.prototype.safeGetLastUrl=function(t){if(!n.config.ciDownloadUpdate)return t.lastUrl;var r="https://www.bing.com/bcs/ci/-1/en-us.cab",i=r;try{return i=t.lastUrl,n.isNullOrUndefined(i)||i.length==0?r:i}catch(u){return r}},i.prototype.safeGetUrlResult=function(t){if(!n.config.ciDownloadUpdate)return t.urlResult;var r="https://www.bing.com/bcs/ci/-1/en-us.cab:0x8000FFFF",i=r;try{return i=t.urlResult,n.isNullOrUndefined(i)||i.length==0?r:i}catch(u){return r}},i.prototype.getUrlForCiCab=function(n,t){return"https://www.bing.com/bcs/ci/"+n+"/"+t+".cab"},i.prototype.getTimeDiffInMins=function(t){if(!n.isValidDate(t))return 0;var i=t.getTime(),r=n.getCurrentTime();return Math.round((r-i)%n.DayToMs%n.HourToMs/n.MinuteToMs)},i.LastCIDownloadAttemptKey="LastCIDownloadAttempt",i}();t.ConstraintIndexDataLoader=i})(t=n.ConstraintIndex||(n.ConstraintIndex={}))}(WSB||(WSB={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function u(n){switch(n.type){case"Folder":return"FD";case"Photo":return"LI";case"Video":return"LV";case"Audio":case"Music":return"MU";default:return n.fileSize?"FL":"FD"}}function c(t){switch(t){case"FD":return n.Scope.Folders;case"LI":return n.Scope.Photos;case"LV":return n.Scope.Videos;case"MU":return n.Scope.Music;default:return n.Scope.Documents}}var t="https://onedrive.live.com",i=t+"/redir.aspx?resid=",e="&ancestorId=",o="&contentMatch=",r="OneDrive provider called without {0}",s=621355968e5,h=function(t){function i(n){var i=t.call(this,"ODC")||this;return i._accessTokenManager=n,i}return __extends(i,t),i.prototype.getName=function(){return"OneDriveDataProvider"},i.prototype.addOneDriveAncestorResourceIdQueryString=function(){if(n.RuntimeConfig.QfMode==5&&!n.isFileExplorerCurrentPathThisPcOrQuickAccess){var t=void 0,i=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootContentUri?n.tryParseUrl(SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootContentUri,!1):null;if(i&&i.parameters&&(t=i.parameters.substr(1).split("&").find(function(n){return n.startsWith("id=")}).substr(3)),t)return e+t;SharedLogHelper.LogError("OneDriveParser","QfMode="+n.RuntimeConfig.QfMode,new Error(n.formatString(r,["currentSyncRootResourceId"])))}return""},i.prototype.addOneDriveContentMatchQueryString=function(t){return n.RuntimeConfig.QfMode==5||t.scope==n.Scope.Documents?o+"1":""},i.prototype.createUrl=function(t){var i=decodeURIComponent(n.config.oneDriveDotComRootUrl),r;return i+=this.addOneDriveAncestorResourceIdQueryString(),i+=this.addOneDriveContentMatchQueryString(t),r=t?n.encodeQueryParameter(t.queryToFetch.toLowerCase()):"",i+"&q="+r},i.prototype.getAllAccountTokens=function(t){var i=n.Host.isAuthInvestigation()?["OneDriveDataProvider::getAllAccountTokens"]:undefined,u;n.RuntimeConfig.QfMode==5?(u=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootAccount,u?this._accessTokenManager.getAccountByUserName(!1,0,u,!1,!0,function(n){n&&n.Token?t([n.Token]):t(null,"AccountNotFound")},i):n.isFileExplorerCurrentPathThisPcOrQuickAccess?this._accessTokenManager.getAllSyncingAccounts(!1,0,!1,!0,function(n){n.length>0?t(n.map(function(n){return n.Token})):t(null,"NoAccountsFound")},i):(SharedLogHelper.LogError("OneDriveParser","QfMode="+n.RuntimeConfig.QfMode,new Error(n.formatString(r,["currentSyncRootAccount"]))),t(null,"CurrentSyncRootAccount"))):n.AccessTokenManager.getWindowsAccountType()==2?this._accessTokenManager.getAccount(0,n.getBingResourceOrScope(0),!1,!0,function(n){n&&n.Token?t([n.Token]):t(null,"NoAccountsFound")},undefined,i):t(null)},i.prototype.fetch=function(i,r,u,f,e,o,s){var l=this,h,c;n.isDataSourceEnabled(this._dataSource,i)&&(h={numOfPendingResponses:0},s||(s={}),s["BingAPIs-Authorization-Source"]="Explicit",c=function(c){var v=Object.assign({},s),a;c&&(v["X-Search-RPSToken"]=c);a=Object.assign({},o);delete a[n.Service.QueryParams.ImpressionGuid];delete a[n.Service.QueryParams.RequestElToken];t.prototype.fetch.call(l,i,function(n,t,i,u,f){--h.numOfPendingResponses;r(n,t,i,u,f,h.numOfPendingResponses!=0)},u,f,e,a,v)},this.getAllAccountTokens(function(n,t){t?r(l._dataSource,null,t,null,null,!1):n?(h.numOfPendingResponses=n.length,n.forEach(function(n){return c(n)})):(h.numOfPendingResponses=1,c(null))}))},i}(n.JsonDataProvider),f;n.OneDriveDataProvider=h;f=function(){function r(){}return r.prototype.parse=function(t,i,r,u,f,e){var h=[],o,c,l,s,a,v;if(u&&u.suggestionGroups)for(o=0,c=u.suggestionGroups;o<c.length;o++)if(l=c[o],l.searchSuggestions)for(s=0,a=l.searchSuggestions;s<a.length;s++)v=a[s],this.addContent(t,h,v,i);n.decorateSuggestionsWithParentFolder(h);e("ODC",h,null)},r.prototype.isValidSuggestion=function(n){return!n.result||n.result.length!=1?!1:n.result[0].type==="History"?(SharedLogHelper.LogError("OneDriveParser",null,new Error("History should be disabled in the request URL")),!1):n.result[0].type==="Tag"?!1:!0},r.prototype.addContent=function(r,f,e,o){var l,a,w;if(this.isValidSuggestion(e)&&(l=e.result[0],a=u(l),n.isSuggestionTypeEnabled("ODC",a,7,r))){var v=l.rawResourceId,b="https://storage.live.com/items/"+v+":Cropped176x176#h=176&w=176",p=n.ScopeConfig[c(a)].icon,y=a=="FD"?"":n.getFileExtension(l.path),k=this.getOneDriveSuggestionIcon(n.isMedia(a),p,b,y,v),h=n.createSuggestion(r,e.displayText,k,p,a,e.query,n.InstrumentedItem.createInstrumentedItem(o,a),7,o,!0);h.url=i+v;h.path="OneDrive:\\"+l.path.slice(1).replace(/[/]/g,"\\");h.extensionLC=y?y.toLocaleLowerCase():undefined;w=+l.dateModified/1e4-s;h.lastModifiedDate=n.toDate(w);h.sourceForGroup=2;n.setFileTemplate(r,n.getEffectiveQuery(r),n.isL2(r),h);h.click=function(){return n.Host.launchUri(h.url)};h.locationUrl=l.parentFolder&&l.parentFolder.id?i+l.parentFolder.id:t;h.reactKey=this.generateReactKey(l);n.setExtraVerbs(h,function(){var t={verb:n.JumplistActionItemType[n.JumplistActionItemType.S_OpenFileLocationInBrowser],displayName:n.Host.getLocString("OpenFileLocationIn",n.getGroupSourceDisplayName(2)),executeSync:function(){return n.Host.launchUri(h.locationUrl)},icon:{type:2,content:"&#xE838"}};return[t]},!0);n.isValidSuggestion(h,"OneDriveParser")&&f.push(h)}},r.prototype.generateReactKey=function(n){return u(n)+n.path+n.rawResourceId},r.prototype.getOneDriveSuggestionIcon=function(t,i,r,u){return n.getIconForTypeAsync(i,u)},r}();n.OneDriveParser=f}(WSB||(WSB={})),function(n){var t;(function(t){var i=function(){function t(){var t=this;n.Host.bindQueryChangedOrInitialized(function(){t._previousWebSignals=t._currentWebSignals;t._currentWebSignals=null;(!n.config.enableCISpeller||t._currentSpellerTrigger)&&(t._previousSpellerTrigger=t._currentSpellerTrigger,t._currentSpellerTrigger=null)});n.Host.bindConversationStart(function(){t._previousWebSignals=null;t._currentWebSignals=null;t._previousSpellerTrigger=null;t._currentSpellerTrigger=null;t._previousBestMatchSuggestion=null;t._previousQuery=null})}return t.prototype.setPreviousQuery=function(n){this._previousQuery=n},t.prototype.getPreviousQuery=function(){return this._previousQuery||""},t.prototype.updateWebSignalsData=function(n,t){this._currentWebSignals={query:n,signals:t}},t.prototype.setPreviousTopHit=function(n){this._previousBestMatchSuggestion=n},t.prototype.getPreviousTopHit=function(){return this._previousBestMatchSuggestion},t.prototype.updateSpellerTriggerData=function(n,t){this._currentSpellerTrigger={query:n,triggerSpeller:this.triggerSpellerOnTheNextKeyStroke(t,n)}},t.prototype.getPreviousEventWebSignalsData=function(n){return this._previousWebSignals&&this.isPreviousEventQuery(this._previousWebSignals.query,n)?this._previousWebSignals.signals:null},t.prototype.disableCISpeller=function(n){return this._previousSpellerTrigger&&this._previousSpellerTrigger.triggerSpeller&&this.isPossibleFirstMisspelling(n,this._previousSpellerTrigger.query)?!0:!1},t.prototype.enableCISpeller=function(t){return n.config.enableCISpeller?this._previousSpellerTrigger&&this._previousSpellerTrigger.triggerSpeller&&this.disableCISpeller(t)?!1:this._previousSpellerTrigger&&this.isPossibleFirstMisspelling(this._previousSpellerTrigger.query,t)?!0:this._previousSpellerTrigger&&(this.isTypedEventQuery(this._previousSpellerTrigger.query,t)||this.isBackspaceEventQuery(this._previousSpellerTrigger.query,t))&&this._previousSpellerTrigger.triggerSpeller:this._previousSpellerTrigger&&this.isPreviousEventQuery(this._previousSpellerTrigger.query,t)&&this._previousSpellerTrigger.triggerSpeller},t.prototype.triggerSpellerOnTheNextKeyStroke=function(t,i){return n.config.enableCISpeller==1?!0:t.every(function(n){return n.notAResult})?!0:t.length>0&&this.isWebSpellCorrectedSuggestion(t[0])&&t.every(function(n){return n.handoffType==0})?!0:n.config.enableCISpeller==2&&!t.some(function(t){return n.isApp(t.type)||n.isSetting(t.type)})?!0:this.enableCISpeller(i)?!0:!1},t.prototype.isWebSpellCorrectedSuggestion=function(n){return n.type=="SC"||n.type=="OS"},t.prototype.isPreviousEventQuery=function(n,t){return n&&t&&n.length==t.length-1&&t.startsWith(n)},t.prototype.isBackspaceEventQuery=function(n,t){return n&&t&&n.length==t.length+1&&n.startsWith(t)},t.prototype.isTypedEventQuery=function(n,t){return(n||n==="")&&t&&n.length<t.length&&t.startsWith(n)},t.prototype.isPossibleFirstMisspelling=function(t,i){if(this._previousBestMatchSuggestion){var r=this._previousBestMatchSuggestion.ciMatchedQuery||this._previousBestMatchSuggestion.query;return r.toLocaleLowerCase().startsWith(t.toLocaleLowerCase())&&!r.toLocaleLowerCase().startsWith(i.toLocaleLowerCase())&&this.isTypedEventQuery(t,i)&&i.length>=n.config.enableCISpellerAtPrefixLength?!0:!1}return this._previousBestMatchSuggestion&&this._previousBestMatchSuggestion.query.toLocaleLowerCase().startsWith(t.toLocaleLowerCase())&&!this._previousBestMatchSuggestion.query.toLocaleLowerCase().startsWith(i.toLocaleLowerCase())&&this.isTypedEventQuery(t,i)&&i.length>=n.config.enableCISpellerAtPrefixLength?!0:!1},t}();t.PreviousKeystrokeCache=i})(t=n.Cache||(n.Cache={}))}(WSB||(WSB={})),function(n){var t;(function(t){function c(t){(e=t,n.StaticHtmlElements.dialogBox)&&(sj_be(n.StaticHtmlElements.dialogBox,"click",function(n){var r=n.target.id,t=i().filter(function(n){return n.id==r}).shift();t?(t.action&&t.action(),u()):r=="dialog_overlay"&&u();sj_sp(n)},!0),n.Host.bindKeyDown(function(n){var e,o,t,s,f,u;if(r){e=void 0;switch(n){case 39:for(t=i(),o=!1,f=0,u=void 0;u=t[f];f++)if(o){e=u;break}else if(o=u.selected==!0,o&&f+1==t.length){e=t[0];break}break;case 37:for(t=i(),s=void 0,f=0,u=void 0;u=t[f];f++){if(u.selected==!0){e=s?s:t[t.length-1];break}s=u}}e&&h(e)}}),n.Host.bindKeyEscape(function(n){o()&&(u(),n.handled=!0)}))}function l(t,i,u,o){var s,h;if(f=[],i.length==0)throw new Error("DialogBox: Empty buttons array");f=i.map(function(n,t){var i=n;return i.id="dialog_b"+t,i.narratorText=i.text,i.selected&&(s=i.id),i});h={isVisible:!0,title:u,messageText:t,buttons:f,isModal:o};e.updateDialogBox(h);s&&n.safeSetTimeout(function(){return _ge(s).focus()},0,"DialogBox.show");n.Host.setFocusInWebView("dialogBoxViewModel");r=!0}function u(){if(r)e.updateDialogBox({isVisible:!1}),r=!1}function o(){return r}function i(){return f}function a(){return i().map(function(n){return[n]})}function s(){return i().filter(function(n){return n.selected}).shift()}function h(n){for(var r,t=0,u=i();t<u.length;t++)r=u[t],r.selected=r.id==n.id,r.selected&&_ge(n.id).focus()}function v(){if(o()){var n=s();n&&(n.action&&n.action(),u())}}function y(){return!1}var f=[],e,r=!1;t.init=c;t.show=l;t.hide=u;t.isVisible=o;t.getSelectableItems=i;t.getSelectableItemsByGroup=a;t.getSelectedItem=s;t.select=h;t.submit=v;t.onAfterKeyDown=y})(t=n.DialogBox||(n.DialogBox={}))}(WSB||(WSB={})),function(n){function p(n){return n.includes("form=vsranf")}function w(t){var i=n.tryParseUrl(t,!0);return!!i&&/[\?\&]q=/i.test(i.parameters)&&!/[\?\&]view=detail/i.test(i.parameters)}function ii(t){var i=n.tryParseUrl(t,!0);return!!i&&dt.test(i.parameters)}function ri(n){switch(n){case 17:case 21:case 1:case 0:return 1;case 13:return 2;case 14:return 3;default:throw Error("Unsupported handoff type: "+n);}}function b(n){switch(n){case 1:return 1;case 2:return 7;case 3:return 8;default:throw Error("Unsupported vertical: "+n);}}function k(t){var i=n.tryGetBingPathLC(t);return i?n.contains(bt,i)?2:n.contains(kt,i)?3:n.contains(n.WebSearchPaths,i)?1:null:null}var u=["bfbVerticalConfig","bfbTenantSettings","bfbUserConfigs","bfbSubstrateUnifiedSearch"],o=["bfbTenantSettingsFailed","bfbUserConfigsFailed","bfbSubstrateUnifiedSearchFailed"],c=n.PreviewPaneWidth-24,g="miniserp_focus",nt="disableOutline",i=2,tt=["tab-active","slide"],it=["aria-expanded"],rt="videoPreview",ut=300,f=30,ft="IsSearchAppXYFocusEnabled",et="WinJS",ot="dFocusExit",t="win-xyfocus-suspended",st="Rewards.ReportActivity.Success",ht="Rewards.ReportActivity.Failure",d,h;n.MiniSerpIframeId="miniIframeSerp";n.MiniSerpFetchEvent="miniSERP.Fetch";n.MiniSerpLoadedEvent="MiniSerpContentLoaded";n.MiniSerpClearingEvent="MiniSerpContentClearing";var ct=["/account/","/settings.aspx"],r=function(){var n={};return n[37]="left",n[39]="right",n[38]="up",n[40]="down",n}(),lt=1e4,at=800,s=535,l=580,a=150,vt=439,yt=441,pt=100,wt=["&form=s00037&"],bt=["/images/search","/images"],kt=["/videos/search","/videos"],dt=/[\?\&]FORM=HDRSC[1-3]/i,e="ClientInst",v="wsbpf",gt="wsbPrefetchGuid",y="inprocess",ni="wsbstoploadingscreen",ti="wsbstoprequeryloadingscreen";d=function(){function t(t,i){var r=this,u;this._navigationHelper=t;this._msRewardsViewModel=i;this._deviceScale=1;this._previewRequestId=0;this._previousURLs=[];this.blockedMiniSERPUrls=[_w.location.origin+_w.location.pathname];this._msbContext=(u=_w.BingAtWork)===null||u===void 0?void 0:u.context;this._wsbPrefetchModel={};this._msbContext&&(this._msbContext.isWsbPrefetchEnabled=n.config.wsbWorkScopeWsbPrefetchEnabled);n.Host.bindShown(function(){ThresholdUtilities.getCortanaHeaders(function(n){n&&n["X-BM-DeviceScale"]&&(r._deviceScale=+n["X-BM-DeviceScale"]/100)});r.setVertical(1)});n.Host.bindAppHidden(function(){r._seeAllResults&&(r._seeAllResults.innerText="");r._currentVertical=null});n.Host.bindSearchBoxGotFocus(function(){r._focusHelper&&r._focusHelper.onSearchBoxFocusChanged()});sj_evt.bind(n.MiniSerpLoadedEvent,function(){r.isMsbPerfLogEnabled()&&bfbWsbTel.logPerfValue("miniSERP::Loaded");r._onIFrameLoadedCallback&&(r._onIFrameLoadedCallback(),r._onIFrameLoadedCallback=null)});this._msRewardsViewModel&&(sj_evt.bind(st,function(n){var t=n[1];r._msRewardsViewModel.notifyPointsRewarded(t)}),sj_evt.bind(ht,function(n){var t=n[1];SharedLogHelper.LogError("RewardsReportActivityFailureEvent",null,t?new Error(t):null)}))}return t.prototype.init=function(t,i){var u=this;this._previewPaneViewModelParent=t;this._root=i;this._seeAllResults=this._root.querySelector("#seeAllResults");this._footer=this._root.querySelector("#footer");this._mask=this._root.querySelector("#previewMask");this._forceLoadScreen=this._root.querySelector("#forceLoadMessage");this._contentContainer=this._root.querySelector("#miniSerpPaneContainer");this._scrollArea=this._root.querySelector("#miniSerpScrollArea");this._loadingScreen=this._root.querySelector("#loadingScreen");this._hasErrored=!1;this._selectedItem=null;sj_be(this._scrollArea,"scroll",function(t){u._iframe&&n.contains([2,3],u._currentVertical)&&u._iframe.contentWindow.dispatchEvent(new Event(t.type,t));u._calculateIFrameHeight&&u._calculateIFrameHeight()});this._footer&&sj_be(this._footer,"keydown",function(t){u._iframe&&n.isUpOrDownKey(t.keyCode)?(t.keyCode==38?u.tryExecuteFocusOnMiniSerp(function(){return u._focusHelper.moveFocusToEdgeFocusableElement(1)}):n.RuntimeConfig.AllowKeyboardNavCycling&&u.tryExecuteFocusOnMiniSerp(function(){return u._focusHelper.moveFocusToEdgeFocusableElement(0)}),sj_pd(t),sj_sp(t)):t.keyCode==13&&u._footer.click()});this._mask&&n.RuntimeConfig.MiniSERPMode!=0&&sj_be(this._mask,"keydown",function(n){n.keyCode==13&&u._mask.click()});sj_be(_w,"message",function(t){var f=t.data?t.data.msWinJSXYFocusControlMessage:null,i,e;f&&f.type==ot&&(i=f.direction,e=f.keyCode,u._focusHelper&&!u._focusHelper.isL2Visible()&&u._focusHelper.getXYFocusRoot()!=u._originalMiniSerpXYFocusRoot?(u._focusHelper.setXYFocusRoot(u._originalMiniSerpXYFocusRoot),u.tryExecuteFocusOnMiniSerp(function(){return u._focusHelper.moveFocus(i,e)})):(i!=r[n.getRtlAdjustedKey(39)]&&t.source.blur(),i==r[40]||i==r[38]&&n.RuntimeConfig.AllowKeyboardNavCycling?u._footer?u._footer.focus():u._focusHelper.moveFocusToEdgeFocusableElement(i==r[38]?1:0):i!=r[n.getRtlAdjustedKey(37)]||n.Host.searchBoxHasFocus()||n.Host.setFocusInSearchBox(e,"previewPaneUnfocus")))})},t.prototype.finalizeKeystroke=function(){this.instrumentOnPreviewPaneRendered(!1,!0)},t.prototype.getSelectableItems=function(){return this._selectedItem?[this._selectedItem]:[]},t.prototype.getSelectableItemsByGroup=function(){return[]},t.prototype.getSelectedItem=function(){return this._selectedItem},t.prototype.select=function(){},t.prototype.onAfterKeyDown=function(){return!1},t.prototype.clear=function(){this._previewedSuggestion=null;this._onPreviewPaneRendered=null;this._hasErrored=!1;this._selectedItem=null;this._footer&&(n.setVisibility(this._footer,!1),this._footer.onclick=null);this._mask&&(n.setVisibility(this._mask,!1),this._mask.onclick=null);this._forceLoadScreen&&this.clearForceLoadPage();this.clearContent();this._previousURLs=[]},t.prototype.showForceLoad=function(t,i){var r=this;n.InstrumentationHelper.logClientInstEvent("Select","ForceLoadOpened",n.SequenceNumberManager.getSequenceNumber(),{suggestionText:t});this.stopLoadingScreen();n.setVisibility(this._scrollArea,!1);n.setVisibility(this._footer,!1);n.setVisibility(this._mask,!1);n.setVisibility(this._forceLoadScreen,!0);this.formatForceLoadPage(t);this._forceLoadScreen.onclick=function(){r.clearForceLoadPage();r.startLoadingScreen();i()}},t.prototype.clearForceLoadPage=function(){for(n.setVisibility(this._forceLoadScreen,!1),n.setVisibility(this._scrollArea,!0),this._forceLoadScreen.onclick=null,this._forceLoadScreen.classList.remove("forceLoadContainer");this._forceLoadScreen.hasChildNodes();)this._forceLoadScreen.removeChild(this._forceLoadScreen.lastChild)},t.prototype.formatForceLoadPage=function(t){var h=n.Host.getLocString("ForceLoadMessage"),c=n.Host.getLocString("ForceLoadButton"),o=h.split("{0}"),s=sj_ce("div","","accentColor"),u,r,f,e,i;this._forceLoadScreen.appendChild(s);u=_d.createElement("span");u.id="forceLoadIcon";u.innerHTML="&#xE721";s.appendChild(u);r=sj_ce("div","forceLoadQueryText","");r.appendChild(_d.createTextNode(o[0]));f=_d.createElement("span");f.textContent=t;r.appendChild(f);r.appendChild(_d.createTextNode(o[1]));this._forceLoadScreen.appendChild(r);e=sj_ce("div","","");this._forceLoadScreen.appendChild(e);i=_d.createElement("button");i.className="c-button";i.id="forceLoadSubmit";i.type="submit";i.textContent=c;e.appendChild(i)},t.prototype.startLoadingScreen=function(){n.setVisibility(this._scrollArea,!1);n.setVisibility(this._footer,!1);n.setVisibility(this._mask,!1);n.setVisibility(this._loadingScreen,!0)},t.prototype.stopLoadingScreen=function(){n.setVisibility(this._loadingScreen,!1);n.setVisibility(this._scrollArea,!0)},t.prototype.clearContent=function(){for(this._previewRequestId+=1,this._focusHelper=null,this._onIFrameLoadedCallback=null,sj_evt.fire(n.MiniSerpClearingEvent);this._contentContainer.hasChildNodes();)this._contentContainer.removeChild(this._contentContainer.lastChild);this._iframe&&(this._iframe=null,this._calculateIFrameHeight=null);this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},t.prototype.hasFocus=function(){if(n.Host.searchBoxHasFocus())return!1;var t=n.getCurrentActiveElement();return t&&t!=this._iframe&&this._root.contains(t)},t.prototype.focus=function(){var i=this,t;this.hasFocus()||(this._iframe?(t=this.tryExecuteFocusOnMiniSerp(function(){return i._focusHelper.moveFocusToLastFocusedElement()}),t?n.Host.setFocusInWebView("miniserp focus"):n.Host.setFocusInSearchBox(null,"MiniSERP VM Focus failed")):this._hasErrored&&n.config.edgeTransferOnTimeout?(_ge("errorFooter").focus(),this._selectedItem={id:"errorFooter",text:null,selected:!0},n.Host.searchBoxHasFocus()&&n.Host.setFocusInWebView("errorPP focus")):this._previewPaneViewModelParent.focusPending=!0)},t.prototype.readyToBlur=function(){return!0},t.prototype.blur=function(){},t.prototype.setVertical=function(t){if(t!=this._currentVertical){if(this._seeAllResults)switch(t){case 1:this._seeAllResults.innerText=n.Host.getLocString("OpenResultsBrowser");break;case 2:this._seeAllResults.innerText=n.Host.getLocString("SeeAllImageResults");break;case 3:this._seeAllResults.innerText=n.Host.getLocString("SeeAllVideoResults");break;default:throw new Error("Unsupported vertical type: "+t);}this._currentVertical=t}},t.prototype.instrumentOnPreviewPaneRendered=function(n,t){if(this._timestampFirstRender&&this._onPreviewPaneRendered){var i={firstRenderTS:this._timestampFirstRender};this._onPreviewPaneRendered(t,!n,i)}},t.prototype.update=function(t,i,r,u,f,e){var o=this,a,s,w,v,l,b,k,y;if(this._onPreviewPaneErrored=e,this._currentSuggestion=t,!f){this.instrumentOnPreviewPaneRendered(!0,!1);return}if(this.isMsbPerfLogEnabled()&&bfbWsbTel.logPerfValue("miniSERP::update"),this.instrumentOnPreviewPaneRendered(!1,!0),this.miniSERPRenderTimeoutInstrumentation("miniSerpViewModelUpdate"),n.config.disableOfflineRequest&&!n.isBrowserOnline()){this.renderOfflineMessage(t.query);return}if(this._currentHandoffType=t.handoffType,typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(t.handoffType)&&this._iframe&&(s=this._iframe.contentWindow,s&&((a=s.BingAtWork)===null||a===void 0?void 0:a.workVerticalNavClickHandler))){var h={navigationPayload:{domain:t.navDomain,id:t.navDomainId},query:t.query},p=t.query===this._queryShown,nt=n.config.msbNewWorkScopeEnabled&&t.scope===n.Scope.Work&&p;if(nt){this.stopLoadingScreen();this._scrollArea.scrollTop=0;h.isRequery=!1;s.BingAtWork.workVerticalNavClickHandler(h);this.updatePreviousState(t,f);return}if(i.scope===n.Scope.Work&&n.config.msbWorkScopeQfRequeryEnabled&&t.previousQuery&&!p){this._scrollArea.scrollTop=0;n.config.msbWorkScopeQfRequeryLoadingScreenEnabled&&this.startLoadingScreen();w=n.Host.createGuid();v="".concat(ti).concat(w);this.handleLoadingStateEvent(v);h.isRequery=!0;h.loadingStateEventKey=v;s.BingAtWork.workVerticalNavClickHandler(h);this.updatePreviousState(t,f);return}}if(this.updatePreviousState(t,f),l=t.type=="MB"&&t.segments=="Organization"?null:t.baseSearchUrl,b=ri(t.handoffType),this.setVertical(b),this._footer&&(this._footer.onclick=function(r){o._previewPaneViewModelParent.onBeforeItemLaunch(n.getCurrentTime(),n.getInputType(r),3);n.Host.launchSearch(t.query,o._navigationHelper.getSearchUrl(i.fullPartialQuery,t.query,t.type,l,t.handoffType,undefined,undefined,undefined,undefined,t.msbVerticalHash),!1);o._previewPaneViewModelParent.onAfterItemLaunch(3)}),this._mask&&(this._mask.onclick=function(r){o._previewPaneViewModelParent.onBeforeItemLaunch(n.getCurrentTime(),n.getInputType(r),3);n.Host.launchSearch(t.query,o._navigationHelper.getSearchUrl(i.fullPartialQuery,t.query,t.type,l,t.handoffType,undefined,undefined,undefined,undefined,t.msbVerticalHash),!1);o._previewPaneViewModelParent.onAfterItemLaunch(3)}),n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.noSerp){this.renderIframe(null,"<html><body><\/body><\/html>",{},undefined,!1);k=n.getCurrentTime();this._previewPaneViewModelParent.onResponseReceived(k);return}var d=r==0,g=SearchAppWrapper.CortanaApp.entryPoint=="WNSHVR",tt=g?"WMSHVA":n.mapOSFormCode("WMSRPA"),it=g?"WMSHVM":n.mapOSFormCode("WMSRPM"),rt=d?tt:it,c=this._navigationHelper.getSearchUrl(i.fullPartialQuery,t.query,t.type,l,t.handoffType,rt,!0,null,d,t.msbVerticalHash);if(c+="&qfig="+n.InstrumentationHelper.getImpressionGuid(n.SequenceNumberManager.getSequenceNumber()),this._msRewardsViewModel&&this._msRewardsViewModel.isRewardsEnabled()&&(c+="&rewards=1"),i.serpURLParams)for(y in i.serpURLParams)c=ThresholdUtilities.setUrlParameter(c,y,i.serpURLParams[y]);this._previousURLs=[];this.downloadAndDisplayMiniSerp(t,c,null,r)},t.prototype.getCurrentHandoffType=function(){return this._currentHandoffType},t.prototype.isIframeActive=function(){return this._iframe!==null},t.prototype.updatePreviousState=function(n,t){this._queryShown=n.query;this._previewedSuggestion=n;this._onPreviewPaneRendered=t;this._timestampFirstRender=null},t.prototype.miniSERPRenderTimeoutInstrumentation=function(t){var i;i={FunctionCalled:t};n.InstrumentationHelper.logClientInstEvent(e,"MiniSERPRenderTimeout",n.SequenceNumberManager.getSequenceNumber(),i)},t.prototype.miniSerpErrorInstrumentation=function(t,i,r){var u;u=r?{ErrorCause:t,ResponseRecievedTimeStamp:i.toString(),ResponseText:r.responseText,ContentType:r.contentType,ResponseStatusCode:r.status.toString(),RequestStatusCode:r.result.toString()}:{ErrorCause:t};n.InstrumentationHelper.notifyTopHitPreviewPaneOpenedOrInterrupted(n.SequenceNumberManager.getSequenceNumber());n.InstrumentationHelper.logClientInstEvent(e,"MiniSERPError",n.SequenceNumberManager.getSequenceNumber(),u)},t.prototype.renderOfflineMessage=function(t){for(var e,o=n.isBrowserOnline(),f=n.Host.getLocString("PreviewPaneOfflineTitle"),r=n.Host.getLocString("PreviewPaneOfflineMessage").split("{0}"),u=[],s=r.length-1,i=0;i<r.length;i++)i==s?u.push({text:r[i],click:function(){return n.Host.launchUri("ms-settings:troubleshoot")}}):u.push({text:r[i]});e={isOnline:o,previewPaneTitle:f,previewPaneItems:u,fullPartialQuery:t,narratorMessage:f};this._onPreviewPaneErrored(e)},t.prototype.renderErrorMessage=function(t){for(var f,e=n.isBrowserOnline(),r=n.Host.getLocString("PreviewPaneErrorMessage").split("{0}"),u=[],o=n.Host.getLocString("PreviewPaneErrorMessage",t)+" "+n.Host.getLocString("PreviewPaneTimeoutMessage"),i=0;i<r.length;i++)u.push({text:r[i]});f={isOnline:e,previewPaneTitle:"",previewPaneItems:u,fullPartialQuery:t,narratorMessage:o};this._hasErrored=!0;this._onPreviewPaneErrored(f)},t.prototype.downloadAndDisplayMiniSerp=function(t,i,r,u){var f=this,s=!1,o,h,l,a,v,p,e,y,w,b,k;this._queryShown=t.query;(n.TestHookUrlParameters||n.MockUrlParameters)&&(s=!!n.MockUrlParameters,o=n.TestHookUrlParameters!==null&&n.TestHookUrlParameters!==void 0?n.TestHookUrlParameters:n.MockUrlParameters,h=o.previewPaneUrlOverride,i=h?decodeURIComponent(h):n.UrlParameters.copyTestParametersTo(i),s&&(i=ThresholdUtilities.setUrlParameter(i,"client","windowsMiniSerp")),l=o.miniSerpBag,l&&(i=ThresholdUtilities.setUrlParameter(i,"bag",l)),a=o.dummyref,a&&(i=ThresholdUtilities.setUrlParameter(i,"dummyref",a)),v=o.clientIP,v&&(i=ThresholdUtilities.setUrlParameter(i,"clientip",v)));p=u==0;sj_evt.fire(n.MiniSerpFetchEvent,t,p);e=n.Host.getCustomHeaders(null);e["X-BM-DeviceDimensionsLogical"]=c+"x"+this._root.clientHeight;e["X-BM-DeviceDimensions"]=String(Math.round(c*this._deviceScale))+"x"+this._root.clientHeight;s||(e["User-Agent"]=navigator.userAgent+" RestrictedAPI");r&&(e["Content-Type"]=r.contentType);n.config.msbMockToken&&(y=_w.BingAtWork&&_w.BingAtWork.wsb&&_w.BingAtWork.wsb.wsbAccessToken,y&&(e.Authorization="Bearer "+y));typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(t.handoffType)&&n.config.wsbWorkScopeWsbPrefetchEnabled&&(this.bindWsbPrefetchResponseWithModel(),n.FetchMsbUnifiedSearch(t.query),n.FetchTenantSettings(),n.FetchUserConfigs());e["X-Search-SafeSearch"]="Strict";w=++this._previewRequestId;b=function(u){if(f._shouldRenderMiniSerp)sb_ct(f._ppMiniSerpRenderTimer),f._ppMiniSerpRenderTimer=null,f._shouldRenderMiniSerp=!1;else return;f.miniSERPRenderTimeoutInstrumentation("miniSerpViewModelCallback");var o=n.getCurrentTime();f._previewPaneViewModelParent.onResponseReceived(o);u.status==200&&u.responseText?(f._previousURLs.push(i),f.renderIframe(i,u.responseText,e,s,!!r)):(n.InstrumentationHelper.notifyTopHitPreviewPaneOpenedOrInterrupted(n.SequenceNumberManager.getSequenceNumber()),f.miniSerpErrorInstrumentation("renderErrorMessage",o,u),f.renderErrorMessage(t.query))};this._ppMiniSerpRenderTimer&&(sb_ct(this._ppMiniSerpRenderTimer),this._ppMiniSerpRenderTimer=null);this._shouldRenderMiniSerp=!0;k=(n.config.miniSERPRequestRetries+1)*n.config.miniSERPRequestTimeout+1e3;this._ppMiniSerpRenderTimer=n.safeSetTimeout(function(){f._previewedSuggestion!=null&&f._previewedSuggestion==t&&(f._shouldRenderMiniSerp=!1,n.InstrumentationHelper.notifyTopHitPreviewPaneOpenedOrInterrupted(n.SequenceNumberManager.getSequenceNumber()),f.miniSERPRenderTimeoutInstrumentation("ppMiniSerpRenderTimeout"),f.stopLoadingScreen(),f.renderErrorMessage(t.query))},k,"ppMiniSerpRenderTimer");this.fetchMiniSerpUrl(i,r?r.data:null,e,b,w,r?0:n.config.miniSERPRequestRetries)},t.prototype.fetchMiniSerpUrl=function(t,i,r,u,f,o){var h=this,s;this.isMsbPerfLogEnabled()&&bfbWsbTel.logPerfValue("miniSERP::fetchMiniSerpUrl");s=u;o>0&&(s=function(i){if(i.result==0&&i.responseText)u(i);else{var s={Url:t,StatusCode:i.status.toString(),Timeout:n.config.miniSERPRequestTimeout.toString(),RetriesRemaining:o.toString()};n.InstrumentationHelper.logClientInstEvent(e,"MiniSERPRefetch",n.SequenceNumberManager.getSequenceNumber(),s);h.fetchMiniSerpUrl(t,null,r,u,f,o-1)}});n.config.isThemeAware&&n.isDarkModeEnabled()&&!t.includes("&darkschemeovr=1")&&(t+="&darkschemeovr=1");n.config.useCobaltCSS&&!t.includes("addfeaturesnoexpansion=wsbcobalt")&&(t+="&addfeaturesnoexpansion=wsbcobalt");n.Host.isBingWallpaperAppInstalled()&&(t+="&BWPA=1");n.fetchUrl(t,r,i,s,null,function(){return f==h._previewRequestId},!0,i?undefined:n.config.miniSERPRequestTimeout)},t.prototype.renderIframe=function(t,i,r,u,f){var e=this;this.clearContent();this.isMsbPerfLogEnabled()&&bfbWsbTel.logPerfValue("miniSERP::renderIframe");this._iframe=sj_ce("iframe",n.MiniSerpIframeId);this._iframe.setAttribute("scrolling","no");this._contentContainer.appendChild(this._iframe);var s=this._iframe.contentWindow,o=this._iframe.contentDocument,c=!1,h=typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(this._currentHandoffType);f=f||h;this._footer&&(n.setVisibility(this._footer,!f),n.setVisibility(this._mask,!f));this.setIframeHeight(0);this._onIFrameLoadedCallback=function(){var i,f,c;h&&(e.handleWorkResultsSize(),n.config.wsbWorkScopeWsbPrefetchEnabled&&e.handleWsbPrefetch(),e.handleLoadingStateForWorkScope());i=o.body;f=0;e._calculateIFrameHeight=function(){var n=i.offsetHeight;n!=f&&n>0&&(f=e.setIframeHeight(n,h))};e._calculateIFrameHeight();e.overrideAjaxCalls(s,r,u);e.captureNavigationsAndSizeEvents(t,i,s,o);e._scrollArea.scrollTop=0;n.config.backStackSearchEnabled&&(e._shouldAddSearchBackStack=!0,e._currentBackStackTimeout&&clearTimeout(e._currentBackStackTimeout),e._currentBackStackTimeout=sb_st(function(){e._shouldAddSearchBackStack=!1},n.config.miniSerpRedirectTimeoutInMs));n.contains([2,3],e._currentVertical)&&(c={childList:!0,subtree:!0},e._mutationObserver=new MutationObserver(function(){e._calculateIFrameHeight&&e._calculateIFrameHeight()}),n.safeExecute(function(){e._currentVertical===2?e._mutationObserver.observe(o.getElementById("images"),c):e._currentVertical===3&&e._mutationObserver.observe(o.getElementById("video"),c)},"onIFrameLoadedCallback"));e._msRewardsViewModel&&e._msRewardsViewModel.isRewardsEnabled()&&s.sj_rra&&s.sj_rra(t);e._timestampFirstRender=n.getCurrentTime();e.instrumentOnPreviewPaneRendered(!0,!1)};this._iframe.onload=function(){if(e.isMsbPerfLogEnabled()&&bfbWsbTel.logPerfValue("miniSERP::_iframe.onload"),h&&(e._scrollArea.scrollTop=0,n.config.wsbWorkScopeWsbPrefetchEnabled&&(e.clearWsbPrefetchStorage(),e.stopLoadingScreen())),c){e.tryLaunchUrl(t,s.location.href,0);return}c=!0;e.overrideAjaxCalls(s,r,u)};this.isMsbPerfLogEnabled()&&bfbWsbTel.logPerfValue("miniSERP::iFrameDocument.open");o.open();o.write(i);o.write("<base href='"+t+"' target='_parent' />");o.write("<script>window.parent.sj_evt.fire('"+n.MiniSerpLoadedEvent+"')<\/script>");o.close();this.isMsbPerfLogEnabled()&&bfbWsbTel.logPerfValue("miniSERP::iFrameDocument.close")},t.prototype.setIframeHeight=function(n,t){var i=t?s:at;return n<i&&(n=i),this._iframe.style.height=n+"px",n},t.prototype.overrideAjaxCalls=function(t,i,r){var u=this;t.sj_gx=function(){var t=sj_gx(),f=t.open;return t.open=function(e,o,s,h,c){if(u.blockedMiniSERPUrls.some(function(n){return o.startsWith(n)}))throw new Error("MiniSERP blocked URL request: iFrame URL: "+u._iframe.contentDocument.baseURI+" requestUrl: "+o);e=="GET"&&r&&(o=ThresholdUtilities.setUrlParameter(o,"client","windowsMiniSerp"));n.config.isThemeAware&&n.isDarkModeEnabled()&&!o.includes("&darkschemeovr=1")&&(o=ThresholdUtilities.setUrlParameter(o,"darkschemeovr","1"));n.config.useCobaltCSS&&!o.includes("&addfeaturesnoexpansion=wsbcobalt")&&(o=ThresholdUtilities.setUrlParameter(o,"addfeaturesnoexpansion","wsbcobalt"));f(e,o,s,h,c);for(var l in i)t.setRequestHeader(l,i[l])},t}},t.prototype.captureNavigationsAndSizeEvents=function(t,i,r,u){var f=this,c;this._focusHelper=this.createFocusHelper(r,u);this._focusHelper&&(this._originalMiniSerpXYFocusRoot=this._focusHelper.getXYFocusRoot());this._previewPaneViewModelParent.focusPending&&(this._previewPaneViewModelParent.focusPending=!1,this.focus());this._iframe.contentWindow.overlay_onBeforeContentLoad=function(){f.setIframeHeight(lt)};this._iframe.contentWindow.overlay_onBeforeSuccess=function(n){f.setIframeHeight(n.clientHeight+pt)};var o=function(){r.sj_lc=function(n){if(n)f.tryLaunchUrl(t,n,0);else{var i=f._previousURLs[f._previousURLs.length-2];f._previousURLs.splice(f._previousURLs.length-2,2);f.tryLaunchUrl(t,i,0)}};r.MiniSerp=!0;f._calculateIFrameHeight()},h=function(n){f._focusHelper.setXYFocusRoot(n);f._focusHelper.moveFocusToEdgeFocusableElement(0)},s=r.sj_evt;s?(c=["onP1","ajaxReady"],c.forEach(function(n){return s.bind(n,o)}),s.bind("l2_overlay_visible",function(n){o();var t=f._iframe.contentDocument.getElementById(n[1]);t&&(f._focusHelper.setIsL2Visible(!0),h(t))}),s.bind("l2_overlay_hidden",function(){o();f._focusHelper.setIsL2Visible(!1);h(f._iframe.contentDocument.body)})):o();r.open=function(n){return f.tryLaunchUrl(t,n,0),null};i.onclick=function(i){var r=i.target;if(r){if(r.id=="miniSERPToWeb"){n.InstrumentationHelper.logClientInstEvent(e,"AdultExplicitLoad",n.SequenceNumberManager.getSequenceNumber(),{url:t,query:f._previewedSuggestion.query});f._footer.click();return}while(r&&!r.href)r=r.parentNode}r&&f.tryLaunchUrl(t,r.href,n.getInputType(i))==0&&i.preventDefault()}},t.prototype.navigateInPlace=function(t,i,r,u){var s=this,f=b(u),e,o;this._previewPaneViewModelParent.onBeforeItemLaunch(i,r,f);this._footer&&(this._footer.onclick=function(){return n.Host.launchSearch(null,s.enrichBingSearchUrlParameters(t),!1)});this.clearContent();this._previewPaneViewModelParent.focusPending=!0;this.startLoadingScreen();e=this.enrichBingSearchUrlParameters(t,!0);this.setVertical(u);o={destinationVertical:u.toString(),url:t};n.InstrumentationHelper.logClientInstEvent("Select","NavigateInPlace",n.SequenceNumberManager.getSequenceNumber(),o);this.downloadAndDisplayMiniSerp(this._previewedSuggestion,e,null,1);this._previewPaneViewModelParent.onAfterItemLaunch(f)},t.prototype.tryLaunchUrl=function(t,i,r){var o,u,s,f,h,e,c,l;if(!i)return 1;if(o=n.getCurrentTime(),i=i.trim(),u=i.toLowerCase(),s=k(i),s!==null&&w(i)&&!p(u)&&ii(i)&&s!==this._currentVertical)return this.navigateInPlace(i,o,r,s),0;if(u.startsWith("javascript:location.reload"))return 0;if(i==t+"#"||u.startsWith("javascript:"))return 1;if(u=="/loading")return 0;if(i.startsWith(window.location.href))return SharedLogHelper.LogError("previewPane.tryLaunchUrl",t,new Error("Anchor navigation on PreviewPane")),0;if(i.startsWith("/")&&(i=n.getWindowProtocol()+"//"+n.getWindowHost()+i),f=k(i),f){if(f==this._currentVertical&&w(i)&&wt.some(function(n){return u.includes(n)}))return this.navigateInPlace(i,o,r,f),0;i=this.enrichBingSearchUrlParameters(i)}h=f?b(f):2;this._previewPaneViewModelParent.onBeforeItemLaunch(o,r,h);e=n.tryGetBingPathLC(i);e?ct.some(function(n){return e.startsWith(n)})||p(u)?n.Host.launchUri(n.config.settingsUri):e.startsWith("/profile/interests")?n.Host.launchCat1(null,"ms-cortana://navigate/Notebook",null):(this._shouldAddSearchBackStack&&i.indexOf("aclk?ld=")>-1&&(sb_ct(this._currentBackStackTimeout),i=this.buildAdsRedirectUrl(this._previewedSuggestion.query,i)),n.Host.launchUri(i)):(this._shouldAddSearchBackStack&&!u.startsWith("ms-settings")&&(sb_ct(this._currentBackStackTimeout),typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(this._previewedSuggestion.handoffType)&&this._iframe?e&&(c="form="+n.mapOSFormCode("WSBWS0")+"&cvid="+n.encodeQueryParameter(n.Host.getConversationId()),l=i.includes("?")?"&":"?",i="".concat(i).concat(l).concat(c)):i=this.buildRedirectUrl(this._previewedSuggestion.query,i)),n.config.enableMoreEdgeProtocol?n.Host.launchUrlWithEdgeProtocol(i,{campaign:n.config.moreEdgeProtocolOCID,medium:"Miniserp"}):n.Host.launchUri(i));this._previewPaneViewModelParent.onAfterItemLaunch(h);return 0},t.prototype.enrichBingSearchUrlParameters=function(n,t){return t===void 0&&(t=!1),n=this._navigationHelper.enrichUrlWithMarketInfo(n),n=this._navigationHelper.enrichUrlWithDeviceInfo(n),n=this._navigationHelper.enrichUrlWithCvid(n),n=this._navigationHelper.enrichUrlWithSuggestionType(n,this._previewedSuggestion.type),t||(n=this._navigationHelper.enrichUrlWithMuidInfo(n),n=this._navigationHelper.enrichUrlWithSafeSearchInfo(n)),n},t.prototype.createFocusHelper=function(n,t){var i=this.getSearchAppWinJSXYFocus(n);return!i&&SearchAppWinJS&&SearchAppWinJS.initXYFocus&&(SearchAppWinJS.initXYFocus(n),i=this.getSearchAppWinJSXYFocus(n),n[ft]=i?!0:!1),i?new h(t,n,i,this._scrollArea,this._currentVertical):null},t.prototype.getSearchAppWinJSXYFocus=function(n){var i,t=n[et];return t&&t.UI&&(i=t.UI.XYFocus),i},t.prototype.tryExecuteFocusOnMiniSerp=function(n){var t=!1;return this._focusHelper&&(t=n()),t||this._footer&&(this._footer.focus(),t=!0),t},t.prototype.buildAdsRedirectUrl=function(t,i){var r=new URL(i);return!r||!r.search||r.search.length<1?i:_w.location.protocol+"//"+_w.location.host+"/WS/redirect/?q="+n.encodeQueryParameter(t)+"&form="+n.mapOSFormCode("WSBBST")+"&cvid="+n.encodeQueryParameter(n.Host.getConversationId())+"&rtk="+this._iframe.contentWindow.rtk+"&"+r.search.substring(1)},t.prototype.buildRedirectUrl=function(t,i){return _w.location.protocol+"//"+_w.location.host+"/WS/redirect/?q="+n.encodeQueryParameter(t)+"&url="+btoa(i)+"&form="+n.mapOSFormCode("WSBBST")+"&cvid="+n.encodeQueryParameter(n.Host.getConversationId())+"&rtk="+this._iframe.contentWindow.rtk},t.prototype.isMsbPerfLogEnabled=function(){return n.config.msbEnablePerfLog&&_w.bfbWsbTel&&typeof n.isTenantMsbEnabled=="function"&&n.isTenantMsbEnabled()},t.prototype.bindWsbPrefetchResponseWithModel=function(){this._wsbPrefetchGuid=n.Host.createGuid();this._wsbPrefetchModel={};this.bindWsbPrefetchSuccessWithModel();this.bindWsbPrefetchFailureWithModel()},t.prototype.bindWsbPrefetchSuccessWithModel=function(){var t=this;u.forEach(function(i){var r,u,f;i==="bfbVerticalConfig"?(r=n.LightweightStorage.getItem(n.VerticalConfigLocalStorageKey),r&&(u=JSON.parse(r),f={status:"done",response:{"0":"bfbVerticalConfig","1":u.data}},t._wsbPrefetchModel[i]=f)):t.bindWsbPrefetchResponse(i)})},t.prototype.bindWsbPrefetchResponse=function(n){var i=this,t;this._wsbPrefetchModel[n]={status:"inprogress"};t=function(r){var u={status:"done",response:r};i._wsbPrefetchModel[n]=u;sj_evt.unbind(n,t)};sj_evt.bind(n,t,!1,0,!0)},t.prototype.bindWsbPrefetchFailureWithModel=function(){var n=this;o.forEach(function(t){var i=function(r){var u={status:"failed",response:r};n._wsbPrefetchModel[t]=u;sj_evt.unbind(t,i)};sj_evt.bind(t,i,!1,0,!0)})},t.prototype.handleLoadingStateForWorkScope=function(){this.handleLoadingStateEvent(ni)},t.prototype.handleLoadingStateEvent=function(n){var u=this,t,i,r;((i=(t=this._iframe)===null||t===void 0?void 0:t.contentWindow)===null||i===void 0?void 0:i.sj_evt)&&(r=function(){var t;u.stopLoadingScreen();(t=u._iframe.contentWindow.sj_evt)===null||t===void 0?void 0:t.unbind(n,r)},this._iframe.contentWindow.sj_evt.bind(n,r,!0,0,!0))},t.prototype.handleWorkResultsSize=function(){var t=this,i,r;((r=(i=this._iframe)===null||i===void 0?void 0:i.contentWindow)===null||r===void 0?void 0:r.BingAtWork)&&!this._iframe.contentWindow.BingAtWork.workVerticalResultsRendered&&(this._iframe.contentWindow.BingAtWork.workVerticalResultsRendered=function(i){n.config.useCobaltCSS?(i=!t._currentSuggestion.navDomain&&i===yt?t._iframe.contentDocument.body.offsetHeight:i+a,i=i<l?l:i):(i=!t._currentSuggestion.navDomain&&i===vt?t._iframe.contentDocument.body.offsetHeight:i+a,i=i<s?s:i);t.setIframeHeight(i,!0)})},t.prototype.handleWsbPrefetch=function(){var n=this;this._iframe.contentWindow&&(this._iframe.contentWindow[gt]=this._wsbPrefetchGuid,u.forEach(function(t){var i=n._wsbPrefetchModel[t];i&&n.setWsbPrefetchToInframeStorageAndFireEvent(i,t,!1,"handleWsbPrefetch:success")}),o.forEach(function(t){var i=n._wsbPrefetchModel[t];i&&i.status==="failed"&&n.setWsbPrefetchToInframeStorageAndFireEvent(i,t,!1,"handleWsbPrefetch:failure")}));this.bindAndSetWsbPrefetchToChildIframeStorage()},t.prototype.setWsbPrefetchToInframeStorageAndFireEvent=function(n,t,i,r){var f,e,o,u;if(n){o=JSON.stringify(n);u="".concat(v).concat(t,"-").concat(this._wsbPrefetchGuid);try{((f=this._iframe)===null||f===void 0?void 0:f.contentWindow)&&(this._iframe.contentWindow.sessionStorage.setItem(u,o),i&&((e=this._iframe.contentWindow.sj_evt)===null||e===void 0?void 0:e.fire("".concat(y).concat(u),n)))}catch(s){}}},t.prototype.bindAndSetWsbPrefetchToChildIframeStorage=function(){this._iframe.contentWindow&&(this.bindAndSetWsbPrefetchSuccess(),this.bindAndSetWsbPrefetchFailure())},t.prototype.bindAndSetWsbPrefetchSuccess=function(){var n=this;u.forEach(function(t){var i=function(r){if(r){var u={status:"done",response:r};n.setWsbPrefetchToInframeStorageAndFireEvent(u,t,!0,"bindAndSetWsbPrefetchSuccess")}sj_evt.unbind(t,i)};sj_evt.bind(t,i,!1,0,!0)})},t.prototype.bindAndSetWsbPrefetchFailure=function(){var n=this;o.forEach(function(t){var i=function(r){var u={status:"failed",response:r};n.setWsbPrefetchToInframeStorageAndFireEvent(u,t,!0,"bindAndSetWsbPrefetchFailure");sj_evt.unbind(t,i)};sj_evt.bind(t,i,!1,0,!0)})},t.prototype.clearWsbPrefetchStorage=function(){var t=this,n;((n=this._iframe)===null||n===void 0?void 0:n.contentWindow)&&(u.forEach(function(n){var i,r,u="".concat(v).concat(n);(r=(i=t._iframe)===null||i===void 0?void 0:i.contentWindow)===null||r===void 0?void 0:r.sessionStorage.removeItem(u)}),this._wsbPrefetchModel={})},t}();n.MiniSerpViewModel=d;h=function(){function u(t,i,r,u,f,e){var o=this,s;this._targetDocument=t;this._targetWindow=i;this._searchAppXYFocus=r;this._scrollArea=u;this._verticalType=f;this._useStickyFocusOverride=e;this._isL2Visible=!1;this._useStickyFocus=!1;(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.stickyFocus)===!0&&(this._useStickyFocus=!0);this._useStickyFocusOverride!=null&&(this._useStickyFocus=this._useStickyFocusOverride);var h="b_hide",c="acc-inactive",l=".b_slidebar";this._focusDiv=sj_ce("div",g,h);t.body.appendChild(this._focusDiv);sj_be(t,"blur",function(t){o._useStickyFocus?(!t.srcElement.offsetParent||t.srcElement.classList.contains("b_hide")||t.relatedTarget)&&n.setVisibility(o._focusDiv,!1):n.setVisibility(o._focusDiv,!1)},!0);s=!0;sj_be(t,"click",function(){return s=!1},!0);sj_be(t,"keydown",function(){return s=!0},!0);sj_be(t,"focus",function(){return o.updateFocusedElementAndOutline(o._targetDocument.activeElement,s)},!0);sj_be(t,"scroll",function(n){o._lastElementFocused&&(n.srcElement==o._lastElementFocused||o._lastElementFocused.compareDocumentPosition(n.srcElement)&Node.DOCUMENT_POSITION_CONTAINS)&&o.updateFocusedElementAndOutline(o._lastElementFocused,s)},!0);sj_be(t,"transitionend",function(n){var t=o._targetDocument.activeElement;(n.propertyName=="height"||n.srcElement==t.closest(l))&&(o._focusOutlineTimeout?(o.clearFocusOutlineTimeout(),o.outlineElementAndScrollIntoView(t)):o._focusDiv.classList.contains(h)||o.outlineElementAndScrollIntoView(t),n.srcElement.style.height=="0px"?n.srcElement.classList.add(c):n.srcElement.classList.remove(c))});this._searchAppXYFocus.keyCodeMap.home.push(36);this._searchAppXYFocus.keyCodeMap.end.push(35)}return u.prototype.getXYFocusRoot=function(){return this._searchAppXYFocus.focusRoot},u.prototype.isL2Visible=function(){return this._isL2Visible},u.prototype.setIsL2Visible=function(n){this._isL2Visible=n},u.prototype.setXYFocusRoot=function(n){this._searchAppXYFocus.focusRoot=n},u.prototype.moveFocus=function(n,t){return this._searchAppXYFocus._xyFocus(n,t)},u.prototype.moveFocusToEdgeFocusableElement=function(n,t){var i,h;if(t===void 0&&(t=!1),this._targetWindow.focus(),t&&n==0)i=this.focusFirstSerpElement();else{var f=void 0,e=void 0,u=void 0,o=this._targetWindow.innerWidth,s=this._targetWindow.innerHeight;n==0?(f=-1,e=0,u=40):n==1&&(f=s,e=s+1,u=38);h={top:f,bottom:e,right:o,left:0,height:1,width:o};i=this._searchAppXYFocus._xyFocus(r[u],u,h)}return i&&(this.scrollTo(n),this.updateFocusedElementAndOutline(this._targetDocument.activeElement)),i},u.prototype.onSearchBoxFocusChanged=function(){this._targetDocument.hasFocus()?this.updateFocusedElementAndOutline(this._targetDocument.activeElement):this._useStickyFocus||n.setVisibility(this._focusDiv,!1)},u.prototype.isVisible=function(n){var t=_w.getComputedStyle(n);return!(t.visibility=="hidden"||t.display=="none"||n.offsetWidth===0&&n.offsetHeight===0)},u.prototype.moveFocusToLastFocusedElement=function(){return this._lastElementFocused&&this.isVisible(this._lastElementFocused)?(this._lastElementFocused.focus(),this.updateFocusedElementAndOutline(this._lastElementFocused),!0):this.moveFocusToEdgeFocusableElement(0,!0)},u.prototype.updateFocusedElementAndOutline=function(t,i){var r=this,u;(i===void 0&&(i=!0),t&&t!=this._targetDocument.body)&&(this.processFocusedElement(t),i)&&(u=this._lastElementFocused&&t.elementType&&t.elementType==this._lastElementFocused.elementType&&t.parentElement==this._lastElementFocused.parentElement?ut:0,u?(n.setVisibility(this._focusDiv,!1),this._focusOutlineTimeout=n.safeSetTimeout(function(){r._targetDocument.activeElement==t&&r.outlineElementAndScrollIntoView(t);r.clearFocusOutlineTimeout()},u,"updateFocusedElementAndOutline")):this.outlineElementAndScrollIntoView(t),this._lastElementFocused=t)},u.prototype.outlineElementAndScrollIntoView=function(t){var u,o,s;if(t!=this._targetDocument.body&&(this._useStickyFocus||this._targetDocument.hasFocus())){var r=t.getBoundingClientRect(),y=this._targetDocument.documentElement.scrollWidth-i*2,p=this._targetDocument.documentElement.scrollHeight-i*2,h=r.top+this._targetWindow.pageYOffset,e=r.left+this._targetWindow.pageXOffset,w=y-e,b=p-h,c=e<0?Math.floor(r.width+e-i):r.width;if(c<=0){n.setVisibility(this._focusDiv,!1);return}if(u=r.height,u<=0&&t.children.length>0)for(o=0;o<t.children.length;o++)s=t.children[o].getBoundingClientRect(),s.height>u&&(u=s.height,h=s.top);this._focusDiv.style.top=Math.max(i,h)+"px";this._focusDiv.style.left=Math.max(this.isL2Visible?i:i*4,e)+"px";this._focusDiv.style.width=Math.min(w,c)+"px";this._focusDiv.style.height=Math.min(b,u)+"px";n.setVisibility(this._focusDiv,!0);var l=t.getBoundingClientRect(),a=this._scrollArea.offsetHeight+this._scrollArea.scrollTop-l.bottom-f,v=l.top-this._scrollArea.scrollTop-f;a<0?this._scrollArea.scrollTop+=f-a:v<0&&(this._scrollArea.scrollTop+=v-f)}},u.prototype.scrollTo=function(n){var t=0;n==1&&(t=this._scrollArea.scrollHeight);this._scrollArea.scrollTop=t},u.prototype.processFocusedElement=function(i){var r=this,u,e,o,c,f,s,h;i.isProcessed||(u=i.tagName.toLocaleLowerCase(),e=i.getAttribute("type"),u=="select"&&(sj_be(i,"keydown",function(n){n.keyCode==32?i.classList.add(t):n.keyCode==13&&i.classList.remove(t)},!0),this.reactivateXYFocusOnBlur(i)),u=="input"&&e=="range"&&(sj_be(i,"keydown",function(n){var r=n.target,f=+r.getAttribute("min"),e=+r.getAttribute("step"),u=n.keyCode==37,o=n.keyCode==39,s=+r.value-e<f&&u;n.keyCode==38||n.keyCode==40||s?i.classList.remove(t):(u||o)&&i.classList.add(t)},!0),this.reactivateXYFocusOnBlur(i)),u=="button"&&typeof n.isMsbWorkScopeApplicable=="function"&&n.isMsbWorkScopeApplicable()&&sj_be(i,"click",function(){return n.setVisibility(r._focusDiv,!1)}),o=function(n,r){var u;if(!r.readOnly){if(u=r.selectionStart!=r.selectionEnd,u){i.classList.add(t);return}var f=r.selectionEnd==0,e=r.selectionEnd==r.value.length,o=n.keyCode==36&&!f,s=n.keyCode==35&&!e,h=n.keyCode==37&&!f,c=n.keyCode==39&&!e;h||c||o||s?i.classList.add(t):i.classList.remove(t)}},u=="textarea"&&(sj_be(i,"keydown",function(n){return o(n,n.target)},!0),this.reactivateXYFocusOnBlur(i)),u=="input"&&(e=="number"||e=="text")&&(sj_be(i,"keydown",function(n){return o(n,n.target)},!0),this.reactivateXYFocusOnBlur(i)),tt.some(function(n){return i.classList.contains(n)})?(i.elementType="slide",c=Array.prototype.slice.call(i.querySelectorAll("a:not([onclick='TestHooks.HideShowTestHooks(this);']):not([disabled])"),0),f=c.filter(function(n){return r.isVisible(n)&&n.offsetHeight>0&&n.offsetWidth>0}),f&&sj_be(i,"keydown",function(n){var t=r.countUniqueHrefs(f),u=n.keyCode;n.srcElement==i&&(t>1&&u==40?(n.preventDefault(),r._searchAppXYFocus.focusRoot=i,f[0].focus()):t==1&&u==13&&f[0].click())})):it.some(function(n){return i.hasAttribute(n)})?(i.elementType="expansion",s=function(t){t===void 0&&(t=!0);n.setVisibility(r._focusDiv,!1);r.updateFocusedElementAndOutline(r._targetDocument.activeElement,t)},sj_be(i,"keyup",function(n){n.keyCode==13&&s()},!0),sj_be(i,"click",function(){s(!1)})):i.classList.contains(rt)&&(h=function(){var n=r._targetDocument.getElementById("vidPreStopButton"),t,u;n&&n.focus();t=function(){i.focus()};sj_be(n,"click",t);sj_be(n,"keydown",function(n){n=sj_ev(n);n.keyCode===13&&t()});u=r._targetDocument.getElementsByTagName("video")[0];sj_be(u,"ended",t)},sj_be(i,"keydown",function(n){n.keyCode==13&&h()},!0),sj_be(i,"click",function(){h()})),i.classList.add(nt),i.isProcessed=!0)},u.prototype.countUniqueHrefs=function(n){var r={},t,i;if(n)for(t=0;t<n.length;t++)i=n[t],i&&(r[i.href]=!0);return Object.keys(r).length},u.prototype.reactivateXYFocusOnBlur=function(n){sj_be(n,"blur",function(){n.classList.remove(t)})},u.prototype.focusFirstSerpElement=function(){var n,i,t,r;switch(this._verticalType){case 1:n=this._targetDocument.getElementById("b_content");break;case 2:n=this._targetDocument.getElementById("images");break;case 3:n=this._targetDocument.getElementById("video");break;case 4:n=this._targetDocument.getElementById("dsb_first_foc");break;default:throw Error("Unknown vertical type "+this._verticalType);}if(n)for(i=n.querySelectorAll('a:not([onclick=\'TestHooks.HideShowTestHooks(this);\']):not([disabled]):not([tabindex="-1"]), button:not([disabled]), input[type=text]:not([disabled]), input[type=submit]:not([disabled]), textarea:not([disabled]), select:not([disabled]):not(#tta_sl):not(#tta_srcsl), [tabindex]:not([disabled]):not([tabindex="-1"]):not(#tta_playiconsrc)'),t=0;t<i.length;t++)if(r=i[t],this.isVisible(r))return r.focus(),!0;return!1},u.prototype.clearFocusOutlineTimeout=function(){sb_ct(this._focusOutlineTimeout);this._focusOutlineTimeout=null},u}();n.WSBMiniSerpFocusHelper=h}(WSB||(WSB={})),function(n){function i(n,t){switch(n){case"arrowRight":case"button":case"submit":return 1;case"autoContent":case"keepOpen":case"alwaysWide":case"refresh":return t&&t.inorganic?3:0;case"arrowUpOrDown":return 0;default:throw new Error("Unknown open type: "+n);}}function r(n){var t="None";switch(n){case 2:t="Local";break;case 3:t="Msb";break;case 1:t="Web";break;case 4:t="GoodNews"}return t}var t="noScroll",u;n.getPreviewPaneTypeAsString=r;u=function(){function u(t,i,r,u,f){var e=this;this._page=t;this._previewPaneId=0;this._beforeItemLaunchEventHandlers=[];this._afterItemLaunchEventHandlers=[];var l=function(n,t,i,r,u){e._clickLoggedForCurrentPreviewPane||e._beforeItemLaunchEventHandlers.forEach(function(f){return f(n,e._previewedSuggestion,t,i,r,u)})},a=function(n){e._clickLoggedForCurrentPreviewPane||(e._afterItemLaunchEventHandlers.forEach(function(t){return t(e._previewedSuggestion,e._queryForPreviewedSuggestion,n)}),e._clickLoggedForCurrentPreviewPane=!0)},v=function(t){var i,r,u;e._previewPaneResponseReceivedTimeStamp=t;u=((i=e._activePreviewPaneViewModel)===null||i===void 0?void 0:i.getCurrentHandoffType)?((r=e._activePreviewPaneViewModel)===null||r===void 0?void 0:r.getCurrentHandoffType())===21:!1;(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isLoading)||!e.isPreviewPaneWithLoaderViewModel(e._activePreviewPaneViewModel)||u||e._activePreviewPaneViewModel.stopLoadingScreen()};this._previewPaneViewModelParent={focusPending:!1,onBeforeItemLaunch:l,onAfterItemLaunch:a,onResponseReceived:v};var o=_ge("localPane"),s=_ge("miniSerpPane"),h=_ge("msbPane"),c=_ge("goodNewsPane");i.init(this._previewPaneViewModelParent,s);r&&r.init(this._previewPaneViewModelParent,o);u&&u.init(this._previewPaneViewModelParent,h);f&&f.init(this._previewPaneViewModelParent,c);SearchAppWrapper.CortanaApp.addEventListener("resettingtodefaultsize",function(){return e.dismiss()});n.Host.bindKeyDown(function(){e._previewPaneViewModelParent.focusPending=!1});n.Host.bindSearchBoxGotFocus(function(){return e._previewPaneViewModelParent.focusPending=!1});n.Host.bindQueryChangedOrInitialized(function(n){return e._currentQuery=n},!0);n.Host.bindAccountChanged(function(){e._miniSerpMustRefresh=!0});n.InstrumentationHelper.bindFinalizeKeystroke(function(n){e._activePreviewPaneViewModel&&n&&e._activePreviewPaneViewModel.finalizeKeystroke()});this._previewPaneInfos=[];this._previewPaneInfos[0]={paneElement:_ge("errorPane"),viewModel:null};this._previewPaneInfos[1]={paneElement:s,viewModel:i,disableRootScroll:!0};this._previewPaneInfos[2]={paneElement:o,viewModel:r,disableRootScroll:n.config.useCobaltCSS?!0:!1};this._previewPaneInfos[3]={paneElement:h,viewModel:u};this._previewPaneInfos[4]={paneElement:c,viewModel:f}}return u.prototype.init=function(n){this._selectionHandler=n},u.prototype.getSelectableItems=function(){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.getSelectableItems():[]},u.prototype.getSelectableItemsByGroup=function(){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.getSelectableItemsByGroup():[]},u.prototype.getSelectedItem=function(){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.getSelectedItem():null},u.prototype.select=function(n,t){this._activePreviewPaneViewModel&&this._activePreviewPaneViewModel.select(n,t)},u.prototype.onAfterKeyDown=function(n,t,i,r){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.onAfterKeyDown(n,t,i,r):!1},u.prototype.getPreviewedSuggestion=function(){return this._previewedSuggestion},u.prototype.getPreviewedSuggestionToForceTopHit=function(){return this._forceTopHitForPreviewedSuggestion&&!this._closeTimer?this._previewedSuggestion:null},u.prototype.getOnPreviewPaneRendered=function(t,u,f,e){var o=this,c=++this._previewPaneId,s=!0,l=n.getCurrentTime(),h;return this._instrumentedOpenThisImpression=!1,h=t?r(t.previewPaneType):"None",n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("RenderPreviewPane - "+h),function(r,a,v){var y,p;if(r||!a){if(a||(s=!1),!o._instrumentedOpenThisImpression){if(y={ppId:""+c,openType:u,suggestion:t?t.instItem.getLayoutKValue():undefined,suggestionType:t?t.type:undefined,startOpening:""+l,openDelay:f?""+f:undefined},v)for(p in v)y[p]=v[p];y.waitingForMore=s?"true":undefined;n.InstrumentationHelper.previewPaneOpenedOrClosed(!0,n.SequenceNumberManager.getSequenceNumber(),t?t.instItem:undefined,t?t.previewPaneType:undefined,i(u,e)==0,y)}o._instrumentedOpenThisImpression=!0;r&&(o._instrumentedOpenThisImpression=!1,u="keepOpen");!s&&n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("RenderPreviewPane - "+h)}}},u.prototype.onPreviewPaneErrored=function(i){for(var f,r=0,u=this._previewPaneInfos;r<u.length;r++)f=u[r],n.setVisibility(f.paneElement,!1);this._page.updateNarratorMessageView(null);n.StaticHtmlElements.qfPreviewScrollArea.classList.remove(t);this._page.updatePreviewErrorMessageView(i);n.setVisibility(this._previewPaneInfos[0].paneElement,!0);this._page.updateNarratorMessageView(i.narratorMessage)},u.prototype.showPreview=function(t,r,u,f,e,o){var h=this,s;u===void 0&&(u="button");f===void 0&&(f=!1);e===void 0&&(e=0);o===void 0&&(o=!1);this.updateMsbWorkScopeSuggestion(t,r);this._previewPaneOpenedForThisQuery=!0;this.clearSuggOpeningState(this._pendingPreviewedSuggestion);this.clearOpenTimer();this.clearCloseTimer();(r!=this._previewedSuggestion||f)&&(n.RuntimeConfig.AlwaysWide||this._page.setPreviewPaneVisibility(!0),s=this.getOnPreviewPaneRendered(r,u,e,t),o?n.InstrumentationHelper.notifyPreviewPanePending(n.SequenceNumberManager.getSequenceNumber(),r.previewPaneType,r.type):n.InstrumentationHelper.notifyTopHitPreviewPaneOpenedOrInterrupted(n.SequenceNumberManager.getSequenceNumber()),this.setPreviewPaneContent(t,r,i(u,t),this._previewPaneId,s,function(n){return h.onPreviewPaneErrored(n)}),this._selectionHandler.updateLastMiniSerpAutoSuggestion(r));u!="button"&&this._selectionHandler.updateSelectionState(r)},u.prototype.updateMsbWorkScopeSuggestion=function(t,i){var r,u,f,e=typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(i.handoffType);e&&(i.previousQuery=(r=this._previewedSuggestion)===null||r===void 0?void 0:r.query,i.previousScope=(u=this._previewedSuggestion)===null||u===void 0?void 0:u.scope,i.query=t.queryToFetch,i.scope=t.scope,i.previousMsbVerticalHash=(f=this._previewedSuggestion)===null||f===void 0?void 0:f.msbVerticalHash)},u.prototype.showPreviewAndFocus=function(n,t,i){i===void 0&&(i="submit");(this._closeTimer||this._previewedSuggestion!=t)&&this.showPreview(n,t,i);this._activePreviewPaneViewModel.focus(!1);this._forceTopHitForPreviewedSuggestion=!0},u.prototype.focus=function(n){return this._activePreviewPaneViewModel?(this._activePreviewPaneViewModel.focus(n),!0):!1},u.prototype.blur=function(){this._activePreviewPaneViewModel&&this._activePreviewPaneViewModel.blur()},u.prototype.dismiss=function(){this.close(!0)},u.prototype.close=function(t){var r=this,i;this.clearOpenTimer();i=t?0:n.config.closePreviewPaneDelay;i?this._closeTimer||(this._closeTimer=n.safeSetTimeout(function(){r._closeTimer=null;r.innerClose(t)},i,"ppCloseTimer")):(this.clearCloseTimer(),this.innerClose(t))},u.prototype.innerClose=function(t){var i,r;this._previewedSuggestion&&(i=!0,t&&(this._clickLoggedForCurrentPreviewPane?i=!1:this._previewPaneResponseReceivedTimeStamp&&n.getCurrentTime()>this._previewPaneResponseReceivedTimeStamp+1e3&&(i=!1)),i&&(r=t?{fromQFDismiss:"1"}:undefined,n.InstrumentationHelper.previewPaneOpenedOrClosed(!1,n.SequenceNumberManager.getSequenceNumber(),this._previewedSuggestion.instItem,this._previewedSuggestion.previewPaneType,undefined,r)),n.RuntimeConfig.AlwaysWide||t||this._page.setPreviewPaneVisibility(!1),this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.stopLoadingScreen(),this.clear())},u.prototype.clear=function(t){for(var i=0;i<this._previewPaneInfos.length;++i)n.setVisibility(this._previewPaneInfos[i].paneElement,!1);this._previewedSuggestion&&(this._previewedSuggestion.hasPreviewPaneOpened=!1,this._selectionHandler.updateSelectionState(this._previewedSuggestion),this._previewedSuggestion=null);this._forceTopHitForPreviewedSuggestion=!1;this._clickLoggedForCurrentPreviewPane=!1;this._previewPaneViewModelParent.focusPending=!1;this._activePreviewPaneViewModel&&(t||this._activePreviewPaneViewModel.clear(),this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.stopLoadingScreen());this._queryForPreviewedSuggestion=null;this._previewPaneResponseReceivedTimeStamp=null;this._activePreviewPaneViewModel=null},u.prototype.onQueryChanged=function(t,i){var r,u;if(this._previewPaneOpenedForThisQuery=!1,r=this._queryForPendingPreviewedSuggestion||this._queryForPreviewedSuggestion,this._queryIsContinuationOfPreviousQuery=r&&t.queryToFetch.toLocaleLowerCase().startsWith(r.queryToFetch.toLocaleLowerCase()),r&&t.queryToFetch.toLocaleLowerCase()!=r.queryToFetch.toLocaleLowerCase())if(u=this._pendingPreviewedSuggestion&&this._pendingPreviewedSuggestion.updateFromQuery?this._pendingPreviewedSuggestion:this._previewedSuggestion&&!this._closeTimer&&this._previewedSuggestion.updateFromQuery?this._previewedSuggestion:null,u){if(n.RuntimeConfig.AlwaysWide){this.autoOpen(t,u,"alwaysWide",!0,!0);return}this._queryIsContinuationOfPreviousQuery?(this._forceTopHitForPreviewedSuggestion=!1,this.autoOpen(t,u,"keepOpen",!0,!0)):this.close(!1)}else i&&this.autoOpen(t,i,"keepOpen",!0,!0)},u.prototype.clearSuggOpeningState=function(n){n&&(n.isPreviewPaneOpening=!1,this._selectionHandler.updateSelectionState(n))},u.prototype.clearOpenTimer=function(){this._openTimer&&(sb_ct(this._openTimer),this._openTimer=null,this._pendingPreviewedSuggestion.isPreviewPaneOpening=!1,this._pendingPreviewedSuggestion=null,this._queryForPendingPreviewedSuggestion=null,this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.stopLoadingScreen())},u.prototype.clearCloseTimer=function(){this._closeTimer&&(sb_ct(this._closeTimer),this._closeTimer=null)},u.prototype.onTopHitUpdated=function(t,i,r,u){if(r){if(!this._closeTimer&&(this._openTimer&&this._pendingPreviewedSuggestion!=r&&this.clearOpenTimer(),!this._miniSerpMustRefresh||r.previewPaneType!=1)){if(r.scope=t.scope,this._pendingPreviewedSuggestion&&n.isEquivalentForPreviewPanePurposes(t,this._pendingPreviewedSuggestion,r)){this._pendingPreviewedSuggestion=r;this._queryForPendingPreviewedSuggestion=t;r.hasPreviewPaneOpened=!0;this._selectionHandler.updateSelectionState(r);return}if(this._previewedSuggestion&&n.isEquivalentForPreviewPanePurposes(t,this._previewedSuggestion,r)){(!n.contains(u,i)||r.previewPaneNeedsRefreshAfterDeduping)&&(this._previewedSuggestion=r,this._queryForPreviewedSuggestion=t,r.hasPreviewPaneOpened=!0,this._selectionHandler.updateSelectionState(r),this.refreshLocalContent(t,r,n.SequenceNumberManager.getSequenceNumber()));return}}if(this._miniSerpMustRefresh=!1,this._forceTopHitForPreviewedSuggestion=!1,r.previewPaneType){if(n.RuntimeConfig.AlwaysWide){this.autoOpen(t,r,"alwaysWide",!1,!0);return}if(r==u[0]&&!this._previewPaneOpenedForThisQuery){if(r.autoOpenPreviewPaneWhenOnTopHit){this.autoOpen(t,r,"autoContent",!1,!0);return}if(this._previewedSuggestion&&this._queryIsContinuationOfPreviousQuery){this.autoOpen(t,r,"keepOpen",!1,!0);return}}}}this._openTimer&&(this.clearSuggOpeningState(this._pendingPreviewedSuggestion),this.clearOpenTimer());this._previewedSuggestion&&this.close(!1)},u.prototype.getDelayForMiniSerp=function(t,i,r){var u=n.getTweakedSetting("preventAutomaticMiniSerp");switch(t){case"keepOpen":case"alwaysWide":return r&&r.inorganic?0:u?Number.MAX_VALUE:n.config.probabilityNextKeyStrokeEnabled&&i.featureStore&&i.featureStore[264]!==undefined?this.calculateDelayForProbabilitySignal(i.featureStore[264]):n.RuntimeConfig.AlwaysWide?i.isAnswer?0:typeof n.getTenantMsbStatus=="function"&&n.getTenantMsbStatus()===n.TenantMsbStatus.Enabled?n.config.msbMiniSerpDelay:n.config.autoOpenMiniSerpDelay:n.config.keepMiniSerpOpenDelay;case"arrowUpOrDown":return u?Number.MAX_VALUE:n.config.openOnKeybNavMiniSerpDelay}return 0},u.prototype.calculateDelayForProbabilitySignal=function(t){for(var i=n.config.probabilityNextKeyStrokeThresholds.length-1;i>=0;i--)if(t>=n.config.probabilityNextKeyStrokeThresholds[i])return n.config.probabilityNextKeyStrokeDelays[i];return 0},u.prototype.shouldOpenMiniSerp=function(t){return n.RuntimeConfig.MiniSERPMode==0||t.previewPaneType!=1?!1:t.isAnswer?(n.RuntimeConfig.MiniSERPMode&1)!=0:t.type=="MD"?(n.RuntimeConfig.MiniSERPMode&2)!=0:(n.RuntimeConfig.MiniSERPMode&4)!=4?!1:t.query.length>=n.config.minPrefixLengthForMiniSerp},u.prototype.autoOpen=function(t,i,r,u,f){var e=this,s,h,o;n.InstrumentationHelper.notifyPreviewPaneStartRender(n.SequenceNumberManager.getSequenceNumber());f&&n.InstrumentationHelper.notifyPreviewPanePending(n.SequenceNumberManager.getSequenceNumber(),i.previewPaneType,i.type);h=n.config.disableOfflineRequest?n.isBrowserOnline()&&this.shouldOpenMiniSerp(i):this.shouldOpenMiniSerp(i);o=h?this.getDelayForMiniSerp(r,i,t):0;o?((i===null||i===void 0?void 0:i.previewPaneType)!=((s=this._previewedSuggestion)===null||s===void 0?void 0:s.previewPaneType)&&this.clear(),typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(i.handoffType)||r!="arrowUpOrDown"||(this.clear(),this.clearSuggOpeningState(this._pendingPreviewedSuggestion),this.clearSuggOpeningState(this._previewedSuggestion)),i.isPreviewPaneOpening=!0,this._selectionHandler.updateSelectionState(i),this.clearOpenTimer(),this.clearCloseTimer(),this._pendingPreviewedSuggestion=i,this._queryForPendingPreviewedSuggestion=t,this.setActivePreviewPaneContainer(i,t),this._openTimer=o==Number.MAX_VALUE?Number.MAX_VALUE:n.safeSetTimeout(function(){e._openTimer=null;i=e._pendingPreviewedSuggestion;e._pendingPreviewedSuggestion=null;e._queryForPendingPreviewedSuggestion=null;e.showPreview(t,i,r,u,o,f)},o,"ppOpenTimer"),!this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)||!this.isStartLoadingRequiredInWorkScopeScenarios(t,i)&&(r=="arrowUpOrDown"||this._previewedSuggestion!=null)||this._activePreviewPaneViewModel.startLoadingScreen()):this.showPreview(t,i,r,u,null,f)},u.prototype.onAfterKeyDownWhenNewSelection=function(t,i,r){var f=n.RuntimeConfig.AlwaysWide&&n.config.openOnKeybNavMiniSerp,e,u;if(n.isGroup(r)){f&&(this.clearSuggOpeningState(this._pendingPreviewedSuggestion),this.clearSuggOpeningState(this._previewedSuggestion),n.InstrumentationHelper.notifyTopHitPreviewPaneOpenedOrInterrupted(n.SequenceNumberManager.getSequenceNumber()),e=r.type==n.GroupType.Related&&i.scope===n.Scope.Work,this.clear(e),this.clearOpenTimer(),this.clearCloseTimer(),this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.stopLoadingScreen());return}u=r;u.previewPaneType?f&&(t==40||t==38||t==9)?(this._previewedSuggestion!=u||typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(u.handoffType))&&this.autoOpen(i,u,"arrowUpOrDown",!1,!1):t==n.getRtlAdjustedKey(39)&&this._currentQuery.originalCursorPosition==this._currentQuery.originalQuery.length&&n.Host.searchBoxHasFocus()?this.showPreviewAndFocus(i,u,"arrowRight"):t==n.getRtlAdjustedKey(37)&&this._activePreviewPaneViewModel&&this._activePreviewPaneViewModel.hasFocus()&&this._activePreviewPaneViewModel.readyToBlur()&&n.Host.setFocusInSearchBox(t,"previewPaneUnfocus"):this.clear()},u.prototype.isStartLoadingRequiredInWorkScopeScenarios=function(t,i){var r,u=typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(i.handoffType),f=i.msbVerticalHash!=""&&t.scope===n.Scope.Work,e=i.previousMsbVerticalHash!=""&&i.msbVerticalHash==""&&t.scope===n.Scope.Work,o=((r=this._previewedSuggestion)===null||r===void 0?void 0:r.query)!==t.queryToFetch&&t.scope===n.Scope.Work;return u&&!f&&!o&&!e},u.prototype.refreshLocalContent=function(t,i,r){var e=this,u=null,f;this._instrumentedOpenThisImpression&&(u=this.getOnPreviewPaneRendered(i,"refresh",0,t));f=function(n){return e.onPreviewPaneErrored(n)};n.InstrumentationHelper.notifyPreviewPanePending(r,i.previewPaneType,i.type);this._activePreviewPaneViewModel.update(i,t,0,this._previewPaneId,u,f,!0)},u.prototype.setActivePreviewPaneContainer=function(i,r){var u=i.previewPaneType;i.previewPaneType!=2&&(this.shouldOpenMiniSerp(i)||i.previewPaneType!=1)||(u=2);n.setVisibility(this._previewPaneInfos[u].paneElement,!0);this._activePreviewPaneViewModel=this._previewPaneInfos[u].viewModel;this._previewPaneInfos[u].disableRootScroll?n.StaticHtmlElements.qfPreviewScrollArea.classList.add(t):n.StaticHtmlElements.qfPreviewScrollArea.classList.remove(t);this.shouldStartWorkScopeLoadingState(r.scope,i.handoffType)&&this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.startLoadingScreen()},u.prototype.shouldStartWorkScopeLoadingState=function(t,i){var r=!0,u,f;return typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(i)&&!n.config.msbNewWorkScopeEnabled&&(u=this._activePreviewPaneViewModel.isIframeActive?this._activePreviewPaneViewModel.isIframeActive():!1,f=this._activePreviewPaneViewModel.getCurrentHandoffType?this._activePreviewPaneViewModel.getCurrentHandoffType()===i:!1,r=!(u&&f)),r},u.prototype.setPreviewPaneContent=function(t,i,r,u,f,e){var o,s;typeof n.isMsbWorkScope=="function"&&n.isMsbWorkScope(i.handoffType)&&((o=this._previewedSuggestion)===null||o===void 0?void 0:o.previewPaneType)===1||(s=n.config.msbNewWorkScopeEnabled&&t.scope===n.Scope.Work&&!!t.queryToFetch,this.clear(s));this._previewedSuggestion=i;this._previewedSuggestion&&(this._previewedSuggestion.hasPreviewPaneOpened=!0,this._previewedSuggestion.isPreviewPaneOpening=!1);this._previewPaneResponseReceivedTimeStamp=null;this._queryForPreviewedSuggestion=t;this.setActivePreviewPaneContainer(i,t);this._activePreviewPaneViewModel.update(i,t,r,u,f,e,i.previewPaneNeedsRefreshAfterDeduping)},u.prototype.bindBeforeItemLaunch=function(n){this._beforeItemLaunchEventHandlers.push(n)},u.prototype.bindAfterItemLaunch=function(n){this._afterItemLaunchEventHandlers.push(n)},u.prototype.hasFocus=function(){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.hasFocus():!1},u.prototype.isOpened=function(){return!!this._previewedSuggestion},u.prototype.isPreviewPaneWithLoaderViewModel=function(n){return!!(n===null||n===void 0?void 0:n.startLoadingScreen)},u}();n.PreviewPane=u}(WSB||(WSB={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t="NR",i="RF",r="CHN",u="OFL",f=function(f){function e(){return f!==null&&f.apply(this,arguments)||this}return __extends(e,f),e.prototype.fetchUrl=function(f,e,o,s,h,c){var a=this,l;if(n.isBrowserOnline()){var w=o?1:0,v=SearchAppWrapper.CortanaApp,y=v.createStringMap(),p=v.createStringMap();if(e)for(l in e)l.toLowerCase().startsWith("content")?p[l]=e[l]:y[l]=e[l];n.Async.safeChain("makeHttpRequestAsync",function(){return v.makeHttpRequestAsync(w,f,y,o,p)},function(r){c()&&(r.statusCode===200?n.Async.safeChain("cortanaJson_ReadResponse",function(){return r.readAsStringAsync()},function(i){if(c()){n.TestHookUrlParameters&&i&&(i=i.replace(new RegExp("<!--[^]*?-->","gm"),""));var r=i?n.safeExecute(function(){return JSON.parse(i)},"parseCortanaHttpResponse",null,null):null;r!=null?s(a._dataSource,r,null):s(a._dataSource,null,t)}},function(){return s(a._dataSource,null,i)},h):s(a._dataSource,null,r.statusCode.toString()))},function(){return s(a._dataSource,null,r)},h)}else s(this._dataSource,null,u,null,!0)},e}(n.JsonDataProvider);n.CortanaJsonDataProvider=f}(WSB||(WSB={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){function u(){return n.MockUrlParameters&&typeof n.MockedAnaheimDataResponse=="object"}var e=n.config.enableAnaheimDataQFPassive||n.config.enableAnaheimDataQFAggressive?80:20,i=5,r=2,t="ANA",o="lastUpdated",f;n.isForTest=u;f=function(f){function s(t,i){var r=this,u=function(t,r,u){return i(n.ANADatabaseName,function(n){t(n)},r,u,o)},e=function(t,i,u){return s._instrumentStringNumber.LFC=++s._lifetimeFetchCount,n.safeExecute(function(){return r.createAnaheimDataResponse(t,i,u)},"createAnaheimDataResponse")},h=function(){return!0},c=function(n){return n=="R"?undefined:n};return r=f.call(this,u,e,h,c,"ANA")||this,n.Host.bindShown(function(){r.resetInitialized(null);r.queryStorage("anaheimData",function(n){s.setCachedAnaheimAccount(n);s.setCachedAnaheimDismissedDataItemIds(n)},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()},function(){return r.onAfterWrite()});r.searchIndexerWithMultipleResults(n.Host.getQuery(),new n.CancellationManager)}),r.accessTokenManager=t,r._pendingWrites=[],r}return __extends(s,f),s.getResultsCount=function(){return s._getResultsCount},s.getResultsExceptionCount=function(){return s._getResultsExceptionCount},s.getANANumberMap=function(){return s._instrumentStringNumber},s.decreaseRetryCount=function(){return s.retryCount-=1},s.getRetryCount=function(){return s.retryCount},s.getExpirationThreshold=function(){var n=s.retryCount;return s.expirationThresholds[n]},s.getAvailableChannels=function(){return s.availableChannels},s.getSelectedProfile=function(){return s.selectedProfile},s.isInitialized=function(){return s.initialized},s.setShouldShowAnaheimDataSH=function(n){return s.shouldShowAnaheimDataSH=n},s.getShouldShowAnaheimDataSH=function(){return s.shouldShowAnaheimDataSH},s.setShouldShowAnaheimDataQF=function(n){return s.shouldShowAnaheimDataQF=n},s.getShouldShowAnaheimDataQF=function(){return s.shouldShowAnaheimDataQF},s.setCachedAnaheimDismissedDataItemIds=function(n){var i,r,u,f,t=[];t.push.apply(t,(i=n===null||n===void 0?void 0:n.anaHistoryItems)===null||i===void 0?void 0:i.filter(function(n){return n.dismissed}).map(function(n){return n.id}));t.push.apply(t,(r=n===null||n===void 0?void 0:n.anaTopSitesItems)===null||r===void 0?void 0:r.filter(function(n){return n.dismissed}).map(function(n){return n.id}));t.push.apply(t,(u=n===null||n===void 0?void 0:n.anaRecentlyClosedItems)===null||u===void 0?void 0:u.filter(function(n){return n.dismissed}).map(function(n){return n.id}));t.push.apply(t,(f=n===null||n===void 0?void 0:n.anaFavoritesItems)===null||f===void 0?void 0:f.filter(function(n){return n.dismissed}).map(function(n){return n.id}));s.cachedAnaheimDismissedDataItemIds=t},s.setCachedAnaheimAccount=function(n){s.cachedAnaheimAccount=n===null||n===void 0?void 0:n.anaheimAccount},s.prototype.getName=function(){return"AnaheimDataProvider"},s.prototype.validateAndCompareAccount=function(n,t){return n?t?n.accountId==t.accountId&&n.accountProviderAuthority==t.accountProviderAuthority&&n.accountProviderId==t.accountProviderId&&n.accountState==t.accountState&&n.isDefaultAccount==Boolean(t.isDefaultAccount)?!0:!1:!1:!0},s.prototype.createAnaheimDataResponse=function(t,i){var l,a,v=this,r,e,o;if(s.setShouldShowAnaheimDataSH(!0),s.setShouldShowAnaheimDataQF(!0),r={anaheimDataItems:[],quickAnswers:[]},n.config.enableQuickSearch||!n.canShowQuickSearchWithoutANA(t)||n.isTrendingSearchDataEnabled(t)||(r=n.QuickSearchSuggestionsDataProvider.getQuickSearchResponse(r)),i)for(e=0,o=i;e<o.length;e++){var f=o[e].value,y=this.getSelectedWindowsAccount(),p=f===null||f===void 0?void 0:f.anaheimAccount,h=f===null||f===void 0?void 0:f.anaHistoryItems,c=f===null||f===void 0?void 0:f.anaTopSitesItems;this.validateAndCompareAccount(y,p)&&(s._instrumentStringNumber.CFCC=++s._cachedFetchCount,n.config.enableAnaheimDataHS&&!n.isTrendingSearchDataEnabled(t)&&(l=r.anaheimDataItems).push.apply(l,h===null||h===void 0?void 0:h.filter(function(n){var t=n.dismissed;return!t})),n.config.enableAnaheimDataTSTile&&(a=r.anaheimDataItems).push.apply(a,c===null||c===void 0?void 0:c.filter(function(n){var t=n.dismissed;return!t})))}return u()&&(r.anaheimDataItems=this.transformDeviceItemToAnaheimDataItem(n.MockedAnaheimDataResponse.deviceItems,undefined),r.quickAnswers=n.MockedAnaheimDataResponse.quickAnswers),t.isSearchHomeZI&&(r.remove=function(n,t){return v.dismissSingleAnaheimSuggestion(n,t)}),r},s.prototype.isAnaheimDataItemDismissed=function(n){var t;if((t=s.cachedAnaheimDismissedDataItemIds)!==null&&t!==void 0)return t.some(function(t){return t===n})},s.prototype.shouldCompareWithCache=function(n,t){return t?n?JSON.stringify(n)===JSON.stringify(t):!1:!0},s.prototype.getDedupeKey=function(n){var t=n.getProperty("System.Link.TargetUrl");return t?new URL(t).hostname.replace("www.","")+n.getProperty("System.Title"):undefined},s.prototype.transformDeviceItemToAnaheimDataItem=function(n,t){for(var i,c,r,u,f,l=this.shouldCompareWithCache(s.cachedAnaheimAccount,t),o=[],e=0,h=n;e<h.length;e++)i=h[e],c={id:i.id,url:i.getProperty("System.Link.TargetUrl"),title:i.getProperty("System.Title"),dateCreated:(r=i.getProperty("System.DateCreated"))===null||r===void 0?void 0:r.toString(),dateModified:(u=i.getProperty("System.DateModified"))===null||u===void 0?void 0:u.toString(),dateVisited:(f=i.getProperty("System.Link.DateVisited"))===null||f===void 0?void 0:f.toString(),visitCount:i.getProperty("System.History.VisitCount"),urlTypedCount:i.getProperty("System.History.SelectionCount"),dismissed:l?this.isAnaheimDataItemDismissed(i.id):!1,dedupeKey:this.getDedupeKey(i)},o.push(c);return o},s.prototype.resetInitialized=function(){s.retryCount=r;s.expirationThresholds=[3,7,14];s.initialized=!1;s._instrumentStringNumber={};this.anaheimStrategy=0;this.anaheimDataEntry={lastUpdated:0,anaheimAccount:null}},s.prototype.saveAnaheimDataToStorage=function(t){var r=this,f,i,u;if(this._writing){this._pendingWrites.push(function(){return r.saveAnaheimDataToStorage(t)});return}this._writing=!0;this.selectedWindowsAccount&&(f={accountId:this.selectedWindowsAccount.accountId,accountState:this.selectedWindowsAccount.accountState,accountUserName:this.selectedWindowsAccount.accountUserName,accountProviderId:this.selectedWindowsAccount.accountProviderId,accountProviderAuthority:this.selectedWindowsAccount.accountProviderAuthority,accountProviderDisplayName:this.selectedWindowsAccount.accountProviderDisplayName,isDefaultAccount:this.selectedWindowsAccount.isDefaultAccount?1:0});i=this.transformDeviceItemToAnaheimDataItem(t,f);i.length>0&&(u=i[0],u.id.indexOf("History")>-1?this.anaheimDataEntry.anaHistoryItems=i:u.id.indexOf("QuickLinks")>-1?this.anaheimDataEntry.anaTopSitesItems=i:u.id.indexOf("RecentlyClosed")>-1?this.anaheimDataEntry.anaRecentlyClosedItems=i:u.id.indexOf("Favorites")>-1&&(this.anaheimDataEntry.anaFavoritesItems=i));this.anaheimDataEntry.lastUpdated=n.ClientSideStorage.StorageBasedDataProvider.getUnixTime();this.anaheimDataEntry.anaheimAccount=f;this.withStorage(function(n){return n.put("anaheimData",r.anaheimDataEntry,function(){return r.onAfterWrite()},function(n){r.onError(n,"saveAnaheimDataToStorage");r.onAfterWrite()})})||this.onAfterWrite()},s.prototype.searchIndexerWithMultipleResults=function(u,f,o){var h=this,c,l;s.getRetryCount()==r&&(u.anaheimStrategy=this.anaheimStrategy);c=n.IndexerQueryGenerator.generateIndexerQuery(u,null,"",e,t,o);c.indexOf("WHERE")>-1&&(l=function(){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.queryWindowsSearchIndexerAsync(c)},n.Async.safeChain("queryAnaheimData",l,function(r){var e,o;if(s.isInitialized())s._instrumentStringNumber.IFC=++s._indexerFetchCount,e=r.resultSet,h.saveAnaheimDataToStorage(e);else{if(s._lifetimeFetchCount=0,s._cachedFetchCount=0,s._indexerFetchCount=0,s._getResultsCount=0,s._getResultsExceptionCount=0,e=r.resultSet,h.selectedWindowsAccount=h.getSelectedWindowsAccount(),h.selectAnaheimChannelAndProfile(e,h.selectedWindowsAccount),!s.getSelectedProfile())return;for(o=1;o<i;o++)n.IndexerQueryGenerator.updateAnaheimStrategy(t,o);s.initialized=!0}s._getResultsCount++;h.anaheimStrategy++;h.anaheimStrategy<i&&h.searchIndexerWithMultipleResults(u,f)},function(e){n.isCancellation(e)||h.logProviderFailure(t);s._getResultsExceptionCount++;e.number===-2147215865&&s.getRetryCount()>0?s.decreaseRetryCount():(h.anaheimStrategy++,s.retryCount=r);s.isInitialized()&&h.anaheimStrategy<i&&h.searchIndexerWithMultipleResults(u,f)},f,t))},s.prototype.getSelectedWindowsAccount=function(){var t=this.accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["AnaheimDataProvider::getSelectedWindowsAccount"]:undefined),i=-1;return(t===null||t===void 0?void 0:t.accountProviderAuthority)=="consumers"?i=0:(t===null||t===void 0?void 0:t.accountProviderAuthority)=="organizations"&&(i=1),s._instrumentStringNumber.SAType=i,s._instrumentStringNumber.SADefault=(t===null||t===void 0?void 0:t.isDefaultAccount)?1:0,s._instrumentStringNumber.SAState=t===null||t===void 0?void 0:t.accountState.valueOf(),t},s.prototype.selectAnaheimChannelAndProfile=function(n,t){for(var i,c,l,e,r=[],o=[{displayName:"canary"},{displayName:"dev"},{displayName:"beta"},{displayName:"stable"},],f=0,h=n;f<h.length;f++)i=h[f],i&&(c=i.id,c.indexOf("Profiles")>-1&&(l={displayName:i.displayName,emailAddress:i.getProperty("System.Identity"),timestamp:i.getProperty("System.DateCreated"),status:i.getProperty("System.Status"),accountType:i.getProperty("System.ContentType"),id:i.getProperty("System.ProviderItemID")},r.push(l)));if(s.availableChannels=o,r.sort(this.sortProfilesHelper),s.selectedProfile=null,t){for(e in r)if(r[e].emailAddress===t.accountUserName){s.selectedProfile=r[e];break}}else s.selectedProfile=r[0];u()||s.selectedProfile||(s.setShouldShowAnaheimDataSH(!1),s.setShouldShowAnaheimDataQF(!1));s._instrumentStringNumber.ACC=o.length;s._instrumentStringNumber.APC=r.length},s.prototype.sortProfilesHelper=function(n,t){return n.timestamp>t.timestamp?-1:n.timestamp<t.timestamp?1:0},s.prototype.logProviderFailure=function(t){var i=n.providerFailureLogName(t);i&&SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure&&n.safeExecute(function(){return SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure(i,"ErrorForTopHit")},"logProviderFailure")},s.prototype.dismissSingleAnaheimSuggestion=function(n,t){var i=this;if(this._writing){this._pendingWrites.push(function(){return i.dismissSingleAnaheimSuggestion(n,t)});return}this._writing=!0;this.queryStorage("anaheimData",function(r){return i.setDismissedAndSaveAnaheimData(n,r,t)},function(){return i.onAfterWrite()},function(){return i.onAfterWrite()},function(){return i.onAfterWrite()})},s.prototype.setDismissed=function(n,t){var i=t===null||t===void 0?void 0:t.find(function(t){return t.id===n.id});return i&&i.dedupeKey&&(t===null||t===void 0?void 0:t.map(function(n){n.dedupeKey===i.dedupeKey&&(n.dismissed=!0)})),t},s.prototype.setDismissedAndSaveAnaheimData=function(t,i,r){var u=this;switch(t.type){case"ANAH":i.anaHistoryItems=this.setDismissed(t,i===null||i===void 0?void 0:i.anaHistoryItems);break;case"ANAT":i.anaTopSitesItems=this.setDismissed(t,i===null||i===void 0?void 0:i.anaTopSitesItems);break;case"ANAR":i.anaRecentlyClosedItems=this.setDismissed(t,i===null||i===void 0?void 0:i.anaRecentlyClosedItems);break;case"ANAF":i.anaFavoritesItems=this.setDismissed(t,i===null||i===void 0?void 0:i.anaFavoritesItems)}i.lastUpdated=n.ClientSideStorage.StorageBasedDataProvider.getUnixTime();this.withStorage(function(n){return n.put("anaheimData",i,function(){r&&r();u.onAfterWrite()},function(n){u.onError(n,"setDismissedAndSaveAnaheimData");u.onAfterWrite()})})||this.onAfterWrite()},s.availableChannels=[],s.cachedAnaheimDismissedDataItemIds=[],s.expirationThresholds=[],s._instrumentStringNumber={},s._lifetimeFetchCount=0,s._cachedFetchCount=0,s._indexerFetchCount=0,s._getResultsCount=0,s._getResultsExceptionCount=0,s}(n.ClientSideStorage.StorageBasedDataProvider);n.AnaheimDataProvider=f}(WSB||(WSB={})),function(n){var t=function(){function t(){}return t.getANANumberMap=function(){return t._instrumentStringNumber},t.getANAHCount=function(){return t._ANAHCount},t.getANATCount=function(){return t._ANATCount},t.prototype.getName=function(){return"AnaheimDataParser"},t.prototype.parse=function(i,r,u,f,e,o){var h=this,s;t._instrumentStringNumber.TUC=f.anaheimDataItems.length;s=[];(n.AnaheimDataProvider.getShouldShowAnaheimDataSH()||n.AnaheimDataProvider.getShouldShowAnaheimDataQF())&&n.safeExecute(function(){h.parseAnaheimDataSuggestions(f,i,r,e,s)},"parseAnaheimDataSuggestions "+u);(!i.isSearchHomeZI||n.canShowAnaheimDataSH())&&(i.isSearchHomeZI||n.canShowAnaheimDataQF())||(s=[]);!n.config.enableQuickSearch&&n.canShowQuickSearchWithoutANA(i)&&n.QuickSearchSuggestionsParser.parseQuickSearchSuggestions(i,r,"QSCH",f,s);t._instrumentStringNumber.RCC=n.AnaheimDataProvider.getResultsCount();t._instrumentStringNumber.ECC=n.AnaheimDataProvider.getResultsExceptionCount();o(u,s,null)},t.prototype.isValidQuery=function(n){return n&&!n.isSearchHomeZI&&!n.queryToFetch?!1:!0},t.prototype.isUrlMatched=function(t,i){if(!this.isValidQuery(t)||!i||t.queryToFetch.length<=n.config.anaheimDataQFAggressiveURLMatch)return!1;if(n.config.enableAnaheimDataQFPassive){var r={};return n.computeUrlMatchLengths(r,i,t.queryToFetch.toLowerCase()),r.domainMatchLength>0?!0:!1}return n.config.enableAnaheimDataQFAggressive?i.toLowerCase().includes(t.queryToFetch.toLowerCase()):!1},t.prototype.isTitleMatched=function(t,i){var r,e,o,c;if(!this.isValidQuery(t)||!i||(n.config.enableAnaheimDataQFPassive||n.config.enableAnaheimDataQFAggressive)&&t.queryToFetch.length>0&&t.queryToFetch.length<=n.config.anaheimDataQFAggressiveURLMatch)return!1;var u=i.toLocaleLowerCase(),l=u.split(" "),s=t.queryToFetch.toLocaleLowerCase(),f=!1,h=0;for(r=0,e=l;r<e.length;r++){if(o=e[r],o.startsWith(s)){f=!0;break}if(c=u.substring(h,u.length),h+=o.length+1,c.startsWith(s)){f=!0;break}}return f?!0:!1},t.prototype.parseAnaheimDataSuggestions=function(i,r,u,f,e){for(var v,y,p,o,w=this,s,h={},b=function(t){n.safeExecute(function(){return w.parseAnaheimDataSuggestion(i,t,r,u,f,h)},"parseAnaheimDataSuggestion")},c=0,a=i.anaheimDataItems;c<a.length;c++)v=a[c],b(v);t._ANAHCount=0;t._ANATCount=0;t._ANARCount=0;t._ANAFCount=0;y=(s=n.config.anaheimHSReturnMaxCount)!==null&&s!==void 0?s:4;for(p in h)o=h[p],n.config.enableAnaheimDataHS&&o.type=="ANAH"&&(t._ANAHCount+=1,r.isSearchHomeZI?t._ANAHCount<=y&&e.push(o):e.push(o)),n.config.enableAnaheimDataTSTile&&o.type=="ANAT"&&(t._ANATCount+=1,n.config.enableAnaheimDataTSTile&&t._ANATCount<=6&&e.push(o));if(t._instrumentStringNumber.TSC=e.length,t._instrumentStringNumber.BHSC=t._ANAHCount,t._instrumentStringNumber.TSSC=t._ANATCount,t._instrumentStringNumber.RCSC=t._ANARCount,t._instrumentStringNumber.FVSC=t._ANAFCount,e.sort(function(n,t){var i,r,u,f;return((r=(i=t.anaheimRankingSignals)===null||i===void 0?void 0:i.dateCreated)===null||r===void 0?void 0:r.getTime())-((f=(u=n.anaheimRankingSignals)===null||u===void 0?void 0:u.dateCreated)===null||f===void 0?void 0:f.getTime())}),n.config.topHitMuse){var k=0,l=0,d=3;e.filter(function(n){return n.type=="ANAH"}).filter(function(){return k++<d}).forEach(function(t){t.type="ANATH";t.rankingScore=1.1-l/10;t.text=n.formatString("[{0}] [{1}]",[l.toString(),t.text]);l++})}},t.prototype.parseAnaheimDataSuggestion=function(t,i,r,u,f,e){var p,w,b,h,y,k,d,s,c,g,nt,tt,v,a;if(i&&f()){if(h=void 0,i.id.indexOf("Favorites")>-1)h="ANAF",y="EdgeFavorites";else if(i.id.indexOf("History")>-1)h="ANAH",y="EdgeBrowsingHistory";else if(i.id.indexOf("QuickLinks")>-1)h="ANAT",y="EdgeTopSites";else if(i.id.indexOf("RecentlyClosed")>-1)h="ANAR",y="EdgeRecentClosed";else return;if(k=new Date(i.dateCreated),d=n.AnaheimDataProvider.getExpirationThreshold(),h=="ANAH"&&(!k||n.getTimeDiffInDays(k)>d))return;if(s=i.url,c=i.title,!this.isTitleMatched(r,c)&&!this.isUrlMatched(r,s))return;g=r.isSearchHomeZI?c:HitHighlightingParser.addMarkers(c,r.queryToFetch);n.config.topHitMuse&&(r.fullPartialQuery=c);v=n.AnaheimDataProvider.getSelectedProfile();n.config.enableAnaheimDataProfile&&v&&(v.accountType=="MSA"?nt=v.id:v.accountType=="AAD"&&(tt=v.id));var o=n.createSuggestion(r,g,n.getFaviconUrlForRawUrl(s,64,64,1.5),null,h,r.fullPartialQuery,n.InstrumentedItem.createInstrumentedItemHandOffOverride(u,h,1),1,u,!0,i.id,function(){return n.Host.launchUrlWithEdgeProtocol(s,{campaign:n.config.anaheimDataLaunchOCID,medium:y,cid:nt,oid:tt})},null,h+c+i.id),it=s===null||s===void 0?void 0:s.replace(/(^\w+:|^)\/\//,""),l=s?new URL(s):undefined;if(o.primaryMetadata=(l===null||l===void 0?void 0:l.hostname)?HitHighlightingParser.addMarkers(decodeURIComponent(it),l.hostname):decodeURIComponent(it),o.tooltip=c,h=="ANAT"&&(o.tooltip+="\n"+s),o.url=s,o.narratorText=n.getNarratorText(o),o.template=1,o.anaheimRankingSignals={dateCreated:new Date(i.dateCreated),dateModified:new Date(i.dateModified),dateVisited:new Date(i.dateVisited),visitCount:Number(i.visitCount),urlTypedCount:Number(i.urlTypedCount)},this.setupRemoveFromHistoryContextMenu(o,t),a=((p=l===null||l===void 0?void 0:l.hostname)===null||p===void 0?void 0:p.replace("www.",""))+c,e[a]&&o.type=="ANAH"){var rt=o.id,et=e[a].id,ut=(w=o.anaheimRankingSignals.dateCreated)===null||w===void 0?void 0:w.valueOf(),ft=(b=e[a].anaheimRankingSignals.dateCreated)===null||b===void 0?void 0:b.valueOf();et.indexOf("stable")>-1?rt.indexOf("stable")>-1&&ut>ft&&(e[a]=o):(rt.indexOf("stable")>-1||ut>ft)&&(e[a]=o)}else e[a]=o}},t.prototype.setupRemoveFromHistoryContextMenu=function(t,i){i.remove&&n.setExtraVerbs(t,function(r){if(r||!i.remove)return[];var u={verb:"RemoveFromDeviceHistory",displayName:n.Host.getLocString("RemoveFromDeviceHistory"),executeSync:function(){i.remove(t,function(){n.Host.refreshCurrentPane()});delete i.remove},icon:{content:"&#xE711",type:2}};return[u]},!0)},t._instrumentStringNumber={},t._ANAHCount=0,t._ANATCount=0,t._ANARCount=0,t._ANAFCount=0,t}();n.AnaheimDataParser=t}(WSB||(WSB={}));1;var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},WSB;(function(n){var t="TS",r=n.config.trendingSearchUpdateMillis,u=500,f=function(){function i(){this.WSBTSCacheStorageKey="WSBTrendingSearchCache";n.Host.bindShown(function(){n.isTSFallbackToANA=!1})}return i.prototype.getName=function(){return"TrendingSearchDataProvider"},i.prototype.fetch=function(n,i){n.enabledDataSources[t]&&i(t,this.generateTSDataResponse(),null)},i.prototype.generateTSDataResponse=function(){var t=[],i,u,e,f;return n.MockUrlParameters&&typeof n.MockedTSData=="object"?{suggestions:n.MockedTSData.suggestions}:n.canShowTrendingSearch()?(i=this.loadTSContentFromWSBCache(),n.isTSFallbackToANA=!1,i?(u=i.cacheTime,e=i.trendingSearchSuggestions,t=__spreadArray([],e,!0),(u===0||u+r<n.getCurrentTime())&&this.fetchTSUrlWithTimeout().then(function(t){t&&n.Host.refreshCurrentPane()})):(f=this.loadTSContentFromDSBCache(),f?t=__spreadArray([],f.trendingSearchSuggestions,!0):(n.isTSFallbackToANA=!0,n.Host.refreshCurrentPane()),this.fetchTSUrl()),{suggestions:t}):{suggestions:t}},i.prototype.fetchTSUrlWithTimeout=function(){return __awaiter(this,void 0,void 0,function(){var i,t,r,f=this;return __generator(this,function(e){switch(e.label){case 0:return i=!1,t=n.safeSetTimeout(function(){i=!0},u,"fetchTSContentTimer"),r=function(){return __awaiter(f,void 0,void 0,function(){var n;return __generator(this,function(r){switch(r.label){case 0:return[4,this.fetchTSUrl()];case 1:return(n=r.sent(),!n)?[2,!1]:i?(SharedLogHelper.LogWarning("fetchTrendingSearchContentDone","Fetch trending search content succeed but timeout, will render on next shown"),[2,!1]):(t&&(sb_ct(t),t=null),[2,!0])}})})},[4,r()];case 1:return[2,e.sent()]}})})},i.prototype.fetchTSUrl=function(){return __awaiter(this,void 0,void 0,function(){var r,t,u,i,f;return __generator(this,function(e){switch(e.label){case 0:r=n.isBrowserOnline();t="".concat(location.origin).concat(n.config.wsbTrendingSearchEndpoint);t=ThresholdUtilities.setUrlParameter(t,"cc",n.Host.getRegion());t=ThresholdUtilities.setUrlParameter(t,"setlang",n.getCurrentLanguage());e.label=1;case 1:return e.trys.push([1,6,,7]),[4,fetch(t)];case 2:return(u=e.sent(),!u.ok)?[3,4]:[4,u.json()];case 3:if(i=e.sent(),this.isValidTSContent(i))return this.setTSContentToCache({cacheTime:n.getCurrentTime(),trendingSearchSuggestions:i.scenarios[0].items}),n.isTSFallbackToANA=!1,[2,!0];throw new Error("Invalid trending search content. Online status ".concat(r,". Response data ").concat(i?JSON.stringify(i):"undefined","."));case 4:throw new Error("http status:".concat(u.status,". Online status ").concat(r));case 5:return[3,7];case 6:return f=e.sent(),SharedLogHelper.LogError("fetchTrendingSearchUrl","fetch trending search Url failed from '".concat(t,"'. Online status ").concat(r),f),n.isTSFallbackToANA=!0,n.Host.refreshCurrentPane(),[2,!1];case 7:return[2]}})})},i.prototype.isValidTSContent=function(n){var t;return(n===null||n===void 0?void 0:n.scenarios)&&(n===null||n===void 0?void 0:n.scenarios.length)>0&&((t=n.scenarios[0])===null||t===void 0?void 0:t.items)&&n.scenarios[0].items.length>0},i.prototype.setTSContentToCache=function(t){n.LightweightStorage.setItem(this.WSBTSCacheStorageKey,JSON.stringify(t))},i.prototype.loadTSContentFromWSBCache=function(){var t=n.LightweightStorage.getItem(this.WSBTSCacheStorageKey);return t?JSON.parse(t):null},i.prototype.loadTSContentFromDSBCache=function(){var i,r,u,f,e,h=n.LightweightStorage.getItem(n.config.dsbCacheKey),o,t,s;return h&&(o=JSON.parse(h),t=(u=(r=(i=o.response)===null||i===void 0?void 0:i.ContentCollection[0])===null||r===void 0?void 0:r.Data)===null||u===void 0?void 0:u.filter(function(n){return n.CardType==="Others"}),t&&(t===null||t===void 0?void 0:t.length)==1)?(s=(e=(f=t[0].Cards[0].FieldsStore)===null||f===void 0?void 0:f.Items)===null||e===void 0?void 0:e.map(function(n){var t,i,r,u;return{Query:n.Title,Thumbnail:{ThumbnailUrl:(t=n.Thumbnail)===null||t===void 0?void 0:t.ThumbnailUrl,ThumbnailId:(i=n.Thumbnail)===null||i===void 0?void 0:i.ThumbnailId,ThumbnailHeight:(r=n.Thumbnail)===null||r===void 0?void 0:r.ThumbnailHeight,ThumbnailWidth:(u=n.Thumbnail)===null||u===void 0?void 0:u.ThumbnailWidth}}}),{cacheTime:o.cacheTime,trendingSearchSuggestions:s?s:null}):null},i}(),i;n.TrendingSearchDataProvider=f;i=function(){function t(n){this._navigationHelper=n}return t.prototype.parse=function(t,i,r,u,f,e){for(var c,l=this,s=[],a=function(u){n.safeExecute(function(){return l.parseTrendingSearchDataSuggestion(t,u,r,i,f,s)},"parseTrendingSearchDataSuggestion "+r)},o=0,h=u.suggestions;o<h.length;o++)c=h[o],a(c);e(r,s,null)},t.prototype.parseTrendingSearchDataSuggestion=function(t,i,r,u,f,e){var a=this,s,h="TS",p=n.InstrumentedItem.createInstrumentedItem(u,h),c=i.Query,o,l;if(f()){if(o=n.createSuggestion(t,c,null,null,h,c,p,0,u,!1),n.config.enableThumbnailForTrendingSearchItems&&(l=(s=i.Thumbnail)===null||s===void 0?void 0:s.ThumbnailId,l)){var v=24,y=24,w=n.config.imageHostName+"".concat(l).concat(v?"&w=".concat(v):"").concat(y?"&h=".concat(y):"","&c=1&rs=1&p=0");o.icon={type:0,content:w}}o.reactKey="".concat(h," ").concat(c);o.click=n.config.enableMoreEdgeProtocol?function(){n.Host.launchSearch(o.query,a._navigationHelper.getSearchUrl(t.fullPartialQuery,o.query,o.type,null,o.handoffType,n.mapOSFormCode("SSHTRD")),o.useRaf,n.mapOSFormCode("SSHTRD"))}:function(){n.Host.launchSearch(o.query,a._navigationHelper.getSearchUrl(t.fullPartialQuery,o.query,o.type,null,o.handoffType,n.mapOSFormCode("SSHTRD")),o.useRaf)};e.push(o)}},t}();n.TrendingSearchDataParser=i})(WSB||(WSB={}))