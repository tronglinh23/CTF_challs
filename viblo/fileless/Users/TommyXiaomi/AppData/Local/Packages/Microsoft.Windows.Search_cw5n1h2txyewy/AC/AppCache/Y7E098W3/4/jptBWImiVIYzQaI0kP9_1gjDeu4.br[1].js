var WSB;(function(n){var i="ms-screenclip://?source=SearchBox&callbackformat=ms-search%3A%2F%2FSearch%2F%3FQuerySource%3DSearchButton%26form%3DWNSSBS",t="snipSearchPrivacyBubble",r=function(){function r(t,i,r){var u=this;this._page=t;this._navigationHelper=i;this._popoverFactory=r;this._imageProcessor=_w.ImageProcessor;n.Host.bindShown(function(){n.shouldEnableSnipSearch()&&SearchAppWrapper.CortanaApp.entryPoint=="WNSSBS"&&u.bingImageSearchCallbackV2()});n.Host.bindDismissed(function(){SearchAppWrapper.CortanaApp.entryPoint=="WNSSBS"&&u.updateMessage();u._imageSearchV2CancellationManager&&(u._imageSearchV2CancellationManager.cancelAll(!0),u.updateMessage())})}return r.prototype.getSnipSearchSyntheticSuggestion=function(r,u){var e=this,o,f;if(n.shouldEnableSnipSearch()){if(o=function(){return n.Host.launchUri(i,!0)},f=n.getSyntheticSuggestion(r,u,"SNSC",{type:2,content:"&#xE312"},2,null,!1,o),u!=this._lastSequenceNumber){var s=[{text:n.Host.getLocString("PrivacyPolicy"),id:t+"1",selected:!1,useAccentColor:!0,action:function(){return n.Host.launchUri("http://go.microsoft.com/fwlink/?LinkId=521839")},instItem:n.InstrumentedItem.getNonSuggestionInstrumentedItem("SNSP",n.SyntheticQSCodesMaps.KValues,19),sequenceNumber:u},{text:n.Host.getLocString("TermsOfUse"),id:t+"2",selected:!1,useAccentColor:!0,action:function(){return n.Host.launchUri("http://go.microsoft.com/fwlink/?LinkID=246338")},instItem:n.InstrumentedItem.getNonSuggestionInstrumentedItem("SNST",n.SyntheticQSCodesMaps.KValues,19),sequenceNumber:u}],h=function(){return e._popoverFactory.showPopover(n.Host.getLocString("SnipSearchPrivacyWarning"),s,_ge(t),!0,!0,"sspiPopover")},c=function(i,r){if(r==1){h();return}e._popoverFactory.showPopover(n.Host.getLocString("SnipSearchPrivacyWarning"),s,_ge(t),!0,!1,"sspiPopover")};n.addSubItemToSuggestion(f,t,"",n.View.InformationBubble,{onMouseEnter:c},null,!1,h,c);this._lastSequenceNumber=u}return f.text=n.Host.getLocString("SnipSearchButtonText"),f.tooltip=n.Host.getLocString("SnipSearchTooltipText"),f.staticGroupType=n.GroupType.VisualSearch,f}return null},r.prototype.updateMessage=function(t,i,r){t?this._page.updateSnipSearchMessageView({message:n.Host.getLocString(t),cancel:i,showSpinner:r}):this._page.updateSnipSearchMessageView(null)},r.prototype.bingImageSearchCallbackV2=function(){var t=this,i;this._imageSearchV2CancellationManager=new n.CancellationManager;this._imageSearchV2CancellationManager.register(function(){t._imageSearchV2CancellationManager=null;SearchAppWrapper.CortanaApp.dismissApp()},!0,"bingiscb2");n.Host.keepWSBOpen(!0);this.updateMessage("SnipSearchMessage",function(){return t._imageSearchV2CancellationManager.cancelAll(!1)},!0);i=function(){t.updateMessage("SnipSearchErrorMessage");n.Host.keepWSBOpen(!1)};n.Host.getBitmapURIFromClipboardAsync(function(n){n||i();t._imageProcessor.convertImageUriToBase64(n,function(n){return t.requestSearchUrlAndNavigate(n,i)},i)})},r.prototype.requestSearchUrlAndNavigate=function(t,i){var r={cancelled:!1,timer:0},u,f;this._imageSearchV2CancellationManager.register(function(){r.cancelled=!0;r.timer&&sb_ct(r.timer)},!1,"rsUrl_Nav");u=this.createMultipartBodyWithBase64(t);u?(f=n.getCurrentTime(),n.fetchUrlJson(this._navigationHelper.getImageSearchUrl(),{"content-type":u.contentType},u.data,function(t){if(!r.cancelled){if(t&&t.url){var u=Math.max(n.config.minDelayForSnipSearch-(n.getCurrentTime()-f),0);r.timer=n.safeSetTimeout(function(){n.Host.launchUri(t.url,!1,function(){},i)},u,"Bing screenshot image search");return}i()}},null,function(){return!0},!1,n.config.screenshotUrlRequestTimeout)):i()},r.prototype.createMultipartBodyWithBase64=function(n){var i="-------",r=";base64,",u=n?n.indexOf(r):-1,f,t;return u<0?null:(f=n.substr(u+r.length),t=i+"\r\n",t+='Content-Disposition: form-data; name="imageBin"\r\n',t+="\r\n",t+=f+"\r\n",t+=i+"\r\n",{data:t,contentType:"multipart/form-data; boundary="+i})},r}();n.ImageSearchViewModel=r})(WSB||(WSB={}))