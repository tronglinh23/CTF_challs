var WSB;(function(n){var t=function(){function t(t){var i=this;this._cache={};n.Host.bindAppHidden(function(){return i.clean(n.getCurrentDate())});t.bindItemLaunch(function(t){t.handoffType==0&&n.Host.canHaveSearchHistory()&&i.removeCachedResponsesForClick(t.query.toLocaleLowerCase())});this._TTL=n.config.inMemorySnRResponseCacheTTLSecs*1e3}return t.prototype.get=function(t){if(!t)return undefined;var i=this._cache[t.getCacheKey()],r=n.getCurrentDate();return this.responseIsValid(r,i)?(this.clean(r),i.response):undefined},t.prototype.put=function(t,i){if(t&&i){var r=n.getCurrentDate(),u={timestamp:r,response:i,queryText:t.queryToFetch.toLocaleLowerCase()};this._cache[t.getCacheKey()]=u;this._lastInsertDate=r;this._oldestInsertDate||(this._oldestInsertDate=r)}},t.prototype.clean=function(n){var f=this._oldestInsertDate?this.datesWithinTTL(n,this._oldestInsertDate):!1,u,t,r,i;if(f){if(u=!this.datesWithinTTL(n,this._lastInsertDate),u){this._cache={};this._oldestInsertDate=undefined;this._lastInsertDate=undefined;return}t=n;for(r in this._cache)i=this._cache[r],this.responseIsValid(n,i)?i.timestamp.getTime()<t.getTime()&&(t=i.timestamp):delete this._cache[r];this._oldestInsertDate=t}},t.prototype.removeCachedResponsesForClick=function(n){var r=!1,t,u,i;for(t in this._cache)u=this._cache[t].queryText,n.startsWith(u)&&(i=this._cache[t].timestamp,(i==this._oldestInsertDate||i==this._lastInsertDate)&&(r=!0),delete this._cache[t]);r&&this.resetOldestAndLastDates()},t.prototype.resetOldestAndLastDates=function(){var t,n;this._oldestInsertDate=undefined;this._lastInsertDate=undefined;for(t in this._cache)n=this._cache[t].timestamp,this._oldestInsertDate||(this._oldestInsertDate=n,this._lastInsertDate=n),this._oldestInsertDate>n&&(this._oldestInsertDate=n),this._lastInsertDate<n&&(this._lastInsertDate=n)},t.prototype.responseIsValid=function(n,t){if(!t)return!1;var i=t.timestamp;return this.datesWithinTTL(n,i)},t.prototype.datesWithinTTL=function(n,t){return n.getTime()-t.getTime()<=this._TTL},t}();n.InMemoryResponseCacheManager=t})(WSB||(WSB={}))