var WSB;(function(n){function u(t,r,u,f,e,o,s,h){i(t,r,u,t=>{var i=null;t.status==200&&(i=t.responseText?n.safeExecute(()=>JSON.parse(t.responseText),"JSON.parse"):{success:!0});f(i)},e,o,s,h)}function i(i,r,u,f,e,o,s,h,c,l,a){let v=c&&_w.XMLHttpRequest?new XMLHttpRequest:sj_gx();const p=l!==null&&l!==void 0?l:u?"POST":"GET";try{v.open(p,i,!0)}catch(w){SharedLogHelper.LogError("fetchUrl",i,w);f&&f({responseText:"",contentType:"",status:-1,result:3});return}if(r)for(let n in r)v.setRequestHeader(n,r[n]);let y;e&&(y=e.register(()=>v.abort(),!1,"xhr abort"));n.config.useEventListeners?(v.addEventListener("load",()=>{t(v,0,f,y,e,o,a)}),v.addEventListener("timeout",()=>{t(v,1,f,y,e,o,a)}),v.addEventListener("abort",()=>{t(v,2,f,y,e,o,a)}),v.addEventListener("error",()=>{t(v,3,f,y,e,o,a)})):(v.onreadystatechange=()=>{v.readyState==4&&v.status>0&&t(v,0,f,y,e,o,a)},v.ontimeout=()=>t(v,1,f,y,e,o,a),v.onabort=()=>t(v,2,f,y,e,o,a),v.onerror=()=>t(v,3,f,y,e,o,a));typeof s!="undefined"?v.withCredentials=s:v.withCredentials!==undefined&&(v.withCredentials=!0);h&&h>0&&(v.timeout=h);v.send(u)}function t(n,t,i,r,u,f,e){if(!f||f()){n.readyState==4&&(n.onreadystatechange=function(){});r&&u.unregister(r);let f={};e&&e.map(t=>f[t]=n.getResponseHeader(t));i&&i({responseText:n.responseText,contentType:n.getResponseHeader("content-type")||"",status:n.status,result:t,responseURL:n.responseURL,responseHeaders:f})}}function e(n){let t=n.IconContent;return t?t[0]=="S"?{content:t.slice(1),type:1}:{content:t,type:2}:n.Icon?{content:n.Icon,type:0}:null}n.fetchUrlJson=u;n.fetchUrl=i;class r{constructor(t){this._dataSource=t;this._delay=n.config.webDataSourcesWithThrottling[t]||0;this._timers=[]}getBaseUrl(){throw new Error("Not Implemented");}getPostBody(){return undefined}onBeforeFetchUrl(){}createUrl(t){return decodeURIComponent(this.getBaseUrl())+(t?n.encodeQueryParameter(t.queryToFetch.toLowerCase()):"")}addParamsToUrl(n,t){let i=t?Object.keys(t):[];return i.length>0&&(n+=n.includes("?")?"&":"?",n+=i.map(n=>n+"="+t[n]).join("&")),n}fetch(t,i,r,u,f,e,o,s,h,c){if(n.isDataSourceEnabled(this._dataSource,t)){let l=this.addParamsToUrl(this.createUrl(t),e);n.config.shGAWDx&&(t===null||t===void 0?void 0:t.fromSearchHome)&&(t===null||t===void 0?void 0:t.queryToFetch)==="Good news - MSN"&&(l="https://api.msn.com/news/feed?ocid=winsearch&market=en-us&query=good%20news&apikey=uvobH5fEn1uz1xwZ5yuwtWzu2y32WpRZ6EMpZx7o09");let a=this.getPostBody(t)||"";if(this._lastSequenceNumber!=r){for(let n of this._timers)sb_ct(n);this._timers=[];this._lastSequenceNumber=r}if(this._delay>0&&!t.isFormulatedQuery)this._timers.push(n.safeSetTimeout(()=>{this.onBeforeFetchUrl(r,l);this.fetchUrl(l,o,a,i,u,f,s,h,c)},this._delay,"fetchDelay"));else{this.onBeforeFetchUrl(r,l);this.fetchUrl(l,o,a,i,u,f,s,h,c)}}}fetchUrl(t,r,u,f,e,o,s,h,c){i(t,r,u,({responseText:r,contentType:i,status:u})=>{let e;u==200&&(n.TestHookUrlParameters&&r&&(r=r.replace(new RegExp("<!--[^]*?-->","gm"),"")),r&&i.includes("json")&&(e=n.safeExecute(()=>JSON.parse(r),"parseWebProviderResponse",null,t)));f(this._dataSource,e,u==200?null:u.toString())},this._delay>0?e:null,o,h,s,c)}}n.JsonDataProvider=r;class f extends r{getName(){return"AsSuggestionsDataProvider"}constructor(n){super("Web");this._responseCacheManager=n}getBaseUrl(){return n.config.u}onBeforeFetchUrl(t,i){n.InstrumentationHelper.instrumentSnRProviderFetchUrl(t,i)}fetch(t,i,r,u,f,e,o){if(n.isDataSourceEnabled(this._dataSource,t)){n.config.enableFetchStartLogging&&n.InstrumentationHelper.instrumentFetchProviderBegin(r,"ASDP:"+this._dataSource);let s=i;s=(r,u,f,e)=>{u&&n.isEmptyUrlPrefix(t)&&(u.Suggestions=[]),this.processResourceResponse(u),i(r,u,f,e)};this._responseCacheManager?this.fetchWithCache(t,s,r,u,f,e,o):super.fetch(t,s,r,u,f,e,o)}}fetchWithCache(t,i,r,u,f,e,o){let s=this._responseCacheManager.get(t);if(s){let h=this.addParamsToUrl(this.createUrl(t),e);this.onBeforeFetchUrl(r,h);if(i(this._dataSource,s,null,1),n.config.forceUseNifQF&&this._dataSource=="Web"){let s=n.deepCopy(e);s.wsbnoas="1";this.fetchWithoutCache(t,i,r,u,f,s,o)}}else{let s=()=>!0,n=i;n=(n,r,u)=>{f()&&i(n,r,u,0),t.queryToFetch&&this.responseIsValidForCaching(u,r)&&(r.ELToken&&(r=Object.assign({},r),delete r.ELToken),this._responseCacheManager.put(t,r))};super.fetch(t,n,r,u,s,e,o)}}fetchWithoutCache(n,t,i,r,u,f,e){let s=()=>!0,o=t;o=(n,i,r)=>{u()&&t(n,i,r,0)};super.fetch(n,o,i,r,s,f,e)}responseIsValidForCaching(n,t){const i="HS";return!n&&t&&t.Suggestions.every(n=>!n.InstantAnswer&&n.Attributes.stype!=i)}processResourceResponse(n){if(n){let t=n.Resources;if(t){this._downloadedStylesResources?this.updateWithDownloadedResources(t):this._downloadedStylesResources=t.Styles;let i={Styles:t.Styles,Scripts:null};JsonInject.WriteHeadAndBeforeContentResources(i)}}}updateWithDownloadedResources(n){for(let t in n.Styles)for(let i in n.Styles[t])this._downloadedStylesResources[t][i]?delete n.Styles[t][i]:this._downloadedStylesResources[t][i]=n.Styles[t][i]}}n.AsSuggestionsDataProvider=f;n.getIconFromOnlineResponse=e})(WSB||(WSB={})),function(n){var t;(function(t){function f(n,t,r,u,f){typeof indexedDB!="undefined"&&new i(n,f,t,r,u)}function e(n,t,r,u,f){typeof indexedDB!="undefined"&&new i(n,f,t,r,u)}function o(n,t,r,u,f,e){typeof indexedDB!="undefined"&&new i(n,e,t,r,u,f)}function s(n,t,r,u,f,e){typeof indexedDB!="undefined"&&new i(n,e,t,r,u,f)}function h(n,t,i){r(n,"deleteDatabase requested");try{let f=indexedDB.deleteDatabase(n);f.onsuccess=()=>{r(n,"deleteDatabase completed"),t&&t()};f.onerror=u("deleteDatabase.onError",t=>{SharedLogHelper.LogError("deleteDB",n,t),i&&i(t)})}catch(f){i&&i(f)}}function u(n,t){return i=>{let r=n;try{r+=" "+i.target.error.name}catch(u){}t(new Error(r))}}t.instanceWithNumberKeys=f;t.instanceWithStringKeys=e;t.instanceWithNumberKeysAndSecondaryKey=o;t.instanceWithStringKeysAndSecondaryKey=s;let r=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.dbTrace)?(t,i)=>n.log("["+t+"] "+i):()=>{};t.deleteDatabase=h;t.handleErrorEvent=u;class i{constructor(n,t,f,e,o,s){this._databaseName=n;this.onClosed=o;this._secondaryIndex=s;this._closePending=!1;this._storeName=n+"Store";r(this._databaseName,"open requested");let h;try{h=indexedDB.open(n,t||1)}catch(c){e(new Error("IndexedDbClientSideStorage.const: Could not open database"));return}h.onsuccess=n=>{this._database=n.target.result,i._allInstances.push(this),r(this._databaseName,"open completed"),f(this)};h.onupgradeneeded=n=>{r(this._databaseName,"upgrading");let t=n.target.result;t.objectStoreNames.contains(this._storeName)&&t.deleteObjectStore(this._storeName);let i=t.createObjectStore(this._storeName);this._secondaryIndex&&i.createIndex(this._secondaryIndex,this._secondaryIndex,{unique:!1})};h.onerror=u("open.onError",e);h.onblocked=u("open.onBlocked",e)}put(n,t,i,r){this.safeDbOperation("put",n.toString(),"readwrite",i,(i,r,u)=>{let f=i.put(t,n);f.onsuccess=r;f.onerror=u},r)}putMultiple(n,t,i){this.safeDbOperation("putMultiple",n.length.toString(),"readwrite",t,(t,i,r)=>{let u=0,f=()=>{if(u<n.length){let e=t.put(n[u].value,n[u].key);u+=1;e.onsuccess=u==n.length?i:f;e.onerror=r}};f()},i)}getValue(n,t,i){this.safeDbOperation("getValue",n.toString(),"readonly",n=>t(n.target.result),(t,i,r)=>{let u=t.get(n);u.onsuccess=i;u.onerror=r},i)}getRange(n,t,i,r){this.safeDbOperation("getRange","["+n+", "+t+")","readonly",i,(i,r,u)=>{let f=IDBKeyRange.bound(n,t,!1,!0);this.queryFromCursor(i.openCursor(f),r,u)},r)}getRangeOnSecondaryKey(n,t,i,r){this._secondaryIndex?this.safeDbOperation("getRangeOnSecondaryKey","["+n+", "+t+")","readonly",i,(i,r,u)=>{let f=i.index(this._secondaryIndex),e=IDBKeyRange.bound(n,t,!1,!0);this.queryFromCursor(f.openCursor(e),r,u)},r):r(new Error("getRangeOnSecondaryKey: Index name is missing"))}removeRange(n,t,i,r){this.safeDbOperation("removeRange","["+n+","+t+"]","readwrite",i,(i,r,u)=>{let f=IDBKeyRange.bound(n,t,!1,!0);this.removeFromCursor(i.openCursor(f),r,u)},r)}removeRangeOnSecondaryKey(n,t,i,r){this._secondaryIndex?this.safeDbOperation("removeRangeOnSecondaryKey","["+n+","+t+"]","readwrite",i,(i,r,u)=>{let f=i.index(this._secondaryIndex),e=IDBKeyRange.bound(n,t,!1,!0);this.removeFromCursor(f.openCursor(e),r,u)},r):r(new Error("removeRangeOnSecondaryKey: Index name is missing"))}getAll(n,t){this.safeDbOperation("getAll",null,"readonly",n,(n,t,i)=>this.queryFromCursor(n.openCursor(),t,i),t)}close(){r(this._databaseName,"close requested");this.innerClose()}innerClose(){if(i._requestsInProgress>0)r(this._databaseName,"delaying close because of "+i._requestsInProgress+" requests in progress"),this._closePending=!0;else for(let t of i._allInstances)t._database&&(n.safeExecute(()=>t._database.close(),this._databaseName+".close"),r(t._databaseName,"close completed"),t._database=null,t.onClosed())}queryFromCursor(t,i,r){let u=[];t.onsuccess=t=>{let r=t.target.result;r&&u.push({key:r.primaryKey,value:r.value});r&&u.length!=n.config.maxIndexedDBCursorIterations?r.continue():i(u)};t.onerror=r}removeFromCursor(t,i,r){let u=0;t.onsuccess=t=>{let r=t.target.result;r&&(r.delete(),u+=1);r&&u!=n.config.maxIndexedDBCursorIterations?r.continue():i(null)};t.onerror=r}safeDbOperation(n,t,f,e,o,s){r(this._databaseName,n+" requested"+(t?" "+t:""));i._requestsInProgress+=1;let c=u=>{r(this._databaseName,n+" completed "+(t?t+" ":"")),i._requestsInProgress-=1,e(u),this._closePending&&i._requestsInProgress==0&&this.innerClose()},h=n=>{i._requestsInProgress-=1,s(n),this._closePending&&i._requestsInProgress==0&&this.innerClose()};try{if(this._database){let t=this._database.transaction(this._storeName,f).objectStore(this._storeName);o(t,c,u(n+".onError",h))}else h(new Error(n+" Database not initialized"))}catch(l){h(l)}}}i._requestsInProgress=0;i._allInstances=[]})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(WSB||(WSB={})),function(n){var t;(function(t){const i=3;class r{constructor(t,i,r,u,f){this._storageFactory=t;this.createResponse=i;this.dataPopulated=r;this.getDataSourceState=u;this._dataSource=f;this._pendingQueries=[];this._storageOpenInProgress=!1;this._retryCount=0;n.Host&&(n.Host.bindAppVisible(()=>this.initStorage()),n.Host.bindDismissed(()=>this._pendingQueries=[]),n.Host.bindAppHidden(()=>this.teardownStorage()))}onAfterWrite(){if(this._writing=!1,this._pendingWrites.length>0){let n=this._pendingWrites.shift();n()}else this._tearDownPending&&this.teardownStorage()}teardownStorage(){this._writing?this._tearDownPending=!0:(this._tearDownPending=!1,this._storage&&this._storage.close())}initStorage(){!this._storageOpenInProgress&&this.dataPopulated()&&(this._storageOpenInProgress=!0,this._storageFactory(n=>{this._storage=n,this._storageOpenInProgress=!1,this._pendingQueries.forEach(n=>n()),this._pendingQueries=[]},n=>{this.onError(n,"open storage");this._storageOpenInProgress=!1;this._pendingQueries.forEach(n=>n());this._pendingQueries=[]},()=>this._storage=null))}static getUnixTime(t){return t||(t=n.getCurrentDate()),Math.round(t.getTime()/1e3)}onError(n,t){t!="open storage"&&SharedLogHelper.LogError(t,this._dataSource,n);this.teardownStorage()}reloadStorage(){this.teardownStorage();this.initStorage()}isReady(){return!!this._storage}getTimeout(t,i){return!t||(i===null||i===void 0?void 0:i.isSearchHomeZI)?n.config.latencyTimeoutForZeroInput:n.config.indexedDBTimeout}getKey(n){return this._dataSource=="ANA"?"anaheimData":n.queryToFetch?n.queryToFetch.toLocaleLowerCase():""}fetch(t,i,r,u,f){let o=n.getCurrentTime();if(n.config.enableFetchStartLogging&&n.InstrumentationHelper.instrumentFetchProviderBegin(r,"SBDP:"+this._dataSource),n.isDataSourceEnabled(this._dataSource,t)){this._dataSource=="ANA"&&(n.AnaheimDataProvider.InstrumentStringNumber.FTC=1);let e=(r,u)=>{let e=n.getCurrentTime()-o;n.InstrumentationHelper.instrumentPerfEvent(n.SequenceNumberManager.getSequenceNumber(),"Fetch"+this._dataSource,e);let s=u=="R";f()&&i(this._dataSource,this.createResponse(t,r,s),this.getDataSourceState(u))};this.innerQueryStorage(1,this.getKey(t),n=>e(n,"R"),()=>e(null,"E"),()=>e(null,"X"),()=>e(null,"T"),t)}}withStorage(n){return this._storage?(n(this._storage),!0):!1}getMaxKey(n){return n.slice(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)}getStorage(n,t,i,r){this.innerQueryStorage(null,null,t=>n(t),t,i,r)}queryStorage(n,t,i,r,u){this.innerQueryStorage(0,n,t,i,r,u)}innerQueryStorage(r,u,f,e,o,s,h){let c=null,l=!1,a=!0,v=()=>{if(a)if(a=!1,this._storage){let n=n=>{(n===null||n===void 0?void 0:n.message)==="NotFoundError"&&(this._retryCount+=1);c&&sb_ct(c);this.onError(n,"query");l||(l=!0,e())};r==0?this._storage.getValue(u,n=>{c&&sb_ct(c),l||(l=!0,f(n))},n):u?this._storage.getRange(u,this.getMaxKey(u),n=>{c&&sb_ct(c),l||(l=!0,f(n))},n):this._storage.getAll(n=>{c&&sb_ct(c),l||(l=!0,f(n))},n)}else c&&sb_ct(c),l||(l=!0,e())};if(this._storage)v();else if(this._retryCount<i)if(this.initStorage(),this._storageOpenInProgress)this._pendingQueries.push(v);else{o();return}else{this._retryCount=0;let i=n.DataProviderDBName[this.getName()];this.onError(new Error("Corrupted "+i+". Will delete and reloading."),"IndexDBCorruption");t.deleteDatabase(i);return}let y=this.getTimeout(u,h);y&&(c=n.safeSetTimeout(()=>{c=null,a=!1,l||(l=!0,s())},y,"innerQueryStorage"))}}t.StorageBasedDataProvider=r})(t=n.ClientSideStorage||(n.ClientSideStorage={}))}(WSB||(WSB={})),function(n){class t{constructor(n,t){this._navigationHelper=n;this._temporaryMessageHandler=t}parse(t,i,r,u,f,e,o){let s=[],h=[],c=[],l=[],a=[],v=[],y=[],p=[];if(u&&u.Suggestions)for(let r of u.Suggestions){let u=r.suggestionData;if(u.handoffType==2){if(n.isApp(u.type)){let n=u;h.push(n.id);a.push(r)}else if(n.isSetting(u.type)){let n=u;c.push(n.id);v.push(r)}else if(n.isFileOrFolder(u.type)){let n=u;l.push(n.id);y.push(r)}}else if(n.isBingEnabled()){let f=n.safeExecute(()=>this.parseMRUWebSuggestion(t,r,i),"parseMRUWebSuggestion");f&&(u.handoffType==0?p.push(f):s.push(f))}}r!="MWS"&&(n.lookupById(t,"MPP",h,a,n=>[n.suggestionData.id],"MST",c,v,n=>n.suggestionData.id,f,i,e,o,(n,r,u,f)=>this.parseIdLookupResponse(t,i,n,r,u,f),"MFF",l,y,n=>n.suggestionData.id),n.isDataSourceEnabled("MRS",t)&&e("MRS",p,u));e(r,s,u)}parseIdLookupResponse(t,i,r,u,f,e){let o=r.suggestionData;if((n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.mockMRUDataFile)&&f.length==0){const t={displayName:o.id,id:o.id,kind:"document",getProperty:null,propertyHits:[],rankScore:1e3};f.push(n.createLocalResponseSuggestionWithDeviceItemImage(t,o.type,u))}if(f.length==1){let s=n=>(this.setupRemoveFromHistoryContextMenu(n,r,t),n.lastLaunchTime=r.rankingData.lastLaunchTime,o.appContextData&&(n.appContext=o.appContextData.appContext,n.query=o.appContextData.query,n.text=t.queryToFetch?HitHighlightingParser.addMarkers(o.appContextData.textWithoutHH,t.queryToFetch):o.appContextData.textWithoutHH),this.setRankingSignals(n,o),!0);n.safeExecute(()=>n.parseLocalSuggestion(t,f[0],u,i,this._temporaryMessageHandler,o.type,e,s),"parseLocalSuggestion "+u)}}setRankingSignals(n,t){n.hc=t.hc;n.highConfidenceMetaSuggestionScore=t.highConfidenceMetaSuggestionScore;n.prefetchConfidenceScore=t.prefetchConfidenceScore;n.fromHistory=!0;n.hasMruData=!0}parseMRUWebSuggestion(t,i,r){let f=i.suggestionData,u=n.createSuggestion(t,t.queryToFetch?HitHighlightingParser.addMarkers(f.textWithoutHH,t.queryToFetch):f.textWithoutHH,null,f.icon,f.type,f.query,n.InstrumentedItem.createInstrumentedItem(r,f.type),f.handoffType,r,!1);u.lastLaunchTime=i.rankingData.lastLaunchTime;this.setRankingSignals(u,f);switch(u.handoffType){case 5:case 4:if(!n.isCortanaEnabledCache||u.type=="CSK")return null;let e=f;if(u.primaryMetadata=e.annotation||e.secondaryText,u.reactKey=u.type+u.primaryMetadata,!n.setCat1SuggestionProperties(u,t,r,e.actionUri,e.taskFrame,e.confidence,e.source))return null;break;case 3:case 10:return null;case 0:case 13:case 14:case 21:case 17:if(!(n.isDataSourceEnabled("MRS",t)||n.isDataSourceEnabled("MWS",t)))return null;let h=f;(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isWorkMruEnabled())&&t.isWorkScopeZI&&(u.handoffType==21||u.handoffType==17)?n.msbHost.qfUtils.setMsbMruSuggestionProperties(u,f):(!t.isSearchHomeZI||t.scope==n.Scope.Web&&n.config.enableZeroInputSearchHomeWeb||(u=this.setTextAndIconForLBSHSuggestion(u,h)),n.setWebSearchSuggestionProperties(u,t,r,h.url,this._navigationHelper));u.reactKey=this.generateReactKey(t,u);break;case 1:let o=f,c=i.rankingData;t.queryToFetch.length>3&&(u.autoOpenPreviewPaneWhenOnTopHit=!!c.previewPaneLaunchCount);let s=o.title||o.secondaryText;t.isSearchHomeZI&&s?(u.additionalInfoText=o.url,u.text=HitHighlightingParser.removeMarkers(s)):u.primaryMetadata=s;u.reactKey=o.type+o.url;n.setUrlSuggestionProperties(u,t,r,o.url);n.config.directNavPreviewPane&&u.type=="MD"&&u.url&&(u.getIcon=n.getFaviconUrlForRawUrl(u.url,64,64,1.5),t.isSearchHomeZI||(u.previewPaneType=2));break;default:return SharedLogHelper.LogError("parseMruWebSuggestion",null,new Error("Unexpected handoff type: "+f.handoffType)),null}return n.isValidSuggestion(u,"parseMruWebSuggestion")?(this.setupRemoveFromHistoryContextMenu(u,i,t),u):null}setTextAndIconForLBSHSuggestion(n,t){return n.text=t.query,n.icon=this.getIconForLBSHSuggestion(),n}getIconForLBSHSuggestion(){return n.config.disableMruLBSHColorfulIcon?{type:2,content:"&#xE721"}:{type:0,className:n.config.mirrorMruLBSHItemIcon?"LBSHSpyglassSV2":"LBSHSpyglass"}}setupRemoveFromHistoryContextMenu(t,i,r){n.RuntimeConfig.QfMode!=5&&n.RuntimeConfig.QfMode!=9&&i.remove&&n.setExtraVerbs(t,u=>{if(u||!i.remove)return[];if(!t.removeIcon&&t.duplicates&&t.duplicates.some(n=>!n.fromHistory))return[];const f=n.config.mruSearchHome&&(r.scope===n.Scope.All||r.scope===n.Scope.Work);let e={verb:f?"RemoveFromDeviceHistoryAll":"RemoveFromDeviceHistory",displayName:n.Host.getLocString("RemoveFromDeviceHistory"),executeSync:()=>{i.remove(()=>{n.Host.refreshCurrentPane(),f||this._temporaryMessageHandler.showTemporaryMessage(n.Host.getLocString("RemovedFromDeviceHistory",HitHighlightingParser.removeMarkers(t.text)))}),delete i.remove},icon:{content:"&#xE711",type:2}};return[e]},!0)}generateReactKey(n,t){return(n===null||n===void 0?void 0:n.isSearchHomeZI)?t.type+t.text:t.type+n.fullPartialQuery}}n.MRUParser=t}(WSB||(WSB={})),function(n){var t;(function(t){const u="LastUpdated",r="MRUNoItemsAvailable";class i extends n.ClientSideStorage.StorageBasedDataProvider{static getMRUInstrumentationStringMap(){return i._instrumentedStrings}getName(){return this.dataSource==="MWS"?"MRUWorkSearchDataProvider":"MRUDataProvider"}constructor(t,i,r,f,e,o,s,h,c){t&&(t.bindItemLaunch((n,t,i)=>this.storeSuggestionToMRU(n,t,i)),t.bindConversationEnds((n,t,i)=>this.storeSuggestionToMRU(n,t,i)));let l,a=(t,r,f)=>i(o,i=>{t(i);let r=n.getTimeDiffInDays(l);(r===null||r>=1)&&(l=n.getCurrentDate(),this.prune());this.getStorage(n=>this.instrumentMRUSize(n),()=>this.onAfterWrite(),()=>this.onAfterWrite(),()=>this.onAfterWrite())},r,f,u),v=(t,i,r)=>(n.MockUrlParameters&&(i=this.dataSource==="MWS"?n.MockedMSBMRUData:n.MockedMRUData),n.safeExecute(()=>this.createMruResponse(t,i,r),"createMruResponse")),y=()=>!0,p=n=>n=="R"?undefined:n;n.Host.bindClearMRURequested(t=>{this.teardownStorage(),n.ClientSideStorage.deleteDatabase(o,()=>t(!0),()=>t(!1))},o);super(a,v,y,p,c);this.dataSource=c;this.candidatesEnabled=s;this.loggingEnabled=h;this.getSuggestionKey=r;this.getGroupType=f;this.isMRUHistoryGroupType=e;this._pendingWrites=[];sj_evt.bind("clearMRUButtonClicked",()=>{n.ClientSideStorage.deleteDatabase(o),this.reloadStorage()})}createMruResponse(i,r,u){var o;r=r||[];let e=this.getKey(i);this._lastKey=u?e:null;let s=u?r.find(n=>n.key==e):null;this._valueForLastKey=s?s.value:null;let f={};if(n.config.mruSignalsEnabled&&this._valueForLastKey&&(f.SuggestionEngagementData=this._valueForLastKey.SuggestionEngagementData),f.LookupCompletions=r.map(n=>({key:n.key,value:n.value.SuggestionEngagementData})),this.candidatesEnabled()){let t=[],i=this.getOldestDateToKeep();for(let{key:u,value:n}of r)if(n.Suggestions)for(let r of n.Suggestions){let f=this.getRankingData(n,r);f&&f.lastLaunchTime&&f.lastLaunchTime>=i&&t.push({rankingData:u==this._lastKey?{prefixLaunchCount:f.prefixLaunchCount,lastLaunchTime:f.lastLaunchTime,previewPaneLaunchCount:f.previewPaneLaunchCount,lastPreviewPaneLaunchTime:f.lastPreviewPaneLaunchTime}:f,suggestionData:r,remove:n=>this.remove(u,r,n)})}t.length>0&&(f.Suggestions=[],t.sort((n,t)=>t.rankingData.lastLaunchTime-n.rankingData.lastLaunchTime),t.forEach(n=>this.addToResponseIfNotPresent(f.Suggestions,n)),e?e.length<=n.config.mruLengthA?f.Suggestions.splice(n.config.maxMruA):e.length<=n.config.mruLengthB&&f.Suggestions.splice(n.config.maxMruB):n.config.enableMRUDSBV2&&n.shouldShowDSBFullWidth()?f.Suggestions.splice(n.config.maxMruDSBV2):f.Suggestions.splice(n.config.maxMruZeroInput))}return n.config.enableMRUPerfPingTelemetry&&(t.MRUDataProvider._instrumentedStrings.MRURS=(o=f===null||f===void 0?void 0:f.Suggestions)===null||o===void 0?void 0:o.length.toString()),f}static removeRankerSignals(n,t){return n=="highConfidenceMetaSuggestionScore"||n=="prefetchConfidenceScore"?undefined:t}addToResponseIfNotPresent(n,t){let i=n.find(n=>n.suggestionData.suggestionKey==t.suggestionData.suggestionKey);if(i){let n=i.remove;i.remove=i=>n(()=>t.remove(i));i.rankingData.lastLaunchTime=Math.max(i.rankingData.lastLaunchTime,t.rankingData.lastLaunchTime);i.rankingData.prefixLaunchCount+=t.rankingData.prefixLaunchCount;t.rankingData.previewPaneLaunchCount&&(i.rankingData.previewPaneLaunchCount=(i.rankingData.previewPaneLaunchCount||0)+t.rankingData.previewPaneLaunchCount);t.rankingData.lastPreviewPaneLaunchTime&&(i.rankingData.lastPreviewPaneLaunchTime=i.rankingData.lastPreviewPaneLaunchTime?Math.max(i.rankingData.lastPreviewPaneLaunchTime,t.rankingData.lastPreviewPaneLaunchTime):t.rankingData.lastPreviewPaneLaunchTime)}else n.push(t)}addToDataIfNotPresent(n,t){let r=JSON.stringify(t,i.removeRankerSignals),u=n.find(n=>JSON.stringify(n,i.removeRankerSignals)==r);u||n.push(t)}isSuggestionGroupTypeSupported(t){return n.config.msbWorkScopeZiPageWorkMruEnabled||n.config.msbWorkSearchMruInShDsbEnabled?this.dataSource==="MWS"?n.isWorkScopeMruGroupType(t):!n.isWorkScopeMruGroupType(t):!0}storeSuggestionToMRU(n,t,i){if(this.isSuggestionGroupTypeSupported(n)&&this.loggingEnabled()){if(this._writing){this._pendingWrites.push(()=>this.storeSuggestionToMRU(n,t,i));return}this._writing=!0;let r=this.getKey(t);this._lastKey==r?this.updateAndSaveLaunchData(r,this._valueForLastKey,n,i):this.queryStorage(r,t=>this.updateAndSaveLaunchData(r,t,n,i),()=>this.onAfterWrite(),()=>this.onAfterWrite(),()=>this.onAfterWrite())}}remove(n,t,i){if(this._writing){this._pendingWrites.push(()=>this.remove(n,t,i));return}this._writing=!0;this._lastKey==n?this.removeAndSaveLaunchData(n,this._valueForLastKey,t,i):this.queryStorage(n,r=>this.removeAndSaveLaunchData(n,r,t,i),()=>this.onAfterWrite(),()=>this.onAfterWrite(),()=>this.onAfterWrite())}createOrUpdateDbEntry(t,i,u,f){i?(i.LastUpdated=n.ClientSideStorage.StorageBasedDataProvider.getUnixTime(),i.SuggestionEngagementData=i.SuggestionEngagementData||{}):i={LastUpdated:n.ClientSideStorage.StorageBasedDataProvider.getUnixTime(),SuggestionEngagementData:{}};let e=this.getSuggestionKey(u);if(i.SuggestionEngagementData[e]=this.updateMRUEntryClicksAndTime(i.SuggestionEngagementData[e],i.LastUpdated,f),this.getGroupType&&(i.SuggestionEngagementData[e].groupType=this.getGroupType(u)),n.LightweightStorage.getItem(r)=="1"&&this.isMRUHistoryGroupType&&this.isMRUHistoryGroupType(u)&&n.LightweightStorage.removeItem(r),this.candidatesEnabled()){let n=u.getMruData();n&&t&&(i.Suggestions||(i.Suggestions=[]),this.addToDataIfNotPresent(i.Suggestions,n))}return i}updateMRUEntryClicksAndTime(n,t,i){return n?(n.prefixLaunchCount+=1,n.lastLaunchTime=t):n={prefixLaunchCount:1,lastLaunchTime:t},i&&(n.previewPaneLaunchCount=(n.previewPaneLaunchCount||0)+1,n.lastPreviewPaneLaunchTime=t),n}getOldestDateToKeep(){let t=n.getCurrentDate();return t.setDate(t.getDate()-n.config.mruMaxAgeInDays),n.ClientSideStorage.StorageBasedDataProvider.getUnixTime(t)}updateAndSaveLaunchData(t,i,r,u){if(i=n.safeExecute(()=>this.createOrUpdateDbEntry(t,i,r,u),"createOrUpdateDbEntry"),!i){this.onAfterWrite();return}n.safeExecute(()=>this.removeOldLaunches(i,this.getOldestDateToKeep()),"removeOldLaunches");this._lastKey=t;this._valueForLastKey=i;this.withStorage(n=>n.put(t,i,()=>this.onAfterWrite(),n=>{this.onError(n,"updateAndSaveLaunchData");this.onAfterWrite()}))||this.onAfterWrite()}removeAndSaveLaunchData(n,t,i,r){if(!t){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("MRU entry not present"));this.onAfterWrite();return}let f=JSON.stringify(i),u=(t.Suggestions||[]).findIndex(n=>JSON.stringify(n)==f);if(u==-1){SharedLogHelper.LogError("removeAndSaveLaunchData",null,new Error("Suggestion not present in MRU"));this.onAfterWrite();return}t.Suggestions.splice(u,1);this._lastKey=n;this._valueForLastKey=t;this.withStorage(i=>i.put(n,t,()=>{r&&r(),this.onAfterWrite()},n=>{this.onError(n,"removeAndSaveLaunchData");this.onAfterWrite()}))||this.onAfterWrite()}getRankingData(n,t){return n.SuggestionEngagementData?n.SuggestionEngagementData[t.suggestionKey]:undefined}removeOldLaunches(n,t){if(n.Suggestions)for(let i=n.Suggestions.length-1;i>=0;--i){let r=this.getRankingData(n,n.Suggestions[i]),u=r?r.lastLaunchTime:null;(!u||u<t)&&n.Suggestions.splice(i,1)}this.removeOldEngagementData(n.SuggestionEngagementData,t)}removeOldEngagementData(n,t){if(n)for(let i in n){let r=n[i];if(r){let u=r.lastLaunchTime;(!u||u<t)&&delete n[i]}}}prune(n){if(this._writing){this._pendingWrites.push(()=>this.prune(n));return}this._writing=!0;this.withStorage(t=>t.removeRangeOnSecondaryKey(0,this.getOldestDateToKeep(),()=>{n&&n(),this.onAfterWrite()},n=>{this.onError(n,"MRUDataProvider prune");this.onAfterWrite()}))||this.onAfterWrite()}instrumentMRUSize(i){let r=0;for(let{value:n}of i)n.Suggestions&&(r+=n.Suggestions.length);n.config.enableMRUPerfPingTelemetry&&(t.MRUDataProvider._instrumentedStrings.MRUTQ=i.length.toString(),t.MRUDataProvider._instrumentedStrings.MRUTS=r.toString());let u={totalnumberOfEntries:i.length.toString(),totalNumberOfSuggestions:r.toString()};n.InstrumentationHelper.logClientInstEvent("ClientInst","MRUSize",null,u)}}i._instrumentedStrings={};t.MRUDataProvider=i})(t=n.MRU||(n.MRU={}))}(WSB||(WSB={})),function(n){var t;(function(t){function o(t,i){if(!i)throw new Error("Undefined query IQuery for data source: "+t);r||ft();let u=r[t];if(!u)throw new Error("Unsupported data source: "+t);if(n.config.indexerQuerySimplified&&t=="IFF"&&(i===null||i===void 0?void 0:i.queryToFetch.length)<=8)return u[4];let f=u.filter(n=>!n.enabled||n.enabled(i));if(f.length==0)throw new Error("No enabled strategies for data source: "+t);else if(f.length>1)throw new Error("Multiple strategies for data source: "+t);else return f[0]}function vr(n){return r||ft(),!!r[n]}function yr(n,t,i){if(!r||!r[i]||t.taskFrame)return!1;let u=o(i,t);return u.sfgaoFilter?!u.sfgaoFilter(n.getProperty("System.SFGAOFlags")):!1}function i(n,t){return n=di.concat(n),t&&(n=n.concat(gi)),n}function ft(){p=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getUserSID();let ut=0,lt=f(n.getKnownFolderPathLC(n.FOLDERID_Profile)),[ft,k]=oi(ut,p,!1),[o,t]=oi(ut,p,!0);tt=ft;gt=k;let et='"System.Kind" != ANY ARRAY['+rt.concat("link").map(n=>"'"+n+"'").join(", ")+"] AND "+ft,at="\"System.Kind\" = SOME ARRAY['program'] AND "+o,s='"System.Kind" != ANY ARRAY['+ti.map(n=>"'"+n+"'").join(", ")+"] AND "+o,d='"System.Kind" != ANY ARRAY['+ni.concat(rt).concat("folder").map(n=>"'"+n+"'").join(", ")+"] AND "+o,ii="\"System.Kind\" = SOME ARRAY['folder'] AND "+o,ot="\"System.Kind\" = SOME ARRAY['Music'] AND "+o,st="\"System.Kind\" = SOME ARRAY['Picture'] AND "+o,ht='"System.Kind" = SOME ARRAY['+it.map(n=>"'"+n+"'").join(", ")+"] AND "+o,ri="\"System.Kind\" != ANY ARRAY['game', 'calendar', 'web history', 'feed', 'contact', 'task', 'journal', 'note', 'instantmessage'] AND "+o,ui="SCOPE = 'file:"+lt+"' AND \"System.Kind\" = SOME ARRAY['folder'] AND "+o,fi=gr(p);r={};r.IFF=[{selectFields:i(e,!1),filterFieldsSets:[vt],mostRelevantProps:a,kindAndScopeClauses:et,sortClause:n.config.enableIndexerQueryExtensionSort?w(h):u,searchOptions:3,sfgaoFilter:k,enabled:t=>!!(t===null||t===void 0?void 0:t.queryToFetch)&&!n.supportsShortcuts("IFF",t)},{selectFields:i(e,!1),filterFieldsSets:[],mostRelevantProps:a,kindAndScopeClauses:et,sortClause:n.config.enableIndexerQueryExtensionSort?w(h):u,searchOptions:0,sfgaoFilter:k,enabled:t=>!(t===null||t===void 0?void 0:t.queryToFetch)&&!n.supportsShortcuts("IFF",t)},{selectFields:i(yt,!0),filterFieldsSets:[nr],mostRelevantProps:a,kindAndScopeClauses:s,sortClause:n.config.enableIndexerQueryExtensionSort?w(h):u,searchOptions:3,sfgaoFilter:t,enabled:t=>!!(t===null||t===void 0?void 0:t.queryToFetch)&&n.supportsShortcuts("IFF",t)},{selectFields:i(yt,!0),filterFieldsSets:[],mostRelevantProps:a,kindAndScopeClauses:s,sortClause:n.config.enableIndexerQueryExtensionSort?w(h):u,searchOptions:0,sfgaoFilter:t,enabled:t=>t&&!t.queryToFetch&&n.supportsShortcuts("IFF",t)},{selectFields:i(e,!0),filterFieldsSets:[tr],mostRelevantProps:a.concat(["System.Title"]),kindAndScopeClauses:s,sortClause:n.config.enableIndexerQueryExtensionSort?w(h):u,searchOptions:0,sfgaoFilter:t,enabled:t=>n.config.indexerQuerySimplified&&(t===null||t===void 0?void 0:t.queryToFetch.length)<=8&&!!(t===null||t===void 0?void 0:t.queryToFetch)}];r.MDOC=[{selectFields:i(v,!0),filterFieldsSets:[pt.concat(fr)],mostRelevantProps:b,kindAndScopeClauses:d,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:t=>(t===null||t===void 0?void 0:t.queryToFetch)&&n.config.minLengthForContentMatch&&(t===null||t===void 0?void 0:t.queryToFetch.length)>=n.config.minLengthForContentMatch},{selectFields:i(v,!0),filterFieldsSets:[pt],mostRelevantProps:b,kindAndScopeClauses:d,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:t=>(t===null||t===void 0?void 0:t.queryToFetch)&&(!n.config.minLengthForContentMatch||(t===null||t===void 0?void 0:t.queryToFetch.length)<n.config.minLengthForContentMatch)},{selectFields:i(v,!0),filterFieldsSets:[],mostRelevantProps:b,kindAndScopeClauses:d,sortClause:u,searchOptions:0,sfgaoFilter:t,enabled:n=>n&&!n.queryToFetch},];r.MPVD=[{selectFields:i(v.concat(y).concat(y),!0),filterFieldsSets:[g],mostRelevantProps:b,kindAndScopeClauses:ri,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:n=>!!(n===null||n===void 0?void 0:n.queryToFetch)}];r.MFOL=[{selectFields:i(er,!0),filterFieldsSets:[sr],mostRelevantProps:or,kindAndScopeClauses:ii,sortClause:u,searchOptions:3,sfgaoFilter:t}];r.MPHO=[{selectFields:i(nt,!0),filterFieldsSets:[hr],mostRelevantProps:wt,kindAndScopeClauses:st,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:n=>!!(n===null||n===void 0?void 0:n.queryToFetch)},{selectFields:i(nt,!0),filterFieldsSets:[],mostRelevantProps:wt,kindAndScopeClauses:st,sortClause:u,searchOptions:0,sfgaoFilter:t,enabled:n=>n&&!n.queryToFetch},];r.MVID=[{selectFields:i(y,!0),filterFieldsSets:[cr],mostRelevantProps:bt,kindAndScopeClauses:ht,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:n=>!!(n===null||n===void 0?void 0:n.queryToFetch)},{selectFields:i(y,!0),filterFieldsSets:[],mostRelevantProps:bt,kindAndScopeClauses:ht,sortClause:u,searchOptions:0,sfgaoFilter:t,enabled:n=>n&&!n.queryToFetch},];r.MMUS=[{selectFields:i(kt,!0),filterFieldsSets:[lr],mostRelevantProps:dt,kindAndScopeClauses:ot,sortClause:u,searchOptions:3,sfgaoFilter:t,enabled:n=>!!(n===null||n===void 0?void 0:n.queryToFetch)},{selectFields:i(kt,!0),filterFieldsSets:[],mostRelevantProps:dt,kindAndScopeClauses:ot,sortClause:u,searchOptions:0,sfgaoFilter:t,enabled:n=>n&&!n.queryToFetch},];r.IBA=[{selectFields:i(ir,!0),filterFieldsSets:[ur],mostRelevantProps:rr,kindAndScopeClauses:at,sortClause:u,searchOptions:3,sfgaoFilter:t}];r.MFF=[{selectFields:i(e,!1),filterFieldsSets:[ar],mostRelevantProps:null,kindAndScopeClauses:null,sortClause:null,searchOptions:0,sfgaoFilter:null}];r.LDIC=[{selectFields:i(e,!0),filterFieldsSets:[],mostRelevantProps:null,kindAndScopeClauses:ui,sortClause:u,searchOptions:0,sfgaoFilter:t}];r[ct]=[{selectFields:i(e,!0),filterFieldsSets:[],mostRelevantProps:null,kindAndScopeClauses:s,sortClause:u,searchOptions:0,sfgaoFilter:t}];r.ANA=[{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:fi,sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&!n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==0},{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==1},{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==2},{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==3},{selectFields:i(l,!1),filterFieldsSets:[],mostRelevantProps:[],kindAndScopeClauses:"",sortClause:c,searchOptions:0,sfgaoFilter:null,enabled:t=>n.isDataSourceEnabled("ANA",null)&&n.AnaheimDataProvider.isInitialized()&&t.anaheimStrategy==4},]}function pr(t,i,r,u,f){var e;return n.config.enableNaturalLanguageIndexerQuery?SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSqlFromNQSInput(t.queryToFetch).then(e=>{var o;return e&&e.length>0&&!n.config.enableNaturalLanguageIndexQueryCounterFactual?(n.InstrumentationHelper.notifyNaturalQuerySyntaxFetched(n.SequenceNumberManager.getSequenceNumber(),!0),Promise.resolve(e)):(n.InstrumentationHelper.notifyNaturalQuerySyntaxFetched(n.SequenceNumberManager.getSequenceNumber(),!1),ri((o=t===null||t===void 0?void 0:t.queryToFetch)!==null&&o!==void 0?o:"").then(n=>ot(t,n,i,r,u,f)))}):ri((e=t===null||t===void 0?void 0:t.queryToFetch)!==null&&e!==void 0?e:"").then(n=>ot(t,n,i,r,u,f))}function wr(n,t,i,r){let u=o(t,n),f="SELECT TOP "+i.length+" "+k(u.selectFields)+" FROM SystemIndex WHERE "+ru(u,i,r),e=st(r);return e!=""&&(f+=" AND "+e),f}function br(t,i){let r=o(t,null),e=n.config.maxDeviceItemCacheSize,u="SELECT TOP "+e+" "+k(r.selectFields)+" FROM SystemIndex WHERE ",f=st(i);return f!=""&&(u+=f+" AND "),u+r.kindAndScopeClauses}function kr(){let n=o(ct,null),t="WorkId, "+k(n.selectFields),i=n.kindAndScopeClauses;return"SELECT "+t+" FROM SystemIndex WHERE "+i+" ORDER BY "+n.sortClause}function dr(n,t){r&&r[n]&&r[n][t]&&(r[n][t].kindAndScopeClauses=nu(p,t))}function gr(t){let i=(n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getExpirationThreshold())?n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getExpirationThreshold():14,r='"System.DateCreated" > DATEADD(day, -'+i+", GETGMTDATE())",u="(SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Canary/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Dev/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Beta/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/Stable/Profiles/' OR SCOPE = 'winrt://{"+t+"}/LS/Desktop/Microsoft Edge/undefined/Profiles/')";return r+" AND "+u}function ii(t,i,r,u){let f="";return f+='"System.Link.TargetUrl" IS NOT NULL AND "System.Title" IS NOT NULL AND ',f+='"System.DateCreated" > DATEADD(day, -'+(n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getExpirationThreshold())+", GETGMTDATE()) AND (",f+=et(t,i,r,u),f+")"}function et(n,t,i,r){let u="";for(let f=0;f<i.length;f++){if(u+="SCOPE = 'winrt://{"+n+"}/LS/Desktop/Microsoft Edge/"+i[f].displayName+"/"+r.displayName+"/"+t+"/'",f==i.length-1)break;u+=" OR "}return u}function nu(t,i){let r=n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getAvailableChannels(),u=n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getSelectedProfile();if(r&&u)switch(i){case 1:return ii(t,"History",r,u);case 2:return et(t,"QuickLinks",r,u);case 3:return ii(t,"RecentlyClosed",r,u);case 4:return et(t,"Favorites",r,u)}return""}function ot(n,t,i,r,u,f){var h,c;let l=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getLCIDStringForText((h=n===null||n===void 0?void 0:n.queryToFetch)!==null&&h!==void 0?h:""),e=n.taskFrame?au(u,n.taskFrame.parsed,l):o(u,n),s="SELECT TOP "+r+" "+k(e.selectFields)+" FROM SystemIndex",a=uu(e,(c=n===null||n===void 0?void 0:n.queryToFetch)!==null&&c!==void 0?c:"",t,i,e.searchOptions,l,f);if(a!=""){s=s+" WHERE "+a;let n=st(f);n!=""&&(s+=" AND "+n)}return s+=" ORDER BY "+e.sortClause}function tu(n){if(n.kind=="link"||n.kind=="program"){let i=n.getProperty("System.Kind");for(var t=0;t<i.length;t++){let r=i[t];if(r=="program")return iu(n,r);if(r!="link"){let t={displayName:n.displayName,id:n.id,kind:r,getProperty:t=>n.getProperty(t),propertyHits:n.propertyHits,rankScore:n.rankScore,getImageAsync:t=>n.getImageAsync(t),imageType:n.imageType,canHaveContextMenu:n.canHaveContextMenu,getVerbsAsync:()=>n.getVerbsAsync(),extension:n.extension,itemTypeDisplayName:n.itemTypeDisplayName,createdDate:n.createdDate,lastModifiedDate:n.lastModifiedDate};return t.originalDeviceItem=n,t}}}return n}function iu(t,i){let r=t.displayName;r.toLocaleLowerCase().endsWith(".lnk")&&(r=r.substr(0,r.length-4));let u=n.indexerFilePathToRegularPath(t.id),f={displayName:r,id:u,kind:i,getProperty:n=>t.getProperty(n),propertyHits:t.propertyHits,rankScore:t.rankScore,getImageAsync:n=>t.getImageAsync(n),imageType:t.imageType,canHaveContextMenu:t.canHaveContextMenu,getVerbsAsync:()=>t.getVerbsAsync(),extension:t.extension,itemTypeDisplayName:t.itemTypeDisplayName,createdDate:t.createdDate,lastModifiedDate:t.lastModifiedDate,filePath:u,lastAccessed:t.getProperty("System.DateAccessed"),version:null,isImmersive:!1,logoBackgroundColor:null,launchArguments:null,totalLaunches:null,isTrustedApp:!1,packageFamilyName:null,jumpList:null,getJumpListAsync:null,voiceCommandExamples:null,rawIndexResponse:null};return f.originalDeviceItem=t,f}function k(n){return n.map(n=>n=="System.ParsingPath"?"path":`"${n}"`).join(",")}function st(t){return n.config.useWhereId&&t?"ReuseWhere("+t+") ":""}function ru(n,t){return"("+eu(n,t)+")"}function uu(n,t,i,r,u,e){let o="";n.mostRelevantProps.length>0&&(o+="WITH ("+n.mostRelevantProps.join(", ")+") AS #MRProps ");let s=ou(n,t,i,u,e);s&&(o+="("+s+") AND ");let h=r?f(r):r;return h&&(o+="(Scope = '"+h+"') AND "),o+n.kindAndScopeClauses}function fu(n,t){return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.tokenize(n,t)}function ri(n){return SearchAppWrapper.CortanaApp.queryFormulationView.getLinguisticDataAsync(n)}function ui(t,i){let r="",u=t.filterFieldsSets.length>1;return t.filterFieldsSets.forEach(t=>{u&&(r?r+=") AND (":r="(");let f=!0;for(let u of t){let t=!1;for(let e of i)f?(r+="(",f=!1):r+=t?" OR ":" OR (",r+=n.formatString(u,[e]),t=!0;t&&(r+=")")}}),u&&(r+=")"),r}function eu(t,i){let r=[];return r=n.config.disableMRUFilesAndFoldersWildCards?i.map(n=>f(n)):i.map(n=>ht(n)),ui(t,r)}function ou(n,t,i,r,u){let e=[t];(i===null||i===void 0?void 0:i.alternatives)&&i.alternatives.forEach(n=>e.push(n));let o=e.map(n=>ht(n)),f=ui(n,o);return(r&2)==2&&(f=su(r,i,o,f,u)),f}function su(t,i,r,u,f){let o=hu(t),e=!1;for(let s of o){let o=!1;for(let h of r){let c=[],r=fu(h,i.language);if(e&&n.config.indexerQueryMWLimit){if((t&4)==0||r.length<=n.config.indexerQueryMWLimit)for(let t=0;t<Math.min(r.length,n.config.indexerQueryMWLimit);++t)c.push(r[t])}else if((t&4)==0||r.length<=at)for(let n=0;n<Math.min(r.length,at);++n)c.push(r[n]);if(c.length>1){let t="";for(let n of c)t&&(t+=" AND "),t+='"'+n+(e?'*"':'"');u?u+=o?" OR ":" OR (":u="(";u+=n.formatString(s,[t,f]);o=!0}}o&&(u+=")");e=!e}return u}function hu(n){let t=[];return t.push("CONTAINS(#MRProps, '{0}', {1}) RANK BY COERCION(ABSOLUTE, 600)"),(n&1)==1&&t.push("CONTAINS(#MRProps, '{0}', {1}) RANK BY COERCION(ABSOLUTE, 550)"),t}function fi(n,t){return n.length>0&&(n=n.replace(/'/g,"''"),n=n.replace(/"/g," "),t>=2&&(n=n.replace(/%/g,"[%]"),n=n.replace(/_/g,"[_]"),n=n.replace(/\[/g,"[[]"),t==3?(n=n.replace(/\*/g,"%"),n=n.replace(/\?/g,"_")):(n=n.replace(/\*/g," "),n=n.replace(/\?/g," ")))),n}function f(n){return fi(n,1)}function ht(n){return fi(n,2)}function cu(n){let t=d[n];if(t)return t;throw new Error("select fields for NL Data source was not found: "+n);}function s(n,t,i,...r){typeof i=="string"?(i=ht(i),t.push(r.map(t=>`CONTAINS(${t},'"${i}*"',${n}) RANK BY COERCION(ABSOLUTE, 1000)`))):i&&i.Value&&s(n,t,i.Value,...r)}function au(n,t,i){let f=[],e='"System.Kind" != ANY ARRAY['+ut+"]";if(t.FileType&&t.FileType.Value){let n=t.FileType.Value;switch(n){case"Document":break;case"Picture":e="\"System.Kind\" = SOME ARRAY['Picture']";break;case"Video":e='"System.Kind" = SOME ARRAY['+it.map(n=>"'"+n+"'").join(", ")+"]";break;case"Powerpoint":case"Word":case"Excel":e="CONTAINS(System.ItemType,'\""+lu[n]+"*\"',"+i+') RANK BY COERCION(ABSOLUTE, 1000) AND "System.Kind" != ANY ARRAY['+ut+"]";break;default:e='"System.Kind" != ANY ARRAY['+ut+"]";s(i,f,n,"System.ItemType","System.ItemTypeText")}}s(i,f,t.Title,"System.ItemNameDisplay","System.Title");s(i,f,t.Body,"System.ItemNameDisplay","System.Title","System.FileDescription","System.Keywords","System.Search.Contents");t.People&&t.People.forEach(n=>{let t=n.Value;t&&s(i,f,t=="me"?SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.userName:t,"System.Author","System.FileOwner","System.Document.LastAuthor","System.Photo.TagViewAggregate")});s(i,f,t.Place,"System.Photo.TagViewAggregate");let r=vu(t.Time);r&&f.push(["System.DateCreated>='"+r[0]+"' AND System.DateCreated<'"+r[1]+"'","System.DateModified>='"+r[0]+"' AND System.DateModified<'"+r[1]+"'","System.DateAccessed>='"+r[0]+"' AND System.DateAccessed<'"+r[1]+"'","System.DateArchived>='"+r[0]+"' AND System.DateArchived<'"+r[1]+"'","System.DateAcquired>='"+r[0]+"' AND System.DateAcquired<'"+r[1]+"'",]);return{selectFields:cu(n),filterFieldsSets:f,kindAndScopeClauses:e?e+" AND "+tt:tt,mostRelevantProps:[],searchOptions:0,sortClause:u,sfgaoFilter:gt}}function vu(t){if(!t)return null;let i=t.value;if(!i)return null;let f=i.indexOf("T");f!=-1&&(i=i.substr(0,f));let u=i.split("-");if(u.length<2||u.length>3)return null;let e=new Date(i);if(!n.isValidDate(e))return null;let r=new Date(i);return u.length==3?r.setUTCDate(r.getUTCDate()+1):r.setUTCMonth(r.getUTCMonth()+1),[ei(e),ei(r)]}function ei(n){let t=n.toISOString();return t.substr(0,t.indexOf("T"))}function oi(t,i,r){let u,e;r||(u="NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['hidden'] AND NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['system'] AND NOT System.Shell.SFGAOFlagsStrings = SOME ARRAY['link']");r?e=n=>!(n&pi)&&!(n&yi)&&(!!(n&&wi)||n&&ki&&!!(n&&lt)||n&&bi&&!!(n&&lt)):(u+=" AND (System.Shell.SFGAOFlagsStrings = SOME ARRAY['stream']",u+=" OR (System.Shell.SFGAOFlagsStrings = SOME ARRAY['fileanc'] AND System.Shell.SFGAOFlagsStrings = SOME ARRAY['folder'])",u+=" OR (System.Shell.SFGAOFlagsStrings = SOME ARRAY['storageanc'] AND System.Shell.SFGAOFlagsStrings = SOME ARRAY['folder'])",u+=")");r?u="System.Shell.OmitFromView != 'true'":u+=" AND System.Shell.OmitFromView != 'true'";let o=f(n.getKnownFolderPathLC(n.FOLDERID_Profile));switch(t){case 0:let e=f(n.getKnownFolderPathLC(ci));u+=" AND (Scope = 'file://' OR Scope = 'csc://{"+i+"}') AND (Scope <> 'file:"+o+"\\AppData') AND (Scope <> 'file:"+e+"\\Default\\AppData') AND (Scope <> 'file:"+e+"\\Administrator\\AppData')";let s=f(n.getKnownFolderPathLC(si)),h=f(n.getKnownFolderPathLC(hi));u+=" AND (Scope <> 'file:"+s+"')";h!=s&&(u+=" AND (Scope <> 'file:"+h+"')");let c=f(n.getKnownFolderPathLC(li));u+=" AND (Scope <> 'file:"+c+"')";let l=f(n.getKnownFolderPathLC(ai));if(u+=" AND (Scope <> 'file:"+l+"')",r){let t=f(n.getKnownFolderPathLC(vi));u+=" AND (Scope <> 'file:"+t+"')"}break;case 1:u+=" AND (Scope = 'file://' OR Scope = 'csc://{"+i+"}')";break;default:throw new Error("Unknown SearchScope: "+t);}return[u,e]}function w(n){let t="CASE ",i=1;for(let r of n)t+="WHEN 'System.FileExtension' = "+r+" THEN "+i.toString()+" ",i+=1;return t+="ELSE 999 END ASC, "+u}const ct="PRIME",si="{905e63b6-c1bf-494e-b29c-65b732d3d21a}",hi="{7C5A40EF-A0FB-4BFC-874A-C0F2E0B9FA8E}",ci="{0762D272-C50A-4BB0-A382-697DCD729B80}",li="{A4115719-D62E-491D-AA7C-E74B8BE3B067}",ai="{0482af6c-08f1-4c34-8c90-e17ec98b1e17}",vi="{bfb9d5e0-c6a9-404c-b2b2-ae6db6af4968}",yi=4096,pi=524288,wi=4194304,lt=536870912,bi=8388608,ki=268435456,at=3,u='"System.Search.Rank" DESC, "System.DateModified" DESC, "System.ItemNameDisplay" ASC',h=['".exe"','".xlsx"','".lnk"','".docx"','".xls"','".doc"','".bat"','".pptx"','".pdf"','".txt"',],di=["System.Kind","System.Search.Rank","System.ParsingPath","System.DateCreated","System.DateModified","System.Search.QueryPropertyHits","System.ItemNameDisplay","System.FileExtension","System.ItemType",],gi=["System.Link.TargetParsingPath","System.SFGAOFlags",],c='"System.DateCreated" DESC, "System.Link.DateVisited" DESC, "System.History.VisitCount" DESC, "System.History.SelectionCount" DESC',l=["System.ApplicationName","System.Document.Version","System.Identity","System.Status","System.ContentType","System.ProviderItemID","System.Link.TargetUrl","System.Title","System.Link.DateVisited","System.History.VisitCount","System.History.SelectionCount",],e=["System.Title","System.Music.AlbumTitle","System.Music.DisplayArtist"],a=["System.ItemNameDisplay","System.Music.DisplayArtist","System.Music.AlbumTitle",];let vt=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 960)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 760)","CONTAINS(System.Music.AlbumTitle, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 660)",];const yt=e.concat("System.DateAccessed"),nr=vt.concat(["CONTAINS(System.Link.TargetParsingPath, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 920)"]);let tr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 960)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 860)","CONTAINS(System.Link.TargetParsingPath, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 920)",];const ir=["System.DateAccessed",],rr=["System.ItemNameDisplay",];let ur=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Link.TargetParsingPath, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 795)",];const v=["System.Search.AutoSummary","System.Keywords","System.Title","System.Author","System.Document.LastAuthor",],b=["System.ItemNameDisplay","System.Keywords","System.Title",];let g=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Photo.TagViewAggregate, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)",];n.config.onlyWhereContains||(g=g.concat(["System.ItemNameDisplay = '{0}' RANK BY COERCION(ABSOLUTE, 999)","System.Title = '{0}' RANK BY COERCION(ABSOLUTE, 980)","System.Keywords = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Photo.TagViewAggregate = '{0}' RANK BY COERCION(ABSOLUTE, 940)","System.Music.DisplayArtist = '{0}' RANK BY COERCION(ABSOLUTE, 960)","System.Music.Genre = '{0}' RANK BY COERCION(ABSOLUTE, 950)",]));let pt=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)",];const fr="CONTAINS(System.Search.Contents, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 545)",er=[],or=["System.ItemNameDisplay",];let sr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)",];const nt=["System.Photo.TagViewAggregate","System.Title",],wt=["System.ItemNameDisplay","System.Photo.TagViewAggregate",];let hr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Photo.TagViewAggregate, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)",];const y=["System.Title","System.Keywords","System.Music.DisplayArtist","System.Music.Genre",],bt=["System.ItemNameDisplay","System.Title","System.Keywords",];let cr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)","CONTAINS(System.Keywords, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 835)",],kt=["System.Title","System.Music.DisplayArtist","System.Music.AlbumTitle","System.Music.Genre",];const dt=["System.ItemNameDisplay","System.Title","System.Music.AlbumTitle",];let lr=["CONTAINS(System.ItemNameDisplay, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 895)","CONTAINS(System.Title, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 875)","CONTAINS(System.Music.AlbumTitle, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 865)","CONTAINS(System.Music.DisplayArtist, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 855)","CONTAINS(System.Music.Genre, '\"{0}*\"') RANK BY COERCION(ABSOLUTE, 845)",];const ar=["path = '{0}'"];let r;t.getStrategy=o;t.dataSourceSupported=vr;t.suppress=yr;let p,tt,gt;const it=["Movie","RecordedTV","Video"],ni=it.concat(["Picture","Music"]),ti=["calendar","game","web history","feed","contact","task","journal","note","instantmessage"],rt=ti.concat("program"),ut=ni.concat(rt).concat(["folder","link"]).map(n=>"'"+n+"'").join(",");t.initStrategies=ft;t.generateIndexerQueryAsync=pr;t.generateIndexerQueryForMRUFilesAndFolders=wr;t.generateIndexerQueryForDeviceItemCache=br;t.generateIndexerPrimerQuery=kr;t.updateAnaheimStrategy=dr;t.generateIndexerQuery=ot;t.fixKind=tu;let d={};d.MPHO=i(nt,!1);d.MVID=i(y,!1);d.MDOC=i(v,!1);const lu=(()=>{let n={};return n.Powerpoint="ppt",n.Word="doc",n.Excel="xls",n})()})(t=n.IndexerQueryGenerator||(n.IndexerQueryGenerator={}))}(WSB||(WSB={})),function(n){function l(t,i,r,u,f,e,o,s){let h=u?r+" "+i:r;return n.Async.safeChainWithGlobalCaching("getIcon",i=>t.getImageAsync(n.getImageSizeValue(i)),n=>n+"_"+i,t=>n.toIcon(t,"getIcon.toIcon",e,o,h),e,f?()=>(t===null||t===void 0?void 0:t.imageType)===0:null,h,null,s)}function i(t,i,r,u,f,e){return{deviceItem:t,getIcon:l(t,t.id,r,r&&!n.localDataSourceMayContainPII(r),n.displayedInGridLayout(i),u,f,0),icon:e?u:null,suggestionType:i}}function a(n,t,i){return{deviceItem:n,icon:i,suggestionType:t}}function ht(n){return n.map(n=>({isSimulated:!0,displayName:n,id:null,kind:null,getProperty:null,propertyHits:null,rankScore:null}))}function v(){n.config.enableFetchStartLogging&&n.InstrumentationHelper.instrumentFetchProviderBegin(n.SequenceNumberManager.getSequenceNumber(),"TOPP");let t=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getAllAppsAsync();return t.then(t=>{let i=[];for(let r in t){let u=t[r];u&&(n.config.allowZeroLaunchTopApps||u.totalLaunches>0)&&!n.contains(st,u.id)&&i.push(u)}return n.config.minTopApps&&i.length<n.config.minTopApps?[]:i}).then(n=>n).then(n=>n).then(t=>{return t.sort((t,i)=>t.totalLaunches!==0||i.totalLaunches!==0?i.totalLaunches-t.totalLaunches:n.contains(e,t.id)?n.contains(e,i.id)?e.indexOf(t.id)-e.indexOf(i.id):-1:n.contains(e,i.id)?1:0),[].concat(t)})}function r(t,i,r){switch(t){case"program":return"IBA";case"picture":return i&&n.contains(ct,i.toLowerCase())?"FL":"LI";case"video":return i&&n.contains(lt,i.toLowerCase())?"FL":"LV";case"movie":case"recordedtv":return"LV";case"music":return"MU";case"folder":return"FD";default:return r}}function s(t,i,r,u,f,e,o,s,h){let l=o&&h?t.filter(t=>n.contains(Object.keys(nt),t)):[];l.length>0&&(t=t.filter(t=>!n.contains(l,t)));let c=t=>{for(let i of l){let r=nt[i];t[i]={deviceItem:{id:i,displayName:n.Host.getLocString(r.locStringKey),kind:null,getProperty:()=>null,propertyHits:[],rankScore:1e3},icon:r.icon}}i(t)};n.safeExecute(()=>{if(t.length==0)c({});else{let h={},i=t.slice(0);if(s)for(let n=t.length-1;n>=0;--n){let r=t[n];s.hasOwnProperty(r)&&(h[r]=s[r],i.splice(n,1))}if(i.length==0)c(h);else{let l=!o||n.localDataSourceMayContainPII(o)?o:o+" "+i;n.Async.safeChain(r,()=>u(i),r=>{let u=n.Map.map(i,r,n=>f(n));if(s&&i.forEach(n=>s[n]=u[n]),i.length!=t.length)for(let n in h)h.hasOwnProperty(n)&&(u[n]=h[n]);c(u)},()=>c({}),e,l)}}},"resolveIdsWithCache",null,o,()=>c({}))}function pt(n,t){if(!t.launchArguments||yt.test(n.query))return!0;let i=t.id.toLowerCase();return tt.some(n=>i.includes(n))?!0:!1}function it(t,i,r,u,f){if(!f)return!1;let o=t.displayName.toLocaleLowerCase(),e=i.queryToFetch.toLocaleLowerCase(),s=null;if(f.Parses&&f.Parses.length>0&&f.Parses[0].SubParses&&f.Parses[0].SubParses.length>1&&f.Parses[0].SubParses[0].Interpretation&&f.Parses[0].SubParses[0].Interpretation==="regex"&&e.length>=f.Parses[0].SubParses[0].QueryEnd&&f.Query!=null){if(e.length===f.Parses[0].SubParses[0].QueryEnd)return!0;e=e.substr(f.Parses[0].SubParses[0].QueryEnd+1);f.Query=f.Query.substr(f.Parses[0].SubParses[0].QueryEnd+1)}return e.length<n.config.filterCICandidatesPrefixLength&&!rt(e,o)&&(s=n.matchesOnPropertyHH(o,e),!s)?!0:dt(o,e,t,r,u,f)?!0:!1}function dt(t,i,r,u,f,e){if(!i||!e||!e.MatchScore||!e.Parses||e.Parses.length==0||!e.Parses[0].Entities||e.Parses[0].Entities.length==0||!e.Query||t.startsWith(i)&&i.length>=n.config.filterCICandidatesPrefixLength)return!1;let o=e.Query;if(o.startsWith(i)||n.config.bypassCIFilterOnSubstringMatch&&t.split(" ").some(n=>n.startsWith(i)))return!1;let s=t.startsWith(o);if(!s)return!0;return f.Counter>=1?!0:(f.Counter++,!1)}function rt(n,t){if(!!t&&t.length==0)return!1;let i=t.split(" ");if(n.length!=i.length)return!1;for(let t=0;t<i.length;t++)if(i[t].length==0||i[t][0]!=n[t])return!1;return!0}function ut(n){let i=n.id.toLowerCase();if(i.startsWith("http:")||i.startsWith("https:")||n.kind=="link"&&i.endsWith(".url"))return 1;if(i.startsWith("file:")||n.kind=="document")return 0;let t=n.filePath;if(t&&(t=t.toLowerCase(),t!=i)){if(t.startsWith("http:")||t.startsWith("https:")||n.kind=="link"&&t.endsWith(".url"))return 1;if(t.startsWith("file:"))return 0}return 2}function ft(n,t){if(t.dataSource=="PP"){let t=ut(n);if(t==1)return"LURL";if(t==0)return"LDOC"}return t.getSuggestionType(n)}function et(t){return t&&t.rawIndexResponse?n.safeExecute(()=>JSON.parse(t.rawIndexResponse),"parseConstraintIndexMetaData"):undefined}function ot(t,i,r,u,f,e){if(n.IndexerQueryGenerator&&n.IndexerQueryGenerator.suppress(i,t,u))return!0;if(r=="PP"){let h=i.id;if(n.contains(wt,h))return!0;let o=i;if(it(o,t,!0,f,e))return!0;let r=i.kind;if(r&&(r=r.toLocaleLowerCase(),r!="program"&&r!="unknown")||u=="LRA"&&ut(o)!=2)return!0;let s=o.extension;return s&&s.toLowerCase()==".chm"?!0:!1}if(r!="LURL"&&i.kind=="link"&&n.RuntimeConfig.QfMode!=5)return!0;if(n.isSetting(r))return it(i,t,!1,f,e)?!0:!1;let s=i;if(!n.IndexerQueryGenerator&&u=="MDOC"&&s.propertyHits.length==1&&s.propertyHits[0]=="System.Search.Contents"&&(!n.config.minLengthForContentMatch||t.queryToFetch.length<n.config.minLengthForContentMatch))return!0;let o=s.id;if(o&&(n.RuntimeConfig.QfMode!=5&&(o.includes("\\.")||o.includes("/."))||(o=o.toLowerCase(),t.queryToFetch.toLocaleLowerCase()!=i.displayName.toLocaleLowerCase()&&kt.some(n=>o.includes("\\"+n+"\\")||o.includes("/"+n+"/")))))return!0;let h=s.extension;if(h&&n.RuntimeConfig.QfMode!=5&&!t.queryToFetch.toLowerCase().includes(h.toLowerCase())&&n.contains(bt,h.toLowerCase()))return!0;if(r=="CG"){let r=i,t=r.displayName.split(" ")[0].toLowerCase();if(t.includes("\\")||t.indexOf(":")==1)return!1;let u=r.id.toLowerCase(),f=u.lastIndexOf("."),e=u.lastIndexOf("\\"),o=r.kind=="folder"||f<0||f<e;if(o&&!t.includes("%")||![".exe",".com"].some(n=>t.includes(n))&&(at.some(n=>u.includes(n))||!r.launchArguments&&tt.some(n=>u.includes(n))||n.contains(vt,t)))return!0}return!1}const h=":wux:",c="Classic_{87d66a43-7b11-4a28-9811-c86ee395acf7}",st=["Microsoft.XboxGamingOverlay_8wekyb3d8bbwe!App"],e=["Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge","windows.immersivecontrolpanel_cw5n1h2txyewy!microsoft.windows.immersivecontrolpanel","Microsoft.WindowsCalculator_8wekyb3d8bbwe!App","Microsoft.ScreenSketch_8wekyb3d8bbwe!App","{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}\\mspaint.exe","{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\mspaint.exe"];n.getIcon=l;n.createLocalResponseSuggestionWithDeviceItemImage=i;n.fetchForTopLocalApps=v;const ct=[".dwg",".ai",".psd"],lt=[".ts"];n.getSuggestionTypeFromKindAndExtension=r;const y={getResultsContainer:n=>n.apps,dataSource:"PP",getSuggestionType:()=>"PP",maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Apps].icon,t.isImmersive?t.logoBackgroundColor:undefined),supportsEmptyQuery:!0},p={getResultsContainer:n=>n.settings,dataSource:"ST",getSuggestionType:()=>"ST",maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>{if(n.isModernSetting(t)){let i=t.glyph,u;return u=n.config.useCobaltCSS&&t.glyphFontFamily==="Settings Fluent Icons"?{content:i,type:8}:i?{content:i,type:1}:n.ScopeConfig[n.Scope.Settings].icon,a(t,r,u)}return i(t,r,u,n.ScopeConfig[n.Scope.Settings].icon)},supportsEmptyQuery:!1},w=[y,p,{getResultsContainer:n=>n.media,dataSource:"LM",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:7,maxAfter3chars:10,maxAfter8charsOrInL2ZeroInput:20,supportsEmptyQuery:!0},{getResultsContainer:n=>n.files,dataSource:"FL",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:7,maxAfter3chars:10,maxAfter8charsOrInL2ZeroInput:20,supportsEmptyQuery:!0},{getResultsContainer:()=>{throw Error("Only supported via IndexerQuery");},dataSource:"IBA",getSuggestionType:()=>"IBA",maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Apps].icon),supportsEmptyQuery:!1},{getResultsContainer:()=>{throw Error("Only supported via IndexerQuery");},dataSource:"IFF",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:7,maxAfter3chars:15,maxAfter8charsOrInL2ZeroInput:25,supportsEmptyQuery:!0},],b=[{getResultsContainer:n=>n.files,dataSource:"MDOC",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Documents].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.folders,dataSource:"MFOL",getSuggestionType:n=>r(n.kind,n.extension,"FD"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Folders].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.pictures,dataSource:"MPHO",getSuggestionType:n=>r(n.kind,n.extension,"LI"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Photos].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.video,dataSource:"MVID",getSuggestionType:n=>r(n.kind,n.extension,"LV"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Videos].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.music,dataSource:"MMUS",getSuggestionType:()=>"MU",maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Music].icon,null,!0),supportsEmptyQuery:!1},{getResultsContainer:n=>n.files,dataSource:"MPVD",getSuggestionType:n=>r(n.kind,n.extension,"FL"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Documents].icon,null,!0),supportsEmptyQuery:!1},],k=[{getResultsContainer:n=>SearchAppWrapper.CortanaApp.queryFormulationView.startPathCompletionQuery(n.originalQuery,""),dataSource:"PT",getSuggestionType:()=>"PT",maxUpTo3chars:15,maxAfter3chars:15,maxAfter8charsOrInL2ZeroInput:15,customCancellation:()=>SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastPathCompletionQuery(),supportsEmptyQuery:!1},{getResultsContainer:()=>SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getRecentAppsAsync(),getResults:n=>n,dataSource:"LRA",getSuggestionType:()=>"PP",customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Apps].icon,t.isImmersive?t.logoBackgroundColor:undefined),supportsEmptyQuery:!0},{getResultsContainer:t=>ThresholdUtilities.createPromise(i=>{let r=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.recentSearches||[];if(r=r.filter(n=>!!n),r.length>0&&t.queryToFetch){const i=n.escapeRegex(t.queryToFetch),u=i.split(/\s+/).filter(n=>!!n).map(n=>new RegExp("^"+n+"| "+n,"i"));r=r.filter(n=>u.every(t=>t.test(n)))}let u=ht(r);i(u)}),getResults:n=>n,dataSource:"FEH",getSuggestionType:()=>"FEH",customCreateLocalResponseSuggestion:(n,t)=>{return a(n,t,{type:2,content:"&#xE81C"})},supportsEmptyQuery:!0},{getResultsContainer:()=>v(),getResults:(n,t)=>n.then(n=>t?n.slice(0,t):n),dataSource:"TOPP",getSuggestionType:()=>"TOPL",customGetMax:t=>n.shouldShowStaticSearchHome(t)?6:5,customCreateLocalResponseSuggestion:(t,r,u)=>i(t,r,u,n.ScopeConfig[n.Scope.Apps].icon,t.isImmersive?t.logoBackgroundColor:undefined),supportsEmptyQuery:!0},{getResultsContainer:n=>ThresholdUtilities.createPromise(t=>{let i=u?u.retrieveItemsFromCache(n.queryToFetch):[];t(i)}),getResults:n=>n,dataSource:"LDIC",getSuggestionType:n=>r(n.kind,n.extension,"FD"),maxUpTo3chars:4,maxAfter3chars:7,maxAfter8charsOrInL2ZeroInput:15,supportsEmptyQuery:!1},],d=[{getResultsContainer:n=>SearchAppWrapper.CortanaApp.queryFormulationView.startCommandLineQuery(n.originalQuery,""),dataSource:"CG",getSuggestionType:()=>"CG",customCancellation:()=>SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastCommandLineQuery(),supportsEmptyQuery:!1},];n.LocalDataProviderDataSources=w.concat(b).concat(k).concat(d).map(n=>n.dataSource);const f={suggestions:[],maxedOut:!1};let g={},u,nt={"shell:RecycleBinFolder":{icon:{content:"&#xEF87",type:2},locStringKey:"RecycleBin"}};const at=["\\system32\\user.exe","\\system32\\sidebar.exe","\\system32\\at.exe","\\system32\\change.exe","\\system32\\control.exe","\\system32\\find.exe","\\system32\\net.exe","\\system32\\share.exe","\\system32\\rundll32.exe","\\system32\\append.exe","\\system32\\choice.exe","\\system32\\clip.exe","\\system32\\comp.exe","\\system32\\compact.exe","\\system32\\consent.exe","\\system32\\convert.exe","\\system32\\format.exe","\\system32\\graphics.com","\\system32\\label.exe","\\system32\\mem.exe","\\system32\\mode.com","\\system32\\more.com","\\system32\\recover.exe","\\system32\\replace.exe","\\system32\\reset.exe","\\system32\\shadow.exe","\\system32\\sort.exe","\\system32\\tree.com","\\system32\\webcam.exe","\\system32\\systemsettings.exe","\\system32\\command.com","\\system32\\tabtip.exe","\\system32\\services.exe","\\system32\\help.exe","\\system32\\where.exe","\\system32\\skydrive.exe","\\system32\\calc.exe","\\system32\\fc.exe","\\accessories\\wordpad.exe",n.config.blocklistNotepadCommand?"\\system32\\notepad.exe":null,].filter(n=>!!n),tt=["\\system32\\finger.exe","\\system32\\ping.exe","\\system32\\print.exe","\\system32\\shutdown.exe","\\system32\\expand.exe","\\system32\\tskill.exe","\\system32\\reg.exe","\\system32\\sc.exe",],vt=["uninstall","outlook","excel","skype","nero","onenote","lync","vmware","firefox","itunes","photoshop","print","opera","visio","thunderbird","smartscreen"],yt=/[\/\.\-\\]/;n.isRealCommand=pt;const wt=["Microsoft.Cortana_8wekyb3d8bbwe!CortanaUI","Microsoft.Windows.Cortana_cw5n1h2txyewy!CortanaUI",],bt=[".dll",".pdb",".obj",".bin",".etl",".bak",".config",".resx",".manifest",".ini",".searchconnector-ms",".settingcontent-ms",".vstx",".vssx",".ms-one-stub",],kt=["visio content","bin","debug","obj","objd","amd64","x86","microsoftedgebackups",];n.isInitials=rt;n.getSuggestionTypeOverride=ft;n.parseConstraintIndexMetaData=et;n.isSuppressed=ot;class t{getName(){return"LocalDataProvider"}constructor(t,i){this._previousKeystrokeCache=t;i&&(u=i,n.Host.bindShown(()=>{u&&(u.clean(),this.cacheDeviceItems())}));n.Host.bindAppHidden(()=>{g={}})}static setWhereId(n){var r,i;if(!n||n.close){if(t.lastResultHandle&&!n){(i=(r=t.lastResultHandle).close)===null||i===void 0?void 0:i.call(r);t.lastResultHandle=null;return}t.lastResultHandle=n}}fetch(i,r,u,f,e){var l,a,v,y;f&&f.register(()=>n.Async.clearPendingItemsFromCache(),!1,"clearPendingItemsFromCache");let s=[],c=w.filter(t=>n.isDataSourceEnabled(t.dataSource,i));if(n.IndexerQueryGenerator&&(s=s.concat(c.filter(t=>n.IndexerQueryGenerator.dataSourceSupported(t.dataSource))),c=c.filter(t=>!n.IndexerQueryGenerator.dataSourceSupported(t.dataSource))),c.length>0){if(!i.queryToFetch&&!c.every(n=>n.supportsEmptyQuery))throw new Error(o);f&&f.register(()=>SearchAppWrapper.CortanaApp.queryFormulationView.cancelLastDeviceQuery(),!1,"cancelLastDeviceQuery");let u=n.safeExecute(()=>{let t=n.Host.getRawImpressionGuid();return n.config.logClientPerf&&n.InstrumentationHelper.instrumentDeviceQueryBegin(t),SearchAppWrapper.CortanaApp.queryFormulationView.startDeviceQuery(i.queryToFetch,t)},"startDeviceQuery",null,i.queryToFetch);if(u)for(let n of c)this.searchFolderWithMultipleResults(i,n,u,r,e,f,(l=t.lastResultHandle)===null||l===void 0?void 0:l.whereId);else this.emptyFetch(c,r)}let h=b.filter(t=>n.isDataSourceEnabled(t.dataSource,i));if(n.IndexerQueryGenerator&&(s=s.concat(h.filter(t=>n.IndexerQueryGenerator.dataSourceSupported(t.dataSource))),h=h.filter(t=>!n.IndexerQueryGenerator.dataSourceSupported(t.dataSource))),h.length>0){if(!i.queryToFetch&&!h.every(n=>n.supportsEmptyQuery))throw new Error(o);let u=i.taskFrame?i.taskFrame.raw:"";n.Async.safeChain("executeSearchAsync",()=>SearchAppWrapper.CortanaApp.searchResultsView.executeSearchAsync(i.queryToFetch,u),n=>{var u;if(e())if(n)for(let o of h)this.searchFolderWithMultipleResults(i,o,n,r,e,f,(u=t.lastResultHandle)===null||u===void 0?void 0:u.whereId);else this.emptyFetch(h,r)},()=>this.emptyFetch(h,r),null,u?i.queryToFetch+"\n"+u:i.queryToFetch)}if(s.length>0){if(t.lastQuery&&!i.fullPartialQuery.startsWith(t.lastQuery)&&t.setWhereId(null),t.lastQuery=i.fullPartialQuery,!i.queryToFetch&&!s.every(n=>n.supportsEmptyQuery))throw new Error(o);if(s.some(n=>n.dataSource=="MPHO")&&s.some(n=>n.dataSource=="MVID")&&s.some(n=>n.dataSource=="MDOC")&&s.some(n=>n.dataSource=="MPVD")){let n=s.find(n=>n.dataSource=="MPVD");this.searchFolderWithMultipleResults(i,n,null,r,e,f,(a=t.lastResultHandle)===null||a===void 0?void 0:a.whereId)}else for(let n of s)this.searchFolderWithMultipleResults(i,n,null,r,e,f,(v=t.lastResultHandle)===null||v===void 0?void 0:v.whereId)}let p=k.filter(t=>n.isDataSourceEnabled(t.dataSource,i));if(p.length>0){if(!i.queryToFetch&&!p.every(n=>n.supportsEmptyQuery))throw new Error(o);for(let n of p)f&&n.customCancellation&&f.register(()=>n.customCancellation(),!0,n.dataSource+" cancellation"),this.searchFolderWithMultipleResults(i,n,i,r,e,f,(y=t.lastResultHandle)===null||y===void 0?void 0:y.whereId)}let g=d.filter(t=>n.isDataSourceEnabled(t.dataSource,i));if(g.length>0){if(!i.queryToFetch&&!g.every(n=>n.supportsEmptyQuery))throw new Error(o);for(let n of g)f&&n.customCancellation&&f.register(()=>n.customCancellation(),!0,n.dataSource+" cancellation"),this.searchFolderWithSingleResult(i,n,i,r,e)}i.taskFrame&&n.safeExecute(()=>SearchAppWrapper.CortanaApp.searchResultsView.setTaskFrame(i.originalQuery,""),"reset task frame")}emptyFetch(n,i){for(let r of n)this.logProviderFailure(r.dataSource),i(r.dataSource,f,t.getDataSourceState(0))}getMax(t,i){return i.customGetMax?i.customGetMax(t):n.RuntimeConfig.QfMode==5||t.scope!=n.Scope.All?t.queryToFetch?i.maxAfter8charsOrInL2ZeroInput*2:i.maxAfter8charsOrInL2ZeroInput:t.queryToFetch.length>8?i.maxAfter8charsOrInL2ZeroInput:t.queryToFetch.length>3?i.maxAfter3chars:i.maxUpTo3chars}toLocalResponse(t,r,u,f,e){let o;if(e){let n=f;n.getGroupDisplayName&&(o=n.getGroupDisplayName(e))}let c={Counter:0},s=[],l=u.length<t;for(let t of u){let e=ft(t,f),u=n.isApp(e)||n.isSetting(e)?et(t):undefined;if(!ot(r,t,e,f.dataSource,c,u)){let n;if(n=f.customCreateLocalResponseSuggestion?f.customCreateLocalResponseSuggestion(t,e,f.dataSource):i(t,e,f.dataSource),o&&(n.groupDisplayName=o),u&&(n.ciMetaData=u,u.Query&&u.Query.includes(h))){let t=u.Query.split(h);t.length==2&&(n.uxHint=t[1],n.ciMetaData.Query=t[0])}s.push(n)}}return{suggestions:s,maxedOut:l}}getResults(n,t,i,r){if(r.getResults)return r.getResults(i,t);let u=i,f=this.enableSpellCorrection(n);return u.getItemsAsyncWithSpeller?u.getItemsAsyncWithSpeller(0,t,f):i.getItemsAsync(0,t)}enableSpellCorrection(t){return t.queryToFetch.length>=n.config.enableCISpellerAtPrefixLength&&this._previousKeystrokeCache&&this._previousKeystrokeCache.enableCISpeller(t.queryToFetch)?!0:t.queryToFetch.length>=n.config.enableCISpellerAtPrefixLength&&n.config.enableCISpeller==1?!0:!1}searchFolderWithMultipleResults(i,r,u,e,o,s,h){let c=r.dataSource,l=this.getMax(i,r),a=!u,v,y;if(a){let t;if(n.RuntimeConfig.QfMode==5&&(t=n.Host.getFileExplorerCurrentPath()),t&&!/^[a-zA-Z]\:\\/.test(t)){e(c,f,null,null,!0);return}v=(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.getFeatureEnabled(41150162))?()=>n.IndexerQueryGenerator.generateIndexerQueryAsync(i,t,l,c,h).then(t=>{if(!o())return null;if(n.config.queryShortCircuitAPIFix)return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.querySearchIndexerResultsAsync(t,i.originalQuery,n.Host.getRawImpressionGuid());let r={rawSQL:t,queryText:i.originalQuery,impressionID:n.Host.getRawImpressionGuid()};return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.querySearchIndexerResultsAsync(r)}):()=>n.IndexerQueryGenerator.generateIndexerQueryAsync(i,t,l,c,h).then(n=>SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.queryWindowsSearchIndexerAsync(n))}else{if(y=n.safeExecute(()=>r.getResultsContainer(u),"getResultsContainer "+c),!y){e(c,f,null);return}v=()=>this.getResults(i,l,y,r)}n.Async.safeChain(a?"queryWindowsSearchIndexerAsync":"getItemsAsync",v,u=>{if(o()){let f=u.resultSet,o;u.whereId&&t.setWhereId(u);f?o=u.state:f=typeof u.length=="undefined"?Object.keys(u).map(n=>u[n]):u;a&&n.supportsShortcuts(c,i)&&(f=f.map(t=>n.IndexerQueryGenerator.fixKind(t)));let s=t.getDataSourceState(o);e(c,this.toLocalResponse(l,i,f,r,y),s)}},t=>{n.isCancellation(t)||this.logProviderFailure(c),e(c,f,null)},a?s:null,c+" "+i.queryToFetch)}searchFolderWithSingleResult(t,i,r,u,e){let o=i.dataSource,s=n.safeExecute(()=>i.getResultsContainer(r),"getResultsContainer "+o);s?n.Async.safeChain("tryGetResultAsync "+o,()=>s.tryGetResultAsync(),n=>{e()&&u(o,this.toLocalResponse(1,t,n?[n]:[],i,null),null)},t=>{n.isCancellation(t)||this.logProviderFailure(o),u(o,f,null)},null,t.queryToFetch):u(o,f,null)}logProviderFailure(t){let i=n.providerFailureLogName(t);i&&SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure&&n.safeExecute(()=>SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure(i,"ErrorForTopHit"),"logProviderFailure")}cacheDeviceItems(){let i="LDIC",r=()=>{var r;let u=n.IndexerQueryGenerator.generateIndexerQueryForDeviceItemCache(i,(r=t.lastResultHandle)===null||r===void 0?void 0:r.whereId);return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.queryWindowsSearchIndexerAsync(u)};u.setReady(!1);n.Async.safeChain("initializeDeviceItemCacheAsync",r,n=>{n.whereId&&t.setWhereId(n);for(let t of n.resultSet)u.addItemToCache(t);u.setReady(!0)})}static getDataSourceState(n){switch(n){case 0:return"UN";case 1:return"NI";case 2:return"PI"}return undefined}static getApps(n,t,i,r){s(n,t,"findAppsAsync",n=>SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findAppsAsync(n),n=>y.customCreateLocalResponseSuggestion(n,null,r),i,r,null,!0)}static getSettings(n,t,i,r){s(n,t,"findSettingsAsync",n=>SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findSettingsAsync(n),n=>p.customCreateLocalResponseSuggestion(n,null,r),i,r,null)}static getFiles(u,f,e,o,h){s(u,f,"findFilesAsync",i=>{var r;if(n.IndexerQueryGenerator){let u=n.IndexerQueryGenerator.generateIndexerQueryForMRUFilesAndFolders(e,"MFF",i,(r=t.lastResultHandle)===null||r===void 0?void 0:r.whereId);return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.queryWindowsSearchIndexerAsync(u).then(n=>{n.whereId&&t.setWhereId(n);let i={};for(let t of n.resultSet)i[t.id]=t;return i})}return SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.findFilesAsync(i)},n=>i(n,r(n.kind,n.extension,"FL"),h),o,h,g)}static launchIndexingOptions(i){t.getSettings([c],t=>{let r=t[c];r?n.Host.launchDeviceItem(r.deviceItem,"ST"):i||this.launchIndexingOptions(!0)},null,null,!0)}}n.LocalDataProvider=t;let o="Local provider doesn't support empty query"}(WSB||(WSB={})),function(n){let t;const f="UpsellDismissed",e="moreButton",i="feedbackButton",o="chatButtonLeft",s="chatButtonRight",h="optionsButton",c="rewardsBadgeButton",l="userProfileButton",a="closeButton",v="backButton",r=4.5,u=10;class y{constructor(r,u,y,p,w,b){if(this._page=r,this._accessTokenManager=u,this._msRewardsViewModel=y,this._menuFactory=p,this._substrateProfilePictureProvider=w,this._optionsWindow=b,this._moreButton={id:e,selected:!1,text:null},this._feedbackButton={id:i,selected:!1,text:null},this._optionsButton={id:h,selected:!1,text:null},this._rewardsBadgeButton={id:c,selected:!1,text:null},this._userProfileButton={id:l,selected:!1,text:null},this._closeButton={id:a,selected:!1,text:null},this._backButton={id:v,selected:!1,text:null},this._codexChatLeftButton={id:o,selected:!1,text:null},this._codexChatRightButton={id:s,selected:!1,text:null},this._topHitPresent=!1,this._resultsPresent=!1,this._currentScopeTileIndex=-1,this._moreMenuOpened=!1,this._optionsMenuOpened=!1,this._userProfileMenuOpened=!1,this._shouldRenderScopes=!0,this._advancedOptionsIdCounter=0,this._advancedOptionsScope=[],this._shouldShowBuildNumber=!1,this._userProfilesCache={},this.menuDividerId=0,this._upsellGotDismissed=n.LightweightStorage.getItem(f)=="1",t=SearchAppWrapper.CortanaApp,n.shouldUseMsbEnterpriseScopes()){if(n.config.scopesOrderBeginMsbEnterprise.length==0)return}else if(n.config.scopesOrderBegin.length==0)return;const k=()=>{this._currentQuery&&this.renderScopes()};if(n.Host.bindAppHidden(()=>{this._scopeTiles=null,this._effectiveScopeOrder=null}),n.Host.bindQueryChangedOrInitialized(n=>{this._currentQuery=n,this._currentScopeTileIndex=-1}),n.Host.bindDismissed(()=>{this._shouldRenderScopes=!0,this._currentScopeTileIndex=-1,this._verifyAccountForAADRequired=!1,this._verifyAccountForMSARequired=!1}),n.Host.bindButtonRightOfSearchBoxClick(t=>{(t==""||t=="")&&(n.Host.reformulate(""),this.setFocusInSearchBox("clear search box"),n.InstrumentationHelper.logClientInstEvent("Select","ClearSearchBox",null))}),n.Host.bindScopeListRequiresUpdate(()=>{this.init(),k()}),n.Host.bindOnFeedbackClosing(t=>{var r;!t&&n.RuntimeConfig.AlwaysWide&&((r=_ge(i))===null||r===void 0?void 0:r.focus())}),n.Host.bindKeyDown((n,t)=>{t.ctrlKey&&n==13&&t.shiftKey&&(this._shouldShowBuildNumber=!0)}),this._substrateUpsellDismiss={action:()=>{this._upsellGotDismissed=!0,n.LightweightStorage.setItem(f,"1"),n.Host.refreshCurrentPane()},icon:{content:"&#xE711",type:2}},y&&y.bindRewardsBadgeUpdated(()=>{this._shouldRenderScopes=n.config.optScopesRender,k()}),u){const t=()=>{if(this._currentQuery){const t=n.ScopeConfig[this._currentQuery.scope];this.refreshAdvancedOptionsScopeList(t);this.updateTopHitHeader()}},i=(i,r,u)=>{n.setVisibility(n.StaticHtmlElements.aadVerificationContainer,!1),i==0?(r=="https://substrate.office.com/SubstrateSearch-Internal.ReadWrite"||r=="https://substrate.office.com/M365.Access"||r=="service::cortana.bing.com::mbi_ssl")&&(this._verifyAccountForMSARequired=u,t()):i==1&&(r=="https://substrate.office.com"&&(this._verifyAccountForAADRequired=u,n.isAADVerificationRequired=this._verifyAccountForAADRequired,t()),this._verifyAccountForAADRequired&&this.initializeAADVerification(i))};u.bindVerifyAccountRequired((n,t)=>{i(n,t,!0)});u.bindAccessTokenAvailable((n,t)=>{i(n,t,!1)})}}focusNextScopeTile(t,i){let u=[].slice.call(n.StaticHtmlElements.scopesHeader.getElementsByClassName("scope-tile")),r=n.shouldSkipSelectedScope()?u.filter(n=>!n.classList.contains("scope-tile--selected")):u;r=r.filter(n=>n.tabIndex==-1);this._currentScopeTileIndex=r.indexOf(t);i?this._currentScopeTileIndex!=r.length-1&&++this._currentScopeTileIndex:this._currentScopeTileIndex>0&&--this._currentScopeTileIndex;n.shouldSkipSelectedScope()&&(this._currentScopeTileIndex=u.indexOf(r[this._currentScopeTileIndex]));this._menuFactory.dismiss();u[this._currentScopeTileIndex].focus()}render(t,i,r,u,f,e){if(this._currentQuery=t,t){let o=n.getEffectiveScope(t);this.innerRender(t.scope,o,t,i,r,u,f,e)}else this.cleanUp()}getScopeToolTip(t,i){let u=n.ScopeConfig[t],f=n.getScopeDisplayName(u),r;return r=i&&!this._allScopeButtonPresent?"RemovingScopeNarratorText2":t==n.Scope.All?"AddingScopeNarratorTextAll2":"AddingScopeNarratorText",n.Host.getLocString(r,f)}selectScope(n){this._selectedScope&&(this._selectedScope.tooltip=this.getScopeToolTip(this._selectedScope.type,!1),this._selectedScope.enabled=!1,this._selectedScope=null);for(let t of this._scopeTiles)if(t.enabled=t.type==n,t.enabled){t.tooltip=this.getScopeToolTip(n,!0);this._selectedScope=t;break}}innerRender(t,i,r,u,f,e,o,s){this._topHitPresent=u;this._resultsPresent=f;n.RuntimeConfig.ScopesAvailable&&(this._scopeTiles||this.init(),this._scopeTiles&&(!this._selectedScope||this._selectedScope.type!=t)&&this.selectScope(t));this.renderTopHitHeader(t,i,r,f,e,o,s);n.RuntimeConfig.ScopesAvailable&&(this.renderScopes(),this.renderTopBrandingBar());let h=this._advancedOptionsScope.filter(n=>n.layout==1||n.layout==6);h&&this._page.renderAdvancedOptionsMessages(h)}refreshAdvancedOptionsScopeList(t){this._advancedOptionsScope=n.RuntimeConfig.ScopesAvailable&&t.showUpsellOnSuggestionsList&&t.showUpsellOnSuggestionsList()?this.getAdvancedOptions(n.SequenceNumberManager.getSequenceNumber(),0):[]}renderTopHitHeader(t,i,r,u,f,e,o){let s=n.ScopeConfig[i],a=r.showProgressBar?e:!f,v=!r||!r.queryToFetch,[h,c]=this.getEmptyResultsMessage(u,a,v,i,s,e,o),l=a||v||u||!this._lastRenderedTopHitHeader||n.uses3lineTemplate(i)?this.getHeaderText(i,s):this._lastRenderedTopHitHeader.headerText;if(this.refreshAdvancedOptionsScopeList(s),n.RuntimeConfig.AlwaysWide&&(this._advancedOptionsScope=this._advancedOptionsScope.concat(this.getAdvancedOptions(n.SequenceNumberManager.getSequenceNumber(),1))),!this._lastRenderedTopHitHeader||this._lastRenderedTopHitHeader.scope!=t||this._lastRenderedTopHitHeader.message!=h||this._lastRenderedTopHitHeader.subMessage!=c||this._lastRenderedTopHitHeader.headerText!=l||this._lastRenderedTopHitHeader.advancedOptions!=this._advancedOptionsScope){this._lastRenderedTopHitHeader={scope:t,headerText:l,message:h,subMessage:c,advancedOptions:this._advancedOptionsScope,scopeForDisplay:i};let y={headerText:l,message:h,subMessage:c,messageIcon:h?s.icon:null};this._page.updateTopHitHeaderView(y)}}updateTopHitHeader(){if(this._lastRenderedTopHitHeader){let t=n.ScopeConfig[this._lastRenderedTopHitHeader.scopeForDisplay],i={headerText:this._lastRenderedTopHitHeader.headerText,message:this._lastRenderedTopHitHeader.message,subMessage:this._lastRenderedTopHitHeader.subMessage,messageIcon:this._lastRenderedTopHitHeader.message?t.icon:null};this._page.updateTopHitHeaderView(i)}}shouldShowRewardsBadge(t){return n.RuntimeConfig.QfMode!=11&&(n.RuntimeConfig.AlwaysWide||!!t&&t.scope==n.Scope.All)}initializeAADVerification(){if(this._page!=null){const t=_ge("userProfileButton");if(t||(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)){if(!this._aadVerification){if(this._aadVerification=this._page.createAADVerification("AADVerification"),!this._aadVerification)return;this._aadVerification.addMessage(n.Host.getLocString("VerifyAccountFlyoutAttention")).icon("Rewards").setClass("miniflyout").target(t,"Left")}n.AccessTokenManager.getWindowsAccountType()==1&&this._aadVerification.target(t,"Left").renderAADVerification(this._accessTokenManager)}}}getScopesHeaderDataModel(){var r,u;this._advancedOptionsIdCounter=0;let t=this.getScopeBarElements(),f=this.getHiddenScopeElements(t)||[],e=this._msRewardsViewModel&&this._msRewardsViewModel.getDataModel();const s=(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.enableScopeListBrandingLogo())?this.getTenantBrandingDataModel():null,i=n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isTourVisible();i&&(t=t.map(n=>Object.assign({},n,{click:undefined,tooltip:undefined})),e&&(e.click=()=>null));let[o,h]=n.config.userProfileButtonEnabled?this.getUserProfileButtonData():[null,null];return{isWin11DSB:n.isWin11DSB(this._currentQuery),isWorkScopeHomePage:(r=this._currentQuery)===null||r===void 0?void 0:r.isWorkScopeZI,isSearchHome:(u=this._currentQuery)===null||u===void 0?void 0:u.isSearchHomeZI,scopes:n.config.pureRender?n.deepCopy(t):t,showFeedback:this.isFeedbackEnabled()?i?()=>{}:()=>this.showFeedback():null,scopesBackBtnHandler:()=>this.scopesBackBtnClicked(),scopesLeftCaretBtnHandler:()=>this.scopesLeftCaretClicked(),scopesRightCaretBtnHandler:()=>this.scopesRightCaretClicked(),rewardsBadgeDataModel:this.shouldShowRewardsBadge(this._currentQuery)&&e,moreMenuDataModel:f.length>0?{opened:this._moreMenuOpened,menuItems:f,buttonClickHandler:(n,t,r)=>i?null:this._moreMenuOpened?this.closeMoreMenuDropDown():this.openMoreMenuDropDown(f,n,t,r)}:null,optionsMenuDataModel:{opened:this._optionsMenuOpened,buttonClickHandler:(n,t,r)=>i?null:this._optionsMenuOpened?this.closeOptionsMenuDropDown():this.openOptionsMenuDropDown(n,t,r)},userProfileButtonDataModel:n.config.userProfileButtonEnabled&&o?{opened:this._userProfileMenuOpened,buttonClickHandler:(n,t,r)=>i?null:this._userProfileMenuOpened?this.closeUserProfileDropDown():this.openUserProfileDropDown(n,t,r),icon:o,userName:h}:null,brandBarDataModel:s,closeButtonClickHandler:(n,t,i)=>this.closeButtonClicked(n,t,i),codexChatLeftDataModel:n.isCodexEligible()&&n.config.codexSimple?{buttonClickHandler:(n,t,i)=>this.chatButtonClicked(n,t,!0,i),iconText:n.Host.getLocString("CodexChatButton"),toolTip:n.Host.getLocString("CodexChatButtonToolTip"),ariaText:n.Host.getLocString("CodexChatButtonReader")}:undefined,codexChatRightDataModel:n.isCodexEligible()&&n.config.codexBtnUpperRight?{buttonClickHandler:(n,t,i)=>this.chatButtonClicked(n,t,!1,i),toolTip:n.Host.getLocString("CodexChatButtonToolTip"),ariaText:n.Host.getLocString("CodexChatButtonReader")}:undefined}}renderScopes(){var t,i;(!n.config.optScopesRender||this._currentQuery&&this._currentQuery.scopePrefix||(this._selectedScope?this._selectedScope.selected==!1||((t=this._currentQuery)===null||t===void 0?void 0:t.scope)==n.Scope.Work:((i=this._currentQuery)===null||i===void 0?void 0:i.scope)==n.Scope.All)||this._moreMenuOpened||this._optionsMenuOpened)&&(this._shouldRenderScopes=!0);this._shouldRenderScopes&&(this._page.updateScopesHeaderView(this.getScopesHeaderDataModel()),this._shouldRenderScopes=!1,n.config.scopeWithBackground&&n.RuntimeConfig.AlwaysWide&&this.scopesPresentInstrumentationLog())}scopesPresentInstrumentationLog(){n.isWin11DSB(this._currentQuery)||n.InstrumentationHelper.logClientInstEvent("ClientInst","ScopesArePresent",null,null)}getTenantBrandingDataModel(){var t;if(n.msbHost){const i=n.msbHost.tenantManager.getMsbBranding();if(!!i)return{msbBranding:i,isWin11DSB:n.isWin11DSB(this._currentQuery),areScopesVisibile:(t=this._currentQuery)===null||t===void 0?void 0:t.isWorkScopeZI}}return null}renderTopBrandingBar(){const t=_ge("msbTopBrandingBar");if(t){if(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.enableTopBrandingBar()){const n=this.getTenantBrandingDataModel();if(n===null||n===void 0?void 0:n.msbBranding){this._page.updateTopBrandingBarView(n);return}}this._page.updateTopBrandingBarView(null)}}createTourFlyout(){const u=Object.keys(n.Host.getQuery().enabledDataSources),f=u.indexOf("MRU")!=-1?n.LightweightStorage.getItem("MRUNoItemsAvailable")=="1":!0,i=[{id:"web_Tour",message:n.Host.getLocString("TourSearchText"),title:n.Host.getLocString("TourSearchTitle"),group:`document.createElement('search').setAttribute("id", "search")`,enabled:!0,icon:"WebSearch"},{id:f?"gr37_TourWide":"gr37_Tour",message:n.Host.getLocString("TourQuickSearchText"),title:n.Host.getLocString("TourQuickSearchTitle"),group:"gr37",enabled:n.shouldEnableQuickSearches(n.Host.getLanguage().toLowerCase()),icon:"QuickSearch"},{id:"SNSC_Tour",message:n.Host.getLocString("TourSnipSearchText"),title:n.Host.getLocString("TourSnipSearchTitle"),group:"SNSC",enabled:n.shouldEnableSnipSearch(),icon:"VisualSearch"},{id:"rewardsBadgeButton_Tour",message:n.Host.getLocString("TourRewardsText"),title:n.Host.getLocString("TourRewardsTitle"),group:"rewardsBadgeButton",enabled:this._msRewardsViewModel.isRewardsEnabled(),icon:"RewardsTrophy"}];let t=this._page.createFlyout("WWETour");if(t==null){n.LightweightStorage.removeItem("wweTourEnabled");n.setZeroInputDataSourcesForL1();n.Host.refreshCurrentPane();n.StaticHtmlElements.root.classList.remove("overlayEnabled");n.LightweightStorage.removeItem("wweTourRefreshed");return}n.Host.bindAppHidden(()=>{this.removeTourFlyout(),this._page.hideOverlayAreaView(),this._page.hideFlyoutAreaView(),this._page.updateScopesHeaderView(this.getScopesHeaderDataModel())});this._page.updateScopesHeaderView(this.getScopesHeaderDataModel());t.dismissible(Number.MIN_VALUE,null);t.repeat(Number.MAX_VALUE);t.icon("WebSearch").overlay(!0);i.forEach(n=>{n.enabled&&t.addMessage(n.message,n.title,_ge(n.group),n.id,n.icon)});const r=i.filter(n=>n.enabled).length,e=r==1;n.InstrumentationHelper.logClientInstEvent("Select","WWETour",null,{intendedFlyouts:r.toString()});t.target(n.StaticHtmlElements.groups).button(n.Host.getLocString("WelcomeExpTourFinish"),()=>{this.removeTourFlyout(),this._page.hideOverlayAreaView(),this._page.updateScopesHeaderView(this.getScopesHeaderDataModel())},2).isLinkTextButton(!1).showButton(e).show()}removeTourFlyout(){n.LightweightStorage.removeItem("wweTourRefreshed");n.LightweightStorage.removeItem("wweTourEnabled");n.StaticHtmlElements.root.classList.remove("overlayEnabled")}getInstItem(t,i){let r=n.InstrumentedItem.getNonSuggestionInstrumentedItem(t,n.SyntheticQSCodesMaps.KValues,n.SyntheticQSCodesMaps.HandoffsForNonSuggestions[t]);return n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(i,t,r),r}closeButtonClicked(t,i,r){let u=n.SequenceNumberManager.getSequenceNumber(),f=this.getInstItem("CB",u);n.InstrumentationHelper.instrumentItemClick(t,f,u,null,i,r);SearchAppWrapper.CortanaApp.dismissApp()}openMoreMenuDropDown(t,i,r,u){let f=n.SequenceNumberManager.getSequenceNumber(),e=this.getInstItem("MMB",f);n.InstrumentationHelper.instrumentItemClick(i,e,f,null,r,u);this._msRewardsViewModel&&this._msRewardsViewModel.hide();this._menuFactory.showDropdownMenu(t,document.getElementById(this._moreButton.id),1,()=>{n.safeSetTimeout(()=>this.closeMoreMenuDropDown(),0,"closeMoreMenuDropDown")},r);this._moreMenuOpened=!0;this.renderScopes()}closeMoreMenuDropDown(){this._moreMenuOpened=!1;this.renderScopes()}openOptionsMenuDropDown(t,i,r){let f=n.RuntimeConfig.AlwaysWide?1:2,u=n.SequenceNumberManager.getSequenceNumber(),e=this.getAdvancedOptions(u,f),o=this.getInstItem("OMB",u);n.InstrumentationHelper.instrumentItemClick(t,o,u,null,i,r);this._msRewardsViewModel&&this._msRewardsViewModel.hide();this._menuFactory.showDropdownMenu(e,document.getElementById(this._optionsButton.id),2,()=>{n.safeSetTimeout(()=>this.closeOptionsMenuDropDown(),0,"closeOptionsMenuDropDown")},i);this._optionsMenuOpened=!0;this.renderScopes()}closeOptionsMenuDropDown(){this._optionsMenuOpened=!1;this._shouldShowBuildNumber=!1;this.renderScopes()}openUserProfileDropDown(t,i){let r=n.SequenceNumberManager.getSequenceNumber(),u=this.getAccountOptionsForUserProfileButton(r),f=this.getInstItem("APB",r);n.InstrumentationHelper.instrumentItemClick(t,f,r,null,i,null);this._msRewardsViewModel&&this._msRewardsViewModel.hide();this._menuFactory.showDropdownMenu(u,document.getElementById(this._userProfileButton.id),2,()=>{n.safeSetTimeout(()=>this.closeUserProfileDropDown(),0,"closeUserProfileDropDown")},i);this._userProfileMenuOpened=!0;this.renderScopes()}closeUserProfileDropDown(){this._userProfileMenuOpened=!1;this.renderScopes()}cleanUp(){_w.ReactDOM&&(ReactDOM.unmountComponentAtNode(n.StaticHtmlElements.topResults),ReactDOM.unmountComponentAtNode(n.StaticHtmlElements.groups),ReactDOM.unmountComponentAtNode(n.StaticHtmlElements.topHitHeader),ReactDOM.unmountComponentAtNode(n.StaticHtmlElements.scopesHeader));this._lastRenderedTopHitHeader=null;this._page.updateTopHitHeaderView(null);this._page.updateScopesHeaderView(null)}scopeNamesElements(t){return t.map(t=>this._scopeTiles.find(i=>n.Scope[i.type]==t)).filter(n=>!!n)}getEffectiveScopeOrder(){if(!this._scopeTiles||this._scopeTiles.length==0)return[];if(this._effectiveScopeOrder&&!n.config.pathCompletionReplacesAll)return this._effectiveScopeOrder.slice(0);let t,i,u;n.shouldUseMsbEnterpriseScopes()?n.RuntimeConfig.AlwaysWide?(t=n.config.scopesOrderBeginAlwaysWideMsbEnterprise,i=n.config.scopesOrderLastAlwaysWide,u=n.config.numberOfScopesToRenderAlwaysWideMsbEnterprise):(t=n.config.scopesOrderBeginMsbEnterprise,i=n.config.scopesOrderLast,u=n.config.numberOfScopesToRenderMsbEnterprise):n.RuntimeConfig.AlwaysWide?(t=n.config.scopesOrderBeginAlwaysWide,i=n.config.scopesOrderLastAlwaysWide,u=n.config.numberOfScopesToRenderAlwaysWide):(t=n.config.scopesOrderBegin,i=n.config.scopesOrderLast,u=n.config.numberOfScopesToRender);let r=[];if(t){n.config.pathCompletionReplacesAll&&(i=i.filter(n=>n!="PathCompletion"),this._currentQuery&&this._currentQuery.canBePathCompletion&&(t=t.map(n=>n=="All"?"PathCompletion":n)));let f=i?this.scopeNamesElements(i):[];r=this.scopeNamesElements(t);r=r.slice(0,u-f.length);r.push(...f)}return this._effectiveScopeOrder=r,r.slice(0)}getHiddenScopeElements(t){if(!this._moreScopeTiles)return[];if(n.config.scopeWithBackground){const t=["scope2","scope11","scope7","scope3"],n=[];for(let i=0;i<this._moreScopeTiles.length;i++){let r=this._moreScopeTiles.filter(({id:n})=>n===t[i]);n.push(...r)}return n}return this._moreScopeTiles.filter(i=>t.find(n=>n.type==i.type)==undefined&&n.Scope[i.type]!="PathCompletion"&&n.Scope[i.type]!="All")}getScopeBarElements(){if(!this._scopeTiles)return[];let t=this.getEffectiveScopeOrder();if(n.config.scopeWithBackground&&n.RuntimeConfig.AlwaysWide){let n=this.getHiddenScopeElements(t)||[],i=n.findIndex(n=>{var t;return(n===null||n===void 0?void 0:n.type)==((t=this._selectedScope)===null||t===void 0?void 0:t.type)});i>=0&&(n[i].enabled=!0);let r=t.map(n=>n.type);t=t.concat(n.filter(n=>r.indexOf(n.type)==-1));this._scopeTiles=t}else{let i=t.some(n=>n.enabled);if(!i&&this._selectedScope&&(!n.config.pathCompletionReplacesAll||n.Scope[this._selectedScope.type]!="PathCompletion")){let n=this._scopeTiles.find(n=>n.type==this._selectedScope.type);t.push(n);i=!0}}return t}isFeedbackEnabled(){return n.isBingEnabled()}showFeedback(){n.Host.showFeedbackForm();this._msRewardsViewModel&&this._msRewardsViewModel.hide()}sliderDirection(t){const u=_qs(".scope-with-background__slider"),i=_qs(".scope-with-background__leftCaret"),r=_qs(".scope-with-background__rightCaret"),f=n.isRtl();u&&i&&r&&(f?t==2||t==0?(r.classList.add("b_hide"),i.classList.remove("b_hide")):(i.classList.add("b_hide"),r.classList.remove("b_hide")):t==1||t==0?(i.classList.add("b_hide"),r.classList.remove("b_hide")):(r.classList.add("b_hide"),i.classList.remove("b_hide")),t==0&&(u.scrollLeft=0))}scopesSlider(t,i,r){const u=_qs(".scope-with-background__slider"),e=n.isRtl();if(u){let o=u.scrollWidth;this.sliderDirection(t);let f=0,s=setInterval(()=>{e?t===2?u.scrollLeft-=r:t===1&&(u.scrollLeft+=r):t===1?u.scrollLeft-=r:t===2&&(u.scrollLeft+=r),f>=o&&window.clearInterval(s),f+=r},i)}}scopesBackBtnClicked(){n.RuntimeConfig.AlwaysWide&&(this.scopesSliderReset(),n.Host.reformulate(""),n.InstrumentationHelper.logClientInstEvent("Select","ScopeBackBtnSelected",null,null))}scopesSliderReset(t){this.scopesSlider(0,r,u);t&&n.RuntimeConfig.AlwaysWide&&this._selectedScope&&this._selectedScope.type!==n.Scope.All&&this.clearPrevSelectedScope()}clearPrevSelectedScope(){if(this._scopeTiles)for(let t of this._scopeTiles)t.type===n.Scope.All?(t.enabled=!0,this._selectedScope=t):t.enabled=!1}scopesLeftCaretClicked(){this.scopesSlider(1,r,u)}scopesRightCaretClicked(){this.scopesSlider(2,r,u)}getHeaderText(t,i){if(n.RuntimeConfig.FlatListWithoutGroups)return null;let r=n.getScopeDisplayName(i);if(r){if(this._topHitPresent)if(t==n.Scope.All||t==n.Scope.PathCompletion){let t=n.config.quickMatchLabel?"QuickMatch":"BestMatch";return n.Host.getLocString(t)}else{let i=this.getBestMatchScopeName(t);return n.Host.getLocString(i,r)}if(this._resultsPresent)return null;if(t!=n.Scope.All)return r}return n.Host.getLocString("BestMatch")}getBestMatchScopeName(t){return n.config.quickMatchLabel?`QuickMatchFor${n.Scope[t]}`:`BestMatchFor${t===n.Scope.Work?this.getWorkScopeName():n.Scope[t]}`}getWorkScopeName(){return(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.getIsMsbEduTenantEnabled())?"School":"Work"}getEmptyResultsMessage(t,i,r,u,f,e,o){var s;return n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9||t||!i&&!r||u!=n.Scope.Documents&&(f===null||f===void 0?void 0:f.showUpsellOnSuggestionsList)&&f.showUpsellOnSuggestionsList()?["",""]:(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.isDocumentZeroQueryEnabled())&&u==n.Scope.Documents?e&&o===!1&&(f===null||f===void 0?void 0:f.getEmptyZIMessages)?f.getEmptyZIMessages():["",""]:u==n.Scope.All&&n.isDSBFullWidthFlightEnabled()&&n.isDynamicSearchContentPossible()&&SearchAppWrapper.CortanaApp.entryPoint=="WNSDSB"&&!n.isMsbDsbEnabled()&&n.isBrowserOnline()?["",""]:r&&(f===null||f===void 0?void 0:f.getEmptyZIMessages)?f.getEmptyZIMessages():[n.Host.getLocString("NoResults",(s=this._currentQuery)===null||s===void 0?void 0:s.queryToFetch),""]}init(){if(n.initScopePrefixes(),this._scopeTiles=[],this._moreScopeTiles=[],n.RuntimeConfig.ScopesAvailable){let t;t=n.shouldUseMsbEnterpriseScopes()?n.RuntimeConfig.AlwaysWide?n.config.scopesOrderBeginAlwaysWideMsbEnterprise:n.config.scopesOrderBeginMsbEnterprise:n.RuntimeConfig.AlwaysWide?n.config.scopesOrderBeginAlwaysWide:n.config.scopesOrderBegin;this._allScopeButtonPresent=n.contains(t,"All");for(let t in n.ScopeConfig){let r=parseInt(t),i=n.ScopeConfig[r];(i.prefixes||i.prefixesLocString||i.scopeNameLocString)&&n.isScopeEnabled(r,i)&&((r!=n.Scope.All||this._allScopeButtonPresent)&&this._scopeTiles.push(this.createScopeElement(r,i,!1)),this._moreScopeTiles.push(this.createScopeElement(r,i,!0)))}this._moreScopeTiles.sort((t,i)=>t.type==n.Scope.All?-1:i.type==n.Scope.All?1:t.text.localeCompare(i.text));this._selectedScope&&this.selectScope(this._selectedScope.type);this._effectiveScopeOrder=null}}createScopeElement(t,i,r){return{isScopeElement:!0,id:(r?"scope":"l1scope")+t,type:t,enabled:!1,text:n.getScopeDisplayName(i),title:null,icon:t==n.Scope.All?{content:"&#xE8A9",type:1}:i.icon,click:()=>this.clickHandler(t,"scopeBar"),selected:!1,tooltip:this.getScopeToolTip(t,!1),isSelectable:!0}}clickHandler(t,i,r){let o=n.getScopeDisplayName(n.ScopeConfig[t]),e,u=this._currentQuery,f=u.scope;if(this._shouldRenderScopes=!0,this._scopeTiles.some(n=>n.type==f)||(f=n.Scope.All),o&&f!=t){e=(t==n.Scope.All||t==n.Scope.PathCompletion?"":o+": ")+u.queryToFetch;this.innerRender(t,t,u,this._topHitPresent,this._resultsPresent,!0,!1);let i={query:this._currentQuery,topResults:[],groups:[]};this._page.updateTopResultsView(i,!1);this._page.updateGroupsView(i,!1)}else{if(f==n.Scope.All||this._allScopeButtonPresent){this.setFocusInSearchBox("scope clickHandler noop");return}e=u.queryToFetch;t=n.Scope.All;this.innerRender(t,t,u,this._topHitPresent,this._resultsPresent,!0,!1)}let s=n.Scope[t],h={Scope:s,Source:i,GroupSource:r&&r.source?r.source.toString():undefined};n.InstrumentationHelper.logClientInstEvent("Select","ScopeChanged",null,h);f!=t&&n.Host.reformulate(e,undefined,undefined,r);this.setFocusInSearchBox("scope clickHandler "+s)}setFocusInSearchBox(t){n.Host.setFocusInSearchBox(null,t);let i=n.getCurrentActiveElement();i&&i.blur()}isScopeElement(t){return t&&this._scopeTiles&&(this.isScopeButton(t.id)||n.contains(this._scopeTiles,t))}isMenuElement(n){return n&&this.isMenuButton(n.id)}isScopeButton(n){return n==this._feedbackButton.id||n==this._rewardsBadgeButton.id||n==this._userProfileButton.id||n==this._closeButton.id||n==this._backButton.id||n==this._codexChatLeftButton.id||n==this._codexChatRightButton.id||this.isMenuButton(n)}isMenuButton(n){return n==this._moreButton.id||n==this._optionsButton.id}getSelectableItems(){let t=[];n.RuntimeConfig.ScopesAvailable&&(t=t.concat(this.getScopeSelectableItems()));let i=this._advancedOptionsScope.filter(n=>n.layout==0||n.layout==6);return i.length>0&&(t=t.concat(i)),t}getSelectableItemsByGroup(){let i=[],t=this.getScopeBarElements();if(n.shouldSkipSelectedScope()&&this._selectedScope==t[0]&&(t=t.slice(1)),!n.isWin11DSB(this._currentQuery)){i.push(t.slice(0,1));let r=t.findIndex(n=>n.selected);if(r>0)i.push(t.slice(r,r+1));else if(!n.shouldSkipSelectedScope()){let n=t.findIndex(n=>n.enabled);n>0&&i.push(t.slice(n,n+1))}}const u=[this._backButton,this._codexChatLeftButton].map(n=>_ge(n.id)?[n]:undefined).filter(n=>n),f=[this._moreButton,this._rewardsBadgeButton,this._userProfileButton,this._feedbackButton,this._optionsButton,this._closeButton,this._codexChatRightButton].map(n=>_ge(n.id)?[n]:undefined).filter(n=>n);i=[...u,...i,...f];let r=this._advancedOptionsScope.filter(n=>n.layout==0||n.layout==6);return r.length>0&&i.push(...r.map(n=>[n])),i}getScopeSelectableItems(){var u;let r=this.getScopeBarElements(),t=this._currentScopeTileIndex,f=r.length;if(n.isWin11DSB(this._currentQuery)&&!((u=this._currentQuery)===null||u===void 0?void 0:u.isWorkScopeZI))return t<0&&(t=0),this.getSelectableItemsByGroup()[t];if(n.shouldSkipSelectedScope()&&this._selectedScope==r[0]&&(r=r.slice(1),--t,--f),t<0&&this._selectedScope&&!n.shouldSkipSelectedScope())return[this._selectedScope];else{let u=n.getCurrentActiveElement();if(u)switch(u.id){case e:return[this._moreButton];case i:return[this._feedbackButton];case h:return[this._optionsButton];case c:return[this._rewardsBadgeButton];case l:return[this._userProfileButton];case a:return[this._closeButton];case v:return[this._backButton];case o:return[this._codexChatLeftButton];case s:return[this._codexChatRightButton]}return n.isCodexEligible()&&n.config.codexSimple?--t:n.config.scopeWithBackground&&--t,(t<0||t>=f)&&(t=0),r.slice(t,t+1)}}getSelectedItem(){return null}select(t){let i=[].slice.call(n.StaticHtmlElements.scopesHeader.getElementsByClassName("scope-tile")),r=n.shouldSkipSelectedScope()?i.filter(n=>!n.classList.contains("scope-tile--selected")):i;this._currentScopeTileIndex=r.indexOf(_ge(t.id));n.shouldSkipSelectedScope()&&(this._currentScopeTileIndex=i.indexOf(r[this._currentScopeTileIndex]))}onAfterKeyDown(){return!1}getSubstrateUpsellClickHandler(t,i){i=i&&[...i,`HeaderFooterViewModel::getSubstrateUpsellClickHandler(authType=${t})`];let r=()=>{n.Host.refreshCurrentPane(),n.Host.setFocusInSearchBox(null,"SubstrateUpsell")};return()=>this._accessTokenManager.promptAutheticateDialog(t,n.getSubstrateResourceOrScope(t),r,r,i)}getSubstrateUpsell(t,i,r){let s=null,u="VerifyAccountToSearch",f=0,h="CloudSearch",c=["Verify"],e=null,o=[];if(r==0){let s=n.getEffectiveScope(this._currentQuery);f=6;let i=this._accessTokenManager?this._accessTokenManager.getCachedAccountInfo(t):null;i&&o.push(i.accountUserName);let r=[n.Scope.People,n.Scope.Emails,n.Scope.Documents];n.config.accountVerificationInAllScope&&r.push(n.Scope.All);n.contains(r,s)&&(o.length>0&&(u="VerifyAccount"),e=this._substrateUpsellDismiss);h=""}else r==2&&(u=null,f=2,s={content:"&#xE9BE",type:2,needsAccentColor:!0},e=this._substrateUpsellDismiss,c=["VerifyAccountToSearch"]);return this.createAdvancedOption(t==1?"COFA":"COOA",i,h,u,c,this.getSubstrateUpsellClickHandler(t,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?[`HeaderFooterViewModel::getSubstrateUpsell(authType=${t}, position=${r})`]:undefined),f,e,s,null,o,"VerifyButton")}getOneDriveUpsell(t){return this.createAdvancedOption("SDSC",t,null,null,["SeeResultsFromOneDrive"],()=>{n.Host.launchCortanaSignIn()},2,null,{content:"&#xE9BE",type:2,needsAccentColor:!1})}getIndexingOption(t){let i=n.config.controlPanelSearchSettings?()=>n.Host.launchSearchSettings():()=>n.LocalDataProvider.launchIndexingOptions(!1);return this.createAdvancedOption("OMIO",t,"",null,["OptionsMenuIndexing"],i,2,null,{type:2,content:"&#xED52"})}getAdvancedOptionCssClass(n,t){return n==4?t?"menuInfo selectedAccount":"menuInfo":n==5?"menuLabel":null}createContextMenuGroup(n,t,i,r){let u=this.createAdvancedOption(n,t,null,i,null,null,5);return u.groupItems=r,u.narratorText=u.message,u}createBuildVersionOption(){const t=n.Host.getLocString("Build");return{id:"advancedOption"+this._advancedOptionsIdCounter++,selected:!1,title:t,message:undefined,text:t+": "+n.config.snrVersion,instItem:undefined,click:undefined,layout:4,cssClass:this.getAdvancedOptionCssClass(4),isSelectable:!1,subItems:undefined,isExpanded:!1}}createDebugFallbackOption(t){return this.createAdvancedOption(null,t,"FallbackBundleText",null,["FallbackBundleText"],()=>n.fallbackToPrepopulatedBundle(new Error("Fallback button clicked")),2,null,{type:2,content:"&#xE81F"})}createAdvancedOption(t,i,r,u,f,e,o,s,h,c,l,a){let y;t&&(y=this.getInstItem(t,i));let p="advancedOption"+this._advancedOptionsIdCounter++;c&&c.length==0&&(c=null);let v={id:p,selected:!1,title:n.Host.getLocString(r),message:u?n.Host.getLocString(u,...(l?l:[])):null,text:f?n.Host.getLocString(f[0]):null,instItem:y,click:undefined,layout:o,dismiss:s,icon:h,cssClass:this.getAdvancedOptionCssClass(o),isSelectable:!!e||!!c,subItems:c,buttonLabel:n.Host.getLocString(a),isExpanded:!c?undefined:!1};return v.narratorText=v.text,v.click=e?(t,i)=>{y&&n.InstrumentationHelper.instrumentItemClick(t,y,n.SequenceNumberManager.getSequenceNumber(),null,i,null),e(v)}:undefined,v}getAccountOptions(t,i){let u=[];if(!this._accessTokenManager)return u;let f=this._accessTokenManager.getCachedAccountInfo(0),e=this._accessTokenManager.getCachedAccountInfo(1),c=this._accessTokenManager.isMsaAvailable(),l=this._accessTokenManager.isAadAvailable(),o="menuItemWithButton focusable",s="removeHover",h="highlight",r;return(f||e)&&!i&&(r=this.createAdvancedOption(null,t,null,"ConnectedAccounts",null,null,5),r.cssClass=this.getAdvancedOptionCssClass(5),u.push(r),f&&n.isCloudSearchEnabledMsaCache&&(r=this.createAdvancedOption(null,t,null,null,["MicrosoftAccount"],null,4),r.message=f.accountUserName,r.narratorText=r.message,r.cssClass=this.getAdvancedOptionCssClass(4),n.isSubstrateOutlookAccountConnected||(r.cssClass+=" "+h),u.push(r),this._verifyAccountForMSARequired&&(r=this.createAdvancedOption(null,t,null,"VerifyAccountAttention",null,this.getSubstrateUpsellClickHandler(0,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?[`HeaderFooterViewModel::getAccountOptions(VerifyAccountAttention|MSA)`]:undefined),4),r.cssClass=s,r.icon={type:2,content:"&#xE946"},u.push(r),r=this.createAdvancedOption("OMVA",t,null,"VerifyButton",null,this.getSubstrateUpsellClickHandler(0,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?[`HeaderFooterViewModel::getAccountOptions(VerifyButton|MSA)`]:undefined),2),r.cssClass=o,u.push(r))),e&&n.isCloudSearchEnabledAadCache&&(r=this.createAdvancedOption(null,t,null,null,["AadAccount"],null,4),r.message=e.accountUserName,r.narratorText=r.message,r.cssClass=this.getAdvancedOptionCssClass(4),u.push(r),n.isSubstrateO365AccountConnected||(r.cssClass+=" "+h),this._verifyAccountForAADRequired&&(r=this.createAdvancedOption(null,t,null,"VerifyAccountAttention",null,this.getSubstrateUpsellClickHandler(1,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?[`HeaderFooterViewModel::getAccountOptions(VerifyAccountAttention|AAD)`]:undefined),4),r.cssClass=s,r.icon={type:2,content:"&#xE946"},u.push(r),r=this.createAdvancedOption("OMVA",t,null,"VerifyButton",null,this.getSubstrateUpsellClickHandler(1,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?[`HeaderFooterViewModel::getAccountOptions(VerifyButton|AAD)`]:undefined),2),r.cssClass=o,u.push(r))),u.push(this.getMenuDividerOption()),r=this.createAdvancedOption("OMAC",t,null,null,["ManageAccounts"],()=>n.Host.launchWindowsAccountSettings(),2,null,{type:2,content:"&#xE716"}),r.cssClass=this.getAdvancedOptionCssClass(2),u.push(r)),i&&this._accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptions"]:undefined)||(f&&(n.isCloudSearchEnabledMsaCache||!c)||(r=this.createAdvancedOption("OMAC",t,null,null,n.isCloudSearchEnabledMsaCache?["AddMicrosoftAccount"]:["EnableMsaSearch"],n.isCloudSearchEnabledMsaCache?()=>n.Host.launchWindowsAccountSettings():()=>n.Host.launchSearchPermissions(),2,null,{type:2,content:n.isCloudSearchEnabledMsaCache?"&#xE8FA":"&#xE9BE"}),r.cssClass=this.getAdvancedOptionCssClass(2),u.push(r)),e&&(n.isCloudSearchEnabledAadCache||!l)||(r=this.createAdvancedOption("OMAC",t,null,null,n.isCloudSearchEnabledAadCache?["AddAadAccount"]:["EnableAadSearch"],n.isCloudSearchEnabledAadCache?()=>n.Host.launchWindowsAccountSettings():()=>n.Host.launchSearchPermissions(),2,null,{type:2,content:n.isCloudSearchEnabledAadCache?"&#xE8FA":"&#xE9BE"}),r.cssClass=this.getAdvancedOptionCssClass(2),u.push(r))),u}getUserProfileButtonData(){let r,i,t=this._accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getUserProfileButtonData"]:undefined);if(t){if(i=t.accountProviderAuthority=="consumers"?0:1,r=this._userProfilesCache[t.accountUserName],!r){const r=this._substrateProfilePictureProvider.getPersonDefaultIcon(t.accountUserName);return this._userProfilesCache[t.accountUserName]=r,this._accessTokenManager.getAccount(i,i==1?"https://outlook.office.com/":n.config.useCobaltCSS?"https://outlook.office.com/M365.Access":"https://outlook.office.com/User.ReadWrite",!1,!0,r=>{if(r&&r.Token){let n=this._substrateProfilePictureProvider.getProfilePictureIconForToken(i,r.Token,t.accountUserName);n&&n(1,n=>{n&&(this._userProfilesCache[t.accountUserName]=n,this.renderScopes())})}else n.logAuthRelatedInfo("getAccountOnFailure::HeaderFooterViewModel::getUserProfileButtonData",`authenticate failed for accType ${i}.`)},undefined,n.Host.isAuthInvestigation()?["HeaderFooterViewModel::getUserProfileButtonData"]:undefined),[r,t.accountUserName]}return[r,t.accountUserName]}return[null,null]}getAccountOptionsForUserProfileButton(t){if(!this._accessTokenManager)return[];let s="removeHover",h="menuItemWithButton focusable",e=this._accessTokenManager.getAllAvailableAccounts(0),o=this._accessTokenManager.getAllAvailableAccounts(1),c=this._accessTokenManager.getCachedAccountInfo(0),l=this._accessTokenManager.getCachedAccountInfo(1),f=e.concat(o);if(e.length+o.length==0)return[];let r=[],i,u=this._accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptionsForUserProfileButton"]:undefined);if(u&&(f=f.filter(n=>n.accountUserName!=u.accountUserName),n.config.useCobaltCSS||(i=this.createAdvancedOption(null,t,null,"Accounts",null,null,5),i.cssClass=this.getAdvancedOptionCssClass(5),r.push(i)),i=this.createAdvancedOption(null,t,null,null,u.accountProviderAuthority=="consumers"?["MicrosoftAccount"]:["AadAccount"],null,4,null,this._userProfilesCache[u.accountUserName]),i.message=u.accountUserName,i.narratorText=i.message,i.cssClass=this.getAdvancedOptionCssClass(4,u),i.isSelectedAccount=u&&n.config.useCobaltCSS,r.push(i),c&&n.isCloudSearchEnabledMsaCache&&this._verifyAccountForMSARequired&&(i=this.createAdvancedOption(null,t,null,"VerifyAccountAttention",null,this.getSubstrateUpsellClickHandler(0,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?[`HeaderFooterViewModel::getAccountOptionsForUserProfileButton(VerifyAccountAttention|MSA)`]:undefined),4),i.cssClass=s,i.icon={type:2,content:"&#xE946"},r.push(i),i=this.createAdvancedOption("OMVA",t,null,"VerifyButton",null,this.getSubstrateUpsellClickHandler(0,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?[`HeaderFooterViewModel::getAccountOptionsForUserProfileButton(VerifyButton|MSA)`]:undefined),2),i.cssClass=h,r.push(i)),l&&n.isCloudSearchEnabledAadCache&&this._verifyAccountForAADRequired&&(i=this.createAdvancedOption(null,t,null,"VerifyAccountAttention",null,this.getSubstrateUpsellClickHandler(1,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?[`HeaderFooterViewModel::getAccountOptionsForUserProfileButton(VerifyAccountAttention|AAD)`]:undefined),4),i.cssClass=s,i.icon={type:2,content:"&#xE946"},r.push(i),i=this.createAdvancedOption("OMVA",t,null,"VerifyButton",null,this.getSubstrateUpsellClickHandler(1,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?[`HeaderFooterViewModel::getAccountOptionsForUserProfileButton(VerifyButton|AAD)`]:undefined),2),i.cssClass=h,r.push(i))),f.length>0){r.push(this.getMenuDividerOption());for(let u of f)i=this.createAdvancedOption("APPA",t,null,null,u.accountProviderAuthority=="consumers"?["MicrosoftAccount"]:["AadAccount"],()=>{this._accessTokenManager.setSelectedAccount(u,3,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::getAccountOptionsForUserProfileButton::<navigate callback>"]:undefined),n.Host.notifyAccountSelected(u),this._menuFactory.dismiss()},0,null,{type:2,content:"&#xE77B"}),i.message=u.accountUserName,i.narratorText=i.message,i.cssClass=this.getAdvancedOptionCssClass(0),r.push(i)}return r.push(this.getMenuDividerOption()),i=this.createAdvancedOption("OMAC",t,null,null,["ManageAccounts"],()=>n.Host.launchWindowsAccountSettings(),2,null,{type:2,content:"&#xE716"}),i.cssClass=this.getAdvancedOptionCssClass(2),r.push(i),e&&(n.isCloudSearchEnabledMsaCache||!this._accessTokenManager.isMsaAvailable())||(i=this.createAdvancedOption("OMAC",t,null,null,n.isCloudSearchEnabledMsaCache?["AddMicrosoftAccount"]:["EnableMsaSearch"],n.isCloudSearchEnabledMsaCache?()=>n.Host.launchWindowsAccountSettings():()=>n.Host.launchSearchPermissions(),2,null,{type:2,content:n.isCloudSearchEnabledMsaCache?"&#xE8FA":"&#xE9BE"}),i.cssClass=this.getAdvancedOptionCssClass(2),r.push(i)),o&&(n.isCloudSearchEnabledAadCache||!this._accessTokenManager.isAadAvailable())||(i=this.createAdvancedOption("OMAC",t,null,null,n.isCloudSearchEnabledAadCache?["AddAadAccount"]:["EnableAadSearch"],n.isCloudSearchEnabledAadCache?()=>n.Host.launchWindowsAccountSettings():()=>n.Host.launchSearchPermissions(),2,null,{type:2,content:n.isCloudSearchEnabledAadCache?"&#xE8FA":"&#xE9BE"}),i.cssClass=this.getAdvancedOptionCssClass(2),r.push(i)),r}getMenuDividerOption(){return{id:`divider_${this.menuDividerId++}`,selected:!1,title:"",message:null,isSeparator:!0,text:"",instItem:null,click:null,layout:3,isSelectable:!1}}addZiCustomization(t,i,r=true){if(n.config.enableSearchHomeCustomization&&this._currentQuery.isSearchHomeZI&&this._currentQuery.scope==n.Scope.All){let u={};for(let n in this._currentQuery.availableDataSources){let t=this._currentQuery.availableDataSources[n];if(t&&t.suggestionGroupToggler){if(typeof t.groupType!="number")throw new Error("missing groupType declaration for suggestionGroupToggler");u[t.groupType]||(u[t.groupType]=t.suggestionGroupToggler)}}let f=this._currentQuery.staticGroupOrder?this._currentQuery.staticGroupOrder.filter(n=>!!u[n]):Object.keys(u).map(n=>+n);if(f.length!=0){let e=[];for(let t of f){let r=u[t],f=r.isHidden(),o=this.createAdvancedOption("OMZI",i,null,null,[],()=>{r.toggle(!f),this._menuFactory.dismiss(),n.Host.refreshCurrentPane()},2,null,null,null),s=n.getGroupTitleAndNarratorText(this._currentQuery,t,null,!1).title;o.text=n.Host.getLocString(f?"ShowSomething":"HideSomething",s);e.push(o)}let o=this.createAdvancedOption(null,i,null,null,["CustomizeSearchHome"],n=>this._menuFactory.showSubMenu(n),2,null,{type:2,content:"&#xE70F"},e);r&&t.push(this.getMenuDividerOption());t.push(o)}}}addSinglePaneOptions(i,r){let f=this.getScopeBarElements(),e=this.getHiddenScopeElements(f).filter(t=>t.type!=n.Scope.All).map(n=>{let t=n;return t.layout=0,t});i.push(this.createContextMenuGroup(null,r,"MoreScopesListToolTip",e));i.push(this.getMenuDividerOption());let u=[];if(t.authenticationManager.getAllSearchWebAccountsAsync){if(!this._accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::addSinglePaneOptions"]:undefined)||!n.config.userProfileButtonEnabled){let n=this.getAccountOptions(r);u.push(this.createAdvancedOption(null,r,null,null,["ConnectedAccounts"],null,2,null,{type:2,content:"&#xE716"},n))}u.push(this.createAdvancedOption("OMSS",r,null,null,["SearchSettings"],()=>n.config.controlPanelSearchSettings?n.Host.launchSearchPermissions():n.Host.launchSearchSettings(),2,null,{type:2,content:"&#xE713"}))}else(n.isCloudSearchEnabledAadCache||n.isCloudSearchEnabledMsaCache)&&this.addCloudSearchUpsells(u,r,2);u.push(this.getIndexingOption(r,1));this.addZiCustomization(u,r,!1);i.push(this.createContextMenuGroup(null,r,"OptionsButtonToolTip",u));this.isFeedbackEnabled()&&(i.push(this.getMenuDividerOption()),i.push(this.createAdvancedOption("FB",r,null,null,["FeedbackButtonText"],()=>{this.showFeedback(),this._menuFactory.dismiss()},2,null,{type:2,content:"&#xED15"},null)))}getAdvancedOptions(i,r){let u=[];if(r==1){if(t.authenticationManager.getAllSearchWebAccountsAsync&&(u.push(...this.getAccountOptions(i,n.config.userProfileButtonEnabled)),u.push(this.createAdvancedOption("OMSS",i,null,null,["SearchSettings"],()=>n.config.controlPanelSearchSettings?n.Host.launchSearchPermissions():n.Host.launchSearchSettings(),2,null,{type:2,content:"&#xE713"}))),u.push(this.getIndexingOption(i,r)),this.isFeedbackEnabled()&&n.isTwoPanesZIEnabled()){u.push(this.getMenuDividerOption());let n=this.createAdvancedOption("FB",i,null,null,["FeedbackButtonText"],()=>{this.showFeedback(),this._menuFactory.dismiss()},2,null,{type:2,content:"&#xED15"},null);n.cssClass=this.getAdvancedOptionCssClass(2);u.push(n)}this.addZiCustomization(u,i)}return r==2&&this.addSinglePaneOptions(u,i),r==0&&(n.isCloudSearchEnabledAadCache||n.isCloudSearchEnabledMsaCache)&&this.addCloudSearchUpsells(u,i,r),r!=2&&n.config.troubleshootButton&&u.push(this.getMenuDividerOption()),n.config.troubleshootButton&&(r==1||r==2)&&u.push(this.createAdvancedOption("OMTS",i,null,null,["Troubleshoot"],()=>n.Host.launchUri("https://aka.ms/fixsearch"),2,null,{type:2,content:"&#xE90F"},null)),(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)||!this._optionsWindow||r!=1&&r!=2||u.push(this.createAdvancedOption(null,i,null,null,["OptionsWindowButton"],()=>{this._optionsWindow.showOptionsWindow(),this._menuFactory.dismiss()},2,null,{type:2,content:"&#xE90F"},null)),r!=0&&n.TestHookUrlParameters&&n.config.debugFallbackScenario&&u.push(this.createDebugFallbackOption(i)),n.config.snrVersion&&(r==1||r==2)&&(this._shouldShowBuildNumber||n.TestHookUrlParameters||n.isMsftAccountConnected)&&u.push(this.createBuildVersionOption()),u}addCloudSearchUpsells(t,i,r){this.addMsbUpsell(t,i,r);let e=n.substrateProvidersEnabled();if(r==0||r==2){let f=[n.Scope.People,n.Scope.Emails,n.Scope.Documents];if(n.config.accountVerificationInAllScope&&f.push(n.Scope.All),r!=0||this._selectedScope!=null&&n.contains(f,this._selectedScope.type))if(e){if(this._upsellGotDismissed&&this._selectedScope&&n.contains(f,this._selectedScope.type)&&r==0)return;var u=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();(u==1||u==4)&&this._verifyAccountForAADRequired&&t.push(this.getSubstrateUpsell(1,i,r));(u==2||u==4)&&this._verifyAccountForMSARequired&&t.push(this.getSubstrateUpsell(0,i,r))}else n.isBingEnabled()&&n.isCortanaEnabledCache&&t.push(this.getOneDriveUpsell(i))}}addMsbUpsell(t,i,r){if(n.config.msbAccountVerificationInSearchHome&&n.msbHost&&n.msbEnabledForQuery(null)&&r==0&&this._selectedScope!=null&&this._selectedScope.type==n.Scope.All&&this._currentQuery!=null&&this._currentQuery.isSearchHomeZI){let f=!1,e="MsbVerifyAccount",o=[];const s=n.msbHost.tenantManager.getStoredMsbTenantName();s&&(f=!0,e="MsbReverifyAccount",o=[s]);const u={isReverify:f,WSB_SessinRandom:n.Host.createGuid(),WSB_Position:r,WSB_SequenceNumber:i,WSB_ScopeType:this._selectedScope.type},c=()=>{const t=()=>{_w.bfbWsbTel&&bfbWsbTel.logValue("VerifyAccountSuccess","",u),n.Host.refreshCurrentPane(),n.Host.setFocusInSearchBox(null,"MsbAadUpsell")},i=()=>{_w.bfbWsbTel&&bfbWsbTel.logValue("VerifyAccountFailed","",u),n.Host.refreshCurrentPane(),n.Host.setFocusInSearchBox(null,"MsbAadUpsell")};_w.bfbWsbTel&&bfbWsbTel.logValue("VerifyAccountDialogShown","",u);this._accessTokenManager.promptAutheticateDialog(1,"9ea1ad79-fdb6-4f9a-8bc3-2b70f96e34c7",t,i,(n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["HeaderFooterViewModel::onNavigate(MsbAadUpsell)"]:undefined)},h=this.createAdvancedOption("MSBA",i,null,e,null,c,6,null,{type:2,content:"&#xE814"},null,o,"VerifyButton");h.cssClass="msb-aad-upsell";t.push(h);_w.bfbWsbTel&&bfbWsbTel.logValue("VerifyAccountUpsellAdded","",u)}}chatButtonClicked(t,i,r,u){const e=n.SequenceNumberManager.getSequenceNumber();let f=this.getInstItem(r?"CCBL":"CCBR",e);f=n.InstrumentationHelper.createCodexClickItemProps(f,r?"ChatButtonLeft":"ChatButtonRight");n.InstrumentationHelper.instrumentItemClick(t,f,e,null,i,u);let o=r?`${location.origin}/search?form=WSBCSL&showconv=1&sendquery=1&q=${this._currentQuery.queryToFetch}`:n.config.codexBtnUpperRightLaunchURI,s={campaign:n.config.moreEdgeProtocolOCID,medium:r?"CodexButtonLeft":"CodexButtonRight"};o&&n.Host.launchCodexUri(o,s)}}n.HeaderFooterViewModel=y}(WSB||(WSB={})),function(n){function t(n,t){let i=HitHighlightingParser.removeMarkers(n.text);if(!i.includes(t.queryToFetch)&&i.toLowerCase().startsWith(t.queryToFetch.toLowerCase())){let r=t.queryToFetch+i.substr(t.queryToFetch.length);n.text=HitHighlightingParser.addMarkers(r,t.queryToFetch)}!n.query.includes(t.queryToFetch)&&n.query.toLowerCase().startsWith(t.queryToFetch.toLowerCase())&&(n.query=t.queryToFetch+n.query.substr(t.queryToFetch.length))}function i(i,r,u,f,e,o,s){if(i.actionUri=f,i.confidence=o,i.source=s,i.handoffType==4){let u=i.query.toLowerCase()==r.queryToFetch.toLowerCase();i.updateFromQuery=t=>u?(i.query=t.queryToFetch,i.text=HitHighlightingParser.addMarkers(i.query,t.queryToFetch),i.narratorText=n.getNarratorText(i),!0):!1;let t=n.parseTaskFrame(e);if(t)i.isReformulation=!0,i.click=()=>n.safeSetTimeout(()=>n.Host.reformulate(i.query,t),0,"Cat1Click-Reformulation");else return!1}else i.classNames.push("action"),i.click=()=>n.Host.launchCat1(i.query,f,e);return i.icon={type:3},t(i,r),i.narratorText=n.getNarratorText(i),i.type!="CSK"&&(i.getMruData=()=>Object.assign(Object.assign({},n.getMruWebSuggestionData(i)),{annotation:i.primaryMetadata,actionUri:f,taskFrame:e,confidence:o,source:s})),!0}function o(i,r,u,e,o,s,h,c,l,a,v){if(i.isAnswer=!0,i.htmlContent=e&&e.Content?e.Content.HTML:null,i.segments=c,i.htmlContent){let n=JsonInject.GetResourceKeys([e]);n&&(i.executeScript=()=>JsonInject.WriteAfterContentResources(JsonInject.FilterResources(a,n)))}s&&(i.secondaryIcon={content:s,type:0});i.text.includes(HitHighlightingParser.startMarker)||(i.text=HitHighlightingParser.addMarkers(i.text,r.queryToFetch));i.htmlContent||o&&(i.primaryMetadata=o,i.additionalInfoText=" - "+o);i.handoffType==10?(i.classNames.push("action"),t(i,r),i.icon={type:3},i.click=()=>n.Host.launchCat2or3a(i.query,l),i.allowedInGroups=!i.htmlContent):(f(i,r),i.click=()=>n.Host.launchSearch(i.query,v.getSearchUrl(r.fullPartialQuery,i.query,i.type,h),!1),i.allowedInGroups=i.secondaryIcon?!!i.additionalInfoText:!i.htmlContent,i.getMruData=()=>n.getMruUrlSuggestionData(i,h));i.narratorText=n.getNarratorText(i)}function r(t,i,r,u,e,o){var s,h;f(t,i);i.queryToFetch||(t.text=HitHighlightingParser.addMarkers(t.text));n.config.enableMoreEdgeProtocol?(t.click=()=>n.Host.launchSearch(t.query,e.getSearchUrl(i.fullPartialQuery,t.query,t.type,u,t.handoffType,i.isSearchHomeZI&&n.mapOSFormCode("WSHBSH")),t.useRaf,i.isSearchHomeZI&&n.mapOSFormCode("WSHBSH")),((s=i.fullPartialQuery)===null||s===void 0?void 0:s.length)>0&&n.shouldQFSuggToBingChat(t.query)&&n.setSearchSuggestionChatIcon(t)):(t.click=()=>n.Host.launchSearch(t.query,e.getSearchUrl(i.fullPartialQuery,t.query,t.type,u,t.handoffType,i.isSearchHomeZI&&n.mapOSFormCode("WSHBSH")),t.useRaf),((h=i.fullPartialQuery)===null||h===void 0?void 0:h.length)>0&&n.shouldQFSuggToBingChat(t.query)&&n.setSearchSuggestionChatIcon(t));t.narratorText=n.getNarratorText(t);t.getMruData=()=>n.getMruUrlSuggestionData(t,u);t.type=="HS"&&n.setExtraVerbs(t,()=>{let i=[{verb:"ManageSearchHistory",displayName:n.Host.getLocString("ManageSearchHistory"),executeSync:()=>n.Host.launchPrivacyPortal(),icon:{content:"&#xE81C",type:2}}];return n.config.removeSuggUrl&&i.unshift({verb:"RemoveFromWebHistory",displayName:n.Host.getLocString("RemoveFromWebHistory"),executeSync:()=>o(t.text),icon:{content:"&#xE711",type:2}}),i},!0)}function u(t,i,r,u){t.tooltip=i.isSearchHomeZI?t.text+"\n\n"+u:u+"\n\n"+HitHighlightingParser.removeMarkers(t.primaryMetadata);n.isValidIcon(t.icon)||(t.getIcon=n.Host.getEdgeIcon);t.url=u;t.click=n.config.enableLaunchWithProfile&&t.handoffType==1?()=>n.Host.launchUrlWithEdgeProtocol(u,{}):()=>n.Host.launchUri(u);t.narratorText=n.getNarratorText(t,n.Host.getLocString("DirectNavSuggestion"));t.getMruData=()=>n.getMruUrlSuggestionData(t,u)}function f(t,i){n.isValidIcon(t.icon)||(t.icon=t.type=="HS"?{content:"&#xE81C",type:2}:t.handoffType===13?{content:"&#xEB9F",type:2}:t.handoffType===14?{content:"&#xE714",type:1}:n.getSearchSuggestionIcon());t.primaryMetadata||t.secondaryIcon||t.htmlContent||t.additionalInfoText||(t.primaryMetadata=t.handoffType===13?n.Host.getLocString("SearchForWebImages"):t.handoffType===14?n.Host.getLocString("SearchForWebVideos"):n.getWebSuggestionAnnotation(n.msbEnabledForQuery(i)))}class e{constructor(t,i,r,u){this._navigationHelper=t;this._temporaryMessageHandler=i;this._accessTokenManager=r;this._previousKeystrokeCache=u;this.removeBingHistorySuggestionCallBack=t=>{this._accessTokenManager?this._accessTokenManager.getAccount(0,n.getBingResourceOrScope(0),!1,!0,i=>{if(i&&i.Token){let n={};n["X-Search-RPSToken"]=i.Token;this.sendRemoveBingHistorySuggestionRequest(t,n)}else n.logAuthRelatedInfo("getAccountOnFailure::OnlineSuggParser::removeBingHistorySuggestionCallBack","authenticate failed for MSA account.")},undefined,n.Host.isAuthInvestigation()?["OnlineSuggestionParser::removeBingHistorySuggestionCallBack"]:undefined):this.sendRemoveBingHistorySuggestionRequest(t,null)}}parse(n,t,i,r,u,f,e){this.parseOnlineSuggestions(n,t,r,u,f,e,i)}parseOnlineSuggestions(t,i,r,u,f,e,o){if(!r){n.isDataSourceEnabled("Web",t)&&f("Web",[],null);n.isDataSourceEnabled("OSTMA",t)&&f("OSTMA",[],null);n.isDataSourceEnabled("QS",t)&&f("QS",[],null);return}r&&r.ELToken&&(n.Host.setElToken(r.ELToken),r.LC==1&&n.Host.sendElToken());let h=[],c=[],l=[],s=[],a=[],v=n.isDataSourceEnabled("Web",t);if(n.safeExecute(()=>{for(let u of r.Suggestions){let f=u.Attributes,e=f.appId;if(e){c.push(u);e.split(";").forEach(t=>{n.contains(s,t)||s.push(t)});continue}let y=f.settingId;if(y){l.push(u);a.push(y);continue}if(v){let f=n.safeExecute(()=>this.parseOnlineSuggestion(t,u,i,r.Resources,o),"parseOnlineSuggestion");f&&h.push(f)}}},"parseOnlineSuggestions"),v){let i=null,u=null;r.RankingSignals&&(i=n.safeExecute(()=>n.parseWebEngagementSignals(r.RankingSignals),"parseWebEngagementSignals"),n.isL2(t)||(u=n.safeExecute(()=>n.parseWebSuppressionSignals(r.RankingSignals,t),"parseWebSuppressionSignals")));this._previousKeystrokeCache&&this._previousKeystrokeCache.updateWebSignalsData(t.queryToFetch,i);let e={rankingSignals:r.RankingSignals,engagementSignals:i,suppressedGroups:u,webTopResultRoutingType:r.PrefixRoutingType};f("Web",h,e)}n.lookupById(t,"OSTMA",s,c,n=>n.Attributes.appId.split(";"),"QS",a,l,n=>n.Attributes.settingId,u,i,f,e,(n,u,f,e)=>this.parseIdLookupResponse(r,t,i,n,u,f,e),null,null,null,null)}parseIdLookupResponse(t,r,u,f,e,o,s){if(o.length!=1){let i=n.safeExecute(()=>this.parseOnlineSuggestion(r,f,u,t.Resources,e),"parseOnlineSuggestion "+e);i&&s.push(i);return}let h=t=>{let e=f.Attributes;return this.compliesWithMinVersion(e.appMinVersion,t.deviceItem.version)?(t.appContext=e.appContext,this.setRankingSignals(t,f),f.Text&&e.query&&(!n.isApp(t.type)||t.appContext)&&(t.text=f.Text,t.query=e.query),f.SecondaryText&&(t.primaryMetadata=f.SecondaryText),t.handoffType==5)?i(t,r,u,e.actionUri,e.taskFrame,parseFloat(e.confidence),parseInt(e.source)):!0:!1};n.safeExecute(()=>n.parseLocalSuggestion(r,o[0],e,u,this._temporaryMessageHandler,f.Attributes.stype,s,h),"parseLocalSuggestion "+e)}parseOnlineSuggestion(t,f,e,s,h){let c=f.Attributes,a=c.stype;if(a=="CS"||c.appId||c.settingId)return null;let v;v=c.isAnswer==="1"?c.url||c.vertical?n.verticalToHandoffType(c.vertical):10:c.taskFrame?c.actionUri.startsWith("action://FindMyStuff/")?4:5:a=="MD"||a=="ML"?1:n.verticalToHandoffType(c.vertical);let l=n.createSuggestion(t,f.Text,null,n.getIconFromOnlineResponse(f),a,c.query,n.InstrumentedItem.createInstrumentedItem(e,a),v,e,!1);if(l.primaryMetadata=f.SecondaryText,this.setRankingSignals(l,f),l.autoOpenPreviewPaneWhenOnTopHit=c.openPP==="1",c.isAnswer==="1"){if(!c.url&&!n.isCortanaEnabledCache)return null;l.signals=f.Signals;o(l,t,e,f.InstantAnswer,c.additionalInfoText,c.secondaryIconUrl,c.url,c.segments,c.taskFrame,s,this._navigationHelper);c.noHeightRestriction==="1"&&l.classNames.push("noHeightRestriction");l.reactKey=a+c.url}else if(c.taskFrame){if(!n.isCortanaEnabledCache||!i(l,t,e,c.actionUri,c.taskFrame,parseFloat(c.confidence),parseInt(c.source)))return null;l.reactKey=a+c.taskFrame}else{if(!c.url)return null;if(l.autoOpenPreviewPaneWhenOnTopHit=c.openPP==="1",l.reactKey=a+t.queryToFetch+c.url,l.type=="MD"||l.type=="ML"){let i=n.prettyPrintUrl(c.query,t.queryToFetch,!0);i!=l.query&&(l.query=i,l.text=t.queryToFetch?HitHighlightingParser.addMarkers(i,t.queryToFetch):i);l.primaryMetadata&&!l.primaryMetadata.includes(HitHighlightingParser.startMarker)&&(l.primaryMetadata=HitHighlightingParser.addMarkers(l.primaryMetadata,t.queryToFetch));u(l,t,e,c.url)}else{if(n.queryLooksLikeUrl(l.query))return null;r(l,t,e,c.url,this._navigationHelper,this.removeBingHistorySuggestionCallBack)}}if(!n.isValidSuggestion(l,"parseOnlineSuggestion"))return null;const k=["Actor","City","Place","Country","State","Animal","Attraction","Food","Artist","People"],d=["Song","TvShow","Movie"];let y=l.segments,p=y?y.split(","):[],w=p.some(t=>n.contains(k,t)),b=p.some(t=>n.contains(d,t));return(f.ChildSuggestions||w||b)&&(l.calculateChildSuggestions=()=>this.calculateRelatedSuggestions(l,t,f,h,w,b)),n.config.directNavPreviewPane&&l.type=="MD"&&l.url&&(l.getIcon=n.getFaviconUrlForRawUrl(l.url,64,64,1.5),l.previewPaneType=2),l}setRankingSignals(n,t){let i=t.Attributes;n.hc=i.hc==="1";n.highConfidenceSuggestionScore=+i.hcs;n.highConfidenceMetaSuggestionScore=t.HighConfidenceMetaSuggestionScore;n.prefetchConfidenceScore=t.PrefetchConfidenceScore;n.suggestionLogMeta=i.lm}compliesWithMinVersion(n,t){if(!n)return!0;if(!t)return!1;let i=n.split("."),r=t.split(".");while(i.length>r.length)r.push("0");for(let n=0;n<i.length;++n){let t=r[n],u=i[n];if(t<u)return!1;if(t>u)return!0}return!0}sendRemoveBingHistorySuggestionRequest(t,i){t=HitHighlightingParser.removeMarkers(t);let r=n.config.removeSuggUrl.replace("%7b0%7d",encodeURIComponent(t)).replace("%7bSID%7d",sj_cook.get("_SS","SID"));n.fetchUrlJson(r,i,null,i=>{i&&i.success&&(n.Host.refreshCurrentPane(),n.safeSetTimeout(()=>this._temporaryMessageHandler.showTemporaryMessage(n.Host.getLocString("RemoveFromWebHistoryConfirmation",t)),250,"removeBingHistorySuggestion"))})}addRelatedSuggestion(t,i,u,f,e,o,s){let h=n.createSuggestion(i,f,null,e,o,t?t.Query:u.query,n.InstrumentedItem.createInstrumentedItem(u.sequenceNumber,o),s,u.sequenceNumber,!1,null,null,!0);h.groupType=n.GroupType.Related;h.parent=u;h.isChild=!0;h.tooltip=t?t.SecondaryText:null;h.rankingScore=t?t.RankingScore:0;h.category=t?t.Category:null;h.isAnswer=!0;r(h,i,u.sequenceNumber,t?t.Url:null,this._navigationHelper,this.removeBingHistorySuggestionCallBack);h.primaryMetadata=null;h.reactKey=o+f+(t?t.Category+t.SecondaryText:"");n.isValidSuggestion(h,"calculateRelatedSuggestions")&&u.childSuggestions.push(h)}calculateRelatedSuggestions(t,i,r,u,f,e){if(t.childSuggestions=[],r.ChildSuggestions)for(let u of r.ChildSuggestions)this.addRelatedSuggestion(u,i,t,u.Text,n.getIconFromOnlineResponse(u),u.Type,0);f&&this.addRelatedSuggestion(null,i,t,n.Host.getLocString("Images"),null,"EIM",13);e&&this.addRelatedSuggestion(null,i,t,n.Host.getLocString("Videos"),null,"EVI",14);t.childSuggestions.length>0&&n.InstrumentationHelper.instrumentDataSource(t.sequenceNumber,u,t.childSuggestions,null)}}n.OnlineSuggestionsParser=e;n.adjustCasing=t;n.setCat1SuggestionProperties=i;n.setWebSearchSuggestionProperties=r;n.setUrlSuggestionProperties=u}(WSB||(WSB={})),function(n){function p(n){return n?[n]:[]}function rt(n){if(n){let t=n.lastIndexOf(".");if(t>=0)return n.substring(t)}return""}function ut(t){let i=t?new Date(t):null;return n.isValidDate(i)?i:null}function ft(t){if(t){let i=n.getCurrentDate();if(i.getDate()==t.getDate()&&i.getMonth()==t.getMonth()&&i.getFullYear()==t.getFullYear())return t.toLocaleTimeString(n.uiLanguageCache,{hour:"numeric",minute:"numeric"})}return null}function r(t,r,u,e,o=false){if(!o&&e.extensionLC&&SearchAppWrapper.CortanaApp.hideFileExtensions){let i=e.extensionLC.length,t=e.query,u=t.toLocaleLowerCase();if(u.endsWith(e.extensionLC)){let f=r?HitHighlightingParser.addMarkers(t,r):t,o=n.config.disableSyntaxHighlight?r===""||!e.extensionLC.toLocaleLowerCase().startsWith("."+r.toLocaleLowerCase()):f.toLocaleLowerCase().endsWith(e.extensionLC);if(o){e.query=t.substring(0,t.length-i);let n=e.text.toLocaleLowerCase(),r=HitHighlightingParser.removeMarkers(n);if(u==r){let t=n.lastIndexOf(e.extensionLC);t>0&&(e.text=e.text.substring(0,t)+e.text.substr(t+i))}}}}if(e.lastModifiedDate&&(e.lastModifiedDateString=e.lastModifiedDate.toLocaleString(n.uiLanguageCache,{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric"})),e.lastAccessDate&&(e.lastAccessDateString=e.lastAccessDate.toLocaleString(n.uiLanguageCache,{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"numeric"})),e.primaryMetadata=e.sourceForGroup&&e.sourceForGroup!=1?n.getGroupSourceDisplayName(e.sourceForGroup):e.itemTypeDisplayName,e.explanation?e.additionalInfoText=e.explanation:t.isSearchHomeZI&&(e.additionalInfoText=e.prettyPrintedPath||e.path),e.classNames=e.classNames.indexOf("fbig")>=0?["fbig"]:[],e.match){let t=(at(e.match.matchType)?n.Host.getLocString(n.MatchType[e.match.matchType])+": ":"")+HitHighlightingParser.addMarkers(e.match.matchedText,r);e.additionalInfoText=t;e.secondaryMetadata=t;e.classNames.push("withMatchAnnotation","forceNoWrapOutsideTopResult")}else e.lastModifiedDateString&&n.RuntimeConfig.QfMode!=5&&(e.secondaryMetadata=n.Host.getLocString("LastModified")+": "+e.lastModifiedDateString);e.narratorText=n.getNarratorText(e);n.displayedInGridLayout(e.type)&&(u?e.classNames.push("bigIcon","biggerIcon"):e.classNames.push("bigIcon"));!o&&e.handoffType==2&&SearchAppWrapper.CortanaApp.copyToClipboard&&i(e,()=>[{verb:n.JumplistActionItemType[n.JumplistActionItemType.S_CopyFullPath],displayName:n.Host.getLocString("CopyFullPath"),executeSync:()=>SearchAppWrapper.CortanaApp.copyToClipboard(e.path,""),icon:{type:1,content:"&#xE8C8"}}],!1);let h={},s=e.prettyPrintedPath||e.path;if(s){let i=s.lastIndexOf("/");i<0&&(i=s.lastIndexOf("\\"));i<0&&(i=s.lastIndexOf(" > "));let t=s.substring(0,i);t.endsWith(":")&&(t=t+"\\");e.parentFolder=t;h[n.Host.getLocString("Location")]=[{text:t,click:()=>n.isUncOrLocalPath(t)?SearchAppWrapper.CortanaApp.launcher.startLaunchFolder(t):e.locationUrl?SearchAppWrapper.CortanaApp.launcher.launchUriAsync(decodeURI(e.locationUrl)):SearchAppWrapper.CortanaApp.launcher.launchUriAsync(t)}]}let c=n.nicerCloudFilesEnabled(t,e);e.tooltip=lt(e,c);for(let[t,i,r]of f){let u=e[r];u&&!t&&(h[n.Host.getLocString(i)]=[{text:u}]);e.previewMetadata=h}}function et(t,i,u){i.match||!u.match||i.parentFolderDisambig||(i.match=u.match,i.needsRefreshAfterDeduping=!0,i.previewPaneNeedsRefreshAfterDeduping=!0);for(let[,,n]of f){let t=u[n];t&&!i[n]&&(i[n]=t,i.needsRefreshAfterDeduping=!0,i.previewPaneNeedsRefreshAfterDeduping=!0)}(n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9)&&(i.needsRefreshAfterDeduping=!1,i.previewPaneNeedsRefreshAfterDeduping=!1);i.needsRefreshAfterDeduping&&r(t,n.getEffectiveQuery(t),n.isL2(t),i,!0)}function ot(t,i,r=1){return n.Async.safeChainWithGlobalCaching("getIconForTypeAsync",t=>SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getIconForTypeAsync(i,n.getImageSizeValue(t)),n=>n+"_"+i,i=>n.toIcon(i,"getIconForTypeAsync",t),t,null,null,r)}function w(n){return n!=null&&(n.type==3||!!n.content||!!n.className)}function e(n,t,i=true){let r=n.mayContainPII;return n.text?n.query?!n.handoffType&&n.handoffType!==0?(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing handoff type")),!1):n.type?i&&!n.getIcon&&!w(n.icon)?(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing icon")),!1):!0:(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing suggestion type")),!1):(SharedLogHelper.LogError(t,r?"":n.text,new Error("Missing query")),!1):(SharedLogHelper.LogError(t,r?"":n.deviceItem?n.deviceItem.id:"",new Error("Missing text")),!1)}function i(t,i,r){let u=t.getExtraVerbs;t.getExtraVerbs=t=>{let f=u?u(t):[],e=i(t);return n.joinVerbs(f,e,r)}}function st(t,i,r){let u=t.getExtraVerbsAsync;t.getExtraVerbsAsync=u?t=>ThresholdUtilities.createPromise(f=>u(t).then(u=>i(t).then(t=>f(n.joinVerbs(u,t,r))))):i}function u(n,t){let r=n.propertyHits||[],i=r.indexOf(t);return typeof i=="object"&&i.returnValue!==undefined?i.returnValue:i>=0}function ht(n){if(n&&typeof n=="object"&&n.length){let t="";for(let i=0;i<n.length;i++)t+=n[i],i!=n.length-1&&(t+=", ");return t}return n}function t(t,i,r){return n.safeExecute(()=>ht(t.getProperty(i)),"get"+i,undefined,r)}function ct(t,i,...r){for(let[f,i,e]of r)if(i&&u(t,e))return n.createMatch(f,i);return null}function lt(t,i){let r=i?t.query+"\n"+t.parentFolder:t.prettyPrintedPath||t.path||"";t.textContentIfMatched&&(r+=(r?"\n\n":"")+t.textContentIfMatched);let u=!!r,e=()=>{r&&(r+="\n"),u&&(r+="\n",u=!1)};for(let[o,s,u]of f)if(!i||u!="lastModifiedBy"||!t.lastModifiedDateString){let f=t[u];f&&(!o||i)&&(e(),i&&u=="lastModifiedDateString"&&t.lastModifiedBy&&(f=n.Host.getLocString("LastModifiedCombined",f,t.lastModifiedBy)),r+=n.Host.getLocString(s)+": "+f)}return t.explanation&&t.meeting&&(r=HitHighlightingParser.removeMarkers(t.explanation)+"\n\n"+r),r}function at(t){switch(t){case n.MatchType.Author:case n.MatchType.LastModifiedBy:case n.MatchType.Tags:case n.MatchType.Genre:case n.MatchType.Album:case n.MatchType.Artist:return!0;case n.MatchType.Content:case n.MatchType.Location:return!1;default:throw new Error("Unknown match type: "+t);}}function yt(t,i,r,u,f,e,o,s,h,c,l,a,v,y,w,b,k,d){i&&n.isDataSourceEnabled(i,t)&&n.LocalDataProvider.getApps(r,t=>{if(c()){n.InstrumentationHelper.instrumentResponseReceived(l,i,null,0,!1,!1);let r=[];for(let e of u)n.safeExecute(()=>y(e,i,f(e).map(n=>t[n]).filter(n=>!!n),r),"parseApp "+i);a(i,r,null)}},v,i);e&&n.isDataSourceEnabled(e,t)&&n.LocalDataProvider.getSettings(o,t=>{if(c()){n.InstrumentationHelper.instrumentResponseReceived(l,e,null,0,!1,!1);let r=[];for(let u of s)n.safeExecute(()=>y(u,e,p(t[h(u)]),r),"parseSetting "+i);a(e,r,null)}},v,e);w&&n.isDataSourceEnabled(w,t)&&n.LocalDataProvider.getFiles(b,t=>{if(c()){if(n.config.enableMRUFilesAndFoldersTelemetry||n.config.disableMRUFilesAndFoldersWildCards){let i=0,r=0;for(let n in t)t[n]||i++,r++;n.Host.setMRUFilesAndFoldersDefinedCount(r);n.Host.setMRUFilesAndFoldersUndefinedCount(i)}n.InstrumentationHelper.instrumentResponseReceived(l,w,null,0,!1,!1);let i=[];for(let r of k)n.safeExecute(()=>y(r,w,p(t[d(r)]),i),"parseFile "+w);a(w,i,null)}},t,v,w)}function pt(t){return n.EdgeAppIds.some(n=>t.id==n)?n.Host.getLocString("MicrosoftRecommendedBrowser"):n.Host.getLocString("App")}function wt(t){return n.isModernSetting(t)?n.Host.getLocString("SystemSettingsAnnotation"):n.Host.getLocString("ControlPanelAnnotation")}function bt(t){return n.isFileOrFolder(t.type)?t.deviceItem:null}function kt(t,u,f,e,o,s){let h=n.getAppItem(o);if(h){e&&b(o,h);o.primaryMetadata=pt(h);o.narratorText=n.getNarratorText(o);o.tooltip=t.isSearchHomeZI?o.text:"";o.type=="IBA"&&(o.tooltip=h.id,o.path=h.id);return}if(n.isSetting(o.type)){o.primaryMetadata=wt(o.deviceItem);o.narratorText=n.getNarratorText(o);o.tooltip=t.isSearchHomeZI?o.text:"";return}if(o.type=="LURL"&&(h=o.deviceItem,h)){let t=h.id;o.narratorText=n.getNarratorText(o,n.Host.getLocString("DirectNavSuggestion"));o.tooltip=o.query+"\n\n"+t;o.url=t;return}let c=bt(o);if(c){dt(t,u,f,e,s,o,c);return}if(o.type=="PT"||o.type=="CG"){let n=o;o.type!="PT"&&o.deviceItem.launchArguments||(n.path=o.deviceItem.id);let i=o.deviceItem,s=i.kind;if(s=="program"){k(o);return}let e=gt(i);if(e){n.itemTypeDisplayName=e;r(t,u,f,n);return}o.type=="CG"&&k(o);return}if(o.type=="FEH"){if(o.narratorText=n.getNarratorText(o,n.Host.getLocString("SearchHistorySuggestion")),u&&(o.text=HitHighlightingParser.addMarkers(o.text,u)),SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.onSearchHistoryRemoved){let t={verb:"RemoveFromDeviceHistory",displayName:n.Host.getLocString("RemoveFromDeviceHistory"),executeSync:()=>{SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.onSearchHistoryRemoved(o.query);n.Host.refreshCurrentPane()},icon:{content:"&#xE711",type:2}};i(o,()=>[t],!1)}return}throw new Error("Unexpected type: "+o.type);}function dt(i,f,e,o,s,h,c){let l;l=h.type=="LDOC"?n.resolveKnownFolderGUIDsInPath(c.id):n.indexerFilePathToRegularPath(c.id);h.path=l;h.itemTypeDisplayName=c.itemTypeDisplayName;o&&b(h,c);let a=c.lastModifiedDate;n.isValidDate(a)&&(h.lastModifiedDate=a);let v=c.extension;if(v&&(h.extensionLC=v.toLocaleLowerCase()),s!="MFF"||n.IndexerQueryGenerator){h.type=="MU"&&(h.artist=n.IndexerQueryGenerator?t(c,"System.Music.DisplayArtist",s):t(c,"System.Music.Artist",s),h.album=t(c,"System.Music.AlbumTitle",s));let i;switch(s){case"MPVD":if(h.author=t(c,"System.Author",s),h.lastModifiedBy=t(c,"System.Document.LastAuthor",s),h.tags=t(c,"System.Keywords",s),h.tags+=t(c,"System.Photo.TagViewAggregate",s),u(c,"System.Search.Contents")){let r=t(c,"System.Search.AutoSummary",s);r&&([h.textContentIfMatched,i]=n.tryGetTextContentMatch(r,f));c.propertyHits.length==1&&(h.matchedOnlyOnContent=!0)}n.IndexerQueryGenerator&&(h.artist=t(c,"System.Music.DisplayArtist",s),h.genre=t(c,"System.Music.Genre",s));break;case"MDOC":if(h.author=t(c,"System.Author",s),h.lastModifiedBy=t(c,"System.Document.LastAuthor",s),h.tags=t(c,"System.Keywords",s),u(c,"System.Search.Contents")){let r=t(c,"System.Search.AutoSummary",s);r&&([h.textContentIfMatched,i]=n.tryGetTextContentMatch(r,f));c.propertyHits.length==1&&(h.matchedOnlyOnContent=!0)}break;case"MPHO":h.tags=t(c,"System.Photo.TagViewAggregate",s);break;case"MVID":n.IndexerQueryGenerator&&(h.artist=t(c,"System.Music.DisplayArtist",s),h.genre=t(c,"System.Music.Genre",s));h.tags=t(c,"System.Keywords",s);break;case"MMUS":h.genre=t(c,"System.Music.Genre",s)}let r=n.config.disableSyntaxHighlight?!h.text.startsWith(n.Host.getQuery().queryToFetch)&&f:!h.text.includes(HitHighlightingParser.startMarker)&&f;if(r){let r,e=s!="LM"&&s!="FL";if(e&&(s=="MFF"?(r=t(c,"System.Title",s),r&&!n.matchesOnPropertyHH(r,f)&&(r=undefined)):u(c,"System.Title")&&(r=t(c,"System.Title",s))),r)h.text=HitHighlightingParser.addMarkers(r,f);else if(i)h.match=i;else{let t=n.IndexerQueryGenerator?"System.Music.DisplayArtist":"System.Music.Artist";h.match=ct(c,s,[n.MatchType.Album,h.album,"System.Music.AlbumTitle"],[n.MatchType.Artist,h.artist,t],[n.MatchType.Genre,h.genre,"System.Music.Genre"],[n.MatchType.Tags,h.tags,"System.Keywords"],[n.MatchType.Tags,h.tags,"System.Photo.TagViewAggregate"],[n.MatchType.Author,h.author,"System.Author"],[n.MatchType.LastModifiedBy,h.lastModifiedBy,"System.Document.LastAuthor"])}}}r(i,f,e,h);ni(h)}function b(t,i){let r=n.safeExecute(()=>i.getProperty("System.Link.TargetParsingPath"),"getTargetPath");if(r){r=r.toLocaleLowerCase();let i=n.getKnownFolderPathLC(n.FOLDERID_Profile);if(i){let t=n.getKnownFolderPathLC(n.FOLDERID_SystemX86);if(t&&r.startsWith(t+"\\config\\systemprofile"))r=i+r.substr(t.length+21);else{let t=n.getKnownFolderPathLC(n.FOLDERID_System);t&&r.startsWith(t+"\\config\\systemprofile")&&(r=i+r.substr(t.length+21))}}t.targetPathLC=r}}function gt(n){if(n.launchArguments)return null;let t=n.itemTypeDisplayName;return t&&t[0]!="."?t:null}function o(t){let i=[];for(let r=0;r<t.length-1;++r){let u=t[r];if(!n.displayedInGridLayout(u.type)&&!u.explanation)for(let n=r+1;n<t.length;++n){let f=t[n];if(u.type==f.type&&u.text.toLocaleLowerCase()==f.text.toLocaleLowerCase()){i[r]=!0;i[n]=!0;break}}}if(i.length!=0){let u=t.filter((n,t)=>i[t]),r=n.Host.getLocString("InfoTextWithSource");for(let t of u)if(t.path){let u=t.path.lastIndexOf("\\");if(u==-1)continue;let i=t.path.slice(t.path.lastIndexOf("\\",u-1)+1,u),f=t.handoffType==2?null:t.primaryMetadata;if(f&&i.endsWith(":"))continue;t.type=="IBA"?(t.secondaryMetadata=t.primaryMetadata,t.primaryMetadata=i):t.primaryMetadata=t.primaryMetadata?f?n.formatString(r,[i,t.primaryMetadata]):n.formatString(r,[t.primaryMetadata,i]):i;t.additionalInfoText=n.formatString(r,[" -",i]);t.match&&(t.classNames=t.classNames.filter(n=>n!="withMatchAnnotation"&&n!="forceNoWrapOutsideTopResult"));t.narratorText=n.getNarratorText(t);t.parentFolderDisambig=i}}}function k(t){t.primaryMetadata=n.Host.getLocString("RunCommandPrompt");t.classNames.push("action");t.narratorText=n.getNarratorText(t)}function d(t,i,r,u,f,o,s,h){let y=n.localDataSourceMayContainPII(r);if(!o){let n=i.deviceItem.kind;SharedLogHelper.LogError("parseLocalSuggestion"+r,y?"":i.deviceItem.displayName||i.deviceItem.id,new Error("Unrecognized kind: "+n));return}let p=o=="LURL"?1:2;if(n.isSuggestionTypeEnabled(r,o,p,t)){let a=n.getEffectiveQuery(t),v=i.deviceItem.displayName,w=v&&a?HitHighlightingParser.addMarkers(v,a):v,c=n.createSuggestion(t,w,i.getIcon,i.icon,o,v,n.InstrumentedItem.createInstrumentedItem(u,o),p,u,y);c.uxHint=ui(i,a);i.deviceItem.isSimulated||(c.deviceItem=i.deviceItem);c.ciMetaData=i.ciMetaData;n.isApp(o)&&(c.pinnedToTaskbar=n.Host.isPinnedToTaskbar(i.deviceItem.id));i.groupDisplayName&&(c.groupDisplayName=i.groupDisplayName);let l=n.getAppItem(c);if(l?(c.click=()=>n.Host.launchAppItem(l,r,c.appContext),n.config.maxJLcm&&ti(t,c,l,f,u,r),c.reactKey=o+l.id):c.type=="FEH"?(c.click=()=>n.Host.submitFileExplorerTextSuggestion(c.query),c.reactKey=o+c.query):c.type=="FD"&&n.RuntimeConfig.QfMode==5?(c.click=()=>n.Host.submitFileExplorerFolderSuggestion(c.path),c.reactKey=o+c.deviceItem.id):(c.click=()=>n.Host.launchDeviceItem(c.deviceItem,r),c.reactKey=o+c.deviceItem.id),l&&c.type!="IBA"||n.isSetting(c.type)||n.isFileOrFolder(c.type)&&c.type!="LDOC")c.getMruData=()=>Object.assign(Object.assign({},n.getMruSuggestionData(c)),{id:i.deviceItem.id,appContextData:c.appContext?{appContext:c.appContext,query:c.query,textWithoutHH:HitHighlightingParser.removeMarkers(c.text)}:undefined});else{let t=n.getCommandLineItem(c);t&&(c.hc=n.isRealCommand(c,t))}let b=n.getGroupType(c);n.shouldSetThisPcGroupSource(b,t)&&(c.sourceForGroup=1);kt(t,a,n.isL2(t),n.supportsShortcuts(r,t),c,r);(n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9)&&(c.additionalInfoText=undefined,c.primaryMetadata=undefined,c.secondaryMetadata=undefined);c.reactKey||(c.reactKey=o+t+i.deviceItem.id);e(c,"parseLocalSuggestion "+r)&&h(c)&&s.push(c)}}function ni(t){i(t,()=>{if(t.duplicates){let i=t.duplicates.find(n=>n.handoffType==7||n.handoffType==8);if(i){let t=[];return t.push({verb:n.JumplistActionItemType[n.JumplistActionItemType.S_OpenInBrowser],displayName:n.Host.getLocString("OpenInBrowser"),executeSync:()=>n.Host.launchUri(i.url+(i.handoffType==8?"?web=1":"")),icon:{type:1,content:"&#xE774"}}),i.locationUrl&&t.push({verb:n.JumplistActionItemType[n.JumplistActionItemType.S_OpenFileLocationInBrowser],displayName:n.Host.getLocString("OpenFileLocationIn",n.getGroupSourceDisplayName(i.sourceForGroup)),executeSync:()=>n.Host.launchUri(i.locationUrl),icon:{type:2,content:"&#xE838"}}),t}}return[]},!0)}function g(t,i){return!n.config.enableFallbackIconsForJumpLists||!y[t]?!1:n.contains(y[t],i)}function ti(t,r,u,f,e,o){let l=u.id,y=u.filePath,h;if(!n.config.forceAllJumplists){if(h=n.config.enableJumplistRestrictions&&tt[l],!h&&y){let t=y.toLowerCase();for(let n in v)if(t.includes(n)){h=v[n];break}if(!h&&n.config.enableJumplistRestrictions)for(let n in a)if(t.includes(n)){h=a[n];break}}if(h&&h.length==0)return}(n.RuntimeConfig.AlwaysWide||!it.find(n=>n==l))&&(r.calculateChildSuggestions=()=>ii(t,l,y,r,u,h,f,e,o),n.config.maxJLcm&&i(r,t=>{let i=[];if(!t&&(r.calculateChildSuggestions&&r.calculateChildSuggestions(),r.childSuggestions&&(!n.RuntimeConfig.AlwaysWide||!r.previewPaneType))){let t=!1;r.childSuggestions.filter(t=>t.type=="JL"&&!t.displayed&&t.groupType==n.GroupType.JumpListTasks).slice(0,n.config.maxJLcm).forEach(n=>{t=!0;let e=g(r.deviceItem.id,n.groupType)?r.getIcon:s(n.jumpListItem,n.parent,!1,l),o={verb:"JumpListTask_"+l+"_"+n.text,displayName:n.text,executeSync:()=>c(u,n,f),getIcon:e};i.push(o)});let e=!1;r.childSuggestions.filter(t=>t.type=="JL"&&!t.displayed&&t.groupType!=n.GroupType.JumpListTasks).slice(0,n.config.maxJLcm).forEach((n,r)=>{if(t&&!e)i.push({});e=!0;let o={verb:"JumpList_"+l+"_"+r,displayName:n.text,executeSync:()=>c(u,n,f),getIcon:s(n.jumpListItem,n.parent,!0,l)};i.push(o)})}return i},!0))}function ii(t,i,r,u,f,l,a,v,y){u.calculateChildSuggestions=null;let b=f.jumpList;if(b&&b.length!=0){let w=r||"",k=w.indexOf("}");w=w.substr(k+1);let p=[];for(let r of b)if(!l||n.contains(l,r.type)){let o=h(r.type),y=o!=n.GroupType.JumpListTasks;for(let l of r.items)if(!nt(l)){let d=g(u.deviceItem.id,h(r.type))?u.getIcon:s(l,u,y,i),k="JL",b=n.createSuggestion(t,l.displayName,d,null,k,l.displayName,n.InstrumentedItem.createInstrumentedItem(v,k),2,u.sequenceNumber,y,null,null,!0);b.click=()=>c(f,b,a);b.jumpListItem=l;b.groupType=o;b.groupDisplayName=r.name;b.parent=u;b.tooltip=l.description;let tt=w&&l.path.endsWith(w);tt||(b.path=l.path);e(b,"calculateJumpListSuggestions")&&(p.push(b),ri(f,b,a))}}p.length>0&&(u.childSuggestions=u.childSuggestions?u.childSuggestions.concat(p):p,o(p),n.InstrumentationHelper.instrumentDataSource(v,y,p,null))}}function s(t,i,r,u){return(f,e)=>n.getIcon(t,u+"_"+t.path+"_"+t.displayName,"jumpList",!r,!1,null,null,0)(f,n=>{n?e(n):i.getIcon(f,e)})}function nt(t){return t.displayName?!n.RuntimeConfig.AlwaysWide&&n.olderThan2Weeks(t.lastAccessed)?!0:!1:!0}function h(t){switch(t){case 0:return n.GroupType.JumpListTasks;case 1:return n.GroupType.JumpListPinned;case 2:return n.GroupType.JumpListRecent;case 3:return n.GroupType.JumpListFrequent;default:return n.GroupType.JumpListCustom}}function c(t,i,r){n.Async.safeChain("launchJumpList",()=>i.jumpListItem.launchAsync(),()=>n.Host.manuallyDismissApp(),()=>{n.DialogBox?n.DialogBox.show(n.Host.getLocString("JumpListItemUnavailableDeleteConfirmation"),[{id:null,text:n.Host.getLocString("Cancel"),selected:!0,action:()=>n.Host.setFocusInSearchBox(null,"jumpListItemDialogBoxCancel")},{id:null,text:n.Host.getLocString("Remove"),selected:!1,action:()=>{l(t,i,r),n.Host.setFocusInSearchBox(null,"jumpListItemUnavailable1")}}]):(r.showTemporaryMessage(n.Host.getLocString("JumpListItemUnavailable")),l(t,i,r),n.Host.setFocusInSearchBox(null,"jumpListItemUnavailable2"))})}function l(t,i,r){let u=()=>r.showTemporaryMessage(n.Host.getLocString("RemoveFromListFailure",i.text)),f=i.parent.childSuggestions.length==1;n.Async.safeChain("deleteJumpList",()=>i.jumpListItem.deleteAsync(),()=>{n.Async.safeChain("getJumpListAsync",()=>t.getJumpListAsync(),t=>{f&&t.some(n=>h(n.type)==i.groupType&&n.items.some(n=>!nt(n)))?u():(n.Host.refreshCurrentPane(),r.showTemporaryMessage(n.Host.getLocString("RemovedFromList",i.text)))},u)},u)}function ri(t,r,u){r.jumpListItem.deleteAsync&&i(r,()=>{let i={verb:"RemoveFromThisList",displayName:n.Host.getLocString("RemoveFromThisList"),executeSync:()=>l(t,r,u),icon:{type:2,content:"&#xE711"}};return[i]},!0)}function ui(t,i){if(t&&t.uxHint){let r=i?HitHighlightingParser.addMarkers(t.uxHint,i):t.uxHint;return n.Host.getLocString("RelatedSynonym",r)}return null}const tt={"Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge":[0],"Microsoft.InternetExplorer.Default":[0],Chrome:[0],"360browser":[0]},a={skype:[],outlook:[0],"360browser":[0],chrome:[0],iexplore:[0],opera:[0],firefox:[0],safari:[0]},v={"\\msedge.exe":[0]},it=["Microsoft.Windows.Explorer",],f=[[!0,"LastAccessed","lastAccessDateString"],[!1,"LastModified","lastModifiedDateString"],[!1,"LastModifiedBy","lastModifiedBy"],[!1,"Author","author"],[!1,"Artist","artist"],[!1,"Album","album"],[!1,"Genre","genre"],[!1,"Tags","tags"],],y={"Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge":[n.GroupType.JumpListTasks],"Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe!App":[n.GroupType.JumpListTasks],"Microsoft.XboxApp_8wekyb3d8bbwe!Microsoft.XboxApp":[n.GroupType.JumpListCustom],"com.squirrel.Teams.Teams":[n.GroupType.JumpListTasks],"Microsoft.ScreenSketch_8wekyb3d8bbwe!App":[n.GroupType.JumpListTasks]};n.getFileExtension=rt;n.toDate=ut;n.getTodayTimeString=ft;n.setFileTemplate=r;n.enrichMetadataFromDuplicate=et;n.getIconForTypeAsync=ot;n.isValidIcon=w;n.isValidSuggestion=e;n.setExtraVerbs=i;n.setExtraVerbsAsync=st;class vt{constructor(n){this._temporaryMessageHandler=n}parse(t,i,r,u,f,e){let s=[];for(let f of u.suggestions)n.safeExecute(()=>d(t,f,r,i,this._temporaryMessageHandler,f.suggestionType,s,()=>!0),"parseLocalSuggestion "+r);(n.isFileOrFolderLocalDataSource(r)||r=="IBA")&&o(s);let h={maxedOut:u.maxedOut};e(r,s,h)}}n.SuggestionsParser=vt;n.lookupById=yt;n.decorateSuggestionsWithParentFolder=o;n.parseLocalSuggestion=d}(WSB||(WSB={})),function(n){var t;(function(t){t.currentCIVersion="-1";class i{constructor(r){(n.Host.bindShown(()=>{let n=this.getContstraintIndexInfo(r.lastUrl);t.currentCIVersion=n?String(n.version):"-1"}),n.Host.hasFallbackHappened())||n.Host.bindAppHidden(()=>{if(n.isBingEnabled()&&n.isBrowserOnline()){let o=this.safeGetLastUrl(r),l=this.safeGetUrlResult(r),a=n.getWindowHost().toLowerCase(),p=a=="bing.com"||a.endsWith(".bing.com");if(!p&&!(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest))return;let v=n.LightweightStorage.getItem(i.LastCIDownloadAttemptKey),s=null;if(v&&(s=new Date(v)),s&&(this.getTimeDiffInMins(s)<n.config.waitBetweenCIDownloadCallsInMins?n.config.waitBetweenCIDownloadCallsInMins:0))return;let f=this.getContstraintIndexInfo(o);t.currentCIVersion=String(f.version);let h=n.getCurrentLanguage(),u=n.config.ciVersion,e=this.parseUrlResult(l),c=this.getUrlForCiCab(u,h),y=n.contains(n.config.blocklistedCiVersions,f.version)&&u<f.version,w=u==e.version&&e.errorCode!="00000000";if(u>0&&n.config.supportedCiMarkets[h]&&(h!=f.language||u>f.version||y||w)&&(!e.url||y||o==e.url||e.errorCode!="00000000")){let f="cis_v"+u,e="ci_v"+u,h=n.LightweightStorage.getItem(f)?parseInt(n.LightweightStorage.getItem(f)):0,a=n.LightweightStorage.getItem(e)?parseInt(n.LightweightStorage.getItem(e)):0;n.LightweightStorage.setItem(i.LastCIDownloadAttemptKey,n.getCurrentDate().toString());const s="constraintIndexDownloader.tryDownloadFromUrlAsync";n.Async.safeChain(s,()=>r.tryDownloadFromUrlAsync(c),i=>{if(i){let i=this.getContstraintIndexInfo(o);t.currentCIVersion=String(i.version);h++;n.LightweightStorage.setItem(f,h.toString())}else SharedLogHelper.LogError(s,"urlResult: "+l,"Download failed");a++;n.LightweightStorage.setItem(e,a.toString())},n=>{SharedLogHelper.LogError(s,`onError - url:  ${c}`,n.message)},null,c,0)}}})}parseUrlResult(n){let i=null,t=null,r=1;if(n){let u=n.split(":0x");if(u.length>1){i=u[0];t=u[1];t!="00000000"&&SharedLogHelper.LogWarning("constraintIndexDownloader.urlResult",t,"Download encountered problems");let n=this.getContstraintIndexInfo(i);r=n.version}else SharedLogHelper.LogError("constraintIndexDownloader.parseUrlResult","urlResult: "+n,"Invalid URL")}else SharedLogHelper.LogError("constraintIndexDownloader.parseUrlResult","No urlResult");return{url:i,version:r,errorCode:t}}getContstraintIndexInfo(n){let t=-1,i="";if(n){let r=n.split("/");if(r.length>1){let n=r[r.length-1].split(".");i=n.length==2?n[0]:"";t=+r[r.length-2]}else SharedLogHelper.LogError("constraintIndexDownloader.getContstraintIndexInfo","url: "+n,"Invalid URL")}else SharedLogHelper.LogError("constraintIndexDownloader.getContstraintIndexInfo","No Url");return{version:t,language:i}}safeGetLastUrl(t){if(!n.config.ciDownloadUpdate)return t.lastUrl;const r="https://www.bing.com/bcs/ci/-1/en-us.cab";let i=r;try{return i=t.lastUrl,n.isNullOrUndefined(i)||i.length==0?r:i}catch(u){return r}}safeGetUrlResult(t){if(!n.config.ciDownloadUpdate)return t.urlResult;const r="https://www.bing.com/bcs/ci/-1/en-us.cab:0x8000FFFF";let i=r;try{return i=t.urlResult,n.isNullOrUndefined(i)||i.length==0?r:i}catch(u){return r}}getUrlForCiCab(n,t){return"https://www.bing.com/bcs/ci/"+n+"/"+t+".cab"}getTimeDiffInMins(t){if(!n.isValidDate(t))return 0;let i=t.getTime(),r=n.getCurrentTime();return Math.round((r-i)%n.DayToMs%n.HourToMs/n.MinuteToMs)}}i.LastCIDownloadAttemptKey="LastCIDownloadAttempt";t.ConstraintIndexDataLoader=i})(t=n.ConstraintIndex||(n.ConstraintIndex={}))}(WSB||(WSB={})),function(n){function u(n){switch(n.type){case"Folder":return"FD";case"Photo":return"LI";case"Video":return"LV";case"Audio":case"Music":return"MU";default:return n.fileSize?"FL":"FD"}}function h(t){switch(t){case"FD":return n.Scope.Folders;case"LI":return n.Scope.Photos;case"LV":return n.Scope.Videos;case"MU":return n.Scope.Music;default:return n.Scope.Documents}}const t="https://onedrive.live.com",i=t+"/redir.aspx?resid=",f="&ancestorId=",e="&contentMatch=",r="OneDrive provider called without {0}",o=621355968e5;class s extends n.JsonDataProvider{getName(){return"OneDriveDataProvider"}constructor(n){super("ODC");this._accessTokenManager=n}addOneDriveAncestorResourceIdQueryString(){if(n.RuntimeConfig.QfMode==5&&!n.isFileExplorerCurrentPathThisPcOrQuickAccess){let t,i=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootContentUri?n.tryParseUrl(SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootContentUri,!1):null;if(i&&i.parameters&&(t=i.parameters.substr(1).split("&").find(n=>n.startsWith("id=")).substr(3)),t)return f+t;SharedLogHelper.LogError("OneDriveParser","QfMode="+n.RuntimeConfig.QfMode,new Error(n.formatString(r,["currentSyncRootResourceId"])))}return""}addOneDriveContentMatchQueryString(t){return n.RuntimeConfig.QfMode==5||t.scope==n.Scope.Documents?e+"1":""}createUrl(t){let i=decodeURIComponent(n.config.oneDriveDotComRootUrl);i+=this.addOneDriveAncestorResourceIdQueryString();i+=this.addOneDriveContentMatchQueryString(t);let r=t?n.encodeQueryParameter(t.queryToFetch.toLowerCase()):"";return i+"&q="+r}getAllAccountTokens(t){let i=n.Host.isAuthInvestigation()?["OneDriveDataProvider::getAllAccountTokens"]:undefined;if(n.RuntimeConfig.QfMode==5){let u=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootAccount;u?this._accessTokenManager.getAccountByUserName(!1,0,u,!1,!0,n=>{n&&n.Token?t([n.Token]):t(null,"AccountNotFound")},i):n.isFileExplorerCurrentPathThisPcOrQuickAccess?this._accessTokenManager.getAllSyncingAccounts(!1,0,!1,!0,n=>{n.length>0?t(n.map(n=>n.Token)):t(null,"NoAccountsFound")},i):(SharedLogHelper.LogError("OneDriveParser","QfMode="+n.RuntimeConfig.QfMode,new Error(n.formatString(r,["currentSyncRootAccount"]))),t(null,"CurrentSyncRootAccount"))}else n.AccessTokenManager.getWindowsAccountType()==2?this._accessTokenManager.getAccount(0,n.getBingResourceOrScope(0),!1,!0,n=>{n&&n.Token?t([n.Token]):t(null,"NoAccountsFound")},undefined,i):t(null)}fetch(t,i,r,u,f,e,o){if(n.isDataSourceEnabled(this._dataSource,t)){let s={numOfPendingResponses:0};o||(o={});o["BingAPIs-Authorization-Source"]="Explicit";let h=h=>{let l=Object.assign({},o);h&&(l["X-Search-RPSToken"]=h);let c=Object.assign({},e);delete c[n.Service.QueryParams.ImpressionGuid];delete c[n.Service.QueryParams.RequestElToken];super.fetch(t,(n,t,r,u,f)=>{--s.numOfPendingResponses,i(n,t,r,u,f,s.numOfPendingResponses!=0)},r,u,f,c,l)};this.getAllAccountTokens((n,t)=>{t?i(this._dataSource,null,t,null,null,!1):n?(s.numOfPendingResponses=n.length,n.forEach(n=>h(n))):(s.numOfPendingResponses=1,h(null))})}}}n.OneDriveDataProvider=s;class c{constructor(){}parse(t,i,r,u,f,e){let o=[];if(u&&u.suggestionGroups)for(let n of u.suggestionGroups)if(n.searchSuggestions)for(let r of n.searchSuggestions)this.addContent(t,o,r,i);n.decorateSuggestionsWithParentFolder(o);e("ODC",o,null)}isValidSuggestion(n){return!n.result||n.result.length!=1?!1:n.result[0].type==="History"?(SharedLogHelper.LogError("OneDriveParser",null,new Error("History should be disabled in the request URL")),!1):n.result[0].type==="Tag"?!1:!0}addContent(r,f,e,s){if(this.isValidSuggestion(e)){let l=e.result[0],a=u(l);if(n.isSuggestionTypeEnabled("ODC",a,7,r)){let v=l.rawResourceId,w="https://storage.live.com/items/"+v+":Cropped176x176#h=176&w=176",p=n.ScopeConfig[h(a)].icon,y=a=="FD"?"":n.getFileExtension(l.path),b=this.getOneDriveSuggestionIcon(n.isMedia(a),p,w,y,v),c=n.createSuggestion(r,e.displayText,b,p,a,e.query,n.InstrumentedItem.createInstrumentedItem(s,a),7,s,!0);c.url=i+v;c.path="OneDrive:\\"+l.path.slice(1).replace(/[/]/g,"\\");c.extensionLC=y?y.toLocaleLowerCase():undefined;let k=+l.dateModified/1e4-o;c.lastModifiedDate=n.toDate(k);c.sourceForGroup=2;n.setFileTemplate(r,n.getEffectiveQuery(r),n.isL2(r),c);c.click=()=>n.Host.launchUri(c.url);c.locationUrl=l.parentFolder&&l.parentFolder.id?i+l.parentFolder.id:t;c.reactKey=this.generateReactKey(l);n.setExtraVerbs(c,()=>{let t={verb:n.JumplistActionItemType[n.JumplistActionItemType.S_OpenFileLocationInBrowser],displayName:n.Host.getLocString("OpenFileLocationIn",n.getGroupSourceDisplayName(2)),executeSync:()=>n.Host.launchUri(c.locationUrl),icon:{type:2,content:"&#xE838"}};return[t]},!0);n.isValidSuggestion(c,"OneDriveParser")&&f.push(c)}}}generateReactKey(n){return u(n)+n.path+n.rawResourceId}getOneDriveSuggestionIcon(t,i,r,u){return n.getIconForTypeAsync(i,u)}}n.OneDriveParser=c}(WSB||(WSB={})),function(n){var t;(function(t){class i{constructor(){n.Host.bindQueryChangedOrInitialized(()=>{this._previousWebSignals=this._currentWebSignals,this._currentWebSignals=null,(!n.config.enableCISpeller||this._currentSpellerTrigger)&&(this._previousSpellerTrigger=this._currentSpellerTrigger,this._currentSpellerTrigger=null)});n.Host.bindConversationStart(()=>{this._previousWebSignals=null,this._currentWebSignals=null,this._previousSpellerTrigger=null,this._currentSpellerTrigger=null,this._previousBestMatchSuggestion=null,this._previousQuery=null})}setPreviousQuery(n){this._previousQuery=n}getPreviousQuery(){return this._previousQuery||""}updateWebSignalsData(n,t){this._currentWebSignals={query:n,signals:t}}setPreviousTopHit(n){this._previousBestMatchSuggestion=n}getPreviousTopHit(){return this._previousBestMatchSuggestion}updateSpellerTriggerData(n,t){this._currentSpellerTrigger={query:n,triggerSpeller:this.triggerSpellerOnTheNextKeyStroke(t,n)}}getPreviousEventWebSignalsData(n){return this._previousWebSignals&&this.isPreviousEventQuery(this._previousWebSignals.query,n)?this._previousWebSignals.signals:null}disableCISpeller(n){return this._previousSpellerTrigger&&this._previousSpellerTrigger.triggerSpeller&&this.isPossibleFirstMisspelling(n,this._previousSpellerTrigger.query)?!0:!1}enableCISpeller(t){return n.config.enableCISpeller?this._previousSpellerTrigger&&this._previousSpellerTrigger.triggerSpeller&&this.disableCISpeller(t)?!1:this._previousSpellerTrigger&&this.isPossibleFirstMisspelling(this._previousSpellerTrigger.query,t)?!0:this._previousSpellerTrigger&&(this.isTypedEventQuery(this._previousSpellerTrigger.query,t)||this.isBackspaceEventQuery(this._previousSpellerTrigger.query,t))&&this._previousSpellerTrigger.triggerSpeller:this._previousSpellerTrigger&&this.isPreviousEventQuery(this._previousSpellerTrigger.query,t)&&this._previousSpellerTrigger.triggerSpeller}triggerSpellerOnTheNextKeyStroke(t,i){return n.config.enableCISpeller==1?!0:t.every(n=>n.notAResult)?!0:t.length>0&&this.isWebSpellCorrectedSuggestion(t[0])&&t.every(n=>n.handoffType==0)?!0:n.config.enableCISpeller==2&&!t.some(t=>n.isApp(t.type)||n.isSetting(t.type))?!0:this.enableCISpeller(i)?!0:!1}isWebSpellCorrectedSuggestion(n){return n.type=="SC"||n.type=="OS"}isPreviousEventQuery(n,t){return n&&t&&n.length==t.length-1&&t.startsWith(n)}isBackspaceEventQuery(n,t){return n&&t&&n.length==t.length+1&&n.startsWith(t)}isTypedEventQuery(n,t){return(n||n==="")&&t&&n.length<t.length&&t.startsWith(n)}isPossibleFirstMisspelling(t,i){if(this._previousBestMatchSuggestion){let r=this._previousBestMatchSuggestion.ciMatchedQuery||this._previousBestMatchSuggestion.query;return r.toLocaleLowerCase().startsWith(t.toLocaleLowerCase())&&!r.toLocaleLowerCase().startsWith(i.toLocaleLowerCase())&&this.isTypedEventQuery(t,i)&&i.length>=n.config.enableCISpellerAtPrefixLength?!0:!1}return this._previousBestMatchSuggestion&&this._previousBestMatchSuggestion.query.toLocaleLowerCase().startsWith(t.toLocaleLowerCase())&&!this._previousBestMatchSuggestion.query.toLocaleLowerCase().startsWith(i.toLocaleLowerCase())&&this.isTypedEventQuery(t,i)&&i.length>=n.config.enableCISpellerAtPrefixLength?!0:!1}}t.PreviousKeystrokeCache=i})(t=n.Cache||(n.Cache={}))}(WSB||(WSB={})),function(n){var t;(function(t){function c(t){(e=t,n.StaticHtmlElements.dialogBox)&&(sj_be(n.StaticHtmlElements.dialogBox,"click",n=>{let r=n.target.id,t=i().filter(n=>n.id==r).shift();t?(t.action&&t.action(),u()):r=="dialog_overlay"&&u();sj_sp(n)},!0),n.Host.bindKeyDown(n=>{if(r){let t;switch(n){case 39:{let n=i(),r=!1;for(let i=0,u;u=n[i];i++)if(r){t=u;break}else if(r=u.selected==!0,r&&i+1==n.length){t=n[0];break}break}case 37:{let n=i(),r;for(let u=0,i;i=n[u];u++){if(i.selected==!0){t=r?r:n[n.length-1];break}r=i}break}}t&&h(t)}}),n.Host.bindKeyEscape(n=>{o()&&(u(),n.handled=!0)}))}function l(t,i,u,o){f=[];let s;if(i.length==0)throw new Error("DialogBox: Empty buttons array");f=i.map((n,t)=>{let i=n;return i.id="dialog_b"+t,i.narratorText=i.text,i.selected&&(s=i.id),i});let h={isVisible:!0,title:u,messageText:t,buttons:f,isModal:o};e.updateDialogBox(h);s&&n.safeSetTimeout(()=>_ge(s).focus(),0,"DialogBox.show");n.Host.setFocusInWebView("dialogBoxViewModel");r=!0}function u(){if(r)e.updateDialogBox({isVisible:!1}),r=!1}function o(){return r}function i(){return f}function a(){return i().map(n=>[n])}function s(){return i().filter(n=>n.selected).shift()}function h(n){for(let t of i())t.selected=t.id==n.id,t.selected&&_ge(n.id).focus()}function v(){if(o()){let n=s();n&&(n.action&&n.action(),u())}}function y(){return!1}let f=[],e,r=!1;t.init=c;t.show=l;t.hide=u;t.isVisible=o;t.getSelectableItems=i;t.getSelectableItemsByGroup=a;t.getSelectedItem=s;t.select=h;t.submit=v;t.onAfterKeyDown=y})(t=n.DialogBox||(n.DialogBox={}))}(WSB||(WSB={})),function(n){function y(n){return n.includes("form=vsranf")}function p(t){let i=n.tryParseUrl(t,!0);return!!i&&/[\?\&]q=/i.test(i.parameters)&&!/[\?\&]view=detail/i.test(i.parameters)}function ti(t){let i=n.tryParseUrl(t,!0);return!!i&&kt.test(i.parameters)}function ii(n){switch(n){case 17:case 21:case 1:case 0:return 1;case 13:return 2;case 14:return 3;default:throw Error("Unsupported handoff type: "+n);}}function w(n){switch(n){case 1:return 1;case 2:return 7;case 3:return 8;default:throw Error("Unsupported vertical: "+n);}}function b(t){let i=n.tryGetBingPathLC(t);return i?n.contains(wt,i)?2:n.contains(bt,i)?3:n.contains(n.WebSearchPaths,i)?1:null:null}const u=["bfbVerticalConfig","bfbTenantSettings","bfbUserConfigs","bfbSubstrateUnifiedSearch"],o=["bfbTenantSettingsFailed","bfbUserConfigsFailed","bfbSubstrateUnifiedSearchFailed"],h=n.PreviewPaneWidth-24,d="miniserp_focus",g="disableOutline",i=2,nt=["tab-active","slide"],tt=["aria-expanded"],it="videoPreview",rt=300,f=30,ut="IsSearchAppXYFocusEnabled",ft="WinJS",et="dFocusExit",t="win-xyfocus-suspended",ot="Rewards.ReportActivity.Success",st="Rewards.ReportActivity.Failure";n.MiniSerpIframeId="miniIframeSerp";n.MiniSerpFetchEvent="miniSERP.Fetch";n.MiniSerpLoadedEvent="MiniSerpContentLoaded";n.MiniSerpClearingEvent="MiniSerpContentClearing";const ht=["/account/","/settings.aspx"],r=function(){let n={};return n[37]="left",n[39]="right",n[38]="up",n[40]="down",n}(),ct=1e4,lt=800,s=535,c=580,l=150,at=439,vt=441,yt=100,pt=["&form=s00037&"],wt=["/images/search","/images"],bt=["/videos/search","/videos"],kt=/[\?\&]FORM=HDRSC[1-3]/i,e="ClientInst",a="wsbpf",dt="wsbPrefetchGuid",v="inprocess",gt="wsbstoploadingscreen",ni="wsbstoprequeryloadingscreen";class ri{constructor(t,i){var r;this._navigationHelper=t;this._msRewardsViewModel=i;this._deviceScale=1;this._previewRequestId=0;this._previousURLs=[];this.blockedMiniSERPUrls=[_w.location.origin+_w.location.pathname];this._msbContext=(r=_w.BingAtWork)===null||r===void 0?void 0:r.context;this._wsbPrefetchModel={};this._msbContext&&(this._msbContext.isWsbPrefetchEnabled=!0);n.Host.bindShown(()=>{ThresholdUtilities.getCortanaHeaders(n=>{n&&n["X-BM-DeviceScale"]&&(this._deviceScale=+n["X-BM-DeviceScale"]/100)}),this.setVertical(1)});n.Host.bindAppHidden(()=>{this._seeAllResults&&(this._seeAllResults.innerText=""),this._currentVertical=null});n.Host.bindSearchBoxGotFocus(()=>{this._focusHelper&&this._focusHelper.onSearchBoxFocusChanged()});sj_evt.bind(n.MiniSerpLoadedEvent,()=>{this._onIFrameLoadedCallback&&(this._onIFrameLoadedCallback(),this._onIFrameLoadedCallback=null)});this._msRewardsViewModel&&(sj_evt.bind(ot,([,n])=>{this._msRewardsViewModel.notifyPointsRewarded(n)}),sj_evt.bind(st,([,n])=>{SharedLogHelper.LogError("RewardsReportActivityFailureEvent",null,n?new Error(n):null)}))}init(t,i){this._previewPaneViewModelParent=t;this._root=i;this._seeAllResults=this._root.querySelector("#seeAllResults");this._footer=this._root.querySelector("#footer");this._mask=this._root.querySelector("#previewMask");this._forceLoadScreen=this._root.querySelector("#forceLoadMessage");this._contentContainer=this._root.querySelector("#miniSerpPaneContainer");this._scrollArea=this._root.querySelector("#miniSerpScrollArea");this._loadingScreen=this._root.querySelector("#loadingScreen");this._hasErrored=!1;this._selectedItem=null;sj_be(this._scrollArea,"scroll",t=>{this._iframe&&n.contains([2,3],this._currentVertical)&&this._iframe.contentWindow.dispatchEvent(new Event(t.type,t)),this._calculateIFrameHeight&&this._calculateIFrameHeight()});this._footer&&sj_be(this._footer,"keydown",t=>{this._iframe&&n.isUpOrDownKey(t.keyCode)?(t.keyCode==38?this.tryExecuteFocusOnMiniSerp(()=>this._focusHelper.moveFocusToEdgeFocusableElement(1)):n.RuntimeConfig.AllowKeyboardNavCycling&&this.tryExecuteFocusOnMiniSerp(()=>this._focusHelper.moveFocusToEdgeFocusableElement(0)),sj_pd(t),sj_sp(t)):t.keyCode==13&&this._footer.click()});this._mask&&n.RuntimeConfig.MiniSERPMode!=0&&sj_be(this._mask,"keydown",n=>{n.keyCode==13&&this._mask.click()});sj_be(_w,"message",t=>{let i=t.data?t.data.msWinJSXYFocusControlMessage:null;if(i&&i.type==et){let u=i.direction,f=i.keyCode;this._focusHelper&&!this._focusHelper.isL2Visible()&&this._focusHelper.getXYFocusRoot()!=this._originalMiniSerpXYFocusRoot?(this._focusHelper.setXYFocusRoot(this._originalMiniSerpXYFocusRoot),this.tryExecuteFocusOnMiniSerp(()=>this._focusHelper.moveFocus(u,f))):(u!=r[n.getRtlAdjustedKey(39)]&&t.source.blur(),u==r[40]||u==r[38]&&n.RuntimeConfig.AllowKeyboardNavCycling?this._footer?this._footer.focus():this._focusHelper.moveFocusToEdgeFocusableElement(u==r[38]?1:0):u!=r[n.getRtlAdjustedKey(37)]||n.Host.searchBoxHasFocus()||n.Host.setFocusInSearchBox(f,"previewPaneUnfocus"))}})}finalizeKeystroke(){this.instrumentOnPreviewPaneRendered(!1,!0)}getSelectableItems(){return this._selectedItem?[this._selectedItem]:[]}getSelectableItemsByGroup(){return[]}getSelectedItem(){return this._selectedItem}select(){}onAfterKeyDown(){return!1}clear(){this._previewedSuggestion=null;this._onPreviewPaneRendered=null;this._hasErrored=!1;this._selectedItem=null;this._footer&&(n.setVisibility(this._footer,!1),this._footer.onclick=null);this._mask&&(n.setVisibility(this._mask,!1),this._mask.onclick=null);this._forceLoadScreen&&this.clearForceLoadPage();this.clearContent();this._previousURLs=[]}showForceLoad(t,i){n.InstrumentationHelper.logClientInstEvent("Select","ForceLoadOpened",n.SequenceNumberManager.getSequenceNumber(),{suggestionText:t});this.stopLoadingScreen();n.setVisibility(this._scrollArea,!1);n.setVisibility(this._footer,!1);n.setVisibility(this._mask,!1);n.setVisibility(this._forceLoadScreen,!0);this.formatForceLoadPage(t);this._forceLoadScreen.onclick=()=>{this.clearForceLoadPage(),this.startLoadingScreen(),i()}}clearForceLoadPage(){for(n.setVisibility(this._forceLoadScreen,!1),n.setVisibility(this._scrollArea,!0),this._forceLoadScreen.onclick=null,this._forceLoadScreen.classList.remove("forceLoadContainer");this._forceLoadScreen.hasChildNodes();)this._forceLoadScreen.removeChild(this._forceLoadScreen.lastChild)}formatForceLoadPage(t){var f,u,i,e;let h=n.Host.getLocString("ForceLoadMessage"),c=n.Host.getLocString("ForceLoadButton"),o=h.split("{0}");f=sj_ce("div","","accentColor");this._forceLoadScreen.appendChild(f);u=_d.createElement("span");u.id="forceLoadIcon";u.innerHTML="&#xE721";f.appendChild(u);i=sj_ce("div","forceLoadQueryText","");i.appendChild(_d.createTextNode(o[0]));let s=_d.createElement("span");s.textContent=t;i.appendChild(s);i.appendChild(_d.createTextNode(o[1]));this._forceLoadScreen.appendChild(i);e=sj_ce("div","","");this._forceLoadScreen.appendChild(e);let r=_d.createElement("button");r.className="c-button";r.id="forceLoadSubmit";r.type="submit";r.textContent=c;e.appendChild(r)}startLoadingScreen(){n.setVisibility(this._scrollArea,!1);n.setVisibility(this._footer,!1);n.setVisibility(this._mask,!1);n.setVisibility(this._loadingScreen,!0)}stopLoadingScreen(){n.setVisibility(this._loadingScreen,!1);n.setVisibility(this._scrollArea,!0)}clearContent(t){this._previewRequestId+=1;this._focusHelper=null;this._onIFrameLoadedCallback=null;sj_evt.fire(n.MiniSerpClearingEvent);this.destroyLogger(()=>{while(this._contentContainer.hasChildNodes())this._contentContainer.removeChild(this._contentContainer.lastChild);this._iframe&&(this._iframe=null,this._calculateIFrameHeight=null);this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null);t&&t()})}destroyLogger(t){var i;if(this._iframe&&n.config.msbEnableDestroyMiniSerpLogger){const n=this._iframe.contentWindow;if(n&&((i=n.BingAtWork)===null||i===void 0?void 0:i.miniSerpDestroyLogger)){try{n.BingAtWork.miniSerpDestroyLogger(t)}catch(r){t()}return}}t()}hasFocus(){if(n.Host.searchBoxHasFocus())return!1;let t=n.getCurrentActiveElement();return t&&t!=this._iframe&&this._root.contains(t)}focus(){if(!this.hasFocus())if(this._iframe){let t=this.tryExecuteFocusOnMiniSerp(()=>this._focusHelper.moveFocusToLastFocusedElement());t?n.Host.setFocusInWebView("miniserp focus"):n.Host.setFocusInSearchBox(null,"MiniSERP VM Focus failed")}else this._hasErrored&&n.config.edgeTransferOnTimeout?(_ge("errorFooter").focus(),this._selectedItem={id:"errorFooter",text:null,selected:!0},n.Host.searchBoxHasFocus()&&n.Host.setFocusInWebView("errorPP focus")):this._previewPaneViewModelParent.focusPending=!0}readyToBlur(){return!0}blur(){}setVertical(t){if(t!=this._currentVertical){if(this._seeAllResults)switch(t){case 1:this._seeAllResults.innerText=n.Host.getLocString("OpenResultsBrowser");break;case 2:this._seeAllResults.innerText=n.Host.getLocString("SeeAllImageResults");break;case 3:this._seeAllResults.innerText=n.Host.getLocString("SeeAllVideoResults");break;default:throw new Error("Unsupported vertical type: "+t);}this._currentVertical=t}}instrumentOnPreviewPaneRendered(n,t){if(this._timestampFirstRender&&this._onPreviewPaneRendered){let i={firstRenderTS:this._timestampFirstRender};this._onPreviewPaneRendered(t,!n,i)}}update(t,i,r,u,f,e){var s;if(this._onPreviewPaneErrored=e,this._currentSuggestion=t,(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(t.handoffType))&&this._iframe&&this.isWorkScopeSubVerticalChange(t)&&(this._timestampFirstRender=n.getCurrentTime()),!f){this.instrumentOnPreviewPaneRendered(!0,!1);return}if(this.instrumentOnPreviewPaneRendered(!1,!0),this.miniSERPRenderTimeoutInstrumentation("miniSerpViewModelUpdate"),n.config.disableOfflineRequest&&!n.isBrowserOnline()){this.renderOfflineMessage(t.query);return}if(this._currentHandoffType=t.handoffType,(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(t.handoffType))&&this._iframe){const r=this._iframe.contentWindow;if(r&&((s=r.BingAtWork)===null||s===void 0?void 0:s.workVerticalNavClickHandler)){let u={navigationPayload:{domain:t.navDomain,id:t.navDomainId},query:t.query,impressionGuid:n.InstrumentationHelper.getImpressionGuid(n.SequenceNumberManager.getSequenceNumber())};if(this.isWorkScopeSubVerticalChange(t)){this.stopLoadingScreen();this._scrollArea.scrollTop=0;u.isRequery=!1;r.BingAtWork.workVerticalNavClickHandler(u);this.updatePreviousState(t,f);return}if(i.scope===n.Scope.Work&&t.previousQuery&&!(t.query===this._queryShown)){this._scrollArea.scrollTop=0;this.startLoadingScreen();const e=n.Host.createGuid(),i=`${ni}${e}`;this.handleLoadingStateEvent(i);u.isRequery=!0;u.loadingStateEventKey=i;r.BingAtWork.workVerticalNavClickHandler(u);this.updatePreviousState(t,f);return}}}this.updatePreviousState(t,f);let h=t.type=="MB"&&t.segments=="Organization"?null:t.baseSearchUrl,a=ii(t.handoffType);if(this.setVertical(a),this._footer&&(this._footer.onclick=r=>{this._previewPaneViewModelParent.onBeforeItemLaunch(n.getCurrentTime(),n.getInputType(r),3);n.Host.launchSearch(t.query,this._navigationHelper.getSearchUrl(i.fullPartialQuery,t.query,t.type,h,t.handoffType,undefined,undefined,undefined,undefined,t.msbVerticalHash),!1);this._previewPaneViewModelParent.onAfterItemLaunch(3)}),this._mask&&(this._mask.onclick=r=>{this._previewPaneViewModelParent.onBeforeItemLaunch(n.getCurrentTime(),n.getInputType(r),3);n.Host.launchSearch(t.query,this._navigationHelper.getSearchUrl(i.fullPartialQuery,t.query,t.type,h,t.handoffType,undefined,undefined,undefined,undefined,t.msbVerticalHash),!1);this._previewPaneViewModelParent.onAfterItemLaunch(3)}),n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.noSerp){this.renderIframe(null,"<html><body><\/body><\/html>",{},undefined,!1);let t=n.getCurrentTime();this._previewPaneViewModelParent.onResponseReceived(t);return}const c=r==0,l=SearchAppWrapper.CortanaApp.entryPoint=="WNSHVR",v=l?"WMSHVA":n.mapOSFormCode("WMSRPA"),y=l?"WMSHVM":n.mapOSFormCode("WMSRPM"),p=c?v:y;let o=this._navigationHelper.getSearchUrl(i.fullPartialQuery,t.query,t.type,h,t.handoffType,p,!0,null,c,t.msbVerticalHash);if(o+="&qfig="+n.InstrumentationHelper.getImpressionGuid(n.SequenceNumberManager.getSequenceNumber()),this._msRewardsViewModel&&this._msRewardsViewModel.isRewardsEnabled()&&(o+="&rewards=1"),i.serpURLParams)for(let n in i.serpURLParams)o=ThresholdUtilities.setUrlParameter(o,n,i.serpURLParams[n]);this._previousURLs=[];this.downloadAndDisplayMiniSerp(t,o,null,r)}getCurrentHandoffType(){return this._currentHandoffType}isIframeActive(){return this._iframe!==null}updatePreviousState(n,t){this._queryShown=n.query;this._previewedSuggestion=n;this._onPreviewPaneRendered=t;this._timestampFirstRender=null}miniSERPRenderTimeoutInstrumentation(t){let i;i={FunctionCalled:t};n.InstrumentationHelper.logClientInstEvent(e,"MiniSERPRenderTimeout",n.SequenceNumberManager.getSequenceNumber(),i)}miniSerpErrorInstrumentation(t,i,r){let u;u=r?{ErrorCause:t,ResponseRecievedTimeStamp:i.toString(),ResponseText:r.responseText,ContentType:r.contentType,ResponseStatusCode:r.status.toString(),RequestStatusCode:r.result.toString()}:{ErrorCause:t};n.InstrumentationHelper.logClientInstEvent(e,"MiniSERPError",n.SequenceNumberManager.getSequenceNumber(),u)}renderOfflineMessage(t){let f=n.isBrowserOnline(),u=n.Host.getLocString("PreviewPaneOfflineTitle"),i=n.Host.getLocString("PreviewPaneOfflineMessage").split("{0}"),r=[],e=i.length-1;for(let t=0;t<i.length;t++)t==e?r.push({text:i[t],click:()=>n.Host.launchUri("ms-settings:troubleshoot")}):r.push({text:i[t]});let o={isOnline:f,previewPaneTitle:u,previewPaneItems:r,fullPartialQuery:t,narratorMessage:u};this._onPreviewPaneErrored(o)}renderErrorMessage(t){let u=n.isBrowserOnline(),i=n.Host.getLocString("PreviewPaneErrorMessage").split("{0}"),r=[],f=n.Host.getLocString("PreviewPaneErrorMessage",t)+" "+n.Host.getLocString("PreviewPaneTimeoutMessage");for(let n=0;n<i.length;n++)r.push({text:i[n]});let e={isOnline:u,previewPaneTitle:"",previewPaneItems:r,fullPartialQuery:t,narratorMessage:f};this._hasErrored=!0;this._onPreviewPaneErrored(e)}downloadAndDisplayMiniSerp(t,i,r,u){let e=!1;if(this._queryShown=t.query,n.TestHookUrlParameters||n.MockUrlParameters){e=!!n.MockUrlParameters;let t=n.TestHookUrlParameters!==null&&n.TestHookUrlParameters!==void 0?n.TestHookUrlParameters:n.MockUrlParameters,r=t.previewPaneUrlOverride;i=r?decodeURIComponent(r):n.UrlParameters.copyTestParametersTo(i);e&&(i=ThresholdUtilities.setUrlParameter(i,"client","windowsMiniSerp"));let u=t.miniSerpBag;u&&(i=ThresholdUtilities.setUrlParameter(i,"bag",u));let f=t.dummyref;f&&(i=ThresholdUtilities.setUrlParameter(i,"dummyref",f));let o=t.clientIP;o&&(i=ThresholdUtilities.setUrlParameter(i,"clientip",o))}let o=u==0;sj_evt.fire(n.MiniSerpFetchEvent,t,o);let f=n.Host.getCustomHeaders(null);if(f["X-BM-DeviceDimensionsLogical"]=h+"x"+this._root.clientHeight,f["X-BM-DeviceDimensions"]=String(Math.round(h*this._deviceScale))+"x"+this._root.clientHeight,e||(f["User-Agent"]=navigator.userAgent+" RestrictedAPI"),r&&(f["Content-Type"]=r.contentType),n.config.msbMockToken){const n=_w.BingAtWork&&_w.BingAtWork.wsb&&_w.BingAtWork.wsb.wsbAccessToken;n&&(f.Authorization="Bearer "+n)}(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(t.handoffType))&&(this.bindWsbPrefetchResponseWithModel(),n.msbHost.prefetchManager.FetchMsbUnifiedSearch(t.query),n.msbHost.prefetchManager.FetchTenantSettings(),n.msbHost.prefetchManager.FetchUserConfigs());f["X-Search-SafeSearch"]="Strict";let s=++this._previewRequestId,c=u=>{if(this._shouldRenderMiniSerp)sb_ct(this._ppMiniSerpRenderTimer),this._ppMiniSerpRenderTimer=null,this._shouldRenderMiniSerp=!1;else return;this.miniSERPRenderTimeoutInstrumentation("miniSerpViewModelCallback");let o=n.getCurrentTime();this._previewPaneViewModelParent.onResponseReceived(o);u.status==200&&u.responseText?(this._previousURLs.push(i),this.renderIframe(i,u.responseText,f,e,!!r)):(n.InstrumentationHelper.notifyTopHitPreviewPaneOpenedOrInterrupted(n.SequenceNumberManager.getSequenceNumber()),this.miniSerpErrorInstrumentation("renderErrorMessage",o,u),this.renderErrorMessage(t.query))};this._ppMiniSerpRenderTimer&&(sb_ct(this._ppMiniSerpRenderTimer),this._ppMiniSerpRenderTimer=null);this._shouldRenderMiniSerp=!0;let l=(n.config.miniSERPRequestRetries+1)*n.config.miniSERPRequestTimeout+1e3;this._ppMiniSerpRenderTimer=n.safeSetTimeout(()=>{this._previewedSuggestion!=null&&this._previewedSuggestion==t&&(this._shouldRenderMiniSerp=!1,n.InstrumentationHelper.notifyTopHitPreviewPaneOpenedOrInterrupted(n.SequenceNumberManager.getSequenceNumber()),this.miniSERPRenderTimeoutInstrumentation("ppMiniSerpRenderTimeout"),this.stopLoadingScreen(),this.renderErrorMessage(t.query))},l,"ppMiniSerpRenderTimer");this.fetchMiniSerpUrl(i,r?r.data:null,f,c,s,r?0:n.config.miniSERPRequestRetries)}fetchMiniSerpUrl(t,i,r,u,f,o){let s=u;o>0&&(s=i=>{if(i.result==0&&i.responseText)u(i);else{let s={Url:t,StatusCode:i.status.toString(),Timeout:n.config.miniSERPRequestTimeout.toString(),RetriesRemaining:o.toString()};n.InstrumentationHelper.logClientInstEvent(e,"MiniSERPRefetch",n.SequenceNumberManager.getSequenceNumber(),s);this.fetchMiniSerpUrl(t,null,r,u,f,o-1)}});n.config.isThemeAware&&n.isDarkModeEnabled()&&!t.includes("&darkschemeovr=1")&&(t+="&darkschemeovr=1");n.config.useCobaltCSS&&!t.includes("addfeaturesnoexpansion=wsbcobalt")&&(t+="&addfeaturesnoexpansion=wsbcobalt");n.Host.isBingWallpaperAppInstalled()&&(t+="&BWPA=1");n.fetchUrl(t,r,i,s,null,()=>f==this._previewRequestId,!0,i?undefined:n.config.miniSERPRequestTimeout)}renderIframe(n,t,i,r,u){this.clearContent(()=>{this.renderIframeContent(n,t,i,r,u)})}renderIframeContent(t,i,r,u,f){this._iframe=sj_ce("iframe",n.MiniSerpIframeId);this._iframe.setAttribute("scrolling","no");this._contentContainer.appendChild(this._iframe);let o=this._iframe.contentWindow,e=this._iframe.contentDocument,h=!1;const s=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(this._currentHandoffType);f=f||s;this._footer&&(n.setVisibility(this._footer,!f),n.setVisibility(this._mask,!f));this.setIframeHeight(0);this._onIFrameLoadedCallback=()=>{s&&(this.handleWorkResultsSize(),this.handleWsbPrefetch(),this.handleLoadingStateForWorkScope());let i=e.body,f=0;if(this._calculateIFrameHeight=()=>{let n=i.offsetHeight;n!=f&&n>0&&(f=this.setIframeHeight(n,s))},this._calculateIFrameHeight(),this.overrideAjaxCalls(o,r,u),this.captureNavigationsAndSizeEvents(t,i,o,e),this._scrollArea.scrollTop=0,n.config.backStackSearchEnabled&&(this._shouldAddSearchBackStack=!0,this._currentBackStackTimeout&&clearTimeout(this._currentBackStackTimeout),this._currentBackStackTimeout=sb_st(()=>{this._shouldAddSearchBackStack=!1},n.config.miniSerpRedirectTimeoutInMs)),n.contains([2,3],this._currentVertical)){let t={childList:!0,subtree:!0};this._mutationObserver=new MutationObserver(()=>{this._calculateIFrameHeight&&this._calculateIFrameHeight()});n.safeExecute(()=>{this._currentVertical===2?this._mutationObserver.observe(e.getElementById("images"),t):this._currentVertical===3&&this._mutationObserver.observe(e.getElementById("video"),t)},"onIFrameLoadedCallback")}this._msRewardsViewModel&&this._msRewardsViewModel.isRewardsEnabled()&&o.sj_rra&&o.sj_rra(t);this._timestampFirstRender=n.getCurrentTime();this.instrumentOnPreviewPaneRendered(!0,!1)};this._iframe.onload=()=>{if(s&&(this._scrollArea.scrollTop=0,this.clearWsbPrefetchStorage(),this.stopLoadingScreen()),h){this.tryLaunchUrl(t,o.location.href,0);return}h=!0;this.overrideAjaxCalls(o,r,u)};e.open();e.write(i);e.write("<base href='"+t+"' target='_parent' />");e.write("<script>window.parent.sj_evt.fire('"+n.MiniSerpLoadedEvent+"')<\/script>");e.close()}setIframeHeight(n,t){const i=t?s:lt;return n<i&&(n=i),this._iframe.style.height=n+"px",n}overrideAjaxCalls(t,i,r){t.sj_gx=()=>{let t=sj_gx(),u=t.open;return t.open=(f,e,o,s,h)=>{if(this.blockedMiniSERPUrls.some(n=>e.startsWith(n)))throw new Error("MiniSERP blocked URL request: iFrame URL: "+this._iframe.contentDocument.baseURI+" requestUrl: "+e);f=="GET"&&r&&(e=ThresholdUtilities.setUrlParameter(e,"client","windowsMiniSerp"));n.config.isThemeAware&&n.isDarkModeEnabled()&&!e.includes("&darkschemeovr=1")&&(e=ThresholdUtilities.setUrlParameter(e,"darkschemeovr","1"));n.config.useCobaltCSS&&!e.includes("&addfeaturesnoexpansion=wsbcobalt")&&(e=ThresholdUtilities.setUrlParameter(e,"addfeaturesnoexpansion","wsbcobalt"));u(f,e,o,s,h);for(let n in i)t.setRequestHeader(n,i[n])},t}}captureNavigationsAndSizeEvents(t,i,r,u){this._focusHelper=this.createFocusHelper(r,u);this._focusHelper&&(this._originalMiniSerpXYFocusRoot=this._focusHelper.getXYFocusRoot());this._previewPaneViewModelParent.focusPending&&(this._previewPaneViewModelParent.focusPending=!1,this.focus());this._iframe.contentWindow.overlay_onBeforeContentLoad=()=>{this.setIframeHeight(ct)};this._iframe.contentWindow.overlay_onBeforeSuccess=n=>{this.setIframeHeight(n.clientHeight+yt)};let f=()=>{r.sj_lc=n=>{if(n)this.tryLaunchUrl(t,n,0);else{let n=this._previousURLs[this._previousURLs.length-2];this._previousURLs.splice(this._previousURLs.length-2,2);this.tryLaunchUrl(t,n,0)}},r.MiniSerp=!0,this._calculateIFrameHeight()},s=n=>{this._focusHelper.setXYFocusRoot(n),this._focusHelper.moveFocusToEdgeFocusableElement(0)},o=r.sj_evt;if(o)["onP1","ajaxReady"].forEach(n=>o.bind(n,f)),o.bind("l2_overlay_visible",n=>{f();var t=this._iframe.contentDocument.getElementById(n[1]);t&&(this._focusHelper.setIsL2Visible(!0),s(t))}),o.bind("l2_overlay_hidden",()=>{f(),this._focusHelper.setIsL2Visible(!1),s(this._iframe.contentDocument.body)});else f();r.open=n=>(this.tryLaunchUrl(t,n,0),null);i.onclick=i=>{let r=i.target;if(r){if(r.id=="miniSERPToWeb"){n.InstrumentationHelper.logClientInstEvent(e,"AdultExplicitLoad",n.SequenceNumberManager.getSequenceNumber(),{url:t,query:this._previewedSuggestion.query});this._footer.click();return}while(r&&!r.href)r=r.parentNode}r&&this.tryLaunchUrl(t,r.href,n.getInputType(i))==0&&i.preventDefault()}}navigateInPlace(t,i,r,u){let f=w(u);this._previewPaneViewModelParent.onBeforeItemLaunch(i,r,f);this._footer&&(this._footer.onclick=()=>n.Host.launchSearch(null,this.enrichBingSearchUrlParameters(t),!1));this.clearContent();this._previewPaneViewModelParent.focusPending=!0;this.startLoadingScreen();let e=this.enrichBingSearchUrlParameters(t,!0);this.setVertical(u);let o={destinationVertical:u.toString(),url:t};n.InstrumentationHelper.logClientInstEvent("Select","NavigateInPlace",n.SequenceNumberManager.getSequenceNumber(),o);this.downloadAndDisplayMiniSerp(this._previewedSuggestion,e,null,1);this._previewPaneViewModelParent.onAfterItemLaunch(f)}tryLaunchUrl(t,i,r){if(!i)return 1;let o=n.getCurrentTime();i=i.trim();let u=i.toLowerCase(),s=b(i);if(s!==null&&p(i)&&!y(u)&&ti(i)&&s!==this._currentVertical)return this.navigateInPlace(i,o,r,s),0;if(u.startsWith("javascript:location.reload"))return 0;if(i==t+"#"||u.startsWith("javascript:"))return 1;if(u=="/loading")return 0;if(i.startsWith(window.location.href))return SharedLogHelper.LogError("previewPane.tryLaunchUrl",t,new Error("Anchor navigation on PreviewPane")),0;i.startsWith("/")&&(i=n.getWindowProtocol()+"//"+n.getWindowHost()+i);let f=b(i);if(f){if(f==this._currentVertical&&p(i)&&pt.some(n=>u.includes(n)))return this.navigateInPlace(i,o,r,f),0;i=this.enrichBingSearchUrlParameters(i)}let h=f?w(f):2;this._previewPaneViewModelParent.onBeforeItemLaunch(o,r,h);let e=n.tryGetBingPathLC(i);if(e)ht.some(n=>e.startsWith(n))||y(u)?n.Host.launchUri(n.config.settingsUri):e.startsWith("/profile/interests")?n.Host.launchCat1(null,"ms-cortana://navigate/Notebook",null):(this._shouldAddSearchBackStack&&i.indexOf("aclk?ld=")>-1&&(sb_ct(this._currentBackStackTimeout),i=this.buildAdsRedirectUrl(this._previewedSuggestion.query,i)),n.Host.launchUri(i));else{if(this._shouldAddSearchBackStack&&!u.startsWith("ms-settings"))if(sb_ct(this._currentBackStackTimeout),(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(this._previewedSuggestion.handoffType))&&this._iframe){if(e){const t="form="+n.mapOSFormCode("WSBWS0")+"&cvid="+n.encodeQueryParameter(n.Host.getConversationId()),r=i.includes("?")?"&":"?";i=`${i}${r}${t}`}}else i=this.buildRedirectUrl(this._previewedSuggestion.query,i);n.config.enableMoreEdgeProtocol?n.Host.launchUrlWithEdgeProtocol(i,{campaign:n.config.moreEdgeProtocolOCID,medium:"Miniserp"}):n.Host.launchUri(i)}this._previewPaneViewModelParent.onAfterItemLaunch(h);return 0}enrichBingSearchUrlParameters(n,t=false){return n=this._navigationHelper.enrichUrlWithMarketInfo(n),n=this._navigationHelper.enrichUrlWithDeviceInfo(n),n=this._navigationHelper.enrichUrlWithCvid(n),n=this._navigationHelper.enrichUrlWithSuggestionType(n,this._previewedSuggestion.type),t||(n=this._navigationHelper.enrichUrlWithMuidInfo(n),n=this._navigationHelper.enrichUrlWithSafeSearchInfo(n)),n}createFocusHelper(n,t){let i=this.getSearchAppWinJSXYFocus(n);return!i&&SearchAppWinJS&&SearchAppWinJS.initXYFocus&&(SearchAppWinJS.initXYFocus(n),i=this.getSearchAppWinJSXYFocus(n),n[ut]=i?!0:!1),i?new k(t,n,i,this._scrollArea,this._currentVertical):null}getSearchAppWinJSXYFocus(n){let i,t=n[ft];return t&&t.UI&&(i=t.UI.XYFocus),i}tryExecuteFocusOnMiniSerp(n){let t=!1;return this._focusHelper&&(t=n()),t||this._footer&&(this._footer.focus(),t=!0),t}buildAdsRedirectUrl(t,i){var r=new URL(i);return!r||!r.search||r.search.length<1?i:_w.location.protocol+"//"+_w.location.host+"/WS/redirect/?q="+n.encodeQueryParameter(t)+"&form="+n.mapOSFormCode("WSBBST")+"&cvid="+n.encodeQueryParameter(n.Host.getConversationId())+"&rtk="+this._iframe.contentWindow.rtk+"&"+r.search.substring(1)}buildRedirectUrl(t,i){return _w.location.protocol+"//"+_w.location.host+"/WS/redirect/?q="+n.encodeQueryParameter(t)+"&url="+btoa(i)+"&form="+n.mapOSFormCode("WSBBST")+"&cvid="+n.encodeQueryParameter(n.Host.getConversationId())+"&rtk="+this._iframe.contentWindow.rtk}bindWsbPrefetchResponseWithModel(){this._wsbPrefetchGuid=n.Host.createGuid();this._wsbPrefetchModel={};this.bindWsbPrefetchSuccessWithModel();this.bindWsbPrefetchFailureWithModel()}bindWsbPrefetchSuccessWithModel(){u.forEach(t=>{if(t==="bfbVerticalConfig"){const i=n.LightweightStorage.getItem(n.VerticalConfigLocalStorageKey);if(i){const n=JSON.parse(i),r={status:"done",response:{"0":"bfbVerticalConfig","1":n.data}};this._wsbPrefetchModel[t]=r}}else this.bindWsbPrefetchResponse(t)})}bindWsbPrefetchResponse(n){this._wsbPrefetchModel[n]={status:"inprogress"};const t=i=>{const r={status:"done",response:i};this._wsbPrefetchModel[n]=r;sj_evt.unbind(n,t)};sj_evt.bind(n,t,!1,0,!0)}bindWsbPrefetchFailureWithModel(){o.forEach(n=>{const t=i=>{const r={status:"failed",response:i};this._wsbPrefetchModel[n]=r;sj_evt.unbind(n,t)};sj_evt.bind(n,t,!1,0,!0)})}handleLoadingStateForWorkScope(){this.handleLoadingStateEvent(gt)}handleLoadingStateEvent(n){var t,i;if((i=(t=this._iframe)===null||t===void 0?void 0:t.contentWindow)===null||i===void 0?void 0:i.sj_evt){const t=()=>{var i;this.stopLoadingScreen();(i=this._iframe.contentWindow.sj_evt)===null||i===void 0?void 0:i.unbind(n,t)};this._iframe.contentWindow.sj_evt.bind(n,t,!0,0,!0)}}handleWorkResultsSize(){var t,i;((i=(t=this._iframe)===null||t===void 0?void 0:t.contentWindow)===null||i===void 0?void 0:i.BingAtWork)&&!this._iframe.contentWindow.BingAtWork.workVerticalResultsRendered&&(this._iframe.contentWindow.BingAtWork.workVerticalResultsRendered=t=>{n.config.useCobaltCSS?(t=!this._currentSuggestion.navDomain&&t===vt?this._iframe.contentDocument.body.offsetHeight:t+l,t=t<c?c:t):(t=!this._currentSuggestion.navDomain&&t===at?this._iframe.contentDocument.body.offsetHeight:t+l,t=t<s?s:t),this.setIframeHeight(t,!0)})}handleWsbPrefetch(){this._iframe.contentWindow&&(this._iframe.contentWindow[dt]=this._wsbPrefetchGuid,u.forEach(n=>{const t=this._wsbPrefetchModel[n];t&&this.setWsbPrefetchToInframeStorageAndFireEvent(t,n,!1,"handleWsbPrefetch:success")}),o.forEach(n=>{const t=this._wsbPrefetchModel[n];t&&t.status==="failed"&&this.setWsbPrefetchToInframeStorageAndFireEvent(t,n,!1,"handleWsbPrefetch:failure")}));this.bindAndSetWsbPrefetchToChildIframeStorage()}setWsbPrefetchToInframeStorageAndFireEvent(n,t,i,r){var u,f;if(n){const o=JSON.stringify(n),e=`${a}${t}-${this._wsbPrefetchGuid}`;try{((u=this._iframe)===null||u===void 0?void 0:u.contentWindow)&&(this._iframe.contentWindow.sessionStorage.setItem(e,o),i&&((f=this._iframe.contentWindow.sj_evt)===null||f===void 0?void 0:f.fire(`${v}${e}`,n)))}catch(s){}}}bindAndSetWsbPrefetchToChildIframeStorage(){this._iframe.contentWindow&&(this.bindAndSetWsbPrefetchSuccess(),this.bindAndSetWsbPrefetchFailure())}bindAndSetWsbPrefetchSuccess(){u.forEach(n=>{const t=i=>{if(i){let t={status:"done",response:i};this.setWsbPrefetchToInframeStorageAndFireEvent(t,n,!0,"bindAndSetWsbPrefetchSuccess")}sj_evt.unbind(n,t)};sj_evt.bind(n,t,!1,0,!0)})}bindAndSetWsbPrefetchFailure(){o.forEach(n=>{const t=i=>{let r={status:"failed",response:i};this.setWsbPrefetchToInframeStorageAndFireEvent(r,n,!0,"bindAndSetWsbPrefetchFailure");sj_evt.unbind(n,t)};sj_evt.bind(n,t,!1,0,!0)})}clearWsbPrefetchStorage(){var n;((n=this._iframe)===null||n===void 0?void 0:n.contentWindow)&&(u.forEach(n=>{var t,i;const r=`${a}${n}`;(i=(t=this._iframe)===null||t===void 0?void 0:t.contentWindow)===null||i===void 0?void 0:i.sessionStorage.removeItem(r)}),this._wsbPrefetchModel={})}isWorkScopeSubVerticalChange(t){return t.scope===n.Scope.Work&&t.query===this._queryShown}}n.MiniSerpViewModel=ri;class k{constructor(t,i,r,u,f,e){this._targetDocument=t;this._targetWindow=i;this._searchAppXYFocus=r;this._scrollArea=u;this._verticalType=f;this._useStickyFocusOverride=e;this._isL2Visible=!1;this._useStickyFocus=!1;(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.stickyFocus)===!0&&(this._useStickyFocus=!0);this._useStickyFocusOverride!=null&&(this._useStickyFocus=this._useStickyFocusOverride);const s="b_hide",h="acc-inactive",c=".b_slidebar";this._focusDiv=sj_ce("div",d,s);t.body.appendChild(this._focusDiv);sj_be(t,"blur",t=>{this._useStickyFocus?(!t.srcElement.offsetParent||t.srcElement.classList.contains("b_hide")||t.relatedTarget)&&n.setVisibility(this._focusDiv,!1):n.setVisibility(this._focusDiv,!1)},!0);var o=!0;sj_be(t,"click",()=>o=!1,!0);sj_be(t,"keydown",()=>o=!0,!0);sj_be(t,"focus",()=>this.updateFocusedElementAndOutline(this._targetDocument.activeElement,o),!0);sj_be(t,"scroll",n=>{this._lastElementFocused&&(n.srcElement==this._lastElementFocused||this._lastElementFocused.compareDocumentPosition(n.srcElement)&Node.DOCUMENT_POSITION_CONTAINS)&&this.updateFocusedElementAndOutline(this._lastElementFocused,o)},!0);sj_be(t,"transitionend",n=>{let t=this._targetDocument.activeElement;(n.propertyName=="height"||n.srcElement==t.closest(c))&&(this._focusOutlineTimeout?(this.clearFocusOutlineTimeout(),this.outlineElementAndScrollIntoView(t)):this._focusDiv.classList.contains(s)||this.outlineElementAndScrollIntoView(t),n.srcElement.style.height=="0px"?n.srcElement.classList.add(h):n.srcElement.classList.remove(h))});this._searchAppXYFocus.keyCodeMap.home.push(36);this._searchAppXYFocus.keyCodeMap.end.push(35)}getXYFocusRoot(){return this._searchAppXYFocus.focusRoot}isL2Visible(){return this._isL2Visible}setIsL2Visible(n){this._isL2Visible=n}setXYFocusRoot(n){this._searchAppXYFocus.focusRoot=n}moveFocus(n,t){return this._searchAppXYFocus._xyFocus(n,t)}moveFocusToEdgeFocusableElement(n,t=false){this._targetWindow.focus();let i;if(t&&n==0)i=this.focusFirstSerpElement();else{let u,f,t,e=this._targetWindow.innerWidth,o=this._targetWindow.innerHeight;n==0?(u=-1,f=0,t=40):n==1&&(u=o,f=o+1,t=38);let s={top:u,bottom:f,right:e,left:0,height:1,width:e};i=this._searchAppXYFocus._xyFocus(r[t],t,s)}return i&&(this.scrollTo(n),this.updateFocusedElementAndOutline(this._targetDocument.activeElement)),i}onSearchBoxFocusChanged(){this._targetDocument.hasFocus()?this.updateFocusedElementAndOutline(this._targetDocument.activeElement):this._useStickyFocus||n.setVisibility(this._focusDiv,!1)}isVisible(n){let t=_w.getComputedStyle(n);return!(t.visibility=="hidden"||t.display=="none"||n.offsetWidth===0&&n.offsetHeight===0)}moveFocusToLastFocusedElement(){return this._lastElementFocused&&this.isVisible(this._lastElementFocused)?(this._lastElementFocused.focus(),this.updateFocusedElementAndOutline(this._lastElementFocused),!0):this.moveFocusToEdgeFocusableElement(0,!0)}updateFocusedElementAndOutline(t,i=true){if(t&&t!=this._targetDocument.body&&(this.processFocusedElement(t),i)){let r=this._lastElementFocused&&t.elementType&&t.elementType==this._lastElementFocused.elementType&&t.parentElement==this._lastElementFocused.parentElement?rt:0;r?(n.setVisibility(this._focusDiv,!1),this._focusOutlineTimeout=n.safeSetTimeout(()=>{this._targetDocument.activeElement==t&&this.outlineElementAndScrollIntoView(t),this.clearFocusOutlineTimeout()},r,"updateFocusedElementAndOutline")):this.outlineElementAndScrollIntoView(t);this._lastElementFocused=t}}outlineElementAndScrollIntoView(t){if(t!=this._targetDocument.body&&(this._useStickyFocus||this._targetDocument.hasFocus())){let r=t.getBoundingClientRect(),a=this._targetDocument.documentElement.scrollWidth-i*2,v=this._targetDocument.documentElement.scrollHeight-i*2,o=r.top+this._targetWindow.pageYOffset,u=r.left+this._targetWindow.pageXOffset,y=a-u,p=v-o,s=u<0?Math.floor(r.width+u-i):r.width;if(s<=0){n.setVisibility(this._focusDiv,!1);return}let e=r.height;if(e<=0&&t.children.length>0)for(let n=0;n<t.children.length;n++){let i=t.children[n].getBoundingClientRect();i.height>e&&(e=i.height,o=i.top)}this._focusDiv.style.top=Math.max(i,o)+"px";this._focusDiv.style.left=Math.max(this.isL2Visible?i:i*4,u)+"px";this._focusDiv.style.width=Math.min(y,s)+"px";this._focusDiv.style.height=Math.min(p,e)+"px";n.setVisibility(this._focusDiv,!0);let h=t.getBoundingClientRect(),c=this._scrollArea.offsetHeight+this._scrollArea.scrollTop-h.bottom-f,l=h.top-this._scrollArea.scrollTop-f;c<0?this._scrollArea.scrollTop+=f-c:l<0&&(this._scrollArea.scrollTop+=l-f)}}scrollTo(n){let t=0;n==1&&(t=this._scrollArea.scrollHeight);this._scrollArea.scrollTop=t}processFocusedElement(i){if(!i.isProcessed){let r=i.tagName.toLocaleLowerCase(),u=i.getAttribute("type");r=="select"&&(sj_be(i,"keydown",n=>{n.keyCode==32?i.classList.add(t):n.keyCode==13&&i.classList.remove(t)},!0),this.reactivateXYFocusOnBlur(i));r=="input"&&u=="range"&&(sj_be(i,"keydown",n=>{let r=n.target,f=+r.getAttribute("min"),e=+r.getAttribute("step"),u=n.keyCode==37,o=n.keyCode==39,s=+r.value-e<f&&u;n.keyCode==38||n.keyCode==40||s?i.classList.remove(t):(u||o)&&i.classList.add(t)},!0),this.reactivateXYFocusOnBlur(i));r=="button"&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isWorkScopeApplicable())&&sj_be(i,"click",()=>n.setVisibility(this._focusDiv,!1));let f=(n,r)=>{if(!r.readOnly){let e=r.selectionStart!=r.selectionEnd;if(e){i.classList.add(t);return}let u=r.selectionEnd==0,f=r.selectionEnd==r.value.length,o=n.keyCode==36&&!u,s=n.keyCode==35&&!f,h=n.keyCode==37&&!u,c=n.keyCode==39&&!f;h||c||o||s?i.classList.add(t):i.classList.remove(t)}};if(r=="textarea"&&(sj_be(i,"keydown",n=>f(n,n.target),!0),this.reactivateXYFocusOnBlur(i)),r=="input"&&(u=="number"||u=="text")&&(sj_be(i,"keydown",n=>f(n,n.target),!0),this.reactivateXYFocusOnBlur(i)),nt.some(n=>i.classList.contains(n))){i.elementType="slide";let t=Array.prototype.slice.call(i.querySelectorAll("a:not([onclick='TestHooks.HideShowTestHooks(this);']):not([disabled])"),0),n=t.filter(n=>this.isVisible(n)&&n.offsetHeight>0&&n.offsetWidth>0);n&&sj_be(i,"keydown",t=>{let r=this.countUniqueHrefs(n),u=t.keyCode;t.srcElement==i&&(r>1&&u==40?(t.preventDefault(),this._searchAppXYFocus.focusRoot=i,n[0].focus()):r==1&&u==13&&n[0].click())})}else if(tt.some(n=>i.hasAttribute(n))){i.elementType="expansion";let t=(t=true)=>{n.setVisibility(this._focusDiv,!1),this.updateFocusedElementAndOutline(this._targetDocument.activeElement,t)};sj_be(i,"keyup",n=>{n.keyCode==13&&t()},!0);sj_be(i,"click",()=>{t(!1)})}else if(i.classList.contains(it)){let n=()=>{let n=this._targetDocument.getElementById("vidPreStopButton");n&&n.focus();let t=()=>{i.focus()};sj_be(n,"click",t);sj_be(n,"keydown",function(n){n=sj_ev(n);n.keyCode===13&&t()});let r=this._targetDocument.getElementsByTagName("video")[0];sj_be(r,"ended",t)};sj_be(i,"keydown",t=>{t.keyCode==13&&n()},!0);sj_be(i,"click",()=>{n()})}i.classList.add(g);i.isProcessed=!0}}countUniqueHrefs(n){let t={};if(n)for(let i=0;i<n.length;i++){let r=n[i];r&&(t[r.href]=!0)}return Object.keys(t).length}reactivateXYFocusOnBlur(n){sj_be(n,"blur",()=>{n.classList.remove(t)})}focusFirstSerpElement(){let n;switch(this._verticalType){case 1:n=this._targetDocument.getElementById("b_content");break;case 2:n=this._targetDocument.getElementById("images");break;case 3:n=this._targetDocument.getElementById("video");break;case 4:n=this._targetDocument.getElementById("dsb_first_foc");break;default:throw Error("Unknown vertical type "+this._verticalType);}if(n){let t=n.querySelectorAll('a:not([onclick=\'TestHooks.HideShowTestHooks(this);\']):not([disabled]):not([tabindex="-1"]), button:not([disabled]), input[type=text]:not([disabled]), input[type=submit]:not([disabled]), textarea:not([disabled]), select:not([disabled]):not(#tta_sl):not(#tta_srcsl), [tabindex]:not([disabled]):not([tabindex="-1"]):not(#tta_playiconsrc)');for(let n=0;n<t.length;n++){let i=t[n];if(this.isVisible(i))return i.focus(),!0}}return!1}clearFocusOutlineTimeout(){sb_ct(this._focusOutlineTimeout);this._focusOutlineTimeout=null}}n.WSBMiniSerpFocusHelper=k}(WSB||(WSB={})),function(n){function i(n,t){switch(n){case"arrowRight":case"button":case"submit":return 1;case"autoContent":case"keepOpen":case"alwaysWide":case"refresh":return t&&t.inorganic?3:0;case"arrowUpOrDown":return 0;default:throw new Error("Unknown open type: "+n);}}function r(n){let t="None";switch(n){case 2:t="Local";break;case 3:t="Msb";break;case 1:t="Web";break;case 4:t="GoodNews"}return t}const t="noScroll";n.getPreviewPaneTypeAsString=r;class u{constructor(t,i,r,u,f){this._page=t;this._previewPaneId=0;this._beforeItemLaunchEventHandlers=[];this._afterItemLaunchEventHandlers=[];let c=(n,t,i,r,u)=>{this._clickLoggedForCurrentPreviewPane||this._beforeItemLaunchEventHandlers.forEach(f=>f(n,this._previewedSuggestion,t,i,r,u))},l=n=>{this._clickLoggedForCurrentPreviewPane||(this._afterItemLaunchEventHandlers.forEach(t=>t(this._previewedSuggestion,this._queryForPreviewedSuggestion,n)),this._clickLoggedForCurrentPreviewPane=!0)},a=t=>{var i,r;this._previewPaneResponseReceivedTimeStamp=t;const u=((i=this._activePreviewPaneViewModel)===null||i===void 0?void 0:i.getCurrentHandoffType)?((r=this._activePreviewPaneViewModel)===null||r===void 0?void 0:r.getCurrentHandoffType())===21:!1;(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isLoading)||!this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)||u||this._activePreviewPaneViewModel.stopLoadingScreen()};this._previewPaneViewModelParent={focusPending:!1,onBeforeItemLaunch:c,onAfterItemLaunch:l,onResponseReceived:a};let e=_ge("localPane"),o=_ge("miniSerpPane"),s=_ge("msbPane"),h=_ge("goodNewsPane");i.init(this._previewPaneViewModelParent,o);r&&r.init(this._previewPaneViewModelParent,e);u&&u.init(this._previewPaneViewModelParent,s);f&&f.init(this._previewPaneViewModelParent,h);SearchAppWrapper.CortanaApp.addEventListener("resettingtodefaultsize",()=>this.dismiss());n.Host.bindKeyDown(()=>{this._previewPaneViewModelParent.focusPending=!1});n.Host.bindSearchBoxGotFocus(()=>this._previewPaneViewModelParent.focusPending=!1);n.Host.bindQueryChangedOrInitialized(n=>this._currentQuery=n,!0);n.Host.bindAccountChanged(()=>{this._miniSerpMustRefresh=!0});n.InstrumentationHelper.bindFinalizeKeystroke(n=>{this._activePreviewPaneViewModel&&n&&this._activePreviewPaneViewModel.finalizeKeystroke()});this._previewPaneInfos=[];this._previewPaneInfos[0]={paneElement:_ge("errorPane"),viewModel:null};this._previewPaneInfos[1]={paneElement:o,viewModel:i,disableRootScroll:!0};this._previewPaneInfos[2]={paneElement:e,viewModel:r,disableRootScroll:n.config.useCobaltCSS?!0:!1};this._previewPaneInfos[3]={paneElement:s,viewModel:u};this._previewPaneInfos[4]={paneElement:h,viewModel:f}}init(n){this._selectionHandler=n}getSelectableItems(){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.getSelectableItems():[]}getSelectableItemsByGroup(){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.getSelectableItemsByGroup():[]}getSelectedItem(){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.getSelectedItem():null}select(n,t){this._activePreviewPaneViewModel&&this._activePreviewPaneViewModel.select(n,t)}onAfterKeyDown(n,t,i,r){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.onAfterKeyDown(n,t,i,r):!1}getPreviewedSuggestion(){return this._previewedSuggestion}getPreviewedSuggestionToForceTopHit(){return this._forceTopHitForPreviewedSuggestion&&!this._closeTimer?this._previewedSuggestion:null}getOnPreviewPaneRendered(t,u,f,e){let h=++this._previewPaneId,o=!0,c=n.getCurrentTime();this._instrumentedOpenThisImpression=!1;let s=t?r(t.previewPaneType):"None";return n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("RenderPreviewPane - "+s),(r,l,a)=>{if(r||!l){if(l||(o=!1),!this._instrumentedOpenThisImpression){let r={ppId:""+h,openType:u,suggestion:t?t.instItem.getLayoutKValue():undefined,suggestionType:t?t.type:undefined,startOpening:""+c,openDelay:f?""+f:undefined};if(a)for(let n in a)r[n]=a[n];r.waitingForMore=o?"true":undefined;n.InstrumentationHelper.previewPaneOpenedOrClosed(!0,n.SequenceNumberManager.getSequenceNumber(),t?t.instItem:undefined,t?t.previewPaneType:undefined,i(u,e)==0,r)}this._instrumentedOpenThisImpression=!0;r&&(this._instrumentedOpenThisImpression=!1,u="keepOpen");!o&&n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("RenderPreviewPane - "+s)}}}onPreviewPaneErrored(i){for(let t of this._previewPaneInfos)n.setVisibility(t.paneElement,!1);this._page.updateNarratorMessageView(null);n.StaticHtmlElements.qfPreviewScrollArea.classList.remove(t);this._page.updatePreviewErrorMessageView(i);n.setVisibility(this._previewPaneInfos[0].paneElement,!0);this._page.updateNarratorMessageView(i.narratorMessage)}showPreview(t,r,u="button",f=false,e=0,o=false){if(this.updateMsbWorkScopeSuggestion(t,r),this._previewPaneOpenedForThisQuery=!0,this.clearSuggOpeningState(this._pendingPreviewedSuggestion),this.clearOpenTimer(),this.clearCloseTimer(),r!=this._previewedSuggestion||f){n.RuntimeConfig.AlwaysWide||this._page.setPreviewPaneVisibility(!0);let f=this.getOnPreviewPaneRendered(r,u,e,t);o?n.InstrumentationHelper.notifyPreviewPanePending(n.SequenceNumberManager.getSequenceNumber(),r.previewPaneType,r.type):n.InstrumentationHelper.notifyTopHitPreviewPaneOpenedOrInterrupted(n.SequenceNumberManager.getSequenceNumber());this.setPreviewPaneContent(t,r,i(u,t),this._previewPaneId,f,n=>this.onPreviewPaneErrored(n));this._selectionHandler.updateLastMiniSerpAutoSuggestion(r)}u!="button"&&this._selectionHandler.updateSelectionState(r)}updateMsbWorkScopeSuggestion(t,i){var r,u,f;const e=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(i.handoffType);e&&(i.previousQuery=(r=this._previewedSuggestion)===null||r===void 0?void 0:r.query,i.previousScope=(u=this._previewedSuggestion)===null||u===void 0?void 0:u.scope,i.query=t.queryToFetch,i.scope=t.scope,i.previousMsbVerticalHash=(f=this._previewedSuggestion)===null||f===void 0?void 0:f.msbVerticalHash)}showPreviewAndFocus(n,t,i="submit"){(this._closeTimer||this._previewedSuggestion!=t)&&this.showPreview(n,t,i);this._activePreviewPaneViewModel.focus(!1);this._forceTopHitForPreviewedSuggestion=!0}focus(n){return this._activePreviewPaneViewModel?(this._activePreviewPaneViewModel.focus(n),!0):!1}blur(){this._activePreviewPaneViewModel&&this._activePreviewPaneViewModel.blur()}dismiss(){this.close(!0)}close(t){this.clearOpenTimer();var i=t?0:n.config.closePreviewPaneDelay;i?this._closeTimer||(this._closeTimer=n.safeSetTimeout(()=>{this._closeTimer=null,this.innerClose(t)},i,"ppCloseTimer")):(this.clearCloseTimer(),this.innerClose(t))}innerClose(t){if(this._previewedSuggestion){let i=!0;if(t&&(this._clickLoggedForCurrentPreviewPane?i=!1:this._previewPaneResponseReceivedTimeStamp&&n.getCurrentTime()>this._previewPaneResponseReceivedTimeStamp+1e3&&(i=!1)),i){let i=t?{fromQFDismiss:"1"}:undefined;n.InstrumentationHelper.previewPaneOpenedOrClosed(!1,n.SequenceNumberManager.getSequenceNumber(),this._previewedSuggestion.instItem,this._previewedSuggestion.previewPaneType,undefined,i)}n.RuntimeConfig.AlwaysWide||t||this._page.setPreviewPaneVisibility(!1);this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.stopLoadingScreen();this.clear()}}clear(t){for(let t=0;t<this._previewPaneInfos.length;++t)n.setVisibility(this._previewPaneInfos[t].paneElement,!1);this._previewedSuggestion&&(this._previewedSuggestion.hasPreviewPaneOpened=!1,this._selectionHandler.updateSelectionState(this._previewedSuggestion),this._previewedSuggestion=null);this._forceTopHitForPreviewedSuggestion=!1;this._clickLoggedForCurrentPreviewPane=!1;this._previewPaneViewModelParent.focusPending=!1;this._activePreviewPaneViewModel&&(t||this._activePreviewPaneViewModel.clear(),this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.stopLoadingScreen());this._queryForPreviewedSuggestion=null;this._previewPaneResponseReceivedTimeStamp=null;this._activePreviewPaneViewModel=null}onQueryChanged(t,i){this._previewPaneOpenedForThisQuery=!1;let r=this._queryForPendingPreviewedSuggestion||this._queryForPreviewedSuggestion;if(this._queryIsContinuationOfPreviousQuery=r&&t.queryToFetch.toLocaleLowerCase().startsWith(r.queryToFetch.toLocaleLowerCase()),r&&t.queryToFetch.toLocaleLowerCase()!=r.queryToFetch.toLocaleLowerCase()){let u=this._pendingPreviewedSuggestion&&this._pendingPreviewedSuggestion.updateFromQuery?this._pendingPreviewedSuggestion:this._previewedSuggestion&&!this._closeTimer&&this._previewedSuggestion.updateFromQuery?this._previewedSuggestion:null;if(u){if(n.RuntimeConfig.AlwaysWide){this.autoOpen(t,u,"alwaysWide",!0,!0);return}this._queryIsContinuationOfPreviousQuery?(this._forceTopHitForPreviewedSuggestion=!1,this.autoOpen(t,u,"keepOpen",!0,!0)):this.close(!1)}else i&&this.autoOpen(t,i,"keepOpen",!0,!0)}}clearSuggOpeningState(n){n&&(n.isPreviewPaneOpening=!1,this._selectionHandler.updateSelectionState(n))}clearOpenTimer(){this._openTimer&&(sb_ct(this._openTimer),this._openTimer=null,this._pendingPreviewedSuggestion.isPreviewPaneOpening=!1,this._pendingPreviewedSuggestion=null,this._queryForPendingPreviewedSuggestion=null,this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.stopLoadingScreen())}clearCloseTimer(){this._closeTimer&&(sb_ct(this._closeTimer),this._closeTimer=null)}onTopHitUpdated(t,i,r,u){if(r){if(!this._closeTimer&&(this._openTimer&&this._pendingPreviewedSuggestion!=r&&this.clearOpenTimer(),!this._miniSerpMustRefresh||r.previewPaneType!=1)){if(r.scope=t.scope,this._pendingPreviewedSuggestion&&n.isEquivalentForPreviewPanePurposes(t,this._pendingPreviewedSuggestion,r)){this._pendingPreviewedSuggestion=r;this._queryForPendingPreviewedSuggestion=t;r.hasPreviewPaneOpened=!0;this._selectionHandler.updateSelectionState(r);return}if(this._previewedSuggestion&&n.isEquivalentForPreviewPanePurposes(t,this._previewedSuggestion,r)){(!n.contains(u,i)||r.previewPaneNeedsRefreshAfterDeduping)&&(this._previewedSuggestion=r,this._queryForPreviewedSuggestion=t,r.hasPreviewPaneOpened=!0,this._selectionHandler.updateSelectionState(r),this.refreshLocalContent(t,r,n.SequenceNumberManager.getSequenceNumber()));return}}if(this._miniSerpMustRefresh=!1,this._forceTopHitForPreviewedSuggestion=!1,r.previewPaneType){if(n.RuntimeConfig.AlwaysWide){this.autoOpen(t,r,"alwaysWide",!1,!0);return}if(r==u[0]&&!this._previewPaneOpenedForThisQuery){if(r.autoOpenPreviewPaneWhenOnTopHit){this.autoOpen(t,r,"autoContent",!1,!0);return}if(this._previewedSuggestion&&this._queryIsContinuationOfPreviousQuery){this.autoOpen(t,r,"keepOpen",!1,!0);return}}}}this._openTimer&&(this.clearSuggOpeningState(this._pendingPreviewedSuggestion),this.clearOpenTimer());this._previewedSuggestion&&this.close(!1)}getDelayForMiniSerp(t,i,r){const u=n.getTweakedSetting("preventAutomaticMiniSerp");switch(t){case"keepOpen":case"alwaysWide":return r&&r.inorganic?0:u?Number.MAX_VALUE:n.config.probabilityNextKeyStrokeEnabled&&i.featureStore&&i.featureStore[264]!==undefined?this.calculateDelayForProbabilitySignal(i.featureStore[264]):n.RuntimeConfig.AlwaysWide?i.isAnswer?0:(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isTenantMsbEnabled())?n.config.msbMiniSerpDelay:n.config.autoOpenMiniSerpDelay:n.config.keepMiniSerpOpenDelay;case"arrowUpOrDown":return u?Number.MAX_VALUE:n.config.openOnKeybNavMiniSerpDelay}return 0}calculateDelayForProbabilitySignal(t){for(let i=n.config.probabilityNextKeyStrokeThresholds.length-1;i>=0;i--)if(t>=n.config.probabilityNextKeyStrokeThresholds[i])return n.config.probabilityNextKeyStrokeDelays[i];return 0}shouldOpenMiniSerp(t){return n.RuntimeConfig.MiniSERPMode==0||t.previewPaneType!=1?!1:t.isAnswer?(n.RuntimeConfig.MiniSERPMode&1)!=0:t.type=="MD"?(n.RuntimeConfig.MiniSERPMode&2)!=0:(n.RuntimeConfig.MiniSERPMode&4)!=4?!1:t.query.length>=n.config.minPrefixLengthForMiniSerp}autoOpen(t,i,r,u,f){var o;n.InstrumentationHelper.notifyPreviewPaneStartRender(n.SequenceNumberManager.getSequenceNumber());f&&n.InstrumentationHelper.notifyPreviewPanePending(n.SequenceNumberManager.getSequenceNumber(),i.previewPaneType,i.type);let s=n.config.disableOfflineRequest?n.isBrowserOnline()&&this.shouldOpenMiniSerp(i):this.shouldOpenMiniSerp(i),e=s?this.getDelayForMiniSerp(r,i,t):0;e?((i===null||i===void 0?void 0:i.previewPaneType)!=((o=this._previewedSuggestion)===null||o===void 0?void 0:o.previewPaneType)&&this.clear(),(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(i.handoffType))||r!="arrowUpOrDown"||(this.clear(),this.clearSuggOpeningState(this._pendingPreviewedSuggestion),this.clearSuggOpeningState(this._previewedSuggestion)),i.isPreviewPaneOpening=!0,this._selectionHandler.updateSelectionState(i),this.clearOpenTimer(),this.clearCloseTimer(),this._pendingPreviewedSuggestion=i,this._queryForPendingPreviewedSuggestion=t,this.setActivePreviewPaneContainer(i,t),this._openTimer=e==Number.MAX_VALUE?Number.MAX_VALUE:n.safeSetTimeout(()=>{this._openTimer=null,i=this._pendingPreviewedSuggestion,this._pendingPreviewedSuggestion=null,this._queryForPendingPreviewedSuggestion=null,this.showPreview(t,i,r,u,e,f)},e,"ppOpenTimer"),!this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)||!this.isStartLoadingRequiredInWorkScopeScenarios(t,i)&&(r=="arrowUpOrDown"||this._previewedSuggestion!=null)||this._activePreviewPaneViewModel.startLoadingScreen()):this.showPreview(t,i,r,u,null,f)}onAfterKeyDownWhenNewSelection(t,i,r){let f=n.RuntimeConfig.AlwaysWide&&n.config.openOnKeybNavMiniSerp;if(n.isGroup(r)){if(f){this.clearSuggOpeningState(this._pendingPreviewedSuggestion);this.clearSuggOpeningState(this._previewedSuggestion);n.InstrumentationHelper.notifyTopHitPreviewPaneOpenedOrInterrupted(n.SequenceNumberManager.getSequenceNumber());const t=r.type==n.GroupType.Related&&i.scope===n.Scope.Work;this.clear(t);this.clearOpenTimer();this.clearCloseTimer();this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.stopLoadingScreen()}return}let u=r;u.previewPaneType?f&&(t==40||t==38||t==9)?(this._previewedSuggestion!=u||(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(u.handoffType)))&&this.autoOpen(i,u,"arrowUpOrDown",!1,!1):t==n.getRtlAdjustedKey(39)&&this._currentQuery.originalCursorPosition==this._currentQuery.originalQuery.length&&n.Host.searchBoxHasFocus()?this.showPreviewAndFocus(i,u,"arrowRight"):t==n.getRtlAdjustedKey(37)&&this._activePreviewPaneViewModel&&this._activePreviewPaneViewModel.hasFocus()&&this._activePreviewPaneViewModel.readyToBlur()&&n.Host.setFocusInSearchBox(t,"previewPaneUnfocus"):this.clear()}isStartLoadingRequiredInWorkScopeScenarios(t,i){var r;const u=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(i.handoffType),f=i.msbVerticalHash!=""&&t.scope===n.Scope.Work,e=i.previousMsbVerticalHash!=""&&i.msbVerticalHash==""&&t.scope===n.Scope.Work,o=((r=this._previewedSuggestion)===null||r===void 0?void 0:r.query)!==t.queryToFetch&&t.scope===n.Scope.Work;return u&&!f&&!o&&!e}refreshLocalContent(t,i,r){let u=null;this._instrumentedOpenThisImpression&&(u=this.getOnPreviewPaneRendered(i,"refresh",0,t));let f=n=>this.onPreviewPaneErrored(n);n.InstrumentationHelper.notifyPreviewPanePending(r,i.previewPaneType,i.type);this._activePreviewPaneViewModel.update(i,t,0,this._previewPaneId,u,f,!0)}setActivePreviewPaneContainer(i){let r=i.previewPaneType;i.previewPaneType!=2&&(this.shouldOpenMiniSerp(i)||i.previewPaneType!=1)||(r=2);n.setVisibility(this._previewPaneInfos[r].paneElement,!0);this._activePreviewPaneViewModel=this._previewPaneInfos[r].viewModel;this._previewPaneInfos[r].disableRootScroll?n.StaticHtmlElements.qfPreviewScrollArea.classList.add(t):n.StaticHtmlElements.qfPreviewScrollArea.classList.remove(t);this.isPreviewPaneWithLoaderViewModel(this._activePreviewPaneViewModel)&&this._activePreviewPaneViewModel.startLoadingScreen()}setPreviewPaneContent(t,i,r,u,f,e){var o;if(!((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkScope(i.handoffType))&&((o=this._previewedSuggestion)===null||o===void 0?void 0:o.previewPaneType)===1)){const i=t.scope===n.Scope.Work&&!!t.queryToFetch;this.clear(i)}this._previewedSuggestion=i;this._previewedSuggestion&&(this._previewedSuggestion.hasPreviewPaneOpened=!0,this._previewedSuggestion.isPreviewPaneOpening=!1);this._previewPaneResponseReceivedTimeStamp=null;this._queryForPreviewedSuggestion=t;this.setActivePreviewPaneContainer(i,t);this._activePreviewPaneViewModel.update(i,t,r,u,f,e,i.previewPaneNeedsRefreshAfterDeduping)}bindBeforeItemLaunch(n){this._beforeItemLaunchEventHandlers.push(n)}bindAfterItemLaunch(n){this._afterItemLaunchEventHandlers.push(n)}hasFocus(){return this._activePreviewPaneViewModel?this._activePreviewPaneViewModel.hasFocus():!1}isOpened(){return!!this._previewedSuggestion}isPreviewPaneWithLoaderViewModel(n){return!!(n===null||n===void 0?void 0:n.startLoadingScreen)}}n.PreviewPane=u}(WSB||(WSB={})),function(n){const t="NR",i="RF",r="CHN",u="OFL";class f extends n.JsonDataProvider{fetchUrl(f,e,o,s,h,c){if(n.isBrowserOnline()){let v=o?1:0,u=SearchAppWrapper.CortanaApp,l=u.createStringMap(),a=u.createStringMap();if(e)for(let n in e)n.toLowerCase().startsWith("content")?a[n]=e[n]:l[n]=e[n];n.Async.safeChain("makeHttpRequestAsync",()=>u.makeHttpRequestAsync(v,f,l,o,a),r=>{c()&&(r.statusCode===200?n.Async.safeChain("cortanaJson_ReadResponse",()=>r.readAsStringAsync(),i=>{if(c()){n.TestHookUrlParameters&&i&&(i=i.replace(new RegExp("<!--[^]*?-->","gm"),""));let r=i?n.safeExecute(()=>JSON.parse(i),"parseCortanaHttpResponse",null,null):null;r!=null?s(this._dataSource,r,null):s(this._dataSource,null,t)}},()=>s(this._dataSource,null,i),h):s(this._dataSource,null,r.statusCode.toString()))},()=>s(this._dataSource,null,r),h)}else s(this._dataSource,null,u,null,!0)}}n.CortanaJsonDataProvider=f}(WSB||(WSB={})),function(n){function f(){return n.MockUrlParameters&&typeof n.MockedAnaheimDataResponse=="object"}function e(n){return n?n=="consumers"?1:n=="organizations"?2:9:0}function o(n){return n?n=="MSA"?1:n=="AAD"?2:9:0}const s=n.config.enableAnaheimDataQFPassive||n.config.enableAnaheimDataQFAggressive?80:20,r=5,u=2,i="ANA",h="lastUpdated";n.isForTest=f;n.getAccountTypeFromAuthority=e;n.getAccountTypeFromContentType=o;class t extends n.ClientSideStorage.StorageBasedDataProvider{static getResultsCount(){return t._getResultsCount}static getResultsExceptionCount(){return t._getResultsExceptionCount}static decreaseRetryCount(){return t.retryCount-=1}static getRetryCount(){return t.retryCount}static getExpirationThreshold(){let n=t.retryCount;return t.expirationThresholds[n]}static getAvailableChannels(){return t.availableChannels}static getSelectedProfile(){return t.selectedANAAccountProfile}static isInitialized(){return t.initialized}static setShouldShowAnaheimDataSH(n){return t.shouldShowAnaheimDataSH=n}static getShouldShowAnaheimDataSH(){return t.shouldShowAnaheimDataSH}static setShouldShowAnaheimDataQF(n){return t.shouldShowAnaheimDataQF=n}static getShouldShowAnaheimDataQF(){return t.shouldShowAnaheimDataQF}static setCachedAnaheimDismissedDataItemIds(n){var r,u,f,e,o,s,h,c;let i=[];i.push(...((u=(r=n===null||n===void 0?void 0:n.anaHistoryItems)===null||r===void 0?void 0:r.filter(({dismissed:n})=>n).map(n=>n.id))!==null&&u!==void 0?u:[]));i.push(...((e=(f=n===null||n===void 0?void 0:n.anaTopSitesItems)===null||f===void 0?void 0:f.filter(({dismissed:n})=>n).map(n=>n.id))!==null&&e!==void 0?e:[]));i.push(...((s=(o=n===null||n===void 0?void 0:n.anaRecentlyClosedItems)===null||o===void 0?void 0:o.filter(({dismissed:n})=>n).map(n=>n.id))!==null&&s!==void 0?s:[]));i.push(...((c=(h=n===null||n===void 0?void 0:n.anaFavoritesItems)===null||h===void 0?void 0:h.filter(({dismissed:n})=>n).map(n=>n.id))!==null&&c!==void 0?c:[]));t.cachedAnaheimDismissedDataItemIds=i}static setCachedAnaheimAccount(n){t.cachedAnaheimAccount=n===null||n===void 0?void 0:n.anaheimAccount}getName(){return"AnaheimDataProvider"}constructor(i,r){let u=(t,i,u)=>r(n.ANADatabaseName,n=>{t(n)},i,u,h),f=(i,r,u)=>(t.InstrumentStringNumber.LFC=++t._lifetimeFetchCount,n.safeExecute(()=>this.createAnaheimDataResponse(i,r,u),"createAnaheimDataResponse")),e=()=>!0,o=n=>n=="R"?undefined:n;super(u,f,e,o,"ANA");this.searchIndexerTime=0;n.Host.bindShown(()=>{this.resetInitialized(null),this.queryStorage("anaheimData",n=>{t.setCachedAnaheimAccount(n),t.setCachedAnaheimDismissedDataItemIds(n)},()=>this.onAfterWrite(),()=>this.onAfterWrite(),()=>this.onAfterWrite()),this.searchIndexerWithMultipleResults(n.Host.getQuery(),new n.CancellationManager)});this.accessTokenManager=i;this._pendingWrites=[]}validateAndCompareAccount(n,t){return n?t?n.accountId==t.accountId&&n.accountProviderAuthority==t.accountProviderAuthority&&n.accountProviderId==t.accountProviderId&&n.accountState==t.accountState&&n.isDefaultAccount==Boolean(t.isDefaultAccount)?!0:!1:!1:!0}createAnaheimDataResponse(i,r){var h,c,l,a;t.setShouldShowAnaheimDataSH(!0);t.setShouldShowAnaheimDataQF(!0);n.config.reverseAnaheimData?t.InstrumentStringNumber.REV=1:t.InstrumentStringNumber.FWD=1;let v=this.selectedWSBAccount?e(this.selectedWSBAccount.accountProviderAuthority):-1,y=t.selectedANAAccountProfile?o(t.selectedANAAccountProfile.accountType):-1;t.InstrumentStringNumber.WAT=v;t.InstrumentStringNumber.AAT=y;t.InstrumentStringNumber.ACnt=t.aadCnt;t.InstrumentStringNumber.MCnt=t.msaCnt;t.InstrumentStringNumber.OCnt=t.otherCnt;let s=t.score;s==-1&&(s=this.getUserNameWithTypeScore(v,(c=(h=this.selectedWSBAccount)===null||h===void 0?void 0:h.accountUserName)!==null&&c!==void 0?c:"",y,(a=(l=t.selectedANAAccountProfile)===null||l===void 0?void 0:l.emailAddress)!==null&&a!==void 0?a:""),s==-1&&t.selectedANAAccountProfile&&(s=0));t.InstrumentStringNumber.Score=s;let u={anaheimDataItems:[],quickAnswers:[]};if(n.config.enableQuickSearch||!n.canShowQuickSearchWithoutANA(i)||n.isTrendingSearchDataEnabled(i)||(u=n.QuickSearchSuggestionsDataProvider.getQuickSearchResponse(u)),n.config.anaheimAccountCheckLevel==0||t.selectedANAAccountProfile||(r=[]),r)for(let{value:f}of r)if(f){let o=this.getSelectedWindowsAccount(),s=f===null||f===void 0?void 0:f.anaheimAccount,r=f===null||f===void 0?void 0:f.anaHistoryItems,e=f===null||f===void 0?void 0:f.anaTopSitesItems;if(this.validateAndCompareAccount(o,s)){if(t.InstrumentStringNumber.CFCC=++t._cachedFetchCount,r){let f=r===null||r===void 0?void 0:r.filter(({dismissed:n})=>!n);t.InstrumentStringNumber.PVDHS=f.length;n.config.enableAnaheimDataHS&&f.length>0&&!n.isTrendingSearchDataEnabled(i)&&u.anaheimDataItems.push(...f)}if(e){let i=e===null||e===void 0?void 0:e.filter(({dismissed:n})=>!n);t.InstrumentStringNumber.PVDTS=i.length;n.config.enableAnaheimDataTSTile&&i.length>0&&u.anaheimDataItems.push(...i)}}}return f()&&(u.anaheimDataItems=this.transformDeviceItemToAnaheimDataItem(n.MockedAnaheimDataResponse.deviceItems,undefined),u.quickAnswers=n.MockedAnaheimDataResponse.quickAnswers),i.isSearchHomeZI&&(u.remove=(n,t)=>this.dismissSingleAnaheimSuggestion(n,t)),u}isAnaheimDataItemDismissed(n){var i;if((i=t.cachedAnaheimDismissedDataItemIds)!==null&&i!==void 0)return i.some(t=>t===n)}shouldCompareWithCache(n,t){return t?n?JSON.stringify(n)===JSON.stringify(t):!1:!0}getDedupeKey(n){let t=n.getProperty("System.Link.TargetUrl");return t?new URL(t).hostname.replace("www.","")+n.getProperty("System.Title"):undefined}transformDeviceItemToAnaheimDataItem(n,i){var r,u,f;let o=this.shouldCompareWithCache(t.cachedAnaheimAccount,i),e=[];for(let t of n){let n={id:t.id,dateCreatedInS:0,lastUpdatedInS:0,dataType:"",url:t.getProperty("System.Link.TargetUrl"),title:t.getProperty("System.Title"),dateCreated:(r=t.getProperty("System.DateCreated"))===null||r===void 0?void 0:r.toString(),dateModified:(u=t.getProperty("System.DateModified"))===null||u===void 0?void 0:u.toString(),dateVisited:(f=t.getProperty("System.Link.DateVisited"))===null||f===void 0?void 0:f.toString(),visitCount:t.getProperty("System.History.VisitCount"),urlTypedCount:t.getProperty("System.History.SelectionCount"),dismissed:o?this.isAnaheimDataItemDismissed(t.id):!1,duplicated:!1,dedupeKey:this.getDedupeKey(t)};e.push(n)}return e}resetInitialized(){t.retryCount=u;t.expirationThresholds=[3,7,14];t.initialized=!1;t.InstrumentStringNumber={};this.anaheimStrategy=0;this.anaheimDataEntry={lastUpdated:0,anaheimAccount:null}}saveAnaheimDataToStorage(t){if(this._writing){this._pendingWrites.push(()=>this.saveAnaheimDataToStorage(t));return}this._writing=!0;let r;this.selectedWSBAccount&&(r={id:"",dateCreatedInS:0,lastUpdatedInS:0,dataType:"",accountId:this.selectedWSBAccount.accountId,accountType:-2,accountState:this.selectedWSBAccount.accountState,accountUserName:this.selectedWSBAccount.accountUserName,accountProviderId:this.selectedWSBAccount.accountProviderId,accountProviderAuthority:this.selectedWSBAccount.accountProviderAuthority,accountProviderDisplayName:this.selectedWSBAccount.accountProviderDisplayName,anaIdentity:"",anaAccType:-2,anaNameDsp:"",anaStatus:"",anaContType:"",anaProviderItemID:"",isDefaultAccount:this.selectedWSBAccount.isDefaultAccount?1:0,aCnt:0,mCnt:0,oCnt:0,score:0});let i=this.transformDeviceItemToAnaheimDataItem(t,r);if(i.length>0){let n=i[0];n.id.indexOf("History")>-1?this.anaheimDataEntry.anaHistoryItems=i:n.id.indexOf("QuickLinks")>-1?this.anaheimDataEntry.anaTopSitesItems=i:n.id.indexOf("RecentlyClosed")>-1?this.anaheimDataEntry.anaRecentlyClosedItems=i:n.id.indexOf("Favorites")>-1&&(this.anaheimDataEntry.anaFavoritesItems=i)}this.anaheimDataEntry.lastUpdated=n.ClientSideStorage.StorageBasedDataProvider.getUnixTime();this.anaheimDataEntry.anaheimAccount=r;this.searchIndexerTime<=1?this.onAfterWrite():this.withStorage(n=>n.put("anaheimData",this.anaheimDataEntry,()=>this.onAfterWrite(),n=>{this.onError(n,"saveAnaheimDataToStorage");this.onAfterWrite()}))||this.onAfterWrite()}searchIndexerWithMultipleResults(f,e,o){t.getRetryCount()==u&&(f.anaheimStrategy=this.anaheimStrategy);let h=n.IndexerQueryGenerator.generateIndexerQuery(f,null,"",s,i,o);if(h.indexOf("WHERE")>-1){let o=()=>SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.queryWindowsSearchIndexerAsync(h);n.Async.safeChain("queryAnaheimData",o,u=>{if(t.isInitialized()){this.searchIndexerTime++;t.InstrumentStringNumber.IFC=++t._indexerFetchCount;let n=u.resultSet;this.saveAnaheimDataToStorage(n)}else{t._lifetimeFetchCount=0;t._cachedFetchCount=0;t._indexerFetchCount=0;t._getResultsCount=0;t._getResultsExceptionCount=0;let e=u.resultSet,f=this.getSelectedWindowsAccount();if(f&&(this.selectedWSBAccount=f),this.selectAnaheimChannelAndProfile(e,this.selectedWSBAccount),!t.getSelectedProfile())return;for(let t=1;t<r;t++)n.IndexerQueryGenerator.updateAnaheimStrategy(i,t);t.initialized=!0;this.searchIndexerTime=0}t._getResultsCount++;this.anaheimStrategy++;this.anaheimStrategy<r&&this.searchIndexerWithMultipleResults(f,e)},o=>{n.isCancellation(o)||this.logProviderFailure(i),t._getResultsExceptionCount++,o.number===-2147215865&&t.getRetryCount()>0?t.decreaseRetryCount():(this.anaheimStrategy++,t.retryCount=u),t.isInitialized()&&this.anaheimStrategy<r&&this.searchIndexerWithMultipleResults(f,e)},e,i)}}getSelectedWindowsAccount(){let t=this.accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["AnaheimDataProvider::getSelectedWindowsAccount"]:undefined);return t||(t=this.accessTokenManager.getSelectedAccountInfo((n.Host===null||n.Host===void 0?void 0:n.Host.isAuthInvestigation())?["AnaheimDataProvider::getSelectedWindowsAccount"]:undefined)),t}selectAnaheimChannelAndProfile(i,r){var s,h,c,l;if(n.config.anaheimAccountCheckLevel!=-1){let u=[],a=[{displayName:"canary"},{displayName:"dev"},{displayName:"beta"},{displayName:"stable"},];for(let n of i)if(n){let t=n.id;if(t.indexOf("Profiles")>-1){let t={displayName:n.displayName,emailAddress:n.getProperty("System.Identity"),timestamp:n.getProperty("System.DateCreated"),status:n.getProperty("System.Status"),accountType:n.getProperty("System.ContentType"),id:n.getProperty("System.ProviderItemID")};u.push(t)}}if(t.availableChannels=a,u.sort(this.sortProfilesHelper),n.config.anaheimAccountCheckLevel==3){let v=this.selectedWSBAccount?e(this.selectedWSBAccount.accountProviderAuthority):-1,y=(h=(s=this.selectedWSBAccount)===null||s===void 0?void 0:s.accountUserName)!==null&&h!==void 0?h:"",i,n,r,f=0,l=0,a=0;for(let t of u){let u=o(t.accountType),s=(c=t.emailAddress)!==null&&c!==void 0?c:"";u==2?f++:u==1?l++:a++;let e=this.getUserNameWithTypeScore(v,y,u,s);e==3?i=t:e==2?n=t:e==1&&(r=t)}t.aadCnt=f;t.msaCnt=l;t.otherCnt=a;i?(t.selectedANAAccountProfile=i,t.score=3):n?(t.selectedANAAccountProfile=n,t.score=2):r&&(t.selectedANAAccountProfile=n,t.score=1)}else if(t.selectedANAAccountProfile=null,t.otherCnt=(l=u===null||u===void 0?void 0:u.length)!==null&&l!==void 0?l:0,r){for(let n in u)if(u[n].emailAddress===r.accountUserName){t.selectedANAAccountProfile=u[n];t.score=3;break}}else t.selectedANAAccountProfile=u[0],t.score=0;f()||t.selectedANAAccountProfile||(t.setShouldShowAnaheimDataSH(!1),t.setShouldShowAnaheimDataQF(!1));t.InstrumentStringNumber.ACC=a.length;t.InstrumentStringNumber.APC=u.length}}getUserNameWithTypeScore(n,t,i,r){var u,f;t=(u=t===null||t===void 0?void 0:t.toLocaleLowerCase())!==null&&u!==void 0?u:"";r=(f=r===null||r===void 0?void 0:r.toLocaleLowerCase())!==null&&f!==void 0?f:"";switch(n){case 1:return r?t==r?3:-1:2;case-1:case 0:case 9:return r?1:2;default:return-1}}sortProfilesHelper(n,t){return n.timestamp>t.timestamp?-1:n.timestamp<t.timestamp?1:0}logProviderFailure(t){let i=n.providerFailureLogName(t);i&&SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure&&n.safeExecute(()=>SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure(i,"ErrorForTopHit"),"logProviderFailure")}dismissSingleAnaheimSuggestion(n,t){if(!n||!n.type||!n.id){t();return}if(this._writing){this._pendingWrites.push(()=>this.dismissSingleAnaheimSuggestion(n,t));return}this._writing=!0;this.queryStorage("anaheimData",i=>this.setDismissedAndSaveAnaheimData(n,i,t),()=>this.onAfterWrite(),()=>this.onAfterWrite(),()=>this.onAfterWrite())}setDismissed(n,t){let i=t===null||t===void 0?void 0:t.find(t=>t.id===n.id);return i&&i.dedupeKey&&(t===null||t===void 0?void 0:t.map(n=>{n.dedupeKey===i.dedupeKey&&(n.dismissed=!0)})),t}setDismissedAndSaveAnaheimData(t,i,r){if(!i){r();return}switch(t.type){case"ANAH":i.anaHistoryItems=this.setDismissed(t,i===null||i===void 0?void 0:i.anaHistoryItems);break;case"ANAT":i.anaTopSitesItems=this.setDismissed(t,i===null||i===void 0?void 0:i.anaTopSitesItems);break;case"ANAR":i.anaRecentlyClosedItems=this.setDismissed(t,i===null||i===void 0?void 0:i.anaRecentlyClosedItems);break;case"ANAF":i.anaFavoritesItems=this.setDismissed(t,i===null||i===void 0?void 0:i.anaFavoritesItems)}i.lastUpdated=n.ClientSideStorage.StorageBasedDataProvider.getUnixTime();this.withStorage(n=>n.put("anaheimData",i,()=>{r&&r(),this.onAfterWrite()},n=>{this.onError(n,"setDismissedAndSaveAnaheimData");this.onAfterWrite()}))||this.onAfterWrite()}}t.availableChannels=[];t.cachedAnaheimDismissedDataItemIds=[];t.expirationThresholds=[];t.InstrumentStringNumber={};t._lifetimeFetchCount=0;t._cachedFetchCount=0;t._indexerFetchCount=0;t._getResultsCount=0;t._getResultsExceptionCount=0;t.aadCnt=-1;t.msaCnt=-1;t.otherCnt=-1;t.score=-1;n.AnaheimDataProvider=t}(WSB||(WSB={})),function(n){class t{static getANANumberMap(){return t._instrumentStringNumber}static getANAHistoryCount(){return t.HistoryCount}static getANATopSitesCount(){return t.TopSitesCount}static getANARecentlyClosedCount(){return t.RecentlyClosedCount}static getANAFavoriteCount(){return t.FavoriteCount}getName(){return"AnaheimDataParser"}constructor(){}parse(i,r,u,f,e,o){t._instrumentStringNumber.TUC=f&&f.anaheimDataItems?f.anaheimDataItems.length:0;let s=[];(n.AnaheimDataProvider.getShouldShowAnaheimDataSH()||n.AnaheimDataProvider.getShouldShowAnaheimDataQF()||n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable())&&n.safeExecute(()=>{this.parseAnaheimDataSuggestions(f,i,r,e,s)},"parseAnaheimDataSuggestions "+u);(!i.isSearchHomeZI||n.canShowAnaheimDataSH())&&(i.isSearchHomeZI||n.canShowAnaheimDataQF())&&!n.config.reverseAnaheimData||(s=[],t.HistorySuggestionCount=0,t.RecentlyClosedSuggestionCount=0,t.FavoriteSuggestionCount=0,t.TopSitesSuggestionCount=0);!n.config.enableQuickSearch&&n.canShowQuickSearchWithoutANA(i)&&n.QuickSearchSuggestionsParser.parseQuickSearchSuggestions(i,r,"QSCH",f,s);n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable()||(t._instrumentStringNumber.RCC=n.AnaheimDataProvider.getResultsCount(),t._instrumentStringNumber.ECC=n.AnaheimDataProvider.getResultsExceptionCount());o(u,s,null)}isValidQuery(n){return n&&!n.isSearchHomeZI&&!n.queryToFetch?!1:!0}isUrlMatched(t,i){if(!this.isValidQuery(t)||!i||t.queryToFetch.length<=n.config.anaheimDataQFAggressiveURLMatch)return!1;if(n.config.enableAnaheimDataQFPassive){let r=n.computeDomainlMatchLength(i,t.queryToFetch.toLowerCase());return r>0?!0:!1}return n.config.enableAnaheimDataQFAggressive?i.toLowerCase().includes(t.queryToFetch.toLowerCase()):!1}isTitleMatched(t,i){if(!this.isValidQuery(t)||!i||(n.config.enableAnaheimDataQFPassive||n.config.enableAnaheimDataQFAggressive)&&t.queryToFetch.length>0&&t.queryToFetch.length<=n.config.anaheimDataQFAggressiveURLMatch)return!1;let r=i.toLocaleLowerCase(),o=r.split(" "),f=t.queryToFetch.toLocaleLowerCase(),u=!1,e=0;for(let n of o){if(n.startsWith(f)){u=!0;break}let t=r.substring(e,r.length);if(e+=n.length+1,t.startsWith(f)){u=!0;break}}return u?!0:!1}parseAnaheimDataSuggestions(i,r,u,f,e){var o;let s={};if(i&&i.anaheimDataItems)for(let t of i.anaheimDataItems)n.safeExecute(()=>this.parseAnaheimDataSuggestion(i,t,r,u,f,s),"parseAnaheimDataSuggestion");t.HistoryCount=0;t.TopSitesCount=0;t.RecentlyClosedCount=0;t.FavoriteCount=0;t.HistorySuggestionCount=0;t.TopSitesSuggestionCount=0;t.RecentlyClosedSuggestionCount=0;t.FavoriteSuggestionCount=0;for(let i in s){let u=s[i];if(n.config.enableAnaheimDataHS&&u.type=="ANAH")if(t.HistoryCount+=1,r.isSearchHomeZI){let i=(o=n.config.anaheimHSReturnMaxCount)!==null&&o!==void 0?o:4;t.HistoryCount<=i&&(e.push(u),t.HistorySuggestionCount++)}else e.push(u),t.HistorySuggestionCount++;n.config.enableAnaheimDataRC&&u.type=="ANAR"&&(t.RecentlyClosedCount++,r.isSearchHomeZI?t.RecentlyClosedCount<=6&&(e.push(u),t.RecentlyClosedSuggestionCount++):(e.push(u),t.RecentlyClosedSuggestionCount++));n.config.enableAnaheimDataFV&&u.type=="ANAF"&&(t.FavoriteCount++,r.isSearchHomeZI?t.FavoriteCount<=6&&(e.push(u),t.FavoriteSuggestionCount++):(e.push(u),t.FavoriteSuggestionCount++));n.config.enableAnaheimDataTSTile&&u.type=="ANAT"&&(t.TopSitesCount+=1,t.TopSitesCount<=6&&(e.push(u),t.TopSitesSuggestionCount++))}if(t._instrumentStringNumber.TSC=e.length,t._instrumentStringNumber.BHSC=t.HistoryCount,t._instrumentStringNumber.TSSC=t.TopSitesCount,t._instrumentStringNumber.RCSC=t.RecentlyClosedCount,t._instrumentStringNumber.FVSC=t.FavoriteCount,e.sort((n,t)=>{var i,r,u,f;return((r=(i=t.anaheimRankingSignals)===null||i===void 0?void 0:i.dateCreated)===null||r===void 0?void 0:r.getTime())-((f=(u=n.anaheimRankingSignals)===null||u===void 0?void 0:u.dateCreated)===null||f===void 0?void 0:f.getTime())}),n.config.topHitMuse){let i=0,t=0,r=3;e.filter(n=>n.type=="ANAH").filter(()=>i++<r).forEach(i=>{i.type="ANATH",i.rankingScore=1.1-t/10,i.text=n.formatString("[{0}] [{1}]",[t.toString(),i.text]),t++})}}parseAnaheimDataSuggestion(t,i,r,u,f,e){var o,s,h;if(i&&f()){let l,p;if(i.id.indexOf("Favorites")>-1)l="ANAF",p="EdgeFavorites";else if(i.id.indexOf("History")>-1)l="ANAH",p="EdgeBrowsingHistory";else if(i.id.indexOf("QuickLinks")>-1)l="ANAT",p="EdgeTopSites";else if(i.id.indexOf("RecentlyClosed")>-1)l="ANAR",p="EdgeRecentClosed";else return;if(!(n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable())){let t=new Date(i.dateCreated),r=n.AnaheimDataProvider.getExpirationThreshold();if(l=="ANAH"&&(!t||n.getTimeDiffInDays(t)>r))return}let c=i.url,a=i.title;if(!r.isSearchHomeZI&&!this.isTitleMatched(r,a)&&!this.isUrlMatched(r,c))return;let d=r.isSearchHomeZI?a:HitHighlightingParser.addMarkers(a,r.queryToFetch);n.config.topHitMuse&&(r.fullPartialQuery=a);let w,b;if(n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable()&&n.config.enableAnaheimDataProfile)n.AnaheimDataProviderV2.ANAAccountType==1?w=n.AnaheimDataProviderV2.ANAProviderItemID:n.AnaheimDataProviderV2.ANAAccountType==2&&(b=n.AnaheimDataProviderV2.ANAProviderItemID);else if(n.AnaheimDataProvider&&n.config.enableAnaheimDataProfile){let t=n.AnaheimDataProvider.getSelectedProfile();t&&t.accountType=="MSA"?w=t.id:t&&t.accountType=="AAD"&&(b=t.id)}let f=n.createSuggestion(r,d,n.getFaviconUrlForRawUrl(c,64,64,1.5),null,l,r.fullPartialQuery,n.InstrumentedItem.createInstrumentedItemHandOffOverride(u,l,1),1,u,!0,i.id,()=>n.Host.launchUrlWithEdgeProtocol(c,{campaign:n.config.anaheimDataLaunchOCID,medium:p,cid:w,oid:b}),null,l+a+i.id),k=c===null||c===void 0?void 0:c.replace(/(^\w+:|^)\/\//,""),v=c?new URL(c):undefined;f.primaryMetadata=(v===null||v===void 0?void 0:v.hostname)?HitHighlightingParser.addMarkers(decodeURIComponent(k),v.hostname):decodeURIComponent(k);f.tooltip=a;l=="ANAT"&&(f.tooltip+="\n"+c);f.url=c;f.narratorText=n.getNarratorText(f);f.template=1;f.anaheimRankingSignals={dateCreated:new Date(i.dateCreated),dateModified:new Date(i.dateModified),dateVisited:new Date(i.dateVisited),visitCount:Number(i.visitCount),urlTypedCount:Number(i.urlTypedCount)};this.setupRemoveFromHistoryContextMenu(f,t);let y=((o=v===null||v===void 0?void 0:v.hostname)===null||o===void 0?void 0:o.replace("www.",""))+a;if(e[y]&&f.type=="ANAH"){let n=f.id,r=e[y].id,t=(s=f.anaheimRankingSignals.dateCreated)===null||s===void 0?void 0:s.valueOf(),i=(h=e[y].anaheimRankingSignals.dateCreated)===null||h===void 0?void 0:h.valueOf();r.indexOf("stable")>-1?n.indexOf("stable")>-1&&t>i&&(e[y]=f):(n.indexOf("stable")>-1||t>i)&&(e[y]=f)}else e[y]=f}}setupRemoveFromHistoryContextMenu(t,i){i.remove&&n.setExtraVerbs(t,r=>{if(r||!i.remove)return[];let u={verb:"RemoveFromDeviceHistory",displayName:n.Host.getLocString("RemoveFromDeviceHistory"),executeSync:()=>{i.remove(t,()=>{n.Host.refreshCurrentPane()}),delete i.remove},icon:{content:"&#xE711",type:2}};return[u]},!0)}}t._instrumentStringNumber={};t.HistoryCount=0;t.TopSitesCount=0;t.RecentlyClosedCount=0;t.FavoriteCount=0;t.HistorySuggestionCount=0;t.TopSitesSuggestionCount=0;t.RecentlyClosedSuggestionCount=0;t.FavoriteSuggestionCount=0;n.AnaheimDataParser=t}(WSB||(WSB={})),function(n){const t="TS",i=n.config.trendingSearchUpdateMillis,r=500,u="/dsb/scenario?name=EditorialTrendingSearch",f="/dsb/scenario?name=TrendingSearchWithCache";class e{getName(){return"TrendingSearchDataProvider"}constructor(){this.WSBTSCacheStorageKey="WSBTrendingSearchCache";n.Host.bindShown(()=>{n.isTSFallbackToANA=!1})}fetch(n,i){n.enabledDataSources[t]&&i(t,this.generateTSDataResponse(),null)}generateTSDataResponse(){let t=[];if(n.MockUrlParameters&&typeof n.MockedTSData=="object")return{suggestions:n.MockedTSData.suggestions};if(!n.canShowTrendingSearch())return{suggestions:t};const r=this.loadTSContentFromWSBCache();if(n.isTSFallbackToANA=!1,r){const{cacheTime:u,trendingSearchSuggestions:f}=r;t=[...f];(u===0||u+i<n.getCurrentTime())&&this.fetchTSUrlWithTimeout().then(t=>{t&&n.Host.refreshCurrentPane()})}else{const i=this.loadTSContentFromDSBCache();i?t=[...i.trendingSearchSuggestions]:(n.isTSFallbackToANA=!0,n.Host.refreshCurrentPane());this.fetchTSUrl()}return{suggestions:t}}async fetchTSUrlWithTimeout(){let i=!1,t=n.safeSetTimeout(()=>{i=!0},r,"fetchTSContentTimer");const u=async()=>{const n=await this.fetchTSUrl();return n?i?(SharedLogHelper.LogWarning("fetchTrendingSearchContentDone","Fetch trending search content succeed but timeout, will render on next shown"),!1):(t&&(sb_ct(t),t=null),!0):!1};return await u()}async fetchTSUrl(){const o=n.isBrowserOnline(),r=n.Host.getLanguage().toLowerCase(),i=n.Host.getRegion().toLowerCase(),e=n.revIpRegionCache.toLowerCase();let s;s=e=="cn"||i=="cn"||i=="hk"&&r.startsWith("zh")?u:f;let t=`${location.origin}${s}`;t=ThresholdUtilities.setUrlParameter(t,"cc",i);t=ThresholdUtilities.setUrlParameter(t,"setlang",r);try{let u=await fetch(t);if(u.status==200){let t=await u.json();if(this.isValidTSContent(t))return this.setTSContentToCache({cacheTime:n.getCurrentTime(),trendingSearchSuggestions:t.scenarios[0].items}),n.isTSFallbackToANA=!1,!0;throw new Error(`Invalid trending search content. Online status ${o}. Response data ${t?JSON.stringify(t):"undefined"}.`);}else if(u.status==203){const n=e=="cn"?`and revip ${e}`:null;SharedLogHelper.LogWarning("fetchTrendingSearchUrl",`Trending Search is not supporting this region ${i} and language ${r} ${n}`)}else throw new Error(`http status:${u.status}. Online status ${o}`);}catch(h){}return n.isTSFallbackToANA=!0,n.Host.refreshCurrentPane(),!1}isValidTSContent(n){var t;return(n===null||n===void 0?void 0:n.scenarios)&&(n===null||n===void 0?void 0:n.scenarios.length)>0&&((t=n.scenarios[0])===null||t===void 0?void 0:t.items)&&n.scenarios[0].items.length>0}setTSContentToCache(t){n.LightweightStorage.setItem(this.WSBTSCacheStorageKey,JSON.stringify(t))}loadTSContentFromWSBCache(){const t=n.LightweightStorage.getItem(this.WSBTSCacheStorageKey);return t?JSON.parse(t):null}loadTSContentFromDSBCache(){var t,i,r,u,f;const e=n.LightweightStorage.getItem(n.config.dsbCacheKey);if(e){const o=JSON.parse(e),n=(r=(i=(t=o.response)===null||t===void 0?void 0:t.ContentCollection[0])===null||i===void 0?void 0:i.Data)===null||r===void 0?void 0:r.filter(n=>{var t;return((t=n===null||n===void 0?void 0:n.Cards[0])===null||t===void 0?void 0:t.Scenario)=="TrendingSearch"});if(n&&(n===null||n===void 0?void 0:n.length)==1){const t=(f=(u=n[0].Cards[0].FieldsStore)===null||u===void 0?void 0:u.Items)===null||f===void 0?void 0:f.map(n=>{var t,i,r,u;return{Query:n.Title,Thumbnail:{ThumbnailUrl:(t=n.Thumbnail)===null||t===void 0?void 0:t.ThumbnailUrl,ThumbnailId:(i=n.Thumbnail)===null||i===void 0?void 0:i.ThumbnailId,ThumbnailHeight:(r=n.Thumbnail)===null||r===void 0?void 0:r.ThumbnailHeight,ThumbnailWidth:(u=n.Thumbnail)===null||u===void 0?void 0:u.ThumbnailWidth}}});return{cacheTime:o.cacheTime,trendingSearchSuggestions:t?t:null}}}return null}}n.TrendingSearchDataProvider=e;class o{constructor(n){this._navigationHelper=n}parse(t,i,r,u,f,e){let o=[];for(let e of u.suggestions)n.safeExecute(()=>this.parseTrendingSearchDataSuggestion(t,e,r,i,f,o),"parseTrendingSearchDataSuggestion "+r);e(r,o,null)}parseTrendingSearchDataSuggestion(t,i,r,u,f,e){var o;const s="TS",c=n.InstrumentedItem.createInstrumentedItem(u,s),h=i.Query;if(f()){let r=n.createSuggestion(t,h,null,null,s,h,c,0,u,!1);if(n.isThumbnailForTSEnabled()){const t=(o=i.Thumbnail)===null||o===void 0?void 0:o.ThumbnailId;if(t){const i=24,u=24,f=n.config.imageHostName+`${t}${i?`&w=${i}`:""}${u?`&h=${u}`:""}&c=1&rs=1&p=0`;r.icon={type:0,content:f}}}r.reactKey=`${s} ${h}`;r.click=n.config.enableMoreEdgeProtocol?()=>{n.Host.launchSearch(r.query,this._navigationHelper.getSearchUrl(t.fullPartialQuery,r.query,r.type,null,r.handoffType,n.mapOSFormCode("SSHTRD")),r.useRaf,n.mapOSFormCode("SSHTRD"))}:()=>{n.Host.launchSearch(r.query,this._navigationHelper.getSearchUrl(t.fullPartialQuery,r.query,r.type,null,r.handoffType,n.mapOSFormCode("SSHTRD")),r.useRaf)};e.push(r)}}}n.TrendingSearchDataParser=o}(WSB||(WSB={}))