var WSB;(function(n){class t{constructor(t){this._cache={};n.Host.bindAppHidden(()=>this.clean(n.getCurrentDate()));t.bindItemLaunch(t=>{t.handoffType==0&&n.Host.canHaveSearchHistory()&&this.removeCachedResponsesForClick(t.query.toLocaleLowerCase())});this._TTL=n.config.inMemorySnRResponseCacheTTLSecs*1e3}get(t){if(!t)return undefined;let i=this._cache[t.getCacheKey()],r=n.getCurrentDate();return this.responseIsValid(r,i)?(this.clean(r),i.response):undefined}put(t,i){if(t&&i){let r=n.getCurrentDate(),u={timestamp:r,response:i,queryText:t.queryToFetch.toLocaleLowerCase()};this._cache[t.getCacheKey()]=u;this._lastInsertDate=r;this._oldestInsertDate||(this._oldestInsertDate=r)}}clean(n){let i=this._oldestInsertDate?this.datesWithinTTL(n,this._oldestInsertDate):!1;if(i){let r=!this.datesWithinTTL(n,this._lastInsertDate);if(r){this._cache={};this._oldestInsertDate=undefined;this._lastInsertDate=undefined;return}let t=n;for(let i in this._cache){let r=this._cache[i];this.responseIsValid(n,r)?r.timestamp.getTime()<t.getTime()&&(t=r.timestamp):delete this._cache[i]}this._oldestInsertDate=t}}removeCachedResponsesForClick(n){let t=!1;for(let i in this._cache){let r=this._cache[i].queryText;if(n.startsWith(r)){let n=this._cache[i].timestamp;(n==this._oldestInsertDate||n==this._lastInsertDate)&&(t=!0);delete this._cache[i]}}t&&this.resetOldestAndLastDates()}resetOldestAndLastDates(){this._oldestInsertDate=undefined;this._lastInsertDate=undefined;for(let n in this._cache){let t=this._cache[n].timestamp;this._oldestInsertDate||(this._oldestInsertDate=t,this._lastInsertDate=t);this._oldestInsertDate>t&&(this._oldestInsertDate=t);this._lastInsertDate<t&&(this._lastInsertDate=t)}}responseIsValid(n,t){if(!t)return!1;let i=t.timestamp;return this.datesWithinTTL(n,i)}datesWithinTTL(n,t){return n.getTime()-t.getTime()<=this._TTL}}n.InMemoryResponseCacheManager=t})(WSB||(WSB={}))