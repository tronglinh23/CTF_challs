var WSB;(function(n){const i="ms-screenclip://?source=SearchBox&callbackformat=ms-search%3A%2F%2FSearch%2F%3FQuerySource%3DSearchButton%26form%3DWNSSBS",t="snipSearchPrivacyBubble";class r{constructor(t,i,r){this._page=t;this._navigationHelper=i;this._popoverFactory=r;this._imageProcessor=_w.ImageProcessor;n.Host.bindShown(()=>{n.shouldEnableSnipSearch()&&SearchAppWrapper.CortanaApp.entryPoint=="WNSSBS"&&this.bingImageSearchCallbackV2()});n.Host.bindDismissed(()=>{SearchAppWrapper.CortanaApp.entryPoint=="WNSSBS"&&this.updateMessage(),this._imageSearchV2CancellationManager&&(this._imageSearchV2CancellationManager.cancelAll(!0),this.updateMessage())})}getSnipSearchSyntheticSuggestion(r,u){if(n.shouldEnableSnipSearch()){let e=()=>n.Host.launchUri(i,!0),f=n.getSyntheticSuggestion(r,u,"SNSC",{type:2,content:"&#xE312"},2,null,!1,e);if(u!=this._lastSequenceNumber){let i=[{text:n.Host.getLocString("PrivacyPolicy"),id:t+"1",selected:!1,useAccentColor:!0,action:()=>n.Host.launchUri("http://go.microsoft.com/fwlink/?LinkId=521839"),instItem:n.InstrumentedItem.getNonSuggestionInstrumentedItem("SNSP",n.SyntheticQSCodesMaps.KValues,19),sequenceNumber:u},{text:n.Host.getLocString("TermsOfUse"),id:t+"2",selected:!1,useAccentColor:!0,action:()=>n.Host.launchUri("http://go.microsoft.com/fwlink/?LinkID=246338"),instItem:n.InstrumentedItem.getNonSuggestionInstrumentedItem("SNST",n.SyntheticQSCodesMaps.KValues,19),sequenceNumber:u}],r=()=>this._popoverFactory.showPopover(n.Host.getLocString("SnipSearchPrivacyWarning"),i,_ge(t),!0,!0,"sspiPopover"),e=(u,f)=>{if(f==1){r();return}this._popoverFactory.showPopover(n.Host.getLocString("SnipSearchPrivacyWarning"),i,_ge(t),!0,!1,"sspiPopover")};n.addSubItemToSuggestion(f,t,"",n.View.InformationBubble,{onMouseEnter:e},null,!1,r,e);this._lastSequenceNumber=u}return f.text=n.Host.getLocString("SnipSearchButtonText"),f.tooltip=n.Host.getLocString("SnipSearchTooltipText"),f.staticGroupType=n.GroupType.VisualSearch,f}return null}updateMessage(t,i,r){t?this._page.updateSnipSearchMessageView({message:n.Host.getLocString(t),cancel:i,showSpinner:r}):this._page.updateSnipSearchMessageView(null)}bingImageSearchCallbackV2(){this._imageSearchV2CancellationManager=new n.CancellationManager;this._imageSearchV2CancellationManager.register(()=>{this._imageSearchV2CancellationManager=null,SearchAppWrapper.CortanaApp.dismissApp()},!0,"bingiscb2");n.Host.keepWSBOpen(!0);this.updateMessage("SnipSearchMessage",()=>this._imageSearchV2CancellationManager.cancelAll(!1),!0);let t=()=>{this.updateMessage("SnipSearchErrorMessage"),n.Host.keepWSBOpen(!1)};n.Host.getBitmapURIFromClipboardAsync(n=>{n||t(),this._imageProcessor.convertImageUriToBase64(n,n=>this.requestSearchUrlAndNavigate(n,t),t)})}requestSearchUrlAndNavigate(t,i){let r={cancelled:!1,timer:0};this._imageSearchV2CancellationManager.register(()=>{r.cancelled=!0,r.timer&&sb_ct(r.timer)},!1,"rsUrl_Nav");let u=this.createMultipartBodyWithBase64(t);if(u){let t=n.getCurrentTime();n.fetchUrlJson(this._navigationHelper.getImageSearchUrl(),{"content-type":u.contentType},u.data,u=>{if(!r.cancelled){if(u&&u.url){let f=Math.max(n.config.minDelayForSnipSearch-(n.getCurrentTime()-t),0);r.timer=n.safeSetTimeout(()=>{n.Host.launchUri(u.url,!1,()=>{},i)},f,"Bing screenshot image search");return}i()}},null,()=>!0,!1,n.config.screenshotUrlRequestTimeout)}else i()}createMultipartBodyWithBase64(n){const i="-------",r=";base64,";let u=n?n.indexOf(r):-1;if(u<0)return null;let f=n.substr(u+r.length),t=i+"\r\n";return t+='Content-Disposition: form-data; name="imageBin"\r\n',t+="\r\n",t+=f+"\r\n",t+=i+"\r\n",{data:t,contentType:"multipart/form-data; boundary="+i}}}n.ImageSearchViewModel=r})(WSB||(WSB={}))