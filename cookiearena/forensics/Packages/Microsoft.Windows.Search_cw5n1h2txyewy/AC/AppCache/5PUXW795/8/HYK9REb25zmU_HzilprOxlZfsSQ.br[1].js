var WSB;(function(n){function cu(n,i){let r=[];if(i)if(n)r=i.slice();else for(let n in t){let t=i.find(t=>t.verb&&t.verb.toLocaleLowerCase()==n.toLocaleLowerCase());t&&r.push(t)}return r}function lu(n){return n?n.filter(n=>!n.verb||n.verb.toLowerCase()!="open"):[]}function s(t,i,r,u,f,e){e()&&(t=t.slice(),i.getExtraVerbsAsync?n.Async.safeChain("getExtraVerbsAsync",()=>i.getExtraVerbsAsync(u),n=>b(vt(t,n,!0),i,u,f,e),()=>b(t,i,u,f,e),null,r):b(t,i,u,f,e))}function b(n,t,i,r,u){if(u()){let f=t.getExtraVerbs?vt(n,t.getExtraVerbs(i),!1):n;f[0]==it&&f.shift();r(f)}}function au(i,r,u,f){return i.map(i=>{let e,o;if(i.verb){switch(i.verb.toLocaleLowerCase()){case ei:e="PinnedToStart";break;case ft:e="PinnedToTaskbar";break;case oi:e="UnpinnedFromStart";break;case et:e="UnpinnedFromTaskbar";break;case fi:o=n.config.useCobaltCSS?"UninstallMessage":"UninstallConfirmation";e="UninstallationInProgress";break;case iu:e="PathCopied"}let s=t=>{t(),n.RuntimeConfig.AlwaysWide&&e=="UninstallationInProgress"?(r.uninstallationInProgress=!0,f&&f()):e?u.showTemporaryMessage(n.Host.getLocString(e,HitHighlightingParser.removeMarkers(r.text))):u.hideTemporaryMessage(),i.verb.toLocaleLowerCase()==ft&&n.Host.addItemToPinnedToTaskbar(r.deviceItem.id),i.verb.toLocaleLowerCase()==et&&n.Host.removeItemFromPinnedToTaskbar(r.deviceItem.id)},h=i.icon||t[i.verb.toLocaleLowerCase()];return new n.DeviceItemVerbWrapper(i,h,t=>{o&&n.DialogBox?n.DialogBox.show(n.Host.getLocString(o),[{id:null,text:i.displayName,action:()=>s(t),selected:!1,useAccentColor:n.config.useCobaltCSS?!0:!1},{id:null,text:n.Host.getLocString("Cancel"),selected:!0}],n.config.useCobaltCSS?n.Host.getLocString("UninstallConfirmationTitle",HitHighlightingParser.removeMarkers(r.text)):""):s(t)})}return i})}function ai(t,i,r,u,f,e){let o=t+" "+i.type;if(n.isJumpListSuggestion(i))return n.Async.safeChain("jumpListItem.getVerbsAsync",()=>i.jumpListItem.getVerbsAsync(),n=>s(lu(n),i,o,u,f,e),()=>s([],i,o,u,f,e),null,t+" "+i.type),!0;let h=n.getItemWithFileMetadata(i);return h&&h.canHaveContextMenu?(n.Async.safeChain("item.getVerbsAsync",()=>h.getVerbsAsync(),n=>s(cu(r,n),i,o,u,f,e),()=>s([],i,o,u,f,e),null,o),!0):i.getExtraVerbsAsync?(s([],i,o,u,f,e),!0):i.getExtraVerbs?(b([],i,u,f,e),!0):(u&&f([]),!1)}function h(n,t,i){let r=HitHighlightingParser.removeMarkers(n.text),u=r?r.length:0;return n.additionalInfoText&&!i&&(u+=n.additionalInfoText.length),u>(i?nu:tu)}function vi(n){let t={topResults:n.topResults.slice(0),groups:[]};for(let i of n.groups)t.groups.push({typeWithSource:i.typeWithSource,suggestions:i.suggestions.slice(0)});return t}function yi(t,i){if(t.isHtmlAnswer)return er;if(t.grid)return(i?n.IconSize_GridLayout:n.IconSize_GridLayout_Medium)+2*r;let u=t.numberOfLines==3?fr:t.numberOfLines==2?ur:rr;return t.mainTextWrapsToTwoLines&&(u+=dt),u<kt&&(u=kt),u}function vu(t,i){if(!t)return 0;if(i&&n.uses3lineTemplate(n.getScope(i.type)))return yi({mainTextWrapsToTwoLines:!1,numberOfLines:3,isHtmlAnswer:!1,isSuppressed:t.isSuppressed,grid:!1},!1);if(t.isSuppressed)return 0;let r=tr;return t.hasTwoLines?r+=d+2:t.mainTextWrapsToTwoLines&&(r+=dt),r}function yu(t,i){let r=bt;if(i.typeWithSource&&n.displayedInGridLayout(i.typeWithSource.type)){let u=n.isL2(t),f=Math.ceil(i.suggestions.length/(u?ri:ui)),e=u?ni:ti;r+=e*f;r+=2*g}else i.suggestions.forEach(n=>r+=vu(n,i.typeWithSource));return r}function pu(n){switch(n){case 0:return"CP";case 7:return"DI";case 1:return"PP";case 2:return"PD";case 4:return"SP";case 5:return"TP";case 6:return"SD"}return undefined}function vt(n,t,i){if(n.length>0&&t.length>0){let r=i?n.concat(it):n;return r.concat(t)}return n.length>0?n:t.length>0?i?[it].concat(t):t:[]}function i(t,i){return t.find(t=>n.sameGroup(t.typeWithSource,i))}function pi(t,i){return t.find(t=>n.sameGroup(t.group.typeWithSource,i))}function wi(n,t){return n.queryToFetch.substring(0,t.queryToFetch.lastIndexOf("\\"))}function bi(t){switch(t){case n.GroupType.AnaheimDataTile:case n.GroupType.TopApps:case n.GroupType.People:return!0}return!1}function wu(t,i){if(!t.isSearchHomeZI||t.isWorkScopeZI||t.scope==n.Scope.All||i==n.GroupType.RecommendedDocs)return null;if(t.scope==n.Scope.Web){if(i==n.GroupType.Websites)return n.Host.getLocString("RecentWebsiteSection");if(i==n.GroupType.SearchSuggestions)return n.Host.getLocString("RecentWebSearchSection")}return bi(i)?n.Host.getLocString("FrequentSection"):n.Host.getLocString("RecentSection")}function bu(t){return n.Host.getLocString(t?(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.getIsMsbEduTenantEnabled())?"SearchSchoolAndWeb":"SearchWorkAndWeb":n.shouldEnableBingChatString()?"ChatWithBing":n.config.useGroupTitleWeb?"SearchWebData":"SearchTheWeb")}function ku(){return n.Host.getLocString("Websites")}function du(){return n.SubstrateTenantName?(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.getIsMsbEduTenantEnabled())?n.Host.getLocString("MsbRecommendedForYouText"):n.Host.getLocString("MsbTenantRecommended").replace("{0}",n.SubstrateTenantName):n.Host.getLocString("QuickWorkSearchSuggestionsSection")}function ki(t,i,r,u){if(i==n.GroupType.PathCompletion){let n=wi(t,t)+"\\"+String.fromCharCode(8206);return{title:n,narratorText:n}}if(r){let t=r.groupDisplayName;if(t)return{title:t,narratorText:u?n.Host.getLocString("AddingScopeNarratorText",t):t}}let f=wu(t,i);if(!f)switch(i){case n.GroupType.Command:f=n.Host.getLocString("CommandGroup");break;case n.GroupType.Cortana:f=n.Host.getLocString("CortanaGroup");break;case n.GroupType.Store:f=n.Host.getLocString("StoreGroup");break;case n.GroupType.LocalPlaces:f=n.Host.getLocString("LocalPlacesGroup");break;case n.GroupType.Related:f=n.Host.getLocString("RelatedSuggestionsGroup");break;case n.GroupType.SearchSuggestions:f=bu(n.msbEnabledForQuery(t));break;case n.GroupType.AnaheimDataQF:f=n.Host.getLocString("SearchAnaheimData");break;case n.GroupType.Websites:f=ku();break;case n.GroupType.Contact:f=n.Host.getLocString("ContactGroup");break;case n.GroupType.LocalSearchHistory:f="Search history";break;case n.GroupType.CuratedSuggestions:f=n.Host.getLocString("SuggestedSection");break;case n.GroupType.CuratedSettings:f=n.Host.getLocString("QuickSearchSuggestionsSection");break;case n.GroupType.TopApps:f=n.Host.getLocString("TopAppsSection");break;case n.GroupType.QuickSearch:f=n.Host.getLocString("QuickSearchSuggestionsSection");break;case n.GroupType.QuickWorkSearch:case n.GroupType.QuickWorkSearchTopList:case n.GroupType.MsbQuickWorkQueriesTopList:f=du();break;case n.GroupType.VisualSearch:f="Visual search";break;case n.GroupType.MSNNews:f=n.Host.getLocString(n.config.msnNewsTitleResource);break;case n.GroupType.WelcomeExperience:f=n.Host.getLocString("WelcomeExperienceTitle");break;case n.GroupType.Upsell:f=n.Host.getLocString("RecommendedGroup");break;case n.GroupType.MRUHistory:case n.GroupType.WorkSuggestions:f=n.shouldShowDSBFullWidth(t)&&n.config.enableMRUDSBV2?n.Host.getLocString("DSBRecentTitle"):n.Host.getLocString("MRUHistoryGroup");break;case n.GroupType.AnaheimDataTile:f=n.Host.getLocString("AnaheimDataTopSites");break;case n.GroupType.AnaheimDataList:r.type=="QSSG"?f=n.Host.getLocString("QuickSearchSuggestionsSection"):r.type=="ANAH"?f=n.Host.getLocString("AnaheimDataHistory"):r.type=="ANAT"?f=n.Host.getLocString("AnaheimDataTopSites"):r.type=="ANAR"&&(f=n.Host.getLocString("AnaheimDataRecentlyClosed"));break;case n.GroupType.AnaheimDataTopHit:n.config.topHitMuse&&r.type=="ANATH"&&(f="Best match for Edge history");break;case n.GroupType.RecommendedDocs:f=n.Host.getLocString("RecommendedDocsGroup");n.config.msbEnableDocumentZQ&&t.scope==n.Scope.Documents&&(f=n.Host.getLocString("RecommendedZQGroup"));break;case n.GroupType.PromoBanner:f=n.Host.getLocString("VaccineUpdate");break;case n.GroupType.MsbOnRampButton:f="MSB On ramp button";break;case n.GroupType.TrendingSearchData:f=n.Host.getLocString("DSBTrendingTitle")}if(!f){let t=n.getScope(i);if(t==n.Scope.All)throw new Error("Unknown group type: "+i);let r=n.ScopeConfig[t];f=n.getScopeDisplayName(r)}return{title:f,narratorText:u?n.Host.getLocString("AddingScopeNarratorText",f.toLocaleLowerCase()):f}}function gu(t){let i,r;if(n.config.enableAnaheimDataProfile)if(n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable())n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable()&&(n.AnaheimDataProviderV2.ANAAccountType==1?i=n.AnaheimDataProviderV2.ANAProviderItemID:n.AnaheimDataProviderV2.ANAAccountType==2&&(r=n.AnaheimDataProviderV2.ANAProviderItemID));else if(n.AnaheimDataProvider){let t=n.AnaheimDataProvider.getSelectedProfile();t&&(t.accountType=="MSA"?i=t.id:t.accountType=="AAD"&&(r=t.id))}return[{text:n.Host.getLocString("AnaheimDataEdgeSettings"),id:"anaheimDataEdgeSettings",selected:!1,useAccentColor:!0,action:()=>n.Host.launchUrlWithEdgeProtocol(null,{edgeSettingsUrl:n.config.anaheimDataEdgeSettings,cid:i,oid:r}),instItem:n.InstrumentedItem.getNonSuggestionInstrumentedItem("ANA",n.SyntheticQSCodesMaps.KValues,19),sequenceNumber:t}]}function di(t,i,r,u){let f,e=[],o,s;const h=n.canShowAnaheimDataSHTileE2E(),l=n.canShowAnaheimDataSHListE2E(),a=n.canShowAnaheimDataQFE2E(),c=t==n.GroupType.AnaheimDataTile&&h;if((t==n.GroupType.AnaheimDataTile&&h||t==n.GroupType.AnaheimDataList&&l||t==n.GroupType.AnaheimDataQF&&a)&&(f="AnaheimDataGroupPopup",s="anaheimDataPopover",e=gu(u)),f){let r=t+"informationBubble",u=s||t+"groupTitlePopover",h=()=>i.showPopover(n.Host.getLocString(f),e,_ge(r),!0,!0,u,c),l=(t,o)=>{if(o==1){h();return}i.showPopover(n.Host.getLocString(f),e,_ge(r),!0,!1,u,c)};o={subItem:{id:r,selected:!1,selectedStyleSuspended:!1,narratorText:"",tooltip:"",text:"",onSelected:h},onMouseEnter:l}}return o}const yt=4,pt=6,k=8,r=12,wt=1,u=20,d=n.config.useCobaltCSS?20:16,nr=n.config.useCobaltCSS?20:16,tr=n.config.useCobaltCSS?42:u+2*k,bt=n.config.useCobaltCSS?40:nr+2*k,ir=n.config.useCobaltCSS?40:bt,kt=n.config.useCobaltCSS?70:60,rr=n.config.useCobaltCSS?50:u+2*r,ur=n.config.useCobaltCSS?70:u+d+yt+2*r,fr=n.config.useCobaltCSS?88:u+2*(d+yt)+2*r,er=80+2*r,or=n.config.useCobaltCSS?18:k,dt=u,sr=n.config.useCobaltCSS?58:48,gt=48,g=1,ni=n.IconSize_GridLayout+2*(pt+wt),ti=n.IconSize_GridLayout_Medium+2*(pt+wt),hr=n.config.useCobaltCSS?44:32,cr=8,lr=n.config.useCobaltCSS?139:140,ar=156,nt=8,vr=n.config.useCobaltCSS?572:600,yr=510,pr=400,wr=350,c=184,tt=692,br=628,kr=565,dr=501,gr=6,ii=200;let ri=3,ui=4;const nu=n.config.useCobaltCSS?33:39,tu=n.config.useCobaltCSS?33:42,it={},rt="runas",ut="tabletmode_opennewwindow",fi="tile.uninstall",ei="startpin",ft="taskbarpin",oi="startunpin",et="taskbarunpin",si="MRUNoItemsAvailable",l="launchIndexingOptions",iu="s_copyfullpath",ot="workUpsellDismiss",st="workUpsellButton",hi="dynamic-pane-iframe",ht="ws-pills-see-more-less",ru="data-show-more",ct="reclaimKeepButton",f="reclaimUndoButton",lt="reclaimDismiss",a=4,v=[{id:"FlyoutNextButton",selected:!1,text:null},{id:"FlyoutButton",selected:!1,text:null},{id:"FlyoutHyperLinkButton",selected:!1,text:null},{id:"FlyoutDismissFooterButton",selected:!1,text:null},{id:"flyoutDismissIcon",selected:!1,text:null}],y={id:ct,selected:!1},p={id:f,selected:!1},at={id:lt,selected:!1},ci=[y,p,at],w={id:"SearchBox",selected:!1,text:"SearchBox"},uu={id:ot,selected:!1,text:null},fu={id:st,selected:!1,text:null},eu=[uu,fu],ou={id:ht,selected:!1,text:null},e=1,o="WorkUpsellInfo",li=5,t={};t[rt]={content:"&#xE7EF",type:1};t.runasuser={content:"&#xE7EE",type:1};t.openinbrowser={content:"&#xE774",type:1};t.openfilelocation={content:"&#xE838",type:2};t.opencontaining={content:"&#xE838",type:2};t[ut]={content:"&#xE8A7",type:2};t[oi]={content:"&#xE77A",type:1};t[et]={content:"&#xE77A",type:1};t[ei]={content:"&#xE718",type:2};t[ft]={content:"&#xE718",type:2};t.settings={content:"&#xE713",type:2};t.manage={content:"&#xE912",type:1};t.review={content:"&#xE728",type:2};t.share={content:"&#xE72D",type:1};t.connectnetworkdrive={content:"&#xE8CE",type:1};t.disconnectnetworkdrive={content:"&#xE8CD",type:1};t.uninstall={content:"&#xE74D",type:2};t[fi]={content:"&#xE74D",type:2};t.itemproperties={content:"&#xF106",type:2};const su=(()=>{let t={};return t[n.GroupType.PathCompletion]="GPT",t[n.GroupType.Store]="GT",t[n.GroupType.SearchSuggestions]="GW",t[n.GroupType.AnaheimDataQF]="GW",t[n.GroupType.WelcomeExperience]="WWE",t[n.GroupType.MRUHistory]="MRUH",t[n.GroupType.QuickSearch]="QSCH",t[n.GroupType.CuratedSuggestions]="DFLS",t[n.GroupType.CuratedSettings]="CUSE",t[n.GroupType.MSNNews]="MSNN",t[n.GroupType.VisualSearch]="SNSC",t})(),hu=["Bookmark","Building","Person","Qna","File","Group"];n.extendVerbs=au;n.getVerbsAsync=ai;n.wrapsToTwoLines=h;n.joinVerbs=vt;n.getGroupTitleAndNarratorText=ki;n.getGroupPopover=di;class gi{constructor(t,i,r,u,f,e,o,s){this._autoComplete=t;this._navigationHelper=i;this._page=r;this._previewPane=u;this._menuFactory=f;this._upsellViewModel=e;this._popoverFactory=o;this._headerFooterViewModel=s;this._pendingSubmitSequenceNumber=-1;this._pendingSubmitModifierKeys=null;this._pendingSubmitTimeStamp=null;this._itemLaunchEventHandlers=[];this._conversationEndsHandlers=[];this.groups=[];this.topResults=[];this._lastUpdatedSequenceNumber=-1;this._topResultsRenderingDisabled=!1;this._groupRenderingDisabled=!1;this._resultsCounter={topResults:[],groups:[]};this._shouldHideWorkUpsell=!1;this._isWorkUpsellShown=!1;this._pendingSuggestionsInExistingGroups=[];this._pendingSuggestionsInMissingGroups=[];this._lastMiniSerpAutoSuggestion=null;this._addedManualLbshToMru=!1;this.updateExpandedState=()=>{var i;const t=(i=this.groups)===null||i===void 0?void 0:i.findIndex(t=>t.type===n.GroupType.Related);t>-1&&(this.groups[t].isGroupContainerFullyExpanded=!this.groups[t].isGroupContainerFullyExpanded,this._selectedItem.isGroupContainerFullyExpanded=this.groups[t].isGroupContainerFullyExpanded)};n.Host.bindShown(()=>{this._selectedItem=null,this._lastMiniSerpAutoSuggestion=null,this._addedManualLbshToMru=!1});r.setSuggestionClickHandler(this.doubleClickGuardedHandler((t,i)=>{let r={shiftKey:i===null||i===void 0?void 0:i.shiftKey,ctrlKey:i===null||i===void 0?void 0:i.ctrlKey,altKey:i===null||i===void 0?void 0:i.altKey};n.safeExecute(()=>this.click(n.getCurrentTime(),t,n.getInputType(i),r),"suggestionClickHandler")}));r.setContextMenuHandler((t,i)=>{n.safeExecute(()=>this._menuFactory.showContextMenuOnXY(t,i.pageX,i.pageY,()=>n.Host.setFocusInSearchBox(null,"contextMenuDismiss"),n.getInputType(i)),"contextMenuHandler")});r.setOpenPreviewPaneClickHandler((t,i)=>{var r;const u=t;hu.indexOf(u.msbDomain)>-1&&(_w.bfbWsbTel&&bfbWsbTel.logQFSuggestionArrowClick(u.msbDomain),_w.bfbWsbTel&&bfbWsbTel.log3SClickedEvent("QueryFormulationRightArrow_Click",(r=window===null||window===void 0?void 0:window._G)===null||r===void 0?void 0:r.IG));n.safeExecute(()=>this.openPreviewPane(t,i),"openPreviewPaneClickHandler")});r.setExpanderClickInstrumentation((t,i,r)=>{let u="Expander"+(r?"Opened":"Closed"),f={st:i,K:t.instItem.getLayoutKValue()};n.InstrumentationHelper.logClientInstEvent("Select",u,null,f)});this._previewPane&&(this._previewPane.init(this),this._previewPane.bindBeforeItemLaunch((t,i,r,u,f,e)=>n.InstrumentationHelper.instrumentItemClickForPreviewPane(t,i.instItem,i.sequenceNumber,i.instrumentPingBack,r,null,u,f,e)),this._previewPane.bindAfterItemLaunch((n,t,i)=>{this.onSuggestionLaunch(n,t,i)}));n.Host.bindShown(()=>{n.config.setIndexerDefaultValue&&(n.config.searchServiceDisabled=!0),SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSearchServiceStatusAsync&&n.Async.safeChain("getSearchServiceStatusAsync",()=>SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch.getSearchServiceStatusAsync(),t=>{n.InstrumentationHelper.setSearchServiceStatus(pu(t));switch(t){case 1:case 2:case 5:case 6:case 7:n.config.searchServiceDisabled=!0;this.showIndexingMessage(!1);break;case 0:case 4:if(n.config.queryIndexerOnRunningOnly){n.config.searchServiceDisabled=!0;this.showIndexingMessage(!0);break}n.config.searchServiceDisabled=!1;break;case 3:n.config.searchServiceDisabled=!1}})});r.bindOnNarratorLaunch(t=>{let i=n.getCurrentTime(),r=this.getSelectableItems();for(let n of r)if(n.id==t){this.isSuggestionOrGroup(n)?(this.select(n,!1),this.submit(i,!1,n.sequenceNumber,null,!0)):this.isScopeElement(n)&&_ge(n.id).click();break}});n.Host.bindSearchBoxGotFocus(()=>{this._menuFactory.dismiss();let t=n.getCurrentActiveElement();t&&t.blur();this._selectedItem&&!this.isScopeElement(this._selectedItem)&&this.renderSelectedSuggestionState(!1)});n.Host.bindSearchBoxLostFocus(()=>{let t=this.isScopeTile(n.getCurrentActiveElement());t?n.safeSetTimeout(()=>{n.Host.searchBoxHasFocus()||this.isScopeElement(this._selectedItem)||this.renderSelectedSuggestionState(!0)},75,"RootViewModel.bindSearchBoxLostFocus"):this.renderSelectedSuggestionState(!0)});sj_evt.bind("CortanaPaneWidthSet",n=>this.onPaneWidthSet(n[1]));sj_be(n.StaticHtmlElements.qfContainer,"scroll",()=>{this._menuFactory.dismiss(),this._popoverFactory&&this._popoverFactory.dismiss()});this._iconRenderInfos=[]}isScopeTile(n){return n&&n.classList.contains("scope-tile")}isMessageBannerButton(n){return n&&n.classList.contains("reclaimButton")}shouldAddLastAutoSuggToMRU(){var t,i;if(!n.config.disableMRULBSHIncludeAutoMiniSerp&&!this._addedManualLbshToMru&&this._lastMiniSerpAutoSuggestion&&n.getGroupType(this._lastMiniSerpAutoSuggestion)==n.GroupType.SearchSuggestions){let r=(i=(t=this._partialQuery)===null||t===void 0?void 0:t.queryToFetch)===null||i===void 0?void 0:i.trim();if((r===null||r===void 0?void 0:r.length)>=n.config.minQueryLengthForMiniSerpAutoSuggestion||(r===null||r===void 0?void 0:r.split(" ").length)>1)return!0}return!1}onDismiss(){var t;this.shouldAddLastAutoSuggToMRU()&&this.addLastMiniSerpAutoSuggestionToMru();this.topResults=[];this.renderTopResults(!0);this.groups=[];this.renderGroups(!0);this._partialQuery=null;this._lastUpdatedSequenceNumber=-1;this._pendingSuggestionsInExistingGroups=[];this._pendingSuggestionsInMissingGroups=[];this.toggleProgressBar(!1);this._menuFactory.dismiss();this._previewPane&&n.RuntimeConfig.PreviewPaneAvailable&&this._previewPane.dismiss();this._page.hideTemporaryMessage();this.hideIndexingMessage();n.DialogBox&&n.DialogBox.hide();this._headerFooterViewModel&&(this._headerFooterViewModel.render(null,!1,!1,!1,!0),n.config.scopeWithBackground&&((t=this._headerFooterViewModel)===null||t===void 0?void 0:t.scopesSliderReset(!0)));n.Host.setSearchBoxGlyphIcon()}bindItemLaunch(n){this._itemLaunchEventHandlers.push(n)}bindConversationEnds(n){this._conversationEndsHandlers.push(n)}onPaneWidthSet(n){ui=Math.floor((n-2*g)/ti);ri=Math.floor((n-2*g)/ni)}setSelectedStyleSuspended(t,i){t.selectedStyleSuspended=i&&n.Host.isRequestFocusAvailable()}renderSelectedSuggestionState(n){this._selectedItem&&(this.setSelectedStyleSuspended(this._selectedItem,n),this.renderSelection(this._selectedItem))}toggleProgressBar(t){n.config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),t?(this._partialQuery.showProgressBar||this._partialQuery.queryToFetch=="")&&(this._progressTimer=n.safeSetTimeout(()=>{this._progressTimer&&(this._page.setProgressIndicatorVisibility(!0),this._progressTimer=null)},250,"showProgress")):n.config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),this._page.setProgressIndicatorVisibility(!1)))}resetPendingSubmitSequenceNumber(){this._pendingSubmitSequenceNumber=null;this._pendingSubmitModifierKeys=null;this._pendingSubmitTimeStamp=null}onAfterKeyDown(t,i,r,u){var h,c,a,w;if(this._page.scrollRightPaneToTop(),!this._partialQuery||!this._menuFactory.isMenuVisible()&&(!this._popoverFactory||!this._popoverFactory.isPopoverVisible())&&t==13&&this._partialQuery.scope!==n.Scope.Work)return!1;const s=i&&i.shiftKey;if(n.DialogBox&&n.DialogBox.isVisible())return t!=9||u||this.handleCrossViewModelsTabKeyNavigation(null,s),!0;let e=this._previewPane&&this._previewPane.hasFocus();const b="rvm onAfterKeyDown";if(this._page.hideTemporaryMessage(),this.resetPendingSubmitSequenceNumber(),!r&&n.isContextMenuKey(t,s)&&!e)return this.tryShowContextMenuOnSelectedSuggestion(),!0;if(this._menuFactory.isMenuVisible()){if(t==37||t==39||t==13||n.isUpOrDownKey(t)){let f=this._menuFactory.onAfterKeyDown(t,i,r,u);if(f)return!0;if(n.isUpOrDownKey(t))return!1}else if(t==9)return this._menuFactory.dismiss(!0),!0;this._menuFactory.dismiss(!0)}if(this._popoverFactory&&this._popoverFactory.isPopoverVisible()){if(t==37||t==39||t==13||n.isUpOrDownKey(t)){let n=this._popoverFactory.onAfterKeyDown(t,i,r,u);if(n)return!0;if(t==37||t==39)return!1}this._popoverFactory.dismiss(!1)}if(n.RuntimeConfig.QfMode==0||n.RuntimeConfig.QfMode==1){let i=this._selectedItem;if(i&&i.removeIcon&&i.selected){if(t==39)return i.removeIcon.selected=!0,this.renderSelectedSuggestionState(!0),!0;if(t==46&&i.removeIcon.selected)return i.removeIcon.click(n.getCurrentTime(),1),!0;i.removeIcon.selected=!1;this.renderSelection(i)}}if(n.RuntimeConfig.QfMode==5&&t==46){let t=this._selectedItem;return t&&t.removeIcon?(t.removeIcon.click(n.getCurrentTime(),1),!0):!1}let o=n.getCurrentActiveElement();if(!this.isScopeTile(o)||e||this._menuFactory.isMenuVisible()||this._popoverFactory&&this._popoverFactory.isPopoverVisible()||t!=39&&t!=37)if(!n.config.enableMessageBanner||e||t!=39&&t!=37||!this.isMessageBannerButton(o)||this._menuFactory.isMenuVisible()||this._popoverFactory&&this._popoverFactory.isPopoverVisible()){if(t==9)if(n.config.allowTabToSelectSuggestions||s||!this._selectedItem||e||this.isScopeElement(this._selectedItem))if(u){if(n.RuntimeConfig.PreviewPaneAvailable&&this._previewPane&&this._selectedItem&&!this.isScopeElement(this._selectedItem)){this._previewPane.onAfterKeyDownWhenNewSelection(t,this._partialQuery,this._selectedItem);if(e)return!0}}else this.handleCrossViewModelsTabKeyNavigation(o,s);else this.select(this._headerFooterViewModel.getSelectableItems()[0],!1);else if(n.RuntimeConfig.PreviewPaneAvailable&&this._previewPane&&this._selectedItem&&!this.isScopeElement(this._selectedItem)){this._previewPane.onAfterKeyDownWhenNewSelection(t,this._partialQuery,this._selectedItem);if(e)return!0}}else{let u=n.getRtlAdjustedKey(t);const r=[y,p],i=o?r.findIndex(n=>n.id===o.id):-1,f=u==37?i==0:i==r.length-1;if(f)return!1;const e=u==37?i-1:i+1;this.select(r[e],!1);(h=_ge(this._selectedItem.id))===null||h===void 0?void 0:h.focus()}else{let i=n.getRtlAdjustedKey(t);this._headerFooterViewModel.focusNextScopeTile(o,i==39);let r=this._headerFooterViewModel.getSelectableItems();this.select(r[0],!1)}if(e=this._previewPane&&this._previewPane.hasFocus(),this._selectedItem&&(n.isUpOrDownKey(t)||t==9||n.config.msbDsbTabNavigation&&n.isMsbEnterprise()&&this.isDSBItem(this._selectedItem)&&this.isLeftRightArrowKey(t))&&!e){const i=this.isScopeElement(this._selectedItem);i||this._selectedItem==this.topResults[0]?this._page.scrollToTop():this._page.scrollTo(this._selectedItem,n.isWin11DSB(this._partialQuery),this.isWorkScope());const r=b+"-AdjustFocus";i||this.isAdvancedOption(this._selectedItem)||this.isFlyout(this._selectedItem)?(this.isAdvancedOption(this._selectedItem)&&this._selectedItem.id!==l?(c=_ge(this._selectedItem.id))===null||c===void 0?void 0:c.querySelector("input").focus():(a=_ge(this._selectedItem.id))===null||a===void 0?void 0:a.focus(),n.Host.searchBoxHasFocus()&&n.Host.setFocusInWebView(r)):this._selectedItem.id==hi?(this._DSBIframeSelected=!0,n.dsbManager.focus()):this.isDSBItem(this._selectedItem)||this._selectedItem.id==ot||this._selectedItem.id==st||this._selectedItem.id==ct||this._selectedItem.id==f||this._selectedItem.id==lt||this.isWorkScope()&&this._selectedItem.type===n.GroupType.Related||this._selectedItem.id==ht?(w=_ge(this._selectedItem.id))===null||w===void 0?void 0:w.focus():t!=9&&n.Host.searchBoxHasFocus()||n.Host.setFocusInSearchBox(t,r)}return this.isFlyoutVisible()&&v.indexOf(this._selectedItem)>=0&&(t==39?this.selectNextFlyoutItem(1):t==37&&this.selectNextFlyoutItem(-1)),!1}isFlyoutVisible(){return n.config.enableEducationalFlyout&&!n.StaticHtmlElements.flyoutContainer.classList.contains("b_hide")}selectNextFlyoutItem(n){if(this.isFlyoutVisible()){const t=v.filter(n=>_ge(n.id)),r=t.indexOf(this._selectedItem),i=(r+n)%t.length;this._selectedItem=t[i>=0?i:t.length-1];_ge(this._selectedItem.id).focus()}}handleCrossViewModelsTabKeyNavigation(t,i){const u=n.RuntimeConfig.PreviewPaneAvailable&&!!this._previewPane,r=u&&this._previewPane.isOpened(),f=r&&this._previewPane.hasFocus();if(n.DialogBox&&n.DialogBox.isVisible()){let t=n.DialogBox.getSelectableItemsByGroup();i?this.select(t[t.length-1][0],!1):this.select(t[0][0],!1)}else if(f)if(i){this._previewPane.blur();let n=null;if(this._headerFooterViewModel){let t=this._headerFooterViewModel.getSelectableItemsByGroup();n=t[t.length-1][0]}this.select(n,!1)}else{this._previewPane.blur();let n=this.getSelectableItems();this.select(n[0],!0);this._previewPane.onAfterKeyDownWhenNewSelection(9,this._partialQuery,n[0])}else if(this.isScopeTile(t)){let t=!1;if(n.dsbManager&&i){let i=n.dsbManager.getSelectableItemsByGroup();if(i.length>0){let n=i[i.length-1][0];this.select(n,!1);t=!0}}if(!t)if(!r||i){let t=this.getSelectableSuggestionsByGroup();if(t.length>0){let n=i?t[t.length-1][0]:t[0][0];this.select(n,!0)}else{let n=this.getSelectableItems();n.length>0?this.select(n[0],!0):this.select(null,!0)}const r="handleCrossBordersNavigationWithTab";n.safeSetTimeout(()=>n.Host.setFocusInSearchBox(9,r),0,r)}else this.select(this._previewPane.getPreviewedSuggestion(),!0),this._previewPane.focus(!0)}else if(this._selectedItem)if(this._selectedItem.id==hi)if(this._DSBIframeSelected){this._DSBIframeSelected=!1;let n=this.getSelectableItemsByGroup(),t=n[0][0];this.select(t,!1)}else this._DSBIframeSelected=!0,n.dsbManager.focus();else if(i)if(r)this._previewPane.focus();else{let n=this.getSelectableItemsByGroup(),t=n[n.length-1][0];this.select(t,!1)}else this.select(this.getSelectableItemsByGroup()[0][0],!1);else this.select(this.getSelectableItemsByGroup()[0][0],!1)}tryShowContextMenuOnSelectedSuggestion(t){let i=this._selectedItem&&this.isSuggestion(this._selectedItem)?this._selectedItem:null;i&&n.safeExecute(()=>this._menuFactory.showContextMenuOnElement(i,_ge(i.id),()=>n.Host.setFocusInSearchBox(null,"contextMenuDismiss"),t),"contextMenuHandler")}onQueryChanged(t,i){var u;if(n.DialogBox&&n.DialogBox.hide(),this._menuFactory.dismiss(),!this._partialQuery||!this._partialQuery.equals(t)){this._page.hideTemporaryMessage();n.config.dataSourcesWithProgressBar.length>0&&(this._progressTimer&&(sb_ct(this._progressTimer),this._progressTimer=null),t.showProgressBar?this._progressTimer=n.safeSetTimeout(()=>{this._progressTimer&&(this._page.setProgressIndicatorVisibility(!0),this._progressTimer=null)},250,"showProgress"):this._page.setProgressIndicatorVisibility(!1));this._partialQuery&&this._partialQuery.scope!=t.scope&&(this._turnOnIndexingInstItem||this.hideIndexingMessage());let f=this._partialQuery?this._partialQuery.queryToFetch:"",r=t.queryToFetch;if(this._previewPane&&n.RuntimeConfig.PreviewPaneAvailable)this._previewPane.onQueryChanged(t);this._partialQuery=t;let e=!1;for(let n of this.topResults)if(n.updateFromQuery&&!n.hasPreviewPaneOpened)n.updateFromQuery(t)&&(e=!0);else if(r.length>f.length&&r.startsWith(f)&&n.query.toLowerCase().includes(t.queryToFetch.toLowerCase())){let t=n.text.indexOf(HitHighlightingParser.endMarker);t>=0&&t<n.text.length-1&&(n.text=HitHighlightingParser.addMarkers(HitHighlightingParser.removeMarkers(n.text),r),e=!0)}if(e){for(let n of this.topResults)n.sequenceNumber=i,this.updateNarratorWithPreviewMessage(n);this.renderTopResults()}const o=n.RuntimeConfig.EntryPointApp==1;n.config.scopeWithBackground&&r===""&&f.length>=1&&!o&&((u=this._headerFooterViewModel)===null||u===void 0?void 0:u.scopesSliderReset());this.resetIconTimers();this._iconRenderInfos=[]}}onSuggestionsParsed(t,i,r,u,f){var o,s;if(t.enabledDataSources&&t.enabledDataSources[r]){let e=t.enabledDataSources[r].groupType;if(e===n.GroupType.QuickWorkSearch&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qwsShowTopList())&&t.isSearchHomeZI)for(let t of f)t.staticGroupType=t.msbDomain==="Person"?n.GroupType.QuickWorkSearchTopList:e;else if(e===n.GroupType.AnaheimDataList)for(let t of f)t.staticGroupType=n.config.enableAnaheimDataTSTile&&t.type=="ANAT"?n.GroupType.AnaheimDataTile:e;else if(e==n.GroupType.AnaheimDataQF)for(o=0;o<f.length;o++)s=f[o],s.staticGroupType=n.config.topHitMuse&&s.type=="ANATH"?n.GroupType.AnaheimDataTopHit:n.config.useGroupTitleEdgeBS?e:n.GroupType.SearchSuggestions;else if(e===n.GroupType.SearchSuggestions)for(let t of f)t.staticGroupType=n.config.topHitMuse&&t.type=="ANATH"?n.GroupType.AnaheimDataTopHit:e;else if(typeof e=="number")for(let n of f)n.staticGroupType=e;(u==="NI"||u==="PI")&&(r=="PP"||r=="ST"||t.scope!=n.Scope.All)&&n.RuntimeConfig.ScopesAvailable&&t.scope!=n.Scope.Web&&this.showIndexingMessage(!0)}}areSuggestionsPresent(){return this.topResults.length>0||this.groups.length>0&&this.groups.some(n=>n.suggestions.length>0)}isWorkScope(){var t;return((t=this._partialQuery)===null||t===void 0?void 0:t.scope)===n.Scope.Work}getSuggestions(n){let t=this.getCurrentTopResults();return this.groups.forEach(n=>t=t.concat(n.suggestions)),n&&(this._pendingSuggestionsInExistingGroups.forEach(n=>t=t.concat(n.suggestions)),this._pendingSuggestionsInMissingGroups.forEach(n=>t=t.concat(n.suggestions))),t}getSelectableItems(){var i,r,u,e,o,s,h,c,l,a;if(n.DialogBox&&n.DialogBox.isVisible())return n.DialogBox.getSelectableItems();if(this._menuFactory.isMenuVisible())return this._menuFactory.getSelectableItems();if(this._previewPane&&this._previewPane.hasFocus())return this._previewPane.getSelectableItems();if(!n.config.msbDsbTabNavigation&&(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.hasFocus()))return[];let t=[];((i=this._launchIndexingDataModel)===null||i===void 0?void 0:i.action)&&t.push(this._launchIndexingDataModel.action);!this.shouldShowMessageBanner()||((u=(r=n.StaticHtmlElements.messageBannerBottom)===null||r===void 0?void 0:r.className)===null||u===void 0?void 0:u.includes("b_hide"))&&((o=(e=n.StaticHtmlElements.messageBannerTop)===null||e===void 0?void 0:e.className)===null||o===void 0?void 0:o.includes("reclaim"))||t.push(...[at,((s=this._selectedItem)===null||s===void 0?void 0:s.id)==f?p:y]);t.push(...this.topResults);for(let i of this.groups)if(i.click&&t.push(i),i.popover&&t.push(i.popover.subItem),!(this.isWorkScope()&&i.type===n.GroupType.Related&&i.isGroupContainerCollapsed)){let n=i.suggestions.filter(n=>!n.suppressed);const u=`showMoreButton${i.type}`,r=_ge(u);i.maxSuggestionsToShow!=undefined&&(n===null||n===void 0?void 0:n.length)>i.maxSuggestionsToShow&&!i.isGroupContainerFullyExpanded&&(n=n.slice(0,i.maxSuggestionsToShow));r&&r.getAttribute(ru)=="true"&&(n=n.slice(0,5));n.forEach(n=>{n.unselectable||t.push(n),n.subItems&&t.push(...n.subItems.filter(n=>!n.disabled))});r&&r.className&&(a={id:u,selected:!1,click:()=>{r.click()},onSelected:()=>{var n;(n=_ge(this._selectedItem.id))===null||n===void 0?void 0:n.setAttribute("class","showMoreButton sa_hv selected selectable")},onUnselected:()=>{var n;(n=_ge(this._selectedItem.id))===null||n===void 0?void 0:n.setAttribute("class","showMoreButton")},type:"FL",getMruData:()=>{}},t.push(a))}return!this.isWorkScope()||((h=this._selectedItem)===null||h===void 0?void 0:h.isGroupContainerCollapsed)||(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isWorkScopeListViewEnabled())||t.push(ou),n.dsbManager&&t.push(...n.dsbManager.getSelectableItems()),this.areSuggestionsPresent()||t.push(w),this._headerFooterViewModel&&t.push(...this._headerFooterViewModel.getSelectableItems()),!this.shouldShowWorkUpsellMessage()||((l=(c=n.StaticHtmlElements.workUpsellBanner)===null||c===void 0?void 0:c.className)===null||l===void 0?void 0:l.includes("b_hide"))||t.push(...eu),t}getSelectableSuggestionsByGroup(){if(n.config.allowTabToSelectSuggestions){let t=[];return n.config.enableMessageBanner&&t.push(ci),t.push(this.topResults),this.groups.forEach(i=>{if(i.click&&t.push([i]),i.popover&&t.push([i.popover.subItem]),!(this.isWorkScope()&&i.type===n.GroupType.Related&&i.isGroupContainerCollapsed)){let r=[],n=i.suggestions.filter(n=>!n.suppressed);i.maxSuggestionsToShow!=undefined&&(n===null||n===void 0?void 0:n.length)>i.maxSuggestionsToShow&&!i.isGroupContainerFullyExpanded&&(n=n.slice(0,i.maxSuggestionsToShow));n.forEach(n=>{n.unselectable||r.push(n),n.subItems&&r.push(...n.subItems.filter(n=>!n.disabled))});t.push(r)}}),t.filter(n=>n.length>0)}return[]}getSelectableItemsByGroup(){var i,r,u,e,o,s;if(n.DialogBox&&n.DialogBox.isVisible())return n.DialogBox.getSelectableItemsByGroup();if(this._menuFactory.isMenuVisible())return this._menuFactory.getSelectableItemsByGroup();if(this._previewPane&&this._previewPane.hasFocus())return this._previewPane.getSelectableItemsByGroup();let t=[];return this.isFlyoutVisible()&&t.push([v.find(n=>!!_ge(n.id))]),this._headerFooterViewModel&&t.push(...this._headerFooterViewModel.getSelectableItemsByGroup()),((i=this._launchIndexingDataModel)===null||i===void 0?void 0:i.action)&&t.push([this._launchIndexingDataModel.action]),this.areSuggestionsPresent()?(t.push(...this.getSelectableSuggestionsByGroup()),n.dsbManager&&t.push(...n.dsbManager.getSelectableItemsByGroup())):(!this.shouldShowMessageBanner()||((u=(r=n.StaticHtmlElements.messageBannerBottom)===null||r===void 0?void 0:r.className)===null||u===void 0?void 0:u.includes("b_hide"))&&((o=(e=n.StaticHtmlElements.messageBannerTop)===null||e===void 0?void 0:e.className)===null||o===void 0?void 0:o.includes("reclaim"))||t.push([at,((s=this._selectedItem)===null||s===void 0?void 0:s.id)==f?p:y]),n.dsbManager&&t.push(...n.dsbManager.getSelectableItemsByGroup()),t.push([w])),t}getSelectedItem(){return n.DialogBox&&n.DialogBox.isVisible()?n.DialogBox.getSelectedItem():this._menuFactory.isMenuVisible()?this._menuFactory.getSelectedItem():this._previewPane&&this._previewPane.hasFocus()?this._previewPane.getSelectedItem():this._selectedItem?this._selectedItem:w}updateSelectionState(t){n.contains(this.topResults,t)?this.renderTopResults():this.groups.some(i=>n.contains(i.suggestions,t))&&this.renderGroups()}updateLastMiniSerpAutoSuggestion(n){this._lastMiniSerpAutoSuggestion=n}addLastMiniSerpAutoSuggestionToMru(){this._conversationEndsHandlers.forEach(n=>n(this._lastMiniSerpAutoSuggestion,this._partialQuery))}isSubItem(n){return n&&typeof n.itemView!="undefined"}getSuggestionById(n){for(let t=0;t<this.groups.length;t++)for(let i=0;i<this.groups[t].suggestions.length;i++)if(this.groups[t].suggestions[i].id==n)return this.groups[t].suggestions[i];return null}selectGroupItem(n){var i,t;for(i of this.groups)for(t of i.suggestions)t.reactKey==n.reactKey?(t.selected=!0,this._selectedItem=t):t.selected=!1;for(t of this.topResults)t.reactKey==n.reactKey?(t.selected=!0,this._selectedItem=t):t.selected=!1}doesGroupsContain(n){var t,i;for(t of this.groups)for(i of t.suggestions)if(i.reactKey==n.reactKey)return!0;return!1}renderSelection(t,i){var r,u,f,e;this.updateGroupSuggestion(i);this.isSubItem(t)&&(t=this.getSuggestionById(t.suggestionId));i&&this.isSubItem(i)&&(i=this.getSuggestionById(i.suggestionId));(t&&this.isSuggestion(t)&&n.contains(this.topResults,t)||i&&this.isSuggestion(i)&&n.contains(this.topResults,i))&&(this.renderTopResults(),this.groups&&(i&&i.handoffType===21||((r=this.groups[0])===null||r===void 0?void 0:r.suggestions)&&((u=this.groups[0].suggestions[0])===null||u===void 0?void 0:u.handoffType)===21)&&this.renderGroups());this._headerFooterViewModel&&(t&&this.isAdvancedOption(t)||i&&this.isAdvancedOption(i))&&this._headerFooterViewModel.updateTopHitHeader();t&&((e=(f=this._launchIndexingDataModel)===null||f===void 0?void 0:f.action)===null||e===void 0?void 0:e.id)===l&&this._page.updateTemporaryMessageView(this._launchIndexingDataModel);(t&&n.isGroup(t)&&n.contains(this.groups,t)||t&&this.isSuggestion(t)&&this.doesGroupsContain(t)||i&&n.isGroup(i)&&n.contains(this.groups,i)||i&&this.isSuggestion(i)&&this.groups.some(t=>n.contains(t.suggestions,i)))&&this.renderGroups()}updateGroupSuggestion(n){if(n&&n.handoffType===21&&this.groups){const t=this.groups.findIndex(t=>t.type===n.groupType);if(t>-1){const i=this.groups[t].suggestions.findIndex(t=>t.id===n.id);i>-1&&(this.groups[t].suggestions[i].selected=!1)}}}renderGroups(t){var i,r,u;if(this._partialQuery){let t=this._partialQuery.queryToFetch?n.config.maxSuggestionsPerGroup:0;t&&t>0&&this.groups.forEach((n,i,r)=>{r[i].suggestions=n.suggestions.slice(0,t)})}this._groupRenderingDisabled||((((i=this._contentQuery)===null||i===void 0?void 0:i.scope)==n.Scope.All||((r=this._contentQuery)===null||r===void 0?void 0:r.isWorkScopeZI))&&(this.adjustMsbGroups(),this.limitWebSuggestions()),this._page.updateGroupsView({query:this._contentQuery,topResults:this.topResults,groups:this.groups},t,this.isWorkScope()&&this.updateExpandedState,((u=this._partialQuery)===null||u===void 0?void 0:u.queryToFetch)?null:this.buildMessageBannerModel()),n.InstrumentationHelper.updateSuggestionsList(this.topResults,this.groups))}limitWebSuggestions(){if(n.config.msbEnableSearchTheWebMaxSuggestionsPresent){const t=this.topResults.filter(t=>n.isMsbQFSuggestion(t)||n.isWebSuggestion(t)||t.isAnswer).length>0,i=this.groups.filter(t=>t.suggestions.filter(t=>n.isMsbQFSuggestion(t)&&!t.suppressed).length>0).length>0;if(!t&&i){let t=[n.GroupType.SearchSuggestions,n.GroupType.Websites];const r=this.groups.filter(i=>n.contains(t,i.type));let i=[];r.forEach(n=>i.push(...n.suggestions));n.limitWebSuggestions(this._partialQuery,[],i,t,[])}}}adjustMsbGroups(){this.msbGroupsSuppressDefault();this.msbGroupsMergeDocsIntoQws();this.msbGroupsSetupTopList();this.msbGroupsSetLayout()}msbGroupsSuppressDefault(){var t;if((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.enableQws())&&((t=this._contentQuery)===null||t===void 0?void 0:t.isSearchHomeZI)){const t=this.groups.filter(t=>t.type===n.GroupType.QuickWorkSearchTopList)[0],i=this.groups.filter(t=>t.type===n.GroupType.QuickWorkSearch)[0],r=this.groups.filter(t=>t.type===n.GroupType.RecommendedDocs)[0],u=this.groups.filter(t=>t.type===n.GroupType.MsbQuickWorkQueriesTopList)[0];(t||i||r||u)&&(this.groups=this.groups.filter(t=>t.type!==n.GroupType.TopApps&&t.type!==n.GroupType.QuickSearch&&t.type!==n.GroupType.CuratedSettings))}}getMaxMsbItems(){var t;let i=this.getMaxNumberOfRecentItems(n.GroupType.CuratedSuggestions);if(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qwsShowTopList()){const r=this.groups.filter(t=>t.type===n.GroupType.QuickWorkSearchTopList||t.type===n.GroupType.MsbQuickWorkQueriesTopList)[0];if(((t=r===null||r===void 0?void 0:r.suggestions)===null||t===void 0?void 0:t.length)>0)return i-2}return i}msbGroupsMergeDocsIntoQws(){var t,i,r,u;if((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.enableQwsRecDocs())&&(((t=this._contentQuery)===null||t===void 0?void 0:t.isSearchHomeZI)||((i=this._contentQuery)===null||i===void 0?void 0:i.isWorkScopeZI))){const f=this.groups.filter(t=>t.type===n.GroupType.QuickWorkSearch)[0],t=this.groups.filter(t=>t.type===n.GroupType.RecommendedDocs)[0],i=this.groups.filter(t=>t.type===n.GroupType.MsbOnRampButton)[0];if(f&&((r=t===null||t===void 0?void 0:t.suggestions)===null||r===void 0?void 0:r.length)>0){let r=f.suggestions;n.isMsbQwsDocsCacheEnabled(this._partialQuery)&&(r=r.filter(n=>n.type!=="FL"));const u=t.suggestions.slice(0,n.config.ziRecommendedDocsResultsCount),e=this.getMaxMsbItems(),o=e-u.length;r=r.slice(0,o);r.push(...u);i&&(i.suggestions[0].suppressed=!1,r.push(...i.suggestions),this.groups=this.groups.filter(t=>t.type!==n.GroupType.MsbOnRampButton));f.suggestions=r;this.groups=this.groups.filter(t=>t.type!==n.GroupType.RecommendedDocs);this.groups.filter(t=>t.type===n.GroupType.QuickWorkSearch).map(n=>n.instRegionName="QuickWorkSearchWithRecDocs")}!f&&((u=t===null||t===void 0?void 0:t.suggestions)===null||u===void 0?void 0:u.length)>0&&i&&(i.suggestions[0].suppressed=!1,t.suggestions.push(...i.suggestions),this.groups=this.groups.filter(t=>t.type!==n.GroupType.MsbOnRampButton))}}msbGroupsSetupTopList(){var t,i;if((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qwsShowTopList())&&((t=this._contentQuery)===null||t===void 0?void 0:t.isSearchHomeZI)){const t=this.groups.filter(t=>t.type===n.GroupType.QuickWorkSearchTopList||t.type===n.GroupType.MsbQuickWorkQueriesTopList)[0];if(t){const u=this.groups.filter(t=>t.type===n.GroupType.QuickWorkSearch)[0];u&&(u.hideGroupHeader=!0);const f=this.groups.filter(t=>t.type===n.GroupType.RecommendedDocs)[0];f&&(f.hideGroupHeader=!0);t.cssClasses=`${t.cssClasses||""} msbQwsTop`;const r=this.groups.filter(t=>t.type===n.GroupType.MsbQuickWorkQueriesTopList)[0];r&&((i=r===null||r===void 0?void 0:r.suggestions)===null||i===void 0?void 0:i.length)>0&&(t.cssClasses=`${t.cssClasses||""} msbQwqTop`)}}}msbGroupsSetLayout(){var t;if((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qwsShowTopList())&&((t=this._contentQuery)===null||t===void 0?void 0:t.isSearchHomeZI)&&n.RuntimeConfig.AlwaysWide){const t=this.groups.filter(t=>t.type===n.GroupType.QuickWorkSearch)[0];if(t)t.cssClasses=`${t.cssClasses||""} colRight fbig`;else if(n.msbHost.qwsShowTopList()){const t=this.groups.filter(t=>t.type===n.GroupType.RecommendedDocs)[0];t&&(t.cssClasses=`${t.cssClasses||""} colRight fbig`)}const i=this.groups.filter(t=>t.type===n.GroupType.QuickWorkSearchTopList||t.type===n.GroupType.MsbQuickWorkQueriesTopList)[0];i&&(i.cssClasses=`${i.cssClasses||""} colRight fbig`)}}select(t,i){var r,u,f,e,o,s;if(!(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isTourVisible())||((r=t===null||t===void 0?void 0:t.id)===null||r===void 0?void 0:r.toLowerCase().search(/flyout/i))!=-1)if(n.DialogBox&&n.DialogBox.isVisible())n.DialogBox.select(t);else if(this._menuFactory.isMenuVisible()&&n.contains(this._menuFactory.getSelectableItems(),t))this._menuFactory.select(t,!1);else if(this._previewPane&&n.contains(this._previewPane.getSelectableItems(),t))this._previewPane.select(t,!1);else{let r=this._selectedItem;if(r&&(r.selected=!1,((u=this._partialQuery)===null||u===void 0?void 0:u.scope)===n.Scope.Work&&(r.hasPreviewPaneOpened=!1,(r===null||r===void 0?void 0:r.type)===n.GroupType.Related&&((f=_ge(r.id))===null||f===void 0?void 0:f.blur())),n.config.enableMessageBanner&&ci.findIndex(n=>n.id===r.id)!=-1&&((e=_ge(r.id))===null||e===void 0?void 0:e.blur()),this.setSelectedStyleSuspended(r,!1)),t==w?(this._selectedItem=null,n.Host.searchBoxHasFocus()||n.Host.setFocusInSearchBox(null,"rvm_select")):(this._selectedItem=t,t&&(this.isDSBItem(t)&&n.Host.searchBoxHasFocus()&&n.Host.setFocusInWebView("rvm_dsb_select"),t.selected=!0,((o=this._partialQuery)===null||o===void 0?void 0:o.scope)===n.Scope.Work&&(this._selectedItem.hasPreviewPaneOpened=!0),(s=t.onSelected)===null||s===void 0?void 0:s.call(t),this.setSelectedStyleSuspended(t,!n.Host.searchBoxHasFocus()))),i&&t&&(t.arrowOrTabAction=!0),this.renderSelection(this._selectedItem,r),this.isScopeElement(t)&&this._headerFooterViewModel.select(t,!1),i){let i=t?t.query:null;i&&this._partialQuery.scopePrefix&&(i=this._partialQuery.scopePrefix.trim()+": "+i);n.Host.updateQueryWithoutRefetching(i)}}}resetIconTimers(n,t){let i=typeof n=="undefined"||!n,r=typeof n=="undefined"||n;if(i){if(t)for(let n of this._renderGroupsIconsCBs)n();this._renderGroupsIconsCBs=[];this._renderGroupsTimerForIcons&&(sb_ct(this._renderGroupsTimerForIcons),this._renderGroupsTimerForIcons=null)}if(r){if(t)for(let n of this._renderTopResultsIconsCBs)n();this._renderTopResultsIconsCBs=[];this._renderTopResultsTimerForIcons&&(sb_ct(this._renderTopResultsTimerForIcons),this._renderTopResultsTimerForIcons=null)}}setupIcon(t,i,r,u){if(n.config.noFetchIcons||n.config.reactGroups){u();return}let f=()=>{r.isTopResult?this.renderTopResults():this.renderGroups(),this.resetIconTimers(r.isTopResult,!0)},e=t=>{r.iconsPendingReturn==0?(f(),t&&t()):r.isTopResult?(t&&this._renderTopResultsIconsCBs.push(t),this._renderTopResultsTimerForIcons||(this._renderTopResultsTimerForIcons=n.safeSetTimeout(()=>{this._renderTopResultsTimerForIcons=null,f()},ii,"renderTRIconsAsync"))):(t&&this._renderGroupsIconsCBs.push(t),this._renderGroupsTimerForIcons||(this._renderGroupsTimerForIcons=n.safeSetTimeout(()=>{this._renderGroupsTimerForIcons=null,f()},ii,"renderGRPIconsAsync")))};if(++r.iconsPendingReturn,!i.suppressed&&i.getIcon){n.InstrumentationHelper.notifyIconPending(t,r.isTopResult);let f=this._partialQuery;i.getIcon(gi.getImageSize(f,i,r.isTopResult),f=>{i.icon=f;let o=()=>{--r.iconsPendingReturn,this._partialQuery&&t==n.SequenceNumberManager.getSequenceNumber()&&(n.InstrumentationHelper.notifyIconReadyOrFailed(t,r.isTopResult),(r.isTopResult&&n.contains(this.topResults,i)||!r.isTopResult&&this.groups.some(t=>n.contains(t.suggestions,i)))&&e(u))};n.populateImageRatio(i.icon,i.type,o)})}else if(!i.suppressed&&i.icon&&n.canIconFail(i.icon)){n.InstrumentationHelper.notifyIconPending(t,r.isTopResult);let f=i.icon.getFallbackIcon,o=(n,t)=>t(i.icon);const s=i.icon.isValidSize,h=()=>{i.getIcon=f,this.setupIcon(t,i,r,u),n.InstrumentationHelper.notifyIconReadyOrFailed(t,r.isTopResult)},c=()=>{i.icon.isSmall=!0,i.getIcon=o,this.setupIcon(t,i,r,u),n.InstrumentationHelper.notifyIconReadyOrFailed(t,r.isTopResult)};i.icon.onIconError=h;i.icon.onIconRendered=(f,e)=>{s(f,e)||i.icon.isSmall?(n.InstrumentationHelper.notifyIconReadyOrFailed(t,r.isTopResult),u()):c()};--r.iconsPendingReturn;e()}else--r.iconsPendingReturn,u()}static getImageSize(t,i,r){return t.isSearchHomeZI?i.type=="TOPL"?7:8:t.scope==n.Scope.Apps&&!t.queryToFetch?3:n.displayedInGridLayout(i.type)?2:r?0:1}isSuggestionOrGroup(n){return!this.isScopeElement(n)}isSuggestion(t){return!n.isGroup(t)&&!this.isScopeElement(t)&&!this.isAdvancedOption(t)}isDSBItem(n){return!!(n===null||n===void 0?void 0:n.dsb)}isLeftRightArrowKey(n){return n==37||n==39}isAdvancedOption(n){return typeof n.layout=="number"}isFlyout(n){return this.isFlyoutVisible()&&v.indexOf(n)>=0}isBodyOrSuggestion(n){return n&&(n.tagName.toLowerCase()=="body"||n.tagName.toLowerCase()=="iframe"||n.className&&n.classList.contains("suggestion"))}submit(t,i,r,u,e){var h,c,a,v;let s=e?5:i?6:1,o=n.getCurrentActiveElement();if(n.DialogBox&&n.DialogBox.isVisible()){n.DialogBox.submit();return}if(this._previewPane&&this._previewPane.hasFocus()){let n=this._previewPane.getSelectedItem();if(n&&n.click&&n.optionType===undefined){n.click(t,s);return}}else if(!this._selectedItem||!this.isScopeElement(this._selectedItem)||this._menuFactory.isMenuVisible()||this._popoverFactory&&this._popoverFactory.isPopoverVisible()){if((n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9)&&!this._selectedItem){n.Host.submitFileExplorerTextSuggestion(this._partialQuery.queryToFetch);return}}else{_ge(this._selectedItem.id).click();return}let y=this._menuFactory.getSelectedItem();if(y){y.click&&y.click(t,s,u);return}let p=this._popoverFactory?this._popoverFactory.getSelectedItem():null;if(p){this._popoverFactory.submit(p);return}if(((h=this._selectedItem)===null||h===void 0?void 0:h.id)===l){this.click(t,this._selectedItem,s,u);return}let w=!this.isBodyOrSuggestion(o);if(w){n.Host.isRequestFocusAvailable()?o.id==st||o.id==ot?o.click():o.id==ct||o.id==f||o.id==lt?o.click():(this._partialQuery.scope===n.Scope.Work&&((a=(c=this._selectedItem)===null||c===void 0?void 0:c.typeWithSource)===null||a===void 0?void 0:a.type)===n.GroupType.Related||((v=this._selectedItem)===null||v===void 0?void 0:v.id)==ht)&&o.click():o.click();return}if(this._lastUpdatedSequenceNumber!=r&&(!this._selectedItem||this._selectedItem==this.topResults[0])){this._pendingSubmitSequenceNumber=r;this._pendingSubmitModifierKeys=u;this._pendingSubmitTimeStamp=t;return}this._selectedItem?this.click(t,this._selectedItem,s,u):this.groups.length>0&&this._partialQuery.fullPartialQuery&&this.showDisableEnterMessage()}doubleClickGuardedHandler(t){let i;return(r,u)=>{i&&n.getCurrentTime()-i<=250||(i=n.getCurrentTime(),t(r,u))}}click(t,i,r,u){if(this._page.hideTemporaryMessage(),this.isAdvancedOption(i)){i.click&&i.click(t,r,u);return}let f=n.isGroup(i)||this.isSubItem(i)?null:i;if(!i.instItem||f&&f.isReformulation||n.InstrumentationHelper.instrumentItemClick(t,i.instItem,i.sequenceNumber,f?f.instrumentPingBack:null,r,u),!f){i.click&&i.click(t,r,u);return}u=u||n.Host.getModifierKeyState();u.ctrlKey&&u.shiftKey?this.launchVerb(f,rt,t):u.shiftKey?this.launchVerb(f,ut,t):f.click(t,r,u);this.onSuggestionLaunch(f,this._partialQuery)}onSuggestionLaunch(t,i,r){n.isChildSuggestion(t)&&t.parent&&(t=t.parent);this._itemLaunchEventHandlers.forEach(n=>n(t,i,r));n.getGroupType(t)!=n.GroupType.QuickSearch&&(this._addedManualLbshToMru=!0)}launchVerb(t,i,r){let u=ai("launchVerb",t,n.config.rawVerbs,!1,u=>{let f=!1;for(let t of u)if(t.verb&&t.verb.toLocaleLowerCase()==i.toLocaleLowerCase()){t.executeSync?n.safeExecute(()=>t.executeSync(),"verb.executeSync",null,i):n.Async.safeChain("verb.executeAsync",()=>t.executeAsync(),()=>n.Host.manuallyDismissApp(),null,null,i);f=!0;break}f||t.click(r,0)},()=>!0);u||t.click(r,0)}getGroupHeaderClickAction(t,i,r,u){let f,e,o=null,s=null;if(n.RuntimeConfig.ScopesAvailable){let r=n.getScope(i.type);if(this.isWorkScope())return f=null,i.type!==n.GroupType.Related||(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isWorkScopeListViewEnabled())?i.type!=n.GroupType.WorkSuggestions&&n.config.msbWorkScopeGroupHeaderRedirect&&(f=()=>{var t;_w.bfbWsbTel&&bfbWsbTel.logWorkScopeClick(`${n.GroupType[i.type]}GroupHeader`,{redirectTo:n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.redirectScope(u.type)});(t=this._headerFooterViewModel)===null||t===void 0?void 0:t.clickHandler(r,"groupHeader",i)}):f=()=>{const t=this.groups.findIndex(t=>t.type===n.GroupType.Related);t>-1&&(this.groups[t].isGroupContainerCollapsed=!this.groups[t].isGroupContainerCollapsed,this._selectedItem.isGroupContainerCollapsed=this.groups[t].isGroupContainerCollapsed)},[f,null,null,null,null];if(r!=n.Scope.All)if(i.type==n.GroupType.SearchSuggestions&&t.isSearchHomeZI)e=n.Host.getLocString("OpenPrivacyPortalButtonText"),o=n.Host.getLocString("ManageSearchHistory"),f=()=>n.Host.launchPrivacyPortal();else return n.isL2(t)||!n.isScopeEnabled(r,n.ScopeConfig[r])?[null,null,null,null,null]:(f=()=>this._headerFooterViewModel.clickHandler(r,"groupHeader",i),[f,null,null,null,null])}if(!f)switch(i.type){case n.GroupType.Store:f=()=>n.Host.launchStoreSearch(t.queryToFetch);break;case n.GroupType.SearchSuggestions:f=()=>this.launchSearch(t,r);break;case n.GroupType.PathCompletion:f=()=>n.Host.launchFolder(wi(t,this._partialQuery));break;case n.GroupType.MSNNews:if(!n.config.msnNewsAlternativeUX)return e=n.Host.getLocString("QuickSearchSuggestionsSection"),o=n.Host.getLocString("MSNNewsQuickSearchHover"),f=()=>{n.LightweightStorage.setItem(n.currentTabStorageKey,n.MSNNewsTabs.QuickSearches),n.Host.refreshCurrentPane(),n.InstrumentationHelper.logClientInstEvent("Select","MSNNewsTabChange",null,{newtab:"QuickSearches"})},[f,null,e,o,s];break;case n.GroupType.Upsell:if(t.isSearchHomeZI)return s={content:"&#xE711",type:2},e=n.Host.getLocString("DismissUpsell"),o=n.Host.getLocString("DismissUpsell"),f=this._upsellViewModel.getDismissButtonAction(),[f,null,e,o,s];break;case n.GroupType.QuickSearch:if(n.config.msnNewsSearch&&n.shouldEnableMSNNewsSearches(n.getCurrentLanguage()))return e=n.Host.getLocString(n.config.msnNewsTitleResource),o=n.Host.getLocString(n.config.msnNewsHoverResource),f=()=>{n.LightweightStorage.setItem(n.currentTabStorageKey,n.MSNNewsTabs.News),n.Host.refreshCurrentPane(),n.InstrumentationHelper.logClientInstEvent("Select","MSNNewsTabChange",null,{newtab:"MSNNews"})},[f,null,e,o,s];break;case n.GroupType.WelcomeExperience:if(n.config.enableWWETour&&n.RuntimeConfig.PreviewPaneAvailable&&SearchAppWrapper.CortanaApp.height>=615)return s={content:"&#xE711",type:2},e=n.Host.getLocString("DismissUpsell"),o=n.Host.getLocString("DismissUpsell"),f=()=>this.dismissTour(t),[f,null,e,o,s];break;case n.GroupType.AnaheimDataTile:if(n.canShowAnaheimDataSHTileE2E())return s={content:"&#xE711",type:2,className:"anaheimDataTileDismissGroup"},e=n.Host.getLocString("DismissAnaheimData"),o=n.Host.getLocString("DismissAnaheimData"),f=()=>{n.config.enableAnaheimDataTSTile&&(n.LightweightStorage.setItem("AnaheimDataTSTileDismissed","1"),n.InstrumentationHelper.logClientInstEvent("Select","AnaheimDataTSTileDismissed",null)),n.Host.refreshCurrentPane()},[f,null,e,o,s];break;case n.GroupType.AnaheimDataList:if(n.canShowAnaheimDataSHListE2E())return s={content:"&#xE711",type:2,className:"anaheimDataListDismissGroup"},e=n.Host.getLocString("DismissAnaheimData"),o=n.Host.getLocString("DismissAnaheimData"),f=()=>{(n.config.enableAnaheimDataHS||n.config.enableAnaheimDataRC)&&(n.LightweightStorage.setItem("AnaheimDataBHListDismissed","1"),n.InstrumentationHelper.logClientInstEvent("Select","AnaheimDataBHListDismissed",null)),n.Host.refreshCurrentPane()},[f,null,e,o,s];break;case n.GroupType.PromoBanner:return s={content:"&#xE711",type:2},e=n.Host.getLocString("DismissUpsell"),o=n.Host.getLocString("DismissUpsell"),f=this._upsellViewModel.getDismissButtonAction(),[f,null,e,o,s]}if(f){if(!r)throw"No QS code for: "+n.GroupType[i.type];let t=n.InstrumentedItem.getNonSuggestionInstrumentedItem(r,n.SyntheticQSCodesMaps.KValues);return[f,t,e,o,s]}return[null,null,null,null,null]}shouldShowPlusIconInGroupHeader(t,i){if(n.getScope(t)==n.Scope.Web||t==n.GroupType.Store)return!1;if(t==n.GroupType.Apps&&this._partialQuery.queryToFetch.length<n.config.minLengthForIBAonL1)return!0;if(t==n.GroupType.Apps||t==n.GroupType.Settings){let r=i[t==n.GroupType.Apps?"PP":"ST"];return!(r&&r.maxedOut)}return!0}shouldHideGroupHeader(t,i){const u=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.getStoredMsbTenantName(),r=i===n.Host.getLocString("MsbVerticalSuggestionGroupName")||i===n.Host.getLocString("MsbWorkVerticalSuggestionGroupName",u);if(this._partialQuery.scope!==n.Scope.Work||r){if(r&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isWorkScopeListViewEnabled())&&t==n.GroupType.Related)return!0}else return!1;return t===n.GroupType.QuickSearch&&n.shouldEnableMSNNewsSearches(n.getCurrentLanguage())&&n.canShowMSNNewsTab()?!0:t===n.GroupType.VisualSearch||t===n.GroupType.MSNNews&&n.config.msnNewsAlternativeUX||t===n.GroupType.MsbOnRampButton?!0:!1}addGroup(t,r,u,f,e){var h;if(i(this.groups,t))throw new Error("Trying to add repeated group "+t);let v=su[t.type],[c,l,y,b,p]=this.getGroupHeaderClickAction(this._partialQuery,t,v,r),s=ki(this._partialQuery,t.type,r,!!c);const a=((h=this._partialQuery)===null||h===void 0?void 0:h.scope)===n.Scope.Work,k=a&&t.source===5&&n.config.msbWorkScopeTenantGroupTitle;if(t.source){const i=n.getGroupSourceDisplayName(t.source);i&&(!a||k)&&((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isTenantMsbEnabled())&&t.source==1&&t.type==n.GroupType.Documents?s.title=i+" - "+s.title:s.title+=" - "+i)}let d=di(t.type,this._popoverFactory,this._partialQuery.isSearchHomeZI,u),o=[];n.isTopHitChildGroup(t)&&!a?o.push("topHitConnectedToGroup"):t.type==n.GroupType.TopApps||this._partialQuery.isSearchHomeZI&&t.type==n.GroupType.People||t.type==n.GroupType.AnaheimDataTile?o.push("topItemsGroup"):t.type==n.GroupType.QuickSearch?o.push("balloonSuggGroup"):t.type==n.GroupType.QuickWorkSearch?(o.push("quickWorkSearchGroup"),n.msbHost&&n.msbHost.shouldHideTopApp()&&n.isMsbEnterprise()&&!n.msbHost.tenantManager.isGccHighTenant()&&o.push("topMostGroup")):t.type==n.GroupType.VisualSearch?o.push("snipSuggGroup"):t.type==n.GroupType.MSNNews?o.push("msnNewsGroup"):t.type==n.GroupType.WelcomeExperience?o.push("welcomeExperience"):t.type==n.GroupType.Upsell?(o.push("upsellSuggGroup"),n.shouldEnableAnaheimResetDefault()&&o.push("edgeUpsellDefaultTopBanner")):t.type==n.GroupType.PromoBanner?o.push("skypePromoSuggGroup"):t.type==n.GroupType.MRUHistory||t.type==n.GroupType.CuratedSuggestions?o.push("leftPaneZIsuggestions"):t.type==n.GroupType.RecommendedDocs||t.type==n.GroupType.Documents&&n.isRecommendedDocsGroupEnabled(this._partialQuery)?(o.push("recommendedDocsGroup"),n.msbHost&&n.msbHost.shouldHideTopApp()&&n.isMsbEnterprise()&&!n.msbHost.tenantManager.isGccHighTenant()&&o.push("topMostGroup")):t.type==n.GroupType.AnaheimDataList?o.push("anaheimDataGroup"):t.type==n.GroupType.AnaheimDataTopHit?o.push("anaheimDataGroup"):t.type==n.GroupType.AnaheimDataQF?o.push("anaheimDataGroup"):t.type==n.GroupType.TrendingSearchData?o.push("trendingSearchDataGroup"):t.type==n.GroupType.CuratedSettings&&o.push("curatedSettingsGroup");n.config.enableMRU10&&!n.config.useCobaltCSS&&(!n.isMsbEnterprise()||n.config.msbEnabledMru10)&&o.push("mru10");let w={type:t.type,typeWithSource:t,id:"gr"+t.type+(t.source||""),text:s.title,secondaryText:y,secondaryIcon:p,narratorText:s.narratorText,tooltip:b,click:(n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isTourVisible())?null:c,onlyAnnotationIsClickable:c&&(!!y||!!p),suggestions:[],instRegionName:n.GroupType[t.type],instItem:l,selected:!1,cssClasses:o.join(" ")||undefined,sequenceNumber:u,showPlusIconInHeader:this.shouldShowPlusIconInGroupHeader(t.type,e),hideGroupHeader:this.shouldHideGroupHeader(t.type,s.title),popover:d};return l&&n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(u,v,l),this._resultsCounter.groups.push({typeWithSource:t,suggestions:[]}),this.insertGroup(w,f),w}insertGroup(t,i){let u=i.findIndex(i=>n.sameGroup(i,t.typeWithSource)),r=!1;for(let f=0;f<this.groups.length;f++){let e=i.findIndex(t=>n.sameGroup(t,this.groups[f].typeWithSource));if(e>u){this.groups.splice(f,0,t);r=!0;break}}r||this.groups.push(t)}handlePendingSubmit(t){if(this._pendingSubmitSequenceNumber==this._lastUpdatedSequenceNumber)try{if(this.topResults.length==0)(this.groups.length>0||t.length>0)&&this.showDisableEnterMessage();else{let t=this.topResults[0];return n.InstrumentationHelper.instrumentItemClick(this._pendingSubmitTimeStamp,t.instItem,t.sequenceNumber,t.instrumentPingBack,1,this._pendingSubmitModifierKeys),this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.ctrlKey&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(t,rt,this._pendingSubmitTimeStamp):this._pendingSubmitModifierKeys&&this._pendingSubmitModifierKeys.shiftKey?this.launchVerb(t,ut,this._pendingSubmitTimeStamp):t.click(this._pendingSubmitTimeStamp,0,this._pendingSubmitModifierKeys),0}}finally{this.resetPendingSubmitSequenceNumber()}return 1}showDisableEnterMessage(){this._page.showTemporaryMessage(n.Host.getLocString("EnterOnAmbiguousTopHitMessageText"))}showIndexingMessage(t){var i;t?(this._turnOnIndexingInstItem=null,this._launchIndexingDataModel=null):(this._turnOnIndexingInstItem=n.InstrumentedItem.getNonSuggestionInstrumentedItem("IMIO",n.SyntheticQSCodesMaps.KValues),i={id:l,selected:null,text:n.Host.getLocString("WindowsIndexingDisabledAction"),title:null,instItem:this._turnOnIndexingInstItem,click:(t,i)=>{let r=n.SequenceNumberManager.getSequenceNumber();r>this._lastUpdatedSequenceNumber&&n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(r,"IMIO",this._turnOnIndexingInstItem);n.InstrumentationHelper.instrumentItemClick(t,this._turnOnIndexingInstItem,r,null,i,null);n.LocalDataProvider.launchIndexingOptions(!1)},layout:1,isSelectable:!0});this._launchIndexingDataModel={messageText:t?n.Host.getLocString("WindowsIndexingInProgressMessage"):n.Host.getLocString("WindowsIndexingDisabledMessage"),icon:t?{content:"&#xE895",type:2}:null,messageClassName:"indexingMessage",title:t?n.Host.getLocString("WindowsIndexingInProgressToolTip"):n.Host.getLocString("WindowsIndexingDisabledToolTip"),action:i};this._page.updateTemporaryMessageView(this._launchIndexingDataModel);this._shouldHideWorkUpsell=!0}hideIndexingMessage(){this._turnOnIndexingInstItem=null;this._page.updateTemporaryMessageView(null);this._shouldHideWorkUpsell=!1}shouldShowWorkUpsellMessage(){var t;const i=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkUpsellApplicable();if(i&&!this._shouldHideWorkUpsell)try{const i=JSON.parse(n.LightweightStorage.getItem(o));if(!this.isWorkUpsellExpired(i))return(i===null||i===void 0?void 0:i.clicked)!==e&&((t=this._partialQuery)===null||t===void 0?void 0:t.scope)==n.Scope.All}catch(r){return!1}return!1}isWorkUpsellExpired(t){const i=new Date,u=i.getDate(),r=i.getTime(),f=i.setDate(u+(n.config.msbWorkScopeBannerExpiryInDays||0));if(t&&t.expireDate&&!this.isOldVersion(t.version))return r>t.impressionsExpireDate&&r<t.expireDate&&(t.impressionsExpireDate=i.setDate(u+1),t.impressionsCount=0,this.setWorkUpsellInfo(t)),t.version==1&&t.expireDate>f&&t.clicked!=e&&n.isMsbInternalTenant()&&(t.expireDate=f,this.setWorkUpsellInfo(t)),r>t.expireDate||t.impressionsCount>=li&&r<t.impressionsExpireDate;else{const t={clicked:0,expireDate:f,version:n.config.msbWorkScopeBannerIndicatorVersion,impressionsCount:0,impressionsExpireDate:i.setDate(u+1)};return this.setWorkUpsellInfo(t),!1}}isOldVersion(t){return t?t<n.config.msbWorkScopeBannerIndicatorVersion:!0}setWorkUpsellInfo(t){n.LightweightStorage.setItem(o,JSON.stringify(t))}updateWorkUpsell(t,i){try{if(t){const n=this.createWorkUpsellModel();n&&(this.updateWorkUpsellImpressionsCount(i),this._page.updateWorkUpsellAreaView(n))}else{const i=new Date,r=i.getTime();let t=JSON.parse(n.LightweightStorage.getItem(o));(t===null||t===void 0?void 0:t.clicked)==e||r>(t===null||t===void 0?void 0:t.expireDate)?this._page.removeWorkUpsellAreaView():this._page.updateWorkUpsellAreaView(undefined)}}catch(r){SharedLogHelper.LogError("updateWorkUpsell",r);this._page.updateWorkUpsellAreaView(undefined)}}updateWorkUpsellImpressionsCount(t){try{let i=JSON.parse(n.LightweightStorage.getItem(o));t&&i.impressionsCount<li&&(i.impressionsCount=i.impressionsCount+1,this.setWorkUpsellInfo(i));_w.bfbWsbTel&&bfbWsbTel.logWorkScopeImpression("WsbWorkUpsell")}catch(i){throw new Error("Trying to get Work Upsell information form local storage");}}createWorkUpsellModel(){const t=n.config.useCobaltCSS,i="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",r="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";try{let u=JSON.parse(n.LightweightStorage.getItem(o)),f=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.getStoredMsbTenantName();return{title:n.Host.getLocString("WorkUpsellTitle"),message:n.Host.getLocString("WorkUpsellMessage"),icon:{content:`data:image/png;base64,${t?r:i}`,type:0},buttonMessage:n.Host.getLocString("WorkUpsellButtonMessage"),buttonDismissMessage:n.Host.getLocString("WorkUpsellCobaltDismissButtonMessage"),tooltip:n.Host.getLocString("WorkUpsellButtonTooltip",f),buttonClickHandler:()=>{var t;(t=this._headerFooterViewModel)===null||t===void 0?void 0:t.clickHandler(n.Scope.Work,"WsbWorkUpsell");u.clicked=e;this.setWorkUpsellInfo(u);this._page.updateWorkUpsellAreaView(undefined);_w.bfbWsbTel&&bfbWsbTel.logWorkScopeClick("WsbWorkUpsell")},dismissClickHandler:()=>{u.clicked=e,this.setWorkUpsellInfo(u),this._page.updateWorkUpsellAreaView(undefined),_w.bfbWsbTel&&bfbWsbTel.logWorkScopeClick("WsbWorkUpsellDismiss")}}}catch(u){return undefined}}getAvailableSpace(t){if(n.isL2(this._partialQuery)&&this._partialQuery.queryToFetch)return Number.MAX_VALUE;let i=this._page.getSuggestionsContainerHeight();return(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.enableTopBrandingBar())&&(i-=gt+10),n.config.extraTopPadding&&!n.RuntimeConfig.SearchBoxOnTop&&(i-=n.config.extraTopPadding),n.RuntimeConfig.ScopesAvailable&&(i-=sr),t.topResults.length==0||n.RuntimeConfig.FlatListWithoutGroups||(i-=ir),t.topResults.forEach(t=>i-=yi(t,n.isL2(this._partialQuery))),t.groups.forEach(n=>i-=yu(this._partialQuery,n)),t.groups.some(t=>t.typeWithSource&&n.isTopHitChildGroup(t.typeWithSource))&&t.groups.some(t=>t.typeWithSource&&!n.isTopHitChildGroup(t.typeWithSource))&&(i-=or),i}getAvailableSpaceForZeroInputHomeTopSection(t,i){let r=this._page.getSuggestionsContainerWidth();if(n.shouldShowStaticSearchHome(this._partialQuery)||n.shouldShowDSBLayout(this._partialQuery))return r;r-=n.RuntimeConfig.AlwaysWide?hr:cr;r-=nt;let u=t?t.suggestions.filter(n=>n&&!n.suppressed).length:0;u+=i.suppressed?0:1;let f=n.RuntimeConfig.AlwaysWide?lr:ar;return r-=(f+nt)*u,n.config.useCobaltCSS&&(r+=2*nt),r}canFitSuggestion(t,r,u){if(n.config.enableFullFitSearchTheWebMaxSuggestions&&r.type==n.GroupType.SearchSuggestions&&!this._partialQuery.isSearchHomeZI&&!t&&this.getAvailableSpace(this._resultsCounter)>=43)return u.suppressed&&(u.suppressed=!1),!0;if(u.suppressed||n.getTweakedSetting("scrollBarInL1")||u.handoffType===21&&n.config.msbVerticalChildSuggestionsNoTrim)return!0;let e=vi(this._resultsCounter),f;return t?(f={typeWithSource:r,suggestions:[]},e.groups.push(f)):f=i(e.groups,r),f.suggestions.push({mainTextWrapsToTwoLines:u&&h(u,r.type,!1),isSuppressed:u&&u.suppressed,hasTwoLines:u&&n.contains(u.classNames,"forceNoWrapOutsideTopResult")}),this._partialQuery.isSearchHomeZI?this.canFitSuggestionInZeroInputHome(r,u):this.getAvailableSpace(e)>=0}canFitSuggestionInZeroInputHome(t,r){if(r.type==="SNSC"||t.type===n.GroupType.TrendingSearchData||(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.enableQws())&&(t.type===n.GroupType.QuickWorkSearch||t.type===n.GroupType.RecommendedDocs))return!0;let u=i(this.groups,t);return t.type==n.GroupType.MRUHistory?!0:bi(t.type)?this.getAvailableSpaceForZeroInputHomeTopSection(u,r)>=0:(u?u.suggestions.length:0)<this.getMaxNumberOfRecentItems(t.type)}getCountOfSuggestionsToReduce(){let t=0,i=SearchAppWrapper.CortanaApp.height;(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.enableTopBrandingBar())&&n.isTwoPanesZIEnabled()&&(i-=gt);let f=n.shouldShowStaticSearchHome(this._partialQuery)||n.shouldShowDSBLayout(this._partialQuery),u=i-tt,r=n.canShowSearchHomeUpsell(this._partialQuery)&&f;return f?i<dr?t=r?7:4:i<kr?t=r?6:3:i<br?t=r?5:2:i<tt?t=r?4:1:i>tt&&r&&(u<c/3?t=4:u<c/2?t=3:u<c/1.5?t=2:u<c&&(t=1)):i<wr?t=4:i<pr?t=3:i<yr?t=2:i<vr&&(t=1),t}getMaxNumberOfRecentItems(t){if(t===n.GroupType.MSNNews)return 5;if(t==n.GroupType.MRUHistory||t==n.GroupType.RecommendedDocs||t==n.GroupType.CuratedSuggestions){if(n.shouldShowDSBFullWidth()&&n.config.enableMRUDSBV2)return n.config.MRUMaxItemsDSBV2;let t=n.ScopeConfig[n.Scope.All].enabledDataSourcesForZeroInput,i=t.some(n=>n&&n.suggestionGroupToggler&&n.suggestionGroupToggler.isHidden()),r=n.RuntimeConfig.PreviewPaneAvailable&&n.shouldEnableQuickSearches(n.Host.getLanguage().toLowerCase())&&!i||n.shouldShowStaticSearchHome(this._partialQuery)||n.shouldShowDSBLayout(this._partialQuery);if(r)return n.isL2(this._partialQuery)&&this._partialQuery.scope!==n.Scope.Work?10:this._partialQuery.isSearchHomeZI&&n.msbHost&&!n.msbDsbHost&&n.isMsbEnterprise()&&!n.msbHost.tenantManager.isGccHighTenant()&&n.msbHost.shouldHideTopApp()&&n.msbHost.tenantManager.isTenantMsbEnabled()?6:(n.isMsbEnterprise()&&n.config.enableMRU10&&(n.config.activityInZI=9),n.config.activityInZI-this.getCountOfSuggestionsToReduce())}return n.config.activityInZI}getMaxNumberOfGroupsToFitMinSuggestionsPerGroup(){if(n.isL2(this._partialQuery)&&this._partialQuery.queryToFetch||n.getTweakedSetting("scrollBarInL1"))return Number.MAX_VALUE;if(this._partialQuery.isSearchHomeZI)return n.msbHost&&n.msbHost.enableQwsRecDocs()&&n.msbHost.qwsShowTopList()&&n.isMsbEnterprise()&&!n.msbHost.tenantManager.isGccHighTenant()?(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbSHGroupsLimit)?n.TestHookUrlParameters.msbSHGroupsLimit:5+(n.config.msbQwsDynamicDisableEnabled?2:0)+(n.config.msbEnableDocumentZQ?1:0):5;let t=vi(this._resultsCounter);for(let i of t.groups)while(i.suggestions.length<n.config.minSuggestionsPerGroup)i.suggestions.push(i.suggestions[0]);while(this.getAvailableSpace(t)>0){let i={suggestions:[]};for(let t=0;t<n.config.minSuggestionsPerGroup;++t)i.suggestions.push({mainTextWrapsToTwoLines:!1,isSuppressed:!1,hasTwoLines:!1});t.groups.push(i)}return t.groups.length-1}onSuggestionAddedToGroup(t,r){if(this.updateNarratorWithPreviewMessage(t),n.isChildSuggestion(t)){t.displayed=!0;let i=t.parent;t.id=i.id+"_"+i.childSuggestions.indexOf(t);n.isJumpListSuggestion(t)&&t.tooltip===undefined&&n.Async.safeChain("getJumpListDescription",()=>t.jumpListItem.getDescriptionAsync(),i=>{t.tooltip=i,this.groups.some(i=>n.contains(i.suggestions,t))&&this.renderGroups()})}this.setRemoveIcon(t);let u=i(this._resultsCounter.groups,r.typeWithSource);u.suggestions.push({mainTextWrapsToTwoLines:h(t,r.typeWithSource.type,!1),isSuppressed:t.suppressed,hasTwoLines:n.contains(t.classNames,"forceNoWrapOutsideTopResult")});n.displayedInGridLayout(r.typeWithSource.type)&&r.suggestions.filter(n=>!n.suppressed).length>0&&(r.cssClasses+=n.isL2(this._partialQuery)?" gridLayout":" gridLayout gridLayoutMedium")}onGroupsCleared(){this._pendingSuggestionsInExistingGroups=[];this._pendingSuggestionsInMissingGroups=[];this._resultsCounter.groups=[];this._turnOnIndexingInstItem&&n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(this._lastUpdatedSequenceNumber,"IMIO",this._turnOnIndexingInstItem)}dismissTour(t){let i={query:t.queryToFetch};n.LightweightStorage.setItem("wweTourTook","1");n.LightweightStorage.setItem("wweTourRefreshed","1");n.LightweightStorage.removeItem("wweTourEnabled");n.StaticHtmlElements.root.classList.remove("overlayEnabled");n.setZeroInputDataSourcesForL1();n.Host.refreshCurrentPane();n.LightweightStorage.removeItem("wweTourRefreshed");n.InstrumentationHelper.logClientInstEvent("Select","WWETourDismiss",null,i)}launchSearch(t,i){let r=t.queryToFetch;n.config.enableMoreEdgeProtocol?n.Host.launchSearch(r,this._navigationHelper.getSearchUrl(t.fullPartialQuery,r,i),!1,i):n.Host.launchSearch(r,this._navigationHelper.getSearchUrl(t.fullPartialQuery,r,i),!1)}setRemoveIcon(t){let i=t.getExtraVerbs&&t.getExtraVerbs(!1).some(n=>n.verb=="RemoveFromDeviceHistory"),f=t.type=="HS"&&n.config.removeSuggUrl,e=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.forceRemoveIcon,r=t.getExtraVerbs&&t.getExtraVerbs(!1).some(n=>n.verb=="RemoveFromDeviceHistoryAll"),u=this._partialQuery.isSearchHomeZI&&t.type=="ANAH";if(e||i||f||r||u){let f="RemoveFromWebHistory";r?f="RemoveFromDeviceHistoryAll":(i||u)&&(f="RemoveFromDeviceHistory");t.removeIcon={icon:{content:"&#xE711",type:2},title:n.Host.getLocString(f),selected:!1,click:(i,r)=>{this._page.hideTemporaryMessage(),n.InstrumentationHelper.instrumentItemClickForContextMenu(i,t.instItem,t.sequenceNumber,t.instrumentPingBack,r,null,f),this.launchVerb(t,f,i),n.Host.setFocusInSearchBox(null,"remove")}}}}updateNarratorWithPreviewMessage(t){let r=n.RuntimeConfig.AlwaysWide?"PreviewPaneButtonNarratorMessageWidePane":"PreviewPaneButtonNarratorMessage",i=n.Host.getLocString(r);t.narratorText&&t.previewPaneType&&t.narratorText.indexOf(i)==-1&&(t.narratorText+=", "+i)}shouldShowMessageBanner(){var t;return n.config.enableMessageBanner&&((t=this._partialQuery)===null||t===void 0?void 0:t.scope)==n.Scope.All&&SearchAppWrapper.CortanaApp.isUserOnboarded()}buildMessageBannerModel(){if(!this.shouldShowMessageBanner())return null;let t=SearchAppWrapper.CortanaApp.getSearchAppLaunchCount();if(t>=a)return null;return{message:n.Host.getLocString("ReclaimSBMessage"),buttonKeepMessage:n.Host.getLocString("ReclaimSBKeepButtonMessage"),buttonUndoMessage:n.Host.getLocString("ReclaimSBUndoButtonMessage"),buttonKeepClickHandler:(t,i,r)=>{SearchAppWrapper.CortanaApp.setSearchAppLaunchCount(a),this.sendTelemetryForClick("RSBK",t,i,r,"SearchboxKeep"),n.Host.refreshCurrentPane()},buttonUndoClickHandler:(n,i,r)=>{let u=SearchAppWrapper.CortanaApp.revertToPreviousSearchBoxMode();u?SearchAppWrapper.CortanaApp.setSearchAppLaunchCount(a):SearchAppWrapper.CortanaApp.setSearchAppLaunchCount(t==0?0:t-1);this.sendTelemetryForClick("RSBU",n,i,r,"SearchboxUndo");SearchAppWrapper.CortanaApp.dismissApp()},dismissClickHandler:(t,i,r)=>{SearchAppWrapper.CortanaApp.setSearchAppLaunchCount(a),this.sendTelemetryForClick("RSBD",t,i,r,"SearchboxDismiss"),n.Host.refreshCurrentPane()}}}sendTelemetryForClick(t,i,r,u,f){const o=n.SequenceNumberManager.getSequenceNumber();let e=n.InstrumentedItem.getNonSuggestionInstrumentedItem(t,n.SyntheticQSCodesMaps.KValues,n.SyntheticQSCodesMaps.HandoffsForNonSuggestions[t]);e=n.InstrumentationHelper.updateMessageBannerClickItemProps(e,f);n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(o,t,e);n.InstrumentationHelper.instrumentItemClick(i,e,o,null,r,u)}onBeforeRenderTopResults(t,i,r,u,f){var o;this.topResults.forEach(n=>{this.setRemoveIcon(n),this.updateNarratorWithPreviewMessage(n)});let s=1;this.topResults.length!=1||this.topResults[0].hasChildSuggestionsDisplayed||r.some(t=>n.isChildSuggestion(t))&&(((o=this._partialQuery)===null||o===void 0?void 0:o.scope)!==n.Scope.Work&&(this.topResults[0].hasChildSuggestionsDisplayed=!0),s=0);let h=!1,c=this.getSelectableItems();if(n.RuntimeConfig.FirstSuggestionSelectedByDefault){if(!this._selectedItem||!n.contains(c,this._selectedItem)||this.isScopeElement(this._selectedItem)||this._selectedItem==i[0]&&this.topResults[0]!=i[0]||this._selectedItem!=c[0]||this._selectedItem.previewPaneNeedsRefreshAfterDeduping){let t=this._partialQuery.queryToFetch&&this.topResults.length>0?this.topResults[0]:null;const i=this._selectedItem&&this.isSuggestion(this._selectedItem)?this._selectedItem:null;if(n.config.synthWebNoBestMatch&&n.isNullOrUndefined(t)){let i=[n.GroupType.SearchSuggestions,n.GroupType.Websites],u=r.filter(t=>!n.contains(i,n.getGroupType(t)));u.length==0&&(t=r.length>0?r[0]:null)}this._previewPane&&n.RuntimeConfig.PreviewPaneAvailable&&(h=!1,n.safeExecute(()=>this._previewPane.onTopHitUpdated(this._partialQuery,i,t,this.getSuggestions(!1)),"ppOnTopHitUpdated"));this.select(t,!1);this._page.scrollToTop()}}else t&&this.select(null,!1);let l=this.topResults.length>0,e=t=>!t.suppressed&&t.staticGroupType!=n.GroupType.VisualSearch,a=r&&r.length>0;if(this._headerFooterViewModel&&!h){let n=l||r.some(e)||this.groups.some(n=>n.suggestions.some(e))||this._pendingSuggestionsInMissingGroups.some(n=>n.suggestions.some(e))||this._pendingSuggestionsInExistingGroups.some(n=>n.suggestions.some(e));this._headerFooterViewModel.render(this._partialQuery,l,n,u,f,a)}return s}isRankable(t){return n.config.enableAnaheimRelevance==2?t.typeWithSource.type!=n.GroupType.Websites&&t.typeWithSource.type!=n.GroupType.LocalPlaces&&!t.suggestions.some(n.enforceOriginalOrder):t.typeWithSource.type!=n.GroupType.SearchSuggestions&&t.typeWithSource.type!=n.GroupType.Websites&&t.typeWithSource.type!=n.GroupType.LocalPlaces&&!t.suggestions.some(n.enforceOriginalOrder)}isNotRankableWithRecourse(t){return t.typeWithSource.type==n.GroupType.Emails}openPreviewPane(t,i){i.stopPropagation();this._previewPane.showPreview(this._partialQuery,t);const r=n.getGroupType(t);if((n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isWorkMruEnabled())&&n.isWorkScopeMruGroupType(t)||r==n.GroupType.SearchSuggestions||n.isChildSuggestion(t))this.onSuggestionLaunch(t,this._partialQuery);this.select(t,!0);n.config.reactGroups&&this.selectGroupItem(t);n.Host.setFocusInSearchBox(null,"openPreviewPane")}mayNeedFlush(){return!n.RuntimeConfig.FlatListWithoutGroups}update(t,i,r,u,f,e,o,s,c,l){var p;let w=this.topResults;if(t&&(this._contentQuery=this._partialQuery,this._renderTopResultsTimerForIcons=null,this._renderGroupsTimerForIcons=null),n.config.enableMRUHint)for(let t of i)t.mruHintEnabled&&(t.uxHint=n.Host.getLocString("MruBestMatch"));let[b,tt]=this.updateTopResults(t,i,r,u,f,c);tt();this._resultsCounter.topResults=[];for(let t of this.topResults){t.previewPaneNeedsRefreshAfterDeduping=!1;let i=1+(t.primaryMetadata?1:0)+(t.secondaryMetadata?1:0);this._resultsCounter.topResults.push({mainTextWrapsToTwoLines:h(t,null,!0),numberOfLines:i,isHtmlAnswer:!!t.htmlContent,isSuppressed:!1,grid:n.displayedInGridLayout(t.type)})}if(this._autoComplete&&this.topResults.length>0&&this._selectedItem==this.topResults[0]&&this._autoComplete.apply(this.topResults[0]),this.handlePendingSubmit(f)==0)return this.toggleProgressBar(!0),0;this._partialQuery&&this._partialQuery.isSearchHomeZI&&this.toggleProgressBar(!c);let k=!1,v=0,it=this.createIconRenderInfo(),g=()=>{if(k){let t=this.groups.map(n=>n.typeWithSource.type);if(!this._contentQuery.queryToFetch&&v==0){let t=this._cvidAtLastRender!=n.Host.getConversationId();this._cvidAtLastRender=n.Host.getConversationId();n.InstrumentationHelper.instrumentZiRendered(u,t)}n.InstrumentationHelper.instrumentRenderFinished(u,o,t,v!=0,!this._contentQuery.queryToFetch)}},d=(t,i)=>{var r,f;let e=!1;if(this.isRankable(i)&&this._partialQuery&&this._partialQuery.queryToFetch)for(let n=0;n<i.suggestions.length;n++)if(t.rankingScore>i.suggestions[n].rankingScore){i.suggestions.splice(n,0,t);e=!0;break}if(!e){const u=((r=this._partialQuery)===null||r===void 0?void 0:r.scope)===n.Scope.Work,e=!t.childSuggestions&&t.handoffType===21;u&&!((f=this._partialQuery)===null||f===void 0?void 0:f.isWorkScopeZI)&&!e&&i.suggestions.length>=n.config.msbWorkScopeGroupSuggestionLimit&&(t.suppressed=!0);i.suggestions.push(t)}++v;this.setupIcon(u,t,it,()=>{--v,g()});this.onSuggestionAddedToGroup(t,i)},a=this.getMaxNumberOfGroupsToFitMinSuggestionsPerGroup()-this.groups.length,y=!1,nt=()=>{if(a!=0&&r||this.flush(d,u,s),this.groups.sort((t,i)=>s.findIndex(i=>n.sameGroup(i,t.typeWithSource))-s.findIndex(t=>n.sameGroup(t,i.typeWithSource))),this._partialQuery&&this._partialQuery.queryToFetch)for(let n of this.groups){if(this.isRankable(n))n.suggestions.sort((n,t)=>t.rankingScore-n.rankingScore);else if(this.isNotRankableWithRecourse(n)){let t=n.suggestions.map(n=>n.notAResult).findIndex(n=>n);t!=-1&&n.suggestions.splice(n.suggestions.length-1,0,n.suggestions.splice(t,1)[0])}this.populateGroupHeaderFlags(n)}};if(t||f.length>0||e.length>0){this.renderGroupsAfter(()=>{for(let n of e){let t=this.removeSuggestion(n,l);t&&(a+=1)}let i=(t,i)=>{let[f,r]=this.getGroupData(t);if((n.cohortProfileManager===null||n.cohortProfileManager===void 0?void 0:n.cohortProfileManager.isTourVisible())&&(t.click=undefined,t.tooltip=undefined),r){r.count&&r.count++;const u=n.config.minSuggestionsPerGroup&&!i?n.config.minSuggestionsPerGroup-r.suggestions.length:999;u>0&&this.canFitSuggestion(!1,f,t)?d(t,r):this._partialQuery.isSearchHomeZI||this.queueSuggestionInExistingGroup(t,r)}else a>0&&this.canFitSuggestion(!0,f,t)?(r=this.addGroup(f,t,u,s,l),this.shouldTrackGroupCount(r)&&(r.count=1),d(t,r),a-=1):this._partialQuery.isSearchHomeZI||this.queueSuggestionInMissingGroup(t,f,l)};for(let n of w){let[,t]=this.getGroupData(n);t&&t.count&&(t.count-=1)}const r=()=>this._contentQuery.isSearchHomeZI||n.getTweakedSetting("scrollBarInL1")||this.isWorkScope()||n.config.bypassSuggestionQueueForL2&&n.isL2(this._contentQuery);if(b&&!t){for(let t of f)n.contains(w,t)&&i(t,!0);for(let t of f)n.contains(w,t)||i(t,r())}else f.forEach(n=>i(n,r()));for(let n of this.topResults){let[,t]=this.getGroupData(n);t&&t.count&&(t.count+=1)}nt()});const r=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isMsbWorkUpsellApplicable();let i=!1;if(r&&this._partialQuery.queryToFetch&&(i=this.shouldShowWorkUpsellMessage(),this.updateWorkUpsell(i,this._isWorkUpsellShown!=i)),this._isWorkUpsellShown=i,this.isWorkScope()&&((p=this.groups)===null||p===void 0?void 0:p.length)>1&&!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.tenantManager.isWorkScopeListViewEnabled())){const t=this.groups.findIndex(t=>t.type===n.GroupType.Related);t>-1&&(this.groups[t].maxSuggestionsToShow=gr)}y=!0;k=!0}else a!=0&&r||(this._pendingSuggestionsInMissingGroups.some(n=>n.suggestions.length>0)||this._pendingSuggestionsInExistingGroups.some(n=>n.suggestions.length>0))&&(this.renderGroupsAfter(()=>nt()),y=!0,k=!0);if(b||y){let n;b?y||(n=!0):n=!1;this.resetIconTimers(n,!0)}let rt=this.groups.findIndex(t=>t.type==n.GroupType.MRUHistory);if(rt>-1){let t=this.groups.findIndex(t=>t.type==n.GroupType.CuratedSuggestions);t>-1&&this.groups.splice(t,1)}return g(),c&&this.toggleProgressBar(!1),(n.config.mruSearchHome&&this._partialQuery.isSearchHomeZI&&this._partialQuery.scope==n.Scope.All||n.canShowWorkScopeZiPageContent()&&this._partialQuery.isWorkScopeZI)&&this.sortMRUList(),1}sortMRUList(){let t=this.groups.filter(t=>t.type==n.GroupType.MRUHistory),i=this.groups.filter(t=>t.type!=n.GroupType.MRUHistory);const r=this.getMaxNumberOfRecentItems(n.GroupType.MRUHistory);if(t.length>0){n.LightweightStorage.removeItem(si);let u=t[0];u.suggestions.sort((n,t)=>t.lastLaunchTime-n.lastLaunchTime);u.suggestions.length>r&&(u.suggestions=u.suggestions.splice(0,r));let f=-1;this.groups.forEach((t,i)=>{f=t.type==n.GroupType.MRUHistory?i:f});i.splice(f,0,u);this.groups=i;this.renderGroups()}else n.LightweightStorage.setItem(si,"1")}canGoToL2(n){return n.click&&!n.instItem}populateGroupHeaderFlags(t){if(this.isWorkScope()&&t.type!=n.GroupType.WorkSuggestions&&t.suggestions.length>n.config.msbWorkScopeGroupSuggestionLimit&&n.config.msbWorkScopeTenantGroupTitle)t.showCountInHeader=!0,t.count=t.suggestions.length;else if(this.canGoToL2(t)){let n=t.suggestions.every(n=>n.suppressed);t.showCountInHeader=n}}shouldTrackGroupCount(n){return this.canGoToL2(n)}getGroupData(t){let r={type:n.getGroupType(t),source:t.sourceForGroup};return n.enableMRUSearchHome()&&r.type==n.GroupType.MRUHistory&&(r.source=undefined),[r,i(this.groups,r)]}removePendingSuggestionFromExistingGroup(n,t){for(let i=0;i<this._pendingSuggestionsInExistingGroups.length;++i){let r=this._pendingSuggestionsInExistingGroups[i];if(r.group==t){let t=r.suggestions.indexOf(n);if(t==-1)throw new Error("Pending suggestion not found in existing group");else{r.suggestions.splice(t,1);r.suggestions.length==0&&this._pendingSuggestionsInExistingGroups.splice(i,1);return}}}throw new Error("Pending suggestion not found: pending suggestions in existing groups is empty");}removePendingSuggestionFromMissingGroup(t,i){for(let r=0;r<this._pendingSuggestionsInMissingGroups.length;++r){let u=this._pendingSuggestionsInMissingGroups[r];if(n.sameGroup(u.typeWithSource,i)){let n=u.suggestions.indexOf(t);if(n==-1)throw new Error("Pending suggestion not found in missing group");else{u.suggestions.splice(n,1);u.suggestions.length==0&&this._pendingSuggestionsInMissingGroups.splice(r,1);return}}}throw new Error("Pending suggestion not found: pending suggestions in missing groups is empty");}queueSuggestionInExistingGroup(n,t){let i=pi(this._pendingSuggestionsInExistingGroups,t.typeWithSource);i?i.suggestions.push(n):(i={group:t,suggestions:[n]},this._pendingSuggestionsInExistingGroups.push(i))}queueSuggestionInMissingGroup(n,t,r){let u=i(this._pendingSuggestionsInMissingGroups,t);u?u.suggestions.push(n):(u={typeWithSource:t,suggestions:[n],extraSignalsMap:r},this._pendingSuggestionsInMissingGroups.push(u))}partialFlush(n,t,i,r){while(n>0&&i.length>0){let u=i[0];this.canFitSuggestion(!1,t.typeWithSource,u)&&r(u,t);i.splice(0,1);n-=1}}flush(t,i,r){for(let u of this._pendingSuggestionsInMissingGroups){let f=u.suggestions[0];if(f&&this.canFitSuggestion(!0,u.typeWithSource,f)){let e=this.addGroup(u.typeWithSource,f,i,r,u.extraSignalsMap);this.shouldTrackGroupCount(e)&&(e.count=u.suggestions.length);this.partialFlush(n.config.minSuggestionsPerGroup,e,u.suggestions,t);u.suggestions.forEach(n=>this.queueSuggestionInExistingGroup(n,e));u.suggestions=[]}}while(this._pendingSuggestionsInExistingGroups.some(n=>n.suggestions.length>0))for(let i of this._pendingSuggestionsInExistingGroups){let r=n.config.minSuggestionsPerGroup?1:i.suggestions.length;this.partialFlush(r,i.group,i.suggestions,t)}}removeSuggestion(t,r){let f={type:n.getGroupType(t),source:t.sourceForGroup},u=i(this.groups,f);if(u)if(n.tryRemove(u.suggestions,t)){let f=i(this._resultsCounter.groups,u.typeWithSource),e=h(t,u.typeWithSource.type,!1);if(n.removeFirstWhere(f.suggestions,n=>n.mainTextWrapsToTwoLines==e),n.displayedInGridLayout(u.typeWithSource.type)&&u.suggestions.filter(n=>!n.suppressed).length==0&&(u.cssClasses=""),u.suggestions.length==0){n.tryRemove(this.groups,u);this._resultsCounter.groups=this._resultsCounter.groups.filter(n=>n!=f);let t=pi(this._pendingSuggestionsInExistingGroups,u.typeWithSource);return t&&this._pendingSuggestionsInMissingGroups.push({typeWithSource:u.typeWithSource,suggestions:t.suggestions,extraSignalsMap:r}),!0}}else this.removePendingSuggestionFromExistingGroup(t,u);else this.removePendingSuggestionFromMissingGroup(t,f);return!1}isScopeElement(n){return this._headerFooterViewModel&&this._headerFooterViewModel.isScopeElement(n)}createIconRenderInfo(n){let t={iconsPendingReturn:0,isTopResult:n};return this._iconRenderInfos.push(t),t}getCurrentTopResults(){return this.topResults.slice(0)}getTopResultsWhichFitInCanvas(n){return n}resetAriaSelected(n){n&&this._page.render(()=>{let t=_ge(n.id);t&&(t.setAttribute("aria-selected","false"),t.setAttribute("aria-selected","true"))})}updateTopResults(t,i,r,u,f,e){t!=(u!=this._lastUpdatedSequenceNumber)&&SharedLogHelper.LogError("updateTopResult",t+" != (sequenceNumber "+u+" != lastUpdateSequenceNumber "+this._lastUpdatedSequenceNumber+")",new Error("Precondition failed"));this._lastUpdatedSequenceNumber=u;t&&(this.groups=[],this.onGroupsCleared());let a=this._selectedItem,o=this.topResults;i=this.getTopResultsWhichFitInCanvas(i);i.forEach(t=>{n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9||t.staticGroupType&&t.staticGroupType==n.GroupType.Upsell||!t.secondaryMetadata||t.secondaryMetadata.indexOf(n.Host.getLocString("LastModified")+": ")!==0||(t.template=1,t.narratorText=n.getNarratorText(t))});let s=!n.sequenceEqual(i,o)||o.some(n=>n.needsRefreshAfterDeduping);s&&(this.topResults=i.slice(0));let h=!1,c=s?i.length:0,v=this.createIconRenderInfo(!0),l=()=>{h&&(n.config.enableLocalInstrumentation&&n.InstrumentationHelper.instrumentRenderedLocalSuggestion(u,i),n.InstrumentationHelper.instrumentTopResultRendered(u,i.map(n=>n.type),c!=0))};if(s)this.renderTopResultsAfter(()=>{for(let t of this.topResults)t.needsRefreshAfterDeduping=!1,n.contains(o,t)?c-=1:this.setupIcon(u,t,v,()=>{c-=1,l()});this.onBeforeRenderTopResults(t,o,f,r,e)}),this._page.updateMessageBannerAreaView(this.buildMessageBannerModel()),h=!0;else{let n=this.onBeforeRenderTopResults(t,o,f,r,e);n==0&&(this.renderTopResults(),h=!0)}return this._selectedItem&&(a!=this._selectedItem||t)&&n.contains(this.topResults,this._selectedItem)&&this.resetAriaSelected(this._selectedItem),[s,l]}renderGroupsAfter(n){let t=this._groupRenderingDisabled;this._groupRenderingDisabled=!0;try{n()}finally{this._groupRenderingDisabled=t;this.renderGroups()}}renderTopResults(t){this._topResultsRenderingDisabled||(this._page.updateTopResultsView({query:this._contentQuery,topResults:this.topResults,groups:this.groups},t),n.InstrumentationHelper.updateSuggestionsList(this.topResults,this.groups))}renderTopResultsAfter(n){let t=this._topResultsRenderingDisabled;this._topResultsRenderingDisabled=!0;try{n()}finally{this._topResultsRenderingDisabled=t;this.renderTopResults();for(let n of this.topResults)n.executeScript&&n.executeScript()}}}n.RootViewModel=gi})(WSB||(WSB={}))