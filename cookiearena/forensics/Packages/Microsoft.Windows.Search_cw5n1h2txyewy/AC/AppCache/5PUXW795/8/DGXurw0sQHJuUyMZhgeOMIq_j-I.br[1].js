var WSB;(function(n){const i="AnaheimResetDefaultUpsell",r="AnaheimResetDefaultUpsellDismissed",u="AnaheimResetDefaultResultUpsellFail",f="AnaheimResetDefaultResultUpsellSuccess",e="CodexUpsellDismissed",o="CodexUpsellLaunched",t=864e5;class s{constructor(t){this._page=t;n.config.forceEdgeUpsell&&(n.LightweightStorage.removeItem(r),n.LightweightStorage.removeItem(e),n.LightweightStorage.removeItem(o));n.Host.bindShown(()=>{this.checkCanShowUpsell()});this._uriLaunches=0}checkCanShowUpsell(){if(n.config.enableMessageBanner){let t=SearchAppWrapper.CortanaApp.getSearchAppLaunchCount();if(t<4){n.canShowUpsell=!1;return}}let t=this.updateEdgeBarUpsellState();n.isConsumerWindowsSKU()&&!n.isMsbEnterprise()?(n.shouldEnableCodexUpsell()&&n.LightweightStorage.getItem(e)!="1"&&n.LightweightStorage.getItem(o)!="1"?(this._currentUpsell=3,n.canShowUpsell=!0):n.shouldEnableAnaheimResetDefault()&&(n.LightweightStorage.getItem(r)=="1"||this._uriLaunches>2?n.canShowUpsell=!1:n.LightweightStorage.getItem(i)?(n.canShowUpsell=!0,n.LightweightStorage.setItem("EdgeBarUpsellDate",Date.now().toString()),this._currentUpsell=1):n.config.forceEdgeUpsell||n.Host.getDefaultBrowser()!=4&&n.Host.getDefaultBrowser()!=0?(n.canShowUpsell=!0,this._currentUpsell=0):n.canShowUpsell=!1),n.canShowUpsell||t!=1&&t!=3||(this._currentUpsell=2,n.canShowUpsell=!0)):n.canShowUpsell=!1}updateEdgeBarUpsellState(){if(!n.config.showEdgeBarUpsell||!n.isConsumerWindowsSKU())return 4;let i=+n.LightweightStorage.getItem("EdgeBarUpsellState"),r=+n.LightweightStorage.getItem("EdgeBarUpsellDate");switch(i){case 0:(r==0||Date.now()-r>t)&&(i++,n.LightweightStorage.setItem("EdgeBarUpsellDate",Date.now().toString()));break;case 1:Date.now()-r>3*t&&i++;break;case 2:Date.now()-r>7*t&&i++;n.LightweightStorage.setItem("EdgeBarUpsellDate",Date.now().toString());break;case 3:Date.now()-r>3*t&&i++}return n.LightweightStorage.setItem("EdgeBarUpsellState",i.toString()),i}getUpsellSyntheticSuggestion(t,i){return t&&(n.RuntimeConfig.QfMode===1||n.RuntimeConfig.QfMode===0)&&n.canShowSearchHomeUpsell(t)?this.createSHUpsellSuggestion(t,i):null}createSyntheticSuggestion(t,r){let e;if(this._currentUpsell==3)e=n.getSyntheticSuggestion(t,r,"COD",{type:0,className:"codexIcon"},0,null,!1,this.getCodexUpsellAction()),e.staticGroupType=n.GroupType.Upsell,e.template=3,e.text=n.Host.getLocString(n.config.codexUpsellTitleKey),e.additionalInfoText=n.Host.getLocString(n.config.codexUpsellCaptionKey),e.additionalCalloutText=n.Host.getLocString(n.config.codexUpsellButtonKey),e.tooltip=n.Host.getLocString(n.config.codexUpsellTitleKey),e.narratorText=n.Host.getLocString(n.config.codexUpsellTitleKey)+n.Host.getLocString(n.config.codexUpsellButtonKey),e.classNames=["upsellSugg","codexUpsellSuggestion"];else if(this._currentUpsell==0)n.LightweightStorage.removeItem(f),n.LightweightStorage.removeItem(u),e=n.getSyntheticSuggestion(t,r,"EUP",{type:2,content:"&#xE713"},2,null,!1,this.getAnaheimSetDefaultAction()),e.staticGroupType=n.GroupType.Upsell,e.template=3,e.text=n.Host.getLocString(n.config.anaheimResetDefaultTitleString),e.additionalInfoText=n.Host.getLocString(n.config.anaheimResetDefaultDescString),e.additionalCalloutText=n.Host.getLocString("EdgeUpsellResetDefaultButton"),e.tooltip=n.Host.getLocString("AnaheimResetDefaultTooltip"),e.narratorText=n.Host.getLocString(n.config.anaheimResetDefaultTitleString)+n.Host.getLocString("EdgeUpsellResetDefaultButton"),e.classNames=["upsellSugg"];else if(this._currentUpsell==1)if(n.Host.getDefaultBrowser()!=4||n.LightweightStorage.getItem(f)){if(!n.LightweightStorage.getItem(u)){let i=n.InstrumentedItem.getNonSuggestionInstrumentedItem("EDUR",n.SyntheticQSCodesMaps.KValues),t=n.Host.getLocString("EdgeUpsellResetDefaultButtonFail"),f={id:"anaheimResetDefaultFailBtn",selected:!1,text:t,title:t,instItem:i,click:this.getAnaheimSetDefaultAction(),layout:0,isSelectable:!0};this._page.showTemporaryMessage(n.Host.getLocString("AnaheimResetDefaultFail"),{type:0,className:"resetDefaultResultErrorIcon"},"messageActionBtn",f);n.LightweightStorage.setItem(u,"1");n.InstrumentationHelper.logClientInstEvent("Select","EdgeUpsellResetDefaultResultError",r,{currentBrowser:n.Host.getDefaultBrowser().toString()})}}else{n.LightweightStorage.removeItem(i);let t=n.Host.getWindowsTheme()==2?"resetDefaultResultSuccessDarkIcon":"resetDefaultResultSuccessIcon";this._page.showTemporaryMessage(n.Host.getLocString("AnaheimResetDefaultSuccess"),{type:0,className:t});n.LightweightStorage.setItem(f,"1");n.InstrumentationHelper.logClientInstEvent("Select","EdgeUpsellResetDefaultResultSuccess",r)}else this._currentUpsell==2&&(e=n.getSyntheticSuggestion(t,r,"EDBU",{type:0,className:"EdgeBarIcon"},2,null,!1,this.getEdgeBarAction()),e.staticGroupType=n.GroupType.Upsell,e.template=3,e.text=n.Host.getLocString("EdgeBarUpsellTitle"),e.additionalInfoText=n.Host.getLocString("EdgeBarUpsellText"),e.additionalCalloutText=n.Host.getLocString("EdgeBarUpsellCTA"),e.tooltip=n.Host.getLocString("EdgeBarUpsellTitle"),e.narratorText=n.Host.getLocString("EdgeBarUpsellTitle")+n.Host.getLocString("EdgeBarUpsellCTA"),e.classNames=["upsellSugg"]);return e}getEdgeBarAction(){return()=>{n.LightweightStorage.setItem("EdgeBarUpsellState",4..toString()),this._uriLaunches++,n.InstrumentationHelper.logClientInstEvent("Select","EdgeBarUpsellClick",n.SequenceNumberManager.getSequenceNumber(),{currentBrowser:n.Host.getDefaultBrowser().toString(),uriLaunches:this._uriLaunches.toString()}),n.Host.launchUri("microsoft-edge:?ux=webwidget&wwl=1&wws=1&campaign=WSBWWU&url=https://ntp.msn.com/web-widget?form=M@000P&OCID=M@000P",!1)}}getAnaheimSetDefaultAction(){return()=>{n.LightweightStorage.setItem(i,n.getCurrentTime().toString());this._uriLaunches++;const t=n.config.anaheimUpsellDefaultLaunchURI.replace("{0}",n.config.anaheimResetDefaultURIFormCode);n.InstrumentationHelper.logClientInstEvent("Select","EdgeUpsellResetDefaultCall",n.SequenceNumberManager.getSequenceNumber(),{currentBrowser:n.Host.getDefaultBrowser().toString(),uriLaunches:this._uriLaunches.toString()});n.Host.launchUri(t,!1)}}getCodexUpsellAction(){return()=>{n.LightweightStorage.setItem(o,"1"),n.InstrumentationHelper.logClientInstEvent("Select","CodexUpsellLaunch",n.SequenceNumberManager.getSequenceNumber()),n.config.codexUpsellLaunchURI&&n.Host.launchCodexUri(n.config.codexUpsellLaunchURI,{medium:"CodexUpsell"},!1)}}createSHUpsellSuggestion(n,t){return this.createSyntheticSuggestion(n,t)}getDismissButtonAction(){return this._currentUpsell==3?()=>{n.canShowUpsell=!1,n.LightweightStorage.setItem(e,"1"),n.Host.refreshCurrentPane(),n.InstrumentationHelper.logClientInstEvent("Select","CodexUpsellDismissed",null)}:this._currentUpsell==0?()=>{n.canShowUpsell=!1,n.LightweightStorage.setItem(r,"1"),n.Host.refreshCurrentPane(),n.InstrumentationHelper.logClientInstEvent("Select","EdgeUpsellResetResultDismiss",null)}:this._currentUpsell==2?()=>{n.canShowUpsell=!1;n.LightweightStorage.setItem("EdgeBarUpsellDate",Date.now().toString());let t=+n.LightweightStorage.getItem("EdgeBarUpsellState");t==1?n.LightweightStorage.setItem("EdgeBarUpsellState",2..toString()):n.LightweightStorage.setItem("EdgeBarUpsellState",4..toString());n.Host.refreshCurrentPane();n.InstrumentationHelper.logClientInstEvent("Select","EdgeBarUpsellDismiss",null)}:()=>{n.canShowUpsell=!1}}}n.UpsellViewModel=s})(WSB||(WSB={}))